{"version":3,"sources":["index.js"],"names":["_vm","data","require","_fakeTimers","_jestMock","_jestUtil","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","NodeEnvironment","config","context","createContext","global","runInContext","testEnvironmentOptions","clearInterval","clearTimeout","setInterval","setTimeout","Buffer","setImmediate","clearImmediate","ArrayBuffer","Uint8Array","URL","URLSearchParams","TextEncoder","TextDecoder","queueMicrotask","AbortController","AbortSignal","Event","EventTarget","performance","atob","btoa","installCommonGlobals","globals","moduleMocker","ModuleMocker","timerIdToRef","id","ref","unref","timerRefToId","timer","undefined","timerConfig","idToRef","refToId","fakeTimers","LegacyFakeTimers","fakeTimersModern","ModernFakeTimers","dispose","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nfunction _vm() {\n  const data = require('vm');\n\n  _vm = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _fakeTimers() {\n  const data = require('@jest/fake-timers');\n\n  _fakeTimers = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _jestMock() {\n  const data = require('jest-mock');\n\n  _jestMock = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _jestUtil() {\n  const data = require('jest-util');\n\n  _jestUtil = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nclass NodeEnvironment {\n  constructor(config) {\n    _defineProperty(this, 'context', void 0);\n\n    _defineProperty(this, 'fakeTimers', void 0);\n\n    _defineProperty(this, 'fakeTimersModern', void 0);\n\n    _defineProperty(this, 'global', void 0);\n\n    _defineProperty(this, 'moduleMocker', void 0);\n\n    this.context = (0, _vm().createContext)();\n    const global = (this.global = (0, _vm().runInContext)(\n      'this',\n      Object.assign(this.context, config.testEnvironmentOptions)\n    ));\n    global.global = global;\n    global.clearInterval = clearInterval;\n    global.clearTimeout = clearTimeout;\n    global.setInterval = setInterval;\n    global.setTimeout = setTimeout;\n    global.Buffer = Buffer;\n    global.setImmediate = setImmediate;\n    global.clearImmediate = clearImmediate;\n    global.ArrayBuffer = ArrayBuffer; // TextEncoder (global or via 'util') references a Uint8Array constructor\n    // different than the global one used by users in tests. This makes sure the\n    // same constructor is referenced by both.\n\n    global.Uint8Array = Uint8Array; // URL and URLSearchParams are global in Node >= 10\n\n    if (typeof URL !== 'undefined' && typeof URLSearchParams !== 'undefined') {\n      global.URL = URL;\n      global.URLSearchParams = URLSearchParams;\n    } // TextDecoder and TextDecoder are global in Node >= 11\n\n    if (\n      typeof TextEncoder !== 'undefined' &&\n      typeof TextDecoder !== 'undefined'\n    ) {\n      global.TextEncoder = TextEncoder;\n      global.TextDecoder = TextDecoder;\n    } // queueMicrotask is global in Node >= 11\n\n    if (typeof queueMicrotask !== 'undefined') {\n      global.queueMicrotask = queueMicrotask;\n    } // AbortController is global in Node >= 15\n\n    if (typeof AbortController !== 'undefined') {\n      global.AbortController = AbortController;\n    } // AbortSignal is global in Node >= 15\n\n    if (typeof AbortSignal !== 'undefined') {\n      global.AbortSignal = AbortSignal;\n    } // Event is global in Node >= 15.4\n\n    if (typeof Event !== 'undefined') {\n      global.Event = Event;\n    } // EventTarget is global in Node >= 15.4\n\n    if (typeof EventTarget !== 'undefined') {\n      global.EventTarget = EventTarget;\n    } // performance is global in Node >= 16\n\n    if (typeof performance !== 'undefined') {\n      global.performance = performance;\n    } // atob and btoa are global in Node >= 16\n\n    if (typeof atob !== 'undefined' && typeof btoa !== 'undefined') {\n      global.atob = atob;\n      global.btoa = btoa;\n    }\n\n    (0, _jestUtil().installCommonGlobals)(global, config.globals);\n    this.moduleMocker = new (_jestMock().ModuleMocker)(global);\n\n    const timerIdToRef = id => ({\n      id,\n\n      ref() {\n        return this;\n      },\n\n      unref() {\n        return this;\n      }\n    });\n\n    const timerRefToId = timer => (timer && timer.id) || undefined;\n\n    const timerConfig = {\n      idToRef: timerIdToRef,\n      refToId: timerRefToId\n    };\n    this.fakeTimers = new (_fakeTimers().LegacyFakeTimers)({\n      config,\n      global,\n      moduleMocker: this.moduleMocker,\n      timerConfig\n    });\n    this.fakeTimersModern = new (_fakeTimers().ModernFakeTimers)({\n      config,\n      global\n    });\n  }\n\n  async setup() {}\n\n  async teardown() {\n    if (this.fakeTimers) {\n      this.fakeTimers.dispose();\n    }\n\n    if (this.fakeTimersModern) {\n      this.fakeTimersModern.dispose();\n    }\n\n    this.context = null;\n    this.fakeTimers = null;\n    this.fakeTimersModern = null;\n  }\n\n  getVmContext() {\n    return this.context;\n  }\n}\n\nmodule.exports = NodeEnvironment;\n"]}