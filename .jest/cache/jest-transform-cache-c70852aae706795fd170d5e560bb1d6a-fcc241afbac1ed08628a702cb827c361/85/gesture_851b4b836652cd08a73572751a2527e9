960dca95aec76347d938139a8deeb747
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ContinousBaseGesture = exports.BaseGesture = exports.Gesture = exports.CALLBACK_TYPE = void 0;

var _handlersRegistry = require("../handlersRegistry");

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var CALLBACK_TYPE = {
  UNDEFINED: 0,
  BEGAN: 1,
  START: 2,
  UPDATE: 3,
  CHANGE: 4,
  END: 5,
  FINALIZE: 6,
  TOUCHES_DOWN: 7,
  TOUCHES_MOVE: 8,
  TOUCHES_UP: 9,
  TOUCHES_CANCELLED: 10
};
exports.CALLBACK_TYPE = CALLBACK_TYPE;
var Gesture = (0, _createClass2.default)(function Gesture() {
  (0, _classCallCheck2.default)(this, Gesture);
});
exports.Gesture = Gesture;

var BaseGesture = function (_Gesture) {
  (0, _inherits2.default)(BaseGesture, _Gesture);

  var _super = _createSuper(BaseGesture);

  function BaseGesture() {
    var _this;

    (0, _classCallCheck2.default)(this, BaseGesture);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));

    _defineProperty((0, _assertThisInitialized2.default)(_this), "handlerTag", -1);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "handlerName", '');

    _defineProperty((0, _assertThisInitialized2.default)(_this), "config", {});

    _defineProperty((0, _assertThisInitialized2.default)(_this), "handlers", {
      handlerTag: -1,
      isWorklet: []
    });

    return _this;
  }

  (0, _createClass2.default)(BaseGesture, [{
    key: "addDependency",
    value: function addDependency(key, gesture) {
      var value = this.config[key];
      this.config[key] = value ? Array().concat(value, gesture) : [gesture];
    }
  }, {
    key: "withRef",
    value: function withRef(ref) {
      this.config.ref = ref;
      return this;
    }
  }, {
    key: "isWorklet",
    value: function isWorklet(callback) {
      return callback.__workletHash !== undefined;
    }
  }, {
    key: "onBegin",
    value: function onBegin(callback) {
      this.handlers.onBegin = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.BEGAN] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onStart",
    value: function onStart(callback) {
      this.handlers.onStart = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.START] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onEnd",
    value: function onEnd(callback) {
      this.handlers.onEnd = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.END] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onFinalize",
    value: function onFinalize(callback) {
      this.handlers.onFinalize = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.FINALIZE] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onTouchesDown",
    value: function onTouchesDown(callback) {
      this.config.needsPointerData = true;
      this.handlers.onTouchesDown = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.TOUCHES_DOWN] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onTouchesMove",
    value: function onTouchesMove(callback) {
      this.config.needsPointerData = true;
      this.handlers.onTouchesMove = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.TOUCHES_MOVE] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onTouchesUp",
    value: function onTouchesUp(callback) {
      this.config.needsPointerData = true;
      this.handlers.onTouchesUp = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.TOUCHES_UP] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onTouchesCancelled",
    value: function onTouchesCancelled(callback) {
      this.config.needsPointerData = true;
      this.handlers.onTouchesCancelled = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.TOUCHES_CANCELLED] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "enabled",
    value: function enabled(_enabled) {
      this.config.enabled = _enabled;
      return this;
    }
  }, {
    key: "shouldCancelWhenOutside",
    value: function shouldCancelWhenOutside(value) {
      this.config.shouldCancelWhenOutside = value;
      return this;
    }
  }, {
    key: "hitSlop",
    value: function hitSlop(_hitSlop) {
      this.config.hitSlop = _hitSlop;
      return this;
    }
  }, {
    key: "runOnJS",
    value: function runOnJS(_runOnJS) {
      this.config.runOnJS = _runOnJS;
      return this;
    }
  }, {
    key: "simultaneousWithExternalGesture",
    value: function simultaneousWithExternalGesture() {
      for (var _len2 = arguments.length, gestures = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        gestures[_key2] = arguments[_key2];
      }

      for (var _i = 0, _gestures = gestures; _i < _gestures.length; _i++) {
        var gesture = _gestures[_i];
        this.addDependency('simultaneousWith', gesture);
      }

      return this;
    }
  }, {
    key: "requireExternalGestureToFail",
    value: function requireExternalGestureToFail() {
      for (var _len3 = arguments.length, gestures = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        gestures[_key3] = arguments[_key3];
      }

      for (var _i2 = 0, _gestures2 = gestures; _i2 < _gestures2.length; _i2++) {
        var gesture = _gestures2[_i2];
        this.addDependency('requireToFail', gesture);
      }

      return this;
    }
  }, {
    key: "withTestId",
    value: function withTestId(id) {
      this.config.testId = id;
      return this;
    }
  }, {
    key: "initialize",
    value: function initialize() {
      this.handlerTag = (0, _handlersRegistry.getNextHandlerTag)();
      this.handlers = (0, _extends2.default)({}, this.handlers, {
        handlerTag: this.handlerTag
      });

      if (this.config.ref) {
        this.config.ref.current = this;
      }
    }
  }, {
    key: "toGestureArray",
    value: function toGestureArray() {
      return [this];
    }
  }, {
    key: "prepare",
    value: function prepare() {}
  }, {
    key: "shouldUseReanimated",
    get: function get() {
      return this.config.runOnJS !== true && !this.handlers.isWorklet.includes(false);
    }
  }]);
  return BaseGesture;
}(Gesture);

exports.BaseGesture = BaseGesture;

var ContinousBaseGesture = function (_BaseGesture) {
  (0, _inherits2.default)(ContinousBaseGesture, _BaseGesture);

  var _super2 = _createSuper(ContinousBaseGesture);

  function ContinousBaseGesture() {
    (0, _classCallCheck2.default)(this, ContinousBaseGesture);
    return _super2.apply(this, arguments);
  }

  (0, _createClass2.default)(ContinousBaseGesture, [{
    key: "onUpdate",
    value: function onUpdate(callback) {
      this.handlers.onUpdate = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.UPDATE] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "onChange",
    value: function onChange(callback) {
      this.handlers.onChange = callback;
      this.handlers.isWorklet[CALLBACK_TYPE.CHANGE] = this.isWorklet(callback);
      return this;
    }
  }, {
    key: "manualActivation",
    value: function manualActivation(_manualActivation) {
      this.config.manualActivation = _manualActivation;
      return this;
    }
  }]);
  return ContinousBaseGesture;
}(BaseGesture);

exports.ContinousBaseGesture = ContinousBaseGesture;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxhQUNFLEtBQUsvQixNQUFMLENBQVlxQixPQUFaLEtBQXdCLElBQXhCLElBQWdDLENBQUMsS0FBS1osUUFBTCxDQUFjZCxTQUFkLENBQXdCcUMsUUFBeEIsQ0FBaUMsS0FBakMsQ0FEbkM7QUFHRDs7O0VBdktPMUMsTzs7OztJQTBLWTJDLG9COzs7Ozs7Ozs7Ozs7V0FJcEJDLGtCQUFTN0IsUUFBVDZCLEVBQXVFO0FBQ3JFLFdBQUt6QixRQUFMLENBQWN5QixRQUFkLEdBQXlCN0IsUUFBekI7QUFDQSxXQUFLSSxRQUFMLENBQWNkLFNBQWQsQ0FBd0JqQixhQUFhLENBQUNJLE1BQXRDLElBQWdELEtBQUthLFNBQUwsQ0FBZVUsUUFBZixDQUFoRDtBQUNBLGFBQU8sSUFBUDtBQUNEOzs7V0FFRDhCLGtCQUNFOUIsUUFERjhCLEVBSUU7QUFDQSxXQUFLMUIsUUFBTCxDQUFjMEIsUUFBZCxHQUF5QjlCLFFBQXpCO0FBQ0EsV0FBS0ksUUFBTCxDQUFjZCxTQUFkLENBQXdCakIsYUFBYSxDQUFDSyxNQUF0QyxJQUFnRCxLQUFLWSxTQUFMLENBQWVVLFFBQWYsQ0FBaEQ7QUFDQSxhQUFPLElBQVA7QUFDRDs7O1dBRUQrQiwwQkFBaUJBLGlCQUFqQkEsRUFBNEM7QUFDMUMsV0FBS3BDLE1BQUwsQ0FBWW9DLGdCQUFaLEdBQStCQSxpQkFBL0I7QUFDQSxhQUFPLElBQVA7QUFDRDs7O0VBcEJPN0MsVyIsIm5hbWVzIjpbIkNBTExCQUNLX1RZUEUiLCJVTkRFRklORUQiLCJCRUdBTiIsIlNUQVJUIiwiVVBEQVRFIiwiQ0hBTkdFIiwiRU5EIiwiRklOQUxJWkUiLCJUT1VDSEVTX0RPV04iLCJUT1VDSEVTX01PVkUiLCJUT1VDSEVTX1VQIiwiVE9VQ0hFU19DQU5DRUxMRUQiLCJHZXN0dXJlIiwiQmFzZUdlc3R1cmUiLCJhcmdzIiwiX2RlZmluZVByb3BlcnR5IiwiaGFuZGxlclRhZyIsImlzV29ya2xldCIsImFkZERlcGVuZGVuY3kiLCJrZXkiLCJnZXN0dXJlIiwidmFsdWUiLCJjb25maWciLCJBcnJheSIsImNvbmNhdCIsIndpdGhSZWYiLCJyZWYiLCJjYWxsYmFjayIsIl9fd29ya2xldEhhc2giLCJ1bmRlZmluZWQiLCJvbkJlZ2luIiwiaGFuZGxlcnMiLCJvblN0YXJ0Iiwib25FbmQiLCJvbkZpbmFsaXplIiwib25Ub3VjaGVzRG93biIsIm5lZWRzUG9pbnRlckRhdGEiLCJvblRvdWNoZXNNb3ZlIiwib25Ub3VjaGVzVXAiLCJvblRvdWNoZXNDYW5jZWxsZWQiLCJlbmFibGVkIiwic2hvdWxkQ2FuY2VsV2hlbk91dHNpZGUiLCJoaXRTbG9wIiwicnVuT25KUyIsInNpbXVsdGFuZW91c1dpdGhFeHRlcm5hbEdlc3R1cmUiLCJnZXN0dXJlcyIsInJlcXVpcmVFeHRlcm5hbEdlc3R1cmVUb0ZhaWwiLCJ3aXRoVGVzdElkIiwiaWQiLCJ0ZXN0SWQiLCJpbml0aWFsaXplIiwiY3VycmVudCIsInRvR2VzdHVyZUFycmF5IiwicHJlcGFyZSIsImluY2x1ZGVzIiwiQ29udGlub3VzQmFzZUdlc3R1cmUiLCJvblVwZGF0ZSIsIm9uQ2hhbmdlIiwibWFudWFsQWN0aXZhdGlvbiJdLCJzb3VyY2VzIjpbImdlc3R1cmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmxpbmdHZXN0dXJlSGFuZGxlckV2ZW50UGF5bG9hZCB9IGZyb20gJy4uL0ZsaW5nR2VzdHVyZUhhbmRsZXInO1xuaW1wb3J0IHsgRm9yY2VUb3VjaEdlc3R1cmVIYW5kbGVyRXZlbnRQYXlsb2FkIH0gZnJvbSAnLi4vRm9yY2VUb3VjaEdlc3R1cmVIYW5kbGVyJztcbmltcG9ydCB7XG4gIEhpdFNsb3AsXG4gIENvbW1vbkdlc3R1cmVDb25maWcsXG4gIEdlc3R1cmVUb3VjaEV2ZW50LFxuICBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudCxcbiAgR2VzdHVyZVVwZGF0ZUV2ZW50LFxufSBmcm9tICcuLi9nZXN0dXJlSGFuZGxlckNvbW1vbic7XG5pbXBvcnQgeyBnZXROZXh0SGFuZGxlclRhZyB9IGZyb20gJy4uL2hhbmRsZXJzUmVnaXN0cnknO1xuaW1wb3J0IHsgR2VzdHVyZVN0YXRlTWFuYWdlclR5cGUgfSBmcm9tICcuL2dlc3R1cmVTdGF0ZU1hbmFnZXInO1xuaW1wb3J0IHsgTG9uZ1ByZXNzR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQgfSBmcm9tICcuLi9Mb25nUHJlc3NHZXN0dXJlSGFuZGxlcic7XG5pbXBvcnQgeyBQYW5HZXN0dXJlSGFuZGxlckV2ZW50UGF5bG9hZCB9IGZyb20gJy4uL1Bhbkdlc3R1cmVIYW5kbGVyJztcbmltcG9ydCB7IFBpbmNoR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQgfSBmcm9tICcuLi9QaW5jaEdlc3R1cmVIYW5kbGVyJztcbmltcG9ydCB7IFJvdGF0aW9uR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQgfSBmcm9tICcuLi9Sb3RhdGlvbkdlc3R1cmVIYW5kbGVyJztcbmltcG9ydCB7IFRhcEdlc3R1cmVIYW5kbGVyRXZlbnRQYXlsb2FkIH0gZnJvbSAnLi4vVGFwR2VzdHVyZUhhbmRsZXInO1xuaW1wb3J0IHsgTmF0aXZlVmlld0dlc3R1cmVIYW5kbGVyUGF5bG9hZCB9IGZyb20gJy4uL05hdGl2ZVZpZXdHZXN0dXJlSGFuZGxlcic7XG5cbmV4cG9ydCB0eXBlIEdlc3R1cmVUeXBlID1cbiAgfCBCYXNlR2VzdHVyZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj5cbiAgfCBCYXNlR2VzdHVyZTxSZWNvcmQ8c3RyaW5nLCBuZXZlcj4+XG4gIHwgQmFzZUdlc3R1cmU8VGFwR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQ+XG4gIHwgQmFzZUdlc3R1cmU8UGFuR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQ+XG4gIHwgQmFzZUdlc3R1cmU8TG9uZ1ByZXNzR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQ+XG4gIHwgQmFzZUdlc3R1cmU8Um90YXRpb25HZXN0dXJlSGFuZGxlckV2ZW50UGF5bG9hZD5cbiAgfCBCYXNlR2VzdHVyZTxQaW5jaEdlc3R1cmVIYW5kbGVyRXZlbnRQYXlsb2FkPlxuICB8IEJhc2VHZXN0dXJlPEZsaW5nR2VzdHVyZUhhbmRsZXJFdmVudFBheWxvYWQ+XG4gIHwgQmFzZUdlc3R1cmU8Rm9yY2VUb3VjaEdlc3R1cmVIYW5kbGVyRXZlbnRQYXlsb2FkPlxuICB8IEJhc2VHZXN0dXJlPE5hdGl2ZVZpZXdHZXN0dXJlSGFuZGxlclBheWxvYWQ+O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlUmVmID1cbiAgfCBudW1iZXJcbiAgfCBHZXN0dXJlVHlwZVxuICB8IFJlYWN0LlJlZk9iamVjdDxHZXN0dXJlVHlwZSB8IHVuZGVmaW5lZD5cbiAgfCBSZWFjdC5SZWZPYmplY3Q8UmVhY3QuQ29tcG9uZW50VHlwZSB8IHVuZGVmaW5lZD47IC8vIGFsbG93IGFkZGluZyBhIHJlZiB0byBhIGdlc3R1cmUgaGFuZGxlclxuZXhwb3J0IGludGVyZmFjZSBCYXNlR2VzdHVyZUNvbmZpZ1xuICBleHRlbmRzIENvbW1vbkdlc3R1cmVDb25maWcsXG4gICAgUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICByZWY/OiBSZWFjdC5NdXRhYmxlUmVmT2JqZWN0PEdlc3R1cmVUeXBlIHwgdW5kZWZpbmVkPjtcbiAgcmVxdWlyZVRvRmFpbD86IEdlc3R1cmVSZWZbXTtcbiAgc2ltdWx0YW5lb3VzV2l0aD86IEdlc3R1cmVSZWZbXTtcbiAgbmVlZHNQb2ludGVyRGF0YT86IGJvb2xlYW47XG4gIG1hbnVhbEFjdGl2YXRpb24/OiBib29sZWFuO1xuICBydW5PbkpTPzogYm9vbGVhbjtcbiAgdGVzdElkPzogc3RyaW5nO1xufVxuXG50eXBlIFRvdWNoRXZlbnRIYW5kbGVyVHlwZSA9IChcbiAgZXZlbnQ6IEdlc3R1cmVUb3VjaEV2ZW50LFxuICBzdGF0ZU1hbmFnZXI6IEdlc3R1cmVTdGF0ZU1hbmFnZXJUeXBlXG4pID0+IHZvaWQ7XG5cbmV4cG9ydCB0eXBlIEhhbmRsZXJDYWxsYmFja3M8RXZlbnRQYXlsb2FkVCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PiA9IHtcbiAgaGFuZGxlclRhZzogbnVtYmVyO1xuICBvbkJlZ2luPzogKGV2ZW50OiBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudDxFdmVudFBheWxvYWRUPikgPT4gdm9pZDtcbiAgb25TdGFydD86IChldmVudDogR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8RXZlbnRQYXlsb2FkVD4pID0+IHZvaWQ7XG4gIG9uRW5kPzogKFxuICAgIGV2ZW50OiBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudDxFdmVudFBheWxvYWRUPixcbiAgICBzdWNjZXNzOiBib29sZWFuXG4gICkgPT4gdm9pZDtcbiAgb25GaW5hbGl6ZT86IChcbiAgICBldmVudDogR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8RXZlbnRQYXlsb2FkVD4sXG4gICAgc3VjY2VzczogYm9vbGVhblxuICApID0+IHZvaWQ7XG4gIG9uVXBkYXRlPzogKGV2ZW50OiBHZXN0dXJlVXBkYXRlRXZlbnQ8RXZlbnRQYXlsb2FkVD4pID0+IHZvaWQ7XG4gIG9uQ2hhbmdlPzogKGV2ZW50OiBhbnkpID0+IHZvaWQ7XG4gIG9uVG91Y2hlc0Rvd24/OiBUb3VjaEV2ZW50SGFuZGxlclR5cGU7XG4gIG9uVG91Y2hlc01vdmU/OiBUb3VjaEV2ZW50SGFuZGxlclR5cGU7XG4gIG9uVG91Y2hlc1VwPzogVG91Y2hFdmVudEhhbmRsZXJUeXBlO1xuICBvblRvdWNoZXNDYW5jZWxsZWQ/OiBUb3VjaEV2ZW50SGFuZGxlclR5cGU7XG4gIGNoYW5nZUV2ZW50Q2FsY3VsYXRvcj86IChcbiAgICBjdXJyZW50OiBHZXN0dXJlVXBkYXRlRXZlbnQ8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+LFxuICAgIHByZXZpb3VzPzogR2VzdHVyZVVwZGF0ZUV2ZW50PFJlY29yZDxzdHJpbmcsIHVua25vd24+PlxuICApID0+IEdlc3R1cmVVcGRhdGVFdmVudDxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj47XG4gIGlzV29ya2xldDogYm9vbGVhbltdO1xufTtcblxuZXhwb3J0IGNvbnN0IENBTExCQUNLX1RZUEUgPSB7XG4gIFVOREVGSU5FRDogMCxcbiAgQkVHQU46IDEsXG4gIFNUQVJUOiAyLFxuICBVUERBVEU6IDMsXG4gIENIQU5HRTogNCxcbiAgRU5EOiA1LFxuICBGSU5BTElaRTogNixcbiAgVE9VQ0hFU19ET1dOOiA3LFxuICBUT1VDSEVTX01PVkU6IDgsXG4gIFRPVUNIRVNfVVA6IDksXG4gIFRPVUNIRVNfQ0FOQ0VMTEVEOiAxMCxcbn0gYXMgY29uc3Q7XG5cbi8vIEFsbG93IHVzaW5nIENBTExCQUNLX1RZUEUgYXMgb2JqZWN0IGFuZCB0eXBlXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlZGVjbGFyZVxuZXhwb3J0IHR5cGUgQ0FMTEJBQ0tfVFlQRSA9IHR5cGVvZiBDQUxMQkFDS19UWVBFW2tleW9mIHR5cGVvZiBDQUxMQkFDS19UWVBFXTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEdlc3R1cmUge1xuICAvKipcbiAgICogUmV0dXJuIGFycmF5IG9mIGdlc3R1cmVzLCBwcm92aWRpbmcgdGhlIHNhbWUgaW50ZXJmYWNlIGZvciBjcmVhdGluZyBhbmQgdXBkYXRpbmdcbiAgICogaGFuZGxlcnMsIG5vIG1hdHRlciB3aGljaCBvYmplY3Qgd2FzIHVzZWQgdG8gY3JlYXRlIGdlc3R1cmUgaW5zdGFuY2UuXG4gICAqL1xuICBhYnN0cmFjdCB0b0dlc3R1cmVBcnJheSgpOiBHZXN0dXJlVHlwZVtdO1xuXG4gIC8qKlxuICAgKiBBc3NpZ24gaGFuZGxlclRhZyB0byB0aGUgZ2VzdHVyZSBpbnN0YW5jZSBhbmQgc2V0IHJlZi5jdXJyZW50IChpZiBhIHJlZiBpcyBzZXQpXG4gICAqL1xuICBhYnN0cmFjdCBpbml0aWFsaXplKCk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIE1ha2Ugc3VyZSB0aGF0IHZhbHVlcyBvZiBwcm9wZXJ0aWVzIGRlZmluaW5nIHJlbGF0aW9ucyBhcmUgYXJyYXlzLiBEbyBhbnkgbmVjZXNzYXJ5XG4gICAqIHByZXByb2Nlc3NpbmcgcmVxdWlyZWQgdG8gY29uZmlndXJlIHJlbGF0aW9ucyBiZXR3ZWVuIGhhbmRsZXJzLiBDYWxsZWQganVzdCBiZWZvcmVcbiAgICogdXBkYXRpbmcgdGhlIGhhbmRsZXIgb24gdGhlIG5hdGl2ZSBzaWRlLlxuICAgKi9cbiAgYWJzdHJhY3QgcHJlcGFyZSgpOiB2b2lkO1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZUdlc3R1cmU8XG4gIEV2ZW50UGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiBleHRlbmRzIEdlc3R1cmUge1xuICBwdWJsaWMgaGFuZGxlclRhZyA9IC0xO1xuICBwdWJsaWMgaGFuZGxlck5hbWUgPSAnJztcbiAgcHVibGljIGNvbmZpZzogQmFzZUdlc3R1cmVDb25maWcgPSB7fTtcbiAgcHVibGljIGhhbmRsZXJzOiBIYW5kbGVyQ2FsbGJhY2tzPEV2ZW50UGF5bG9hZFQ+ID0ge1xuICAgIGhhbmRsZXJUYWc6IC0xLFxuICAgIGlzV29ya2xldDogW10sXG4gIH07XG5cbiAgcHJpdmF0ZSBhZGREZXBlbmRlbmN5KFxuICAgIGtleTogJ3NpbXVsdGFuZW91c1dpdGgnIHwgJ3JlcXVpcmVUb0ZhaWwnLFxuICAgIGdlc3R1cmU6IEV4Y2x1ZGU8R2VzdHVyZVJlZiwgbnVtYmVyPlxuICApIHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY29uZmlnW2tleV07XG4gICAgdGhpcy5jb25maWdba2V5XSA9IHZhbHVlXG4gICAgICA/IEFycmF5PEdlc3R1cmVSZWY+KCkuY29uY2F0KHZhbHVlLCBnZXN0dXJlKVxuICAgICAgOiBbZ2VzdHVyZV07XG4gIH1cblxuICB3aXRoUmVmKHJlZjogUmVhY3QuTXV0YWJsZVJlZk9iamVjdDxHZXN0dXJlVHlwZSB8IHVuZGVmaW5lZD4pIHtcbiAgICB0aGlzLmNvbmZpZy5yZWYgPSByZWY7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xuICBwcm90ZWN0ZWQgaXNXb3JrbGV0KGNhbGxiYWNrOiBGdW5jdGlvbikge1xuICAgIC8vQHRzLWlnbm9yZSBpZiBjYWxsYmFjayBpcyBhIHdvcmtsZXQsIHRoZSBwcm9wZXJ0eSB3aWxsIGJlIGF2YWlsYWJsZSwgaWYgbm90IHRoZW4gdGhlIGNoZWNrIHdpbGwgcmV0dXJuIGZhbHNlXG4gICAgcmV0dXJuIGNhbGxiYWNrLl9fd29ya2xldEhhc2ggIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIG9uQmVnaW4oY2FsbGJhY2s6IChldmVudDogR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8RXZlbnRQYXlsb2FkVD4pID0+IHZvaWQpIHtcbiAgICB0aGlzLmhhbmRsZXJzLm9uQmVnaW4gPSBjYWxsYmFjaztcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLkJFR0FOXSA9IHRoaXMuaXNXb3JrbGV0KGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uU3RhcnQoY2FsbGJhY2s6IChldmVudDogR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8RXZlbnRQYXlsb2FkVD4pID0+IHZvaWQpIHtcbiAgICB0aGlzLmhhbmRsZXJzLm9uU3RhcnQgPSBjYWxsYmFjaztcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLlNUQVJUXSA9IHRoaXMuaXNXb3JrbGV0KGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uRW5kKFxuICAgIGNhbGxiYWNrOiAoXG4gICAgICBldmVudDogR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8RXZlbnRQYXlsb2FkVD4sXG4gICAgICBzdWNjZXNzOiBib29sZWFuXG4gICAgKSA9PiB2b2lkXG4gICkge1xuICAgIHRoaXMuaGFuZGxlcnMub25FbmQgPSBjYWxsYmFjaztcbiAgICAvL0B0cy1pZ25vcmUgaWYgY2FsbGJhY2sgaXMgYSB3b3JrbGV0LCB0aGUgcHJvcGVydHkgd2lsbCBiZSBhdmFpbGFibGUsIGlmIG5vdCB0aGVuIHRoZSBjaGVjayB3aWxsIHJldHVybiBmYWxzZVxuICAgIHRoaXMuaGFuZGxlcnMuaXNXb3JrbGV0W0NBTExCQUNLX1RZUEUuRU5EXSA9IHRoaXMuaXNXb3JrbGV0KGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uRmluYWxpemUoXG4gICAgY2FsbGJhY2s6IChcbiAgICAgIGV2ZW50OiBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudDxFdmVudFBheWxvYWRUPixcbiAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICApID0+IHZvaWRcbiAgKSB7XG4gICAgdGhpcy5oYW5kbGVycy5vbkZpbmFsaXplID0gY2FsbGJhY2s7XG4gICAgLy9AdHMtaWdub3JlIGlmIGNhbGxiYWNrIGlzIGEgd29ya2xldCwgdGhlIHByb3BlcnR5IHdpbGwgYmUgYXZhaWxhYmxlLCBpZiBub3QgdGhlbiB0aGUgY2hlY2sgd2lsbCByZXR1cm4gZmFsc2VcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLkZJTkFMSVpFXSA9IHRoaXMuaXNXb3JrbGV0KGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uVG91Y2hlc0Rvd24oY2FsbGJhY2s6IFRvdWNoRXZlbnRIYW5kbGVyVHlwZSkge1xuICAgIHRoaXMuY29uZmlnLm5lZWRzUG9pbnRlckRhdGEgPSB0cnVlO1xuICAgIHRoaXMuaGFuZGxlcnMub25Ub3VjaGVzRG93biA9IGNhbGxiYWNrO1xuICAgIHRoaXMuaGFuZGxlcnMuaXNXb3JrbGV0W0NBTExCQUNLX1RZUEUuVE9VQ0hFU19ET1dOXSA9IHRoaXMuaXNXb3JrbGV0KFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvblRvdWNoZXNNb3ZlKGNhbGxiYWNrOiBUb3VjaEV2ZW50SGFuZGxlclR5cGUpIHtcbiAgICB0aGlzLmNvbmZpZy5uZWVkc1BvaW50ZXJEYXRhID0gdHJ1ZTtcbiAgICB0aGlzLmhhbmRsZXJzLm9uVG91Y2hlc01vdmUgPSBjYWxsYmFjaztcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLlRPVUNIRVNfTU9WRV0gPSB0aGlzLmlzV29ya2xldChcbiAgICAgIGNhbGxiYWNrXG4gICAgKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb25Ub3VjaGVzVXAoY2FsbGJhY2s6IFRvdWNoRXZlbnRIYW5kbGVyVHlwZSkge1xuICAgIHRoaXMuY29uZmlnLm5lZWRzUG9pbnRlckRhdGEgPSB0cnVlO1xuICAgIHRoaXMuaGFuZGxlcnMub25Ub3VjaGVzVXAgPSBjYWxsYmFjaztcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLlRPVUNIRVNfVVBdID0gdGhpcy5pc1dvcmtsZXQoXG4gICAgICBjYWxsYmFja1xuICAgICk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uVG91Y2hlc0NhbmNlbGxlZChjYWxsYmFjazogVG91Y2hFdmVudEhhbmRsZXJUeXBlKSB7XG4gICAgdGhpcy5jb25maWcubmVlZHNQb2ludGVyRGF0YSA9IHRydWU7XG4gICAgdGhpcy5oYW5kbGVycy5vblRvdWNoZXNDYW5jZWxsZWQgPSBjYWxsYmFjaztcbiAgICB0aGlzLmhhbmRsZXJzLmlzV29ya2xldFtDQUxMQkFDS19UWVBFLlRPVUNIRVNfQ0FOQ0VMTEVEXSA9IHRoaXMuaXNXb3JrbGV0KFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBlbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmNvbmZpZy5lbmFibGVkID0gZW5hYmxlZDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNob3VsZENhbmNlbFdoZW5PdXRzaWRlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5jb25maWcuc2hvdWxkQ2FuY2VsV2hlbk91dHNpZGUgPSB2YWx1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGhpdFNsb3AoaGl0U2xvcDogSGl0U2xvcCkge1xuICAgIHRoaXMuY29uZmlnLmhpdFNsb3AgPSBoaXRTbG9wO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcnVuT25KUyhydW5PbkpTOiBib29sZWFuKSB7XG4gICAgdGhpcy5jb25maWcucnVuT25KUyA9IHJ1bk9uSlM7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzaW11bHRhbmVvdXNXaXRoRXh0ZXJuYWxHZXN0dXJlKC4uLmdlc3R1cmVzOiBFeGNsdWRlPEdlc3R1cmVSZWYsIG51bWJlcj5bXSkge1xuICAgIGZvciAoY29uc3QgZ2VzdHVyZSBvZiBnZXN0dXJlcykge1xuICAgICAgdGhpcy5hZGREZXBlbmRlbmN5KCdzaW11bHRhbmVvdXNXaXRoJywgZ2VzdHVyZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVxdWlyZUV4dGVybmFsR2VzdHVyZVRvRmFpbCguLi5nZXN0dXJlczogRXhjbHVkZTxHZXN0dXJlUmVmLCBudW1iZXI+W10pIHtcbiAgICBmb3IgKGNvbnN0IGdlc3R1cmUgb2YgZ2VzdHVyZXMpIHtcbiAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeSgncmVxdWlyZVRvRmFpbCcsIGdlc3R1cmUpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHdpdGhUZXN0SWQoaWQ6IHN0cmluZykge1xuICAgIHRoaXMuY29uZmlnLnRlc3RJZCA9IGlkO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLmhhbmRsZXJUYWcgPSBnZXROZXh0SGFuZGxlclRhZygpO1xuXG4gICAgdGhpcy5oYW5kbGVycyA9IHsgLi4udGhpcy5oYW5kbGVycywgaGFuZGxlclRhZzogdGhpcy5oYW5kbGVyVGFnIH07XG5cbiAgICBpZiAodGhpcy5jb25maWcucmVmKSB7XG4gICAgICB0aGlzLmNvbmZpZy5yZWYuY3VycmVudCA9IHRoaXMgYXMgR2VzdHVyZVR5cGU7XG4gICAgfVxuICB9XG5cbiAgdG9HZXN0dXJlQXJyYXkoKTogR2VzdHVyZVR5cGVbXSB7XG4gICAgcmV0dXJuIFt0aGlzIGFzIEdlc3R1cmVUeXBlXTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb25cbiAgcHJlcGFyZSgpIHt9XG5cbiAgZ2V0IHNob3VsZFVzZVJlYW5pbWF0ZWQoKTogYm9vbGVhbiB7XG4gICAgLy8gdXNlIFJlYW5pbWF0ZWQgd2hlbiBydW5PbkpTIGlzbid0IHNldCBleHBsaWNpdGx5IGFuZCBhbGwgZGVmaW5lZCBjYWxsYmFja3MgYXJlIHdvcmtsZXRzXG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuY29uZmlnLnJ1bk9uSlMgIT09IHRydWUgJiYgIXRoaXMuaGFuZGxlcnMuaXNXb3JrbGV0LmluY2x1ZGVzKGZhbHNlKVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENvbnRpbm91c0Jhc2VHZXN0dXJlPFxuICBFdmVudFBheWxvYWRUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIEV2ZW50Q2hhbmdlUGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiBleHRlbmRzIEJhc2VHZXN0dXJlPEV2ZW50UGF5bG9hZFQ+IHtcbiAgb25VcGRhdGUoY2FsbGJhY2s6IChldmVudDogR2VzdHVyZVVwZGF0ZUV2ZW50PEV2ZW50UGF5bG9hZFQ+KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5oYW5kbGVycy5vblVwZGF0ZSA9IGNhbGxiYWNrO1xuICAgIHRoaXMuaGFuZGxlcnMuaXNXb3JrbGV0W0NBTExCQUNLX1RZUEUuVVBEQVRFXSA9IHRoaXMuaXNXb3JrbGV0KGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uQ2hhbmdlKFxuICAgIGNhbGxiYWNrOiAoXG4gICAgICBldmVudDogR2VzdHVyZVVwZGF0ZUV2ZW50PEV2ZW50UGF5bG9hZFQgJiBFdmVudENoYW5nZVBheWxvYWRUPlxuICAgICkgPT4gdm9pZFxuICApIHtcbiAgICB0aGlzLmhhbmRsZXJzLm9uQ2hhbmdlID0gY2FsbGJhY2s7XG4gICAgdGhpcy5oYW5kbGVycy5pc1dvcmtsZXRbQ0FMTEJBQ0tfVFlQRS5DSEFOR0VdID0gdGhpcy5pc1dvcmtsZXQoY2FsbGJhY2spO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbWFudWFsQWN0aXZhdGlvbihtYW51YWxBY3RpdmF0aW9uOiBib29sZWFuKSB7XG4gICAgdGhpcy5jb25maWcubWFudWFsQWN0aXZhdGlvbiA9IG1hbnVhbEFjdGl2YXRpb247XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cbiJdfQ==