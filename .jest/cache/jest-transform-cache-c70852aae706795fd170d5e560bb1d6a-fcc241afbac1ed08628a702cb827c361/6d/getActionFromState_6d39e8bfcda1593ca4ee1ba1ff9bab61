dec2f3de4a8dc2e3d67944bfbc0bdc50
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getActionFromState;

function getActionFromState(state, options) {
  var _state$index, _normalizedConfig$scr;

  var normalizedConfig = options ? createNormalizedConfigItem(options) : {};
  var routes = state.index != null ? state.routes.slice(0, state.index + 1) : state.routes;

  if (routes.length === 0) {
    return undefined;
  }

  if (!(routes.length === 1 && routes[0].key === undefined || routes.length === 2 && routes[0].key === undefined && routes[0].name === (normalizedConfig === null || normalizedConfig === void 0 ? void 0 : normalizedConfig.initialRouteName) && routes[1].key === undefined)) {
    return {
      type: 'RESET',
      payload: state
    };
  }

  var route = state.routes[(_state$index = state.index) !== null && _state$index !== void 0 ? _state$index : state.routes.length - 1];
  var current = route === null || route === void 0 ? void 0 : route.state;
  var config = normalizedConfig === null || normalizedConfig === void 0 ? void 0 : (_normalizedConfig$scr = normalizedConfig.screens) === null || _normalizedConfig$scr === void 0 ? void 0 : _normalizedConfig$scr[route === null || route === void 0 ? void 0 : route.name];
  var params = (0, _extends2.default)({}, route.params);
  var payload = route ? {
    name: route.name,
    path: route.path,
    params: params
  } : undefined;

  while (current) {
    var _config, _config2, _config2$screens;

    if (current.routes.length === 0) {
      return undefined;
    }

    var _routes = current.index != null ? current.routes.slice(0, current.index + 1) : current.routes;

    var _route = _routes[_routes.length - 1];
    (0, _extends2.default)(params, {
      initial: undefined,
      screen: undefined,
      params: undefined,
      state: undefined
    });

    if (_routes.length === 1 && _routes[0].key === undefined) {
      params.initial = true;
      params.screen = _route.name;
    } else if (_routes.length === 2 && _routes[0].key === undefined && _routes[0].name === ((_config = config) === null || _config === void 0 ? void 0 : _config.initialRouteName) && _routes[1].key === undefined) {
      params.initial = false;
      params.screen = _route.name;
    } else {
      params.state = current;
      break;
    }

    if (_route.state) {
      params.params = (0, _extends2.default)({}, _route.params);
      params = params.params;
    } else {
      params.path = _route.path;
      params.params = _route.params;
    }

    current = _route.state;
    config = (_config2 = config) === null || _config2 === void 0 ? void 0 : (_config2$screens = _config2.screens) === null || _config2$screens === void 0 ? void 0 : _config2$screens[_route.name];
  }

  if (!payload) {
    return;
  }

  return {
    type: 'NAVIGATE',
    payload: payload
  };
}

var createNormalizedConfigItem = function createNormalizedConfigItem(config) {
  return typeof config === 'object' && config != null ? {
    initialRouteName: config.initialRouteName,
    screens: config.screens != null ? createNormalizedConfigs(config.screens) : undefined
  } : {};
};

var createNormalizedConfigs = function createNormalizedConfigs(options) {
  return Object.entries(options).reduce(function (acc, _ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];

    acc[k] = createNormalizedConfigItem(v);
    return acc;
  }, {});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R1MsaUJBQWtCWixNQUFLLENBQUNKLElBQXhCLENBQVRNO0FBQ0Q7O0FBRUQsTUFBSSxDQUFDSCxPQUFMLEVBQWM7QUFDWjtBQTlGa0U7O0FBbUdwRSxTQUFPO0FBQ0xELFFBQUksRUFBRSxVQUREO0FBRUxDO0FBRkssR0FBUDtBQUlEOztBQUVELElBQU1WLDBCQUEwQixHQUFJYSxTQUE5QmIsMEJBQThCYSxPQUFEO0FBQUEsU0FDakMsT0FBT0EsTUFBUCxLQUFrQixRQUFsQixJQUE4QkEsTUFBTSxJQUFJLElBQXhDLEdBQ0k7QUFDRUwsb0JBQWdCLEVBQUVLLE1BQU0sQ0FBQ0wsZ0JBRDNCO0FBRUVNLFdBQU8sRUFDTEQsTUFBTSxDQUFDQyxPQUFQRCxJQUFrQixJQUFsQkEsR0FDSVcsdUJBQXVCLENBQUNYLE1BQU0sQ0FBQ0MsT0FBUixDQUQzQkQsR0FFSVI7QUFMUixHQURKLEdBUUksRUFUNkI7QUFBQSxDQUFuQzs7QUFXQSxJQUFNbUIsdUJBQXVCLEdBQUkxQixTQUEzQjBCLHVCQUEyQjFCLFFBQUQ7QUFBQSxTQUM5Qm9CLE1BQU0sQ0FBQ08sT0FBUFAsQ0FBZXBCLE9BQWZvQixFQUF3QlEsTUFBeEJSLENBQTJELFVBQUNTLEdBQUQsUUFBaUI7QUFBQTtBQUFBLFFBQVZDLENBQVU7QUFBQSxRQUFQQyxDQUFPOztBQUMxRUYsT0FBRyxDQUFDQyxDQUFELENBQUhELEdBQVMzQiwwQkFBMEIsQ0FBQzZCLENBQUQsQ0FBbkNGO0FBQ0EsV0FBT0EsR0FBUDtBQUZGLEtBR0csRUFISFQsQ0FEOEI7QUFBQSxDQUFoQyIsIm5hbWVzIjpbImdldEFjdGlvbkZyb21TdGF0ZSIsInN0YXRlIiwib3B0aW9ucyIsIm5vcm1hbGl6ZWRDb25maWciLCJjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbSIsInJvdXRlcyIsImluZGV4Iiwic2xpY2UiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJrZXkiLCJuYW1lIiwiaW5pdGlhbFJvdXRlTmFtZSIsInR5cGUiLCJwYXlsb2FkIiwicm91dGUiLCJjdXJyZW50IiwiY29uZmlnIiwic2NyZWVucyIsIl9ub3JtYWxpemVkQ29uZmlnJHNjciIsInBhcmFtcyIsInBhdGgiLCJPYmplY3QiLCJpbml0aWFsIiwic2NyZWVuIiwiX2NvbmZpZyIsIl9jb25maWcyIiwiX2NvbmZpZzIkc2NyZWVucyIsImNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzIiwiZW50cmllcyIsInJlZHVjZSIsImFjYyIsImsiLCJ2Il0sInNvdXJjZXMiOlsiZ2V0QWN0aW9uRnJvbVN0YXRlLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7XG4gIENvbW1vbkFjdGlvbnMsXG4gIE5hdmlnYXRpb25TdGF0ZSxcbiAgUGFyYW1MaXN0QmFzZSxcbiAgUGFydGlhbFJvdXRlLFxuICBQYXJ0aWFsU3RhdGUsXG4gIFJvdXRlLFxufSBmcm9tICdAcmVhY3QtbmF2aWdhdGlvbi9yb3V0ZXJzJztcblxuaW1wb3J0IHR5cGUgeyBOYXZpZ2F0b3JTY3JlZW5QYXJhbXMsIFBhdGhDb25maWcsIFBhdGhDb25maWdNYXAgfSBmcm9tICcuL3R5cGVzJztcblxudHlwZSBDb25maWdJdGVtID0ge1xuICBpbml0aWFsUm91dGVOYW1lPzogc3RyaW5nO1xuICBzY3JlZW5zPzogUmVjb3JkPHN0cmluZywgQ29uZmlnSXRlbT47XG59O1xuXG50eXBlIE9wdGlvbnMgPSB7XG4gIGluaXRpYWxSb3V0ZU5hbWU/OiBzdHJpbmc7XG4gIHNjcmVlbnM6IFBhdGhDb25maWdNYXA8b2JqZWN0Pjtcbn07XG5cbnR5cGUgTmF2aWdhdGVBY3Rpb248U3RhdGUgZXh0ZW5kcyBOYXZpZ2F0aW9uU3RhdGU+ID0ge1xuICB0eXBlOiAnTkFWSUdBVEUnO1xuICBwYXlsb2FkOiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHBhcmFtcz86IE5hdmlnYXRvclNjcmVlblBhcmFtczxTdGF0ZT47XG4gICAgcGF0aD86IHN0cmluZztcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdldEFjdGlvbkZyb21TdGF0ZShcbiAgc3RhdGU6IFBhcnRpYWxTdGF0ZTxOYXZpZ2F0aW9uU3RhdGU+LFxuICBvcHRpb25zPzogT3B0aW9uc1xuKTogTmF2aWdhdGVBY3Rpb248TmF2aWdhdGlvblN0YXRlPiB8IENvbW1vbkFjdGlvbnMuQWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgLy8gQ3JlYXRlIGEgbm9ybWFsaXplZCBjb25maWdzIG9iamVjdCB3aGljaCB3aWxsIGJlIGVhc2llciB0byB1c2VcbiAgY29uc3Qgbm9ybWFsaXplZENvbmZpZyA9IG9wdGlvbnNcbiAgICA/IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdJdGVtKG9wdGlvbnMgYXMgUGF0aENvbmZpZzxvYmplY3Q+IHwgc3RyaW5nKVxuICAgIDoge307XG5cbiAgY29uc3Qgcm91dGVzID1cbiAgICBzdGF0ZS5pbmRleCAhPSBudWxsID8gc3RhdGUucm91dGVzLnNsaWNlKDAsIHN0YXRlLmluZGV4ICsgMSkgOiBzdGF0ZS5yb3V0ZXM7XG5cbiAgaWYgKHJvdXRlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKFxuICAgICEoXG4gICAgICAocm91dGVzLmxlbmd0aCA9PT0gMSAmJiByb3V0ZXNbMF0ua2V5ID09PSB1bmRlZmluZWQpIHx8XG4gICAgICAocm91dGVzLmxlbmd0aCA9PT0gMiAmJlxuICAgICAgICByb3V0ZXNbMF0ua2V5ID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgcm91dGVzWzBdLm5hbWUgPT09IG5vcm1hbGl6ZWRDb25maWc/LmluaXRpYWxSb3V0ZU5hbWUgJiZcbiAgICAgICAgcm91dGVzWzFdLmtleSA9PT0gdW5kZWZpbmVkKVxuICAgIClcbiAgKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdSRVNFVCcsXG4gICAgICBwYXlsb2FkOiBzdGF0ZSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3Qgcm91dGUgPSBzdGF0ZS5yb3V0ZXNbc3RhdGUuaW5kZXggPz8gc3RhdGUucm91dGVzLmxlbmd0aCAtIDFdO1xuXG4gIGxldCBjdXJyZW50OiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiB8IHVuZGVmaW5lZCA9IHJvdXRlPy5zdGF0ZTtcbiAgbGV0IGNvbmZpZzogQ29uZmlnSXRlbSB8IHVuZGVmaW5lZCA9IG5vcm1hbGl6ZWRDb25maWc/LnNjcmVlbnM/Lltyb3V0ZT8ubmFtZV07XG4gIGxldCBwYXJhbXMgPSB7IC4uLnJvdXRlLnBhcmFtcyB9IGFzIE5hdmlnYXRvclNjcmVlblBhcmFtczxcbiAgICBQYXJhbUxpc3RCYXNlLFxuICAgIE5hdmlnYXRpb25TdGF0ZVxuICA+O1xuXG4gIGxldCBwYXlsb2FkID0gcm91dGVcbiAgICA/IHsgbmFtZTogcm91dGUubmFtZSwgcGF0aDogcm91dGUucGF0aCwgcGFyYW1zIH1cbiAgICA6IHVuZGVmaW5lZDtcblxuICB3aGlsZSAoY3VycmVudCkge1xuICAgIGlmIChjdXJyZW50LnJvdXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3Qgcm91dGVzID1cbiAgICAgIGN1cnJlbnQuaW5kZXggIT0gbnVsbFxuICAgICAgICA/IGN1cnJlbnQucm91dGVzLnNsaWNlKDAsIGN1cnJlbnQuaW5kZXggKyAxKVxuICAgICAgICA6IGN1cnJlbnQucm91dGVzO1xuXG4gICAgY29uc3Qgcm91dGU6IFJvdXRlPHN0cmluZz4gfCBQYXJ0aWFsUm91dGU8Um91dGU8c3RyaW5nPj4gPVxuICAgICAgcm91dGVzW3JvdXRlcy5sZW5ndGggLSAxXTtcblxuICAgIC8vIEV4cGxpY2l0bHkgc2V0IHRvIG92ZXJyaWRlIGV4aXN0aW5nIHZhbHVlIHdoZW4gbWVyZ2luZyBwYXJhbXNcbiAgICBPYmplY3QuYXNzaWduKHBhcmFtcywge1xuICAgICAgaW5pdGlhbDogdW5kZWZpbmVkLFxuICAgICAgc2NyZWVuOiB1bmRlZmluZWQsXG4gICAgICBwYXJhbXM6IHVuZGVmaW5lZCxcbiAgICAgIHN0YXRlOiB1bmRlZmluZWQsXG4gICAgfSk7XG5cbiAgICBpZiAocm91dGVzLmxlbmd0aCA9PT0gMSAmJiByb3V0ZXNbMF0ua2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHBhcmFtcy5pbml0aWFsID0gdHJ1ZTtcbiAgICAgIHBhcmFtcy5zY3JlZW4gPSByb3V0ZS5uYW1lO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICByb3V0ZXMubGVuZ3RoID09PSAyICYmXG4gICAgICByb3V0ZXNbMF0ua2V5ID09PSB1bmRlZmluZWQgJiZcbiAgICAgIHJvdXRlc1swXS5uYW1lID09PSBjb25maWc/LmluaXRpYWxSb3V0ZU5hbWUgJiZcbiAgICAgIHJvdXRlc1sxXS5rZXkgPT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgcGFyYW1zLmluaXRpYWwgPSBmYWxzZTtcbiAgICAgIHBhcmFtcy5zY3JlZW4gPSByb3V0ZS5uYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJhbXMuc3RhdGUgPSBjdXJyZW50O1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKHJvdXRlLnN0YXRlKSB7XG4gICAgICBwYXJhbXMucGFyYW1zID0geyAuLi5yb3V0ZS5wYXJhbXMgfTtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5wYXJhbXMgYXMgTmF2aWdhdG9yU2NyZWVuUGFyYW1zPFxuICAgICAgICBQYXJhbUxpc3RCYXNlLFxuICAgICAgICBOYXZpZ2F0aW9uU3RhdGVcbiAgICAgID47XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmFtcy5wYXRoID0gcm91dGUucGF0aDtcbiAgICAgIHBhcmFtcy5wYXJhbXMgPSByb3V0ZS5wYXJhbXM7XG4gICAgfVxuXG4gICAgY3VycmVudCA9IHJvdXRlLnN0YXRlO1xuICAgIGNvbmZpZyA9IGNvbmZpZz8uc2NyZWVucz8uW3JvdXRlLm5hbWVdO1xuICB9XG5cbiAgaWYgKCFwYXlsb2FkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gVHJ5IHRvIGNvbnN0cnVjdCBwYXlsb2FkIGZvciBhIGBOQVZJR0FURWAgYWN0aW9uIGZyb20gdGhlIHN0YXRlXG4gIC8vIFRoaXMgbGV0cyB1cyBwcmVzZXJ2ZSB0aGUgbmF2aWdhdGlvbiBzdGF0ZSBhbmQgbm90IGxvc2UgaXRcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnTkFWSUdBVEUnLFxuICAgIHBheWxvYWQsXG4gIH07XG59XG5cbmNvbnN0IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdJdGVtID0gKGNvbmZpZzogUGF0aENvbmZpZzxvYmplY3Q+IHwgc3RyaW5nKSA9PlxuICB0eXBlb2YgY29uZmlnID09PSAnb2JqZWN0JyAmJiBjb25maWcgIT0gbnVsbFxuICAgID8ge1xuICAgICAgICBpbml0aWFsUm91dGVOYW1lOiBjb25maWcuaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgICAgc2NyZWVuczpcbiAgICAgICAgICBjb25maWcuc2NyZWVucyAhPSBudWxsXG4gICAgICAgICAgICA/IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzKGNvbmZpZy5zY3JlZW5zKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9XG4gICAgOiB7fTtcblxuY29uc3QgY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MgPSAob3B0aW9uczogUGF0aENvbmZpZ01hcDxvYmplY3Q+KSA9PlxuICBPYmplY3QuZW50cmllcyhvcHRpb25zKS5yZWR1Y2U8UmVjb3JkPHN0cmluZywgQ29uZmlnSXRlbT4+KChhY2MsIFtrLCB2XSkgPT4ge1xuICAgIGFjY1trXSA9IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdJdGVtKHYpO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbiJdfQ==