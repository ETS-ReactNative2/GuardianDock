49f42b4078186d9a1ca78c0b256a624b
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends3 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _excluded = ["children", "screenListeners"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useNavigationBuilder;

var _routers = require("@react-navigation/routers");

var React = _interopRequireWildcard(require("react"));

var _reactIs = require("react-is");

var _Group = _interopRequireDefault(require("./Group"));

var _isArrayEqual = _interopRequireDefault(require("./isArrayEqual"));

var _isRecordEqual = _interopRequireDefault(require("./isRecordEqual"));

var _NavigationHelpersContext = _interopRequireDefault(require("./NavigationHelpersContext"));

var _NavigationRouteContext = _interopRequireDefault(require("./NavigationRouteContext"));

var _NavigationStateContext = _interopRequireDefault(require("./NavigationStateContext"));

var _Screen = _interopRequireDefault(require("./Screen"));

var _types = require("./types");

var _useChildListeners = _interopRequireDefault(require("./useChildListeners"));

var _useComponent = _interopRequireDefault(require("./useComponent"));

var _useCurrentRender = _interopRequireDefault(require("./useCurrentRender"));

var _useDescriptors = _interopRequireDefault(require("./useDescriptors"));

var _useEventEmitter = _interopRequireDefault(require("./useEventEmitter"));

var _useFocusedListenersChildrenAdapter = _interopRequireDefault(require("./useFocusedListenersChildrenAdapter"));

var _useFocusEvents = _interopRequireDefault(require("./useFocusEvents"));

var _useKeyedChildListeners = _interopRequireDefault(require("./useKeyedChildListeners"));

var _useNavigationHelpers = _interopRequireDefault(require("./useNavigationHelpers"));

var _useOnAction = _interopRequireDefault(require("./useOnAction"));

var _useOnGetState = _interopRequireDefault(require("./useOnGetState"));

var _useOnRouteFocus = _interopRequireDefault(require("./useOnRouteFocus"));

var _useRegisterNavigator = _interopRequireDefault(require("./useRegisterNavigator"));

var _useScheduleUpdate = _interopRequireDefault(require("./useScheduleUpdate"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

_types.PrivateValueStore;

var isValidKey = function isValidKey(key) {
  return key === undefined || typeof key === 'string' && key !== '';
};

var getRouteConfigsFromChildren = function getRouteConfigsFromChildren(children, groupKey, groupOptions) {
  var configs = React.Children.toArray(children).reduce(function (acc, child) {
    var _child$type, _child$props;

    if (React.isValidElement(child)) {
      if (child.type === _Screen.default) {
        if (!isValidKey(child.props.navigationKey)) {
          throw new Error("Got an invalid 'navigationKey' prop (" + JSON.stringify(child.props.navigationKey) + ") for the screen '" + child.props.name + "'. It must be a non-empty string or 'undefined'.");
        }

        acc.push({
          keys: [groupKey, child.props.navigationKey],
          options: groupOptions,
          props: child.props
        });
        return acc;
      }

      if (child.type === React.Fragment || child.type === _Group.default) {
        if (!isValidKey(child.props.navigationKey)) {
          throw new Error("Got an invalid 'navigationKey' prop (" + JSON.stringify(child.props.navigationKey) + ") for the group. It must be a non-empty string or 'undefined'.");
        }

        acc.push.apply(acc, (0, _toConsumableArray2.default)(getRouteConfigsFromChildren(child.props.children, child.props.navigationKey, child.type !== _Group.default ? groupOptions : groupOptions != null ? [].concat((0, _toConsumableArray2.default)(groupOptions), [child.props.screenOptions]) : [child.props.screenOptions])));
        return acc;
      }
    }

    throw new Error("A navigator can only contain 'Screen', 'Group' or 'React.Fragment' as its direct children (found " + (React.isValidElement(child) ? "'" + (typeof child.type === 'string' ? child.type : (_child$type = child.type) === null || _child$type === void 0 ? void 0 : _child$type.name) + "'" + ((_child$props = child.props) !== null && _child$props !== void 0 && _child$props.name ? " for the screen '" + child.props.name + "'" : '') : typeof child === 'object' ? JSON.stringify(child) : "'" + String(child) + "'") + "). To render this component in the navigator, pass it in the 'component' prop to 'Screen'.");
  }, []);

  if (process.env.NODE_ENV !== 'production') {
    configs.forEach(function (config) {
      var _config$props = config.props,
          name = _config$props.name,
          children = _config$props.children,
          component = _config$props.component,
          getComponent = _config$props.getComponent;

      if (typeof name !== 'string' || !name) {
        throw new Error("Got an invalid name (" + JSON.stringify(name) + ") for the screen. It must be a non-empty string.");
      }

      if (children != null || component !== undefined || getComponent !== undefined) {
        if (children != null && component !== undefined) {
          throw new Error("Got both 'component' and 'children' props for the screen '" + name + "'. You must pass only one of them.");
        }

        if (children != null && getComponent !== undefined) {
          throw new Error("Got both 'getComponent' and 'children' props for the screen '" + name + "'. You must pass only one of them.");
        }

        if (component !== undefined && getComponent !== undefined) {
          throw new Error("Got both 'component' and 'getComponent' props for the screen '" + name + "'. You must pass only one of them.");
        }

        if (children != null && typeof children !== 'function') {
          throw new Error("Got an invalid value for 'children' prop for the screen '" + name + "'. It must be a function returning a React Element.");
        }

        if (component !== undefined && !(0, _reactIs.isValidElementType)(component)) {
          throw new Error("Got an invalid value for 'component' prop for the screen '" + name + "'. It must be a valid React Component.");
        }

        if (getComponent !== undefined && typeof getComponent !== 'function') {
          throw new Error("Got an invalid value for 'getComponent' prop for the screen '" + name + "'. It must be a function returning a React Component.");
        }

        if (typeof component === 'function') {
          if (component.name === 'component') {
            console.warn("Looks like you're passing an inline function for 'component' prop for the screen '" + name + "' (e.g. component={() => <SomeComponent />}). Passing an inline function will cause the component state to be lost on re-render and cause perf issues since it's re-created every render. You can pass the function as children to 'Screen' instead to achieve the desired behaviour.");
          } else if (/^[a-z]/.test(component.name)) {
            console.warn("Got a component with the name '" + component.name + "' for the screen '" + name + "'. React Components must start with an uppercase letter. If you're passing a regular function and not a component, pass it as children to 'Screen' instead. Otherwise capitalize your component's name.");
          }
        }
      } else {
        throw new Error("Couldn't find a 'component', 'getComponent' or 'children' prop for the screen '" + name + "'. This can happen if you passed 'undefined'. You likely forgot to export your component from the file it's defined in, or mixed up default import and named import when importing.");
      }
    });
  }

  return configs;
};

function useNavigationBuilder(createRouter, options) {
  var navigatorKey = (0, _useRegisterNavigator.default)();
  var route = React.useContext(_NavigationRouteContext.default);
  var children = options.children,
      screenListeners = options.screenListeners,
      rest = (0, _objectWithoutProperties2.default)(options, _excluded);

  var _React$useRef = React.useRef(createRouter((0, _extends3.default)({}, rest, route !== null && route !== void 0 && route.params && route.params.state == null && route.params.initial !== false && typeof route.params.screen === 'string' ? {
    initialRouteName: route.params.screen
  } : null))),
      router = _React$useRef.current;

  var routeConfigs = getRouteConfigsFromChildren(children);
  var screens = routeConfigs.reduce(function (acc, config) {
    if (config.props.name in acc) {
      throw new Error("A navigator cannot contain multiple 'Screen' components with the same name (found duplicate screen named '" + config.props.name + "')");
    }

    acc[config.props.name] = config;
    return acc;
  }, {});
  var routeNames = routeConfigs.map(function (config) {
    return config.props.name;
  });
  var routeKeyList = routeNames.reduce(function (acc, curr) {
    acc[curr] = screens[curr].keys.map(function (key) {
      return key !== null && key !== void 0 ? key : '';
    }).join(':');
    return acc;
  }, {});
  var routeParamList = routeNames.reduce(function (acc, curr) {
    var initialParams = screens[curr].props.initialParams;
    acc[curr] = initialParams;
    return acc;
  }, {});
  var routeGetIdList = routeNames.reduce(function (acc, curr) {
    return (0, _extends3.default)(acc, (0, _defineProperty2.default)({}, curr, screens[curr].props.getId));
  }, {});

  if (!routeNames.length) {
    throw new Error("Couldn't find any screens for the navigator. Have you defined any screens as its children?");
  }

  var isStateValid = React.useCallback(function (state) {
    return state.type === undefined || state.type === router.type;
  }, [router.type]);
  var isStateInitialized = React.useCallback(function (state) {
    return state !== undefined && state.stale === false && isStateValid(state);
  }, [isStateValid]);

  var _React$useContext = React.useContext(_NavigationStateContext.default),
      currentState = _React$useContext.state,
      getCurrentState = _React$useContext.getState,
      setCurrentState = _React$useContext.setState,
      setKey = _React$useContext.setKey,
      getKey = _React$useContext.getKey,
      getIsInitial = _React$useContext.getIsInitial;

  var stateCleanedUp = React.useRef(false);
  var cleanUpState = React.useCallback(function () {
    setCurrentState(undefined);
    stateCleanedUp.current = true;
  }, [setCurrentState]);
  var setState = React.useCallback(function (state) {
    if (stateCleanedUp.current) {
      return;
    }

    setCurrentState(state);
  }, [setCurrentState]);

  var _React$useMemo = React.useMemo(function () {
    var _route$params4;

    var initialRouteParamList = routeNames.reduce(function (acc, curr) {
      var _route$params, _route$params2, _route$params3;

      var initialParams = screens[curr].props.initialParams;
      var initialParamsFromParams = (route === null || route === void 0 ? void 0 : (_route$params = route.params) === null || _route$params === void 0 ? void 0 : _route$params.state) == null && (route === null || route === void 0 ? void 0 : (_route$params2 = route.params) === null || _route$params2 === void 0 ? void 0 : _route$params2.initial) !== false && (route === null || route === void 0 ? void 0 : (_route$params3 = route.params) === null || _route$params3 === void 0 ? void 0 : _route$params3.screen) === curr ? route.params.params : undefined;
      acc[curr] = initialParams !== undefined || initialParamsFromParams !== undefined ? (0, _extends3.default)({}, initialParams, initialParamsFromParams) : undefined;
      return acc;
    }, {});

    if ((currentState === undefined || !isStateValid(currentState)) && (route === null || route === void 0 ? void 0 : (_route$params4 = route.params) === null || _route$params4 === void 0 ? void 0 : _route$params4.state) == null) {
      return [router.getInitialState({
        routeNames: routeNames,
        routeParamList: initialRouteParamList,
        routeGetIdList: routeGetIdList
      }), true];
    } else {
      var _route$params$state, _route$params5;

      return [router.getRehydratedState((_route$params$state = route === null || route === void 0 ? void 0 : (_route$params5 = route.params) === null || _route$params5 === void 0 ? void 0 : _route$params5.state) !== null && _route$params$state !== void 0 ? _route$params$state : currentState, {
        routeNames: routeNames,
        routeParamList: initialRouteParamList,
        routeGetIdList: routeGetIdList
      }), false];
    }
  }, [currentState, router, isStateValid]),
      _React$useMemo2 = (0, _slicedToArray2.default)(_React$useMemo, 2),
      initializedState = _React$useMemo2[0],
      isFirstStateInitialization = _React$useMemo2[1];

  var previousRouteKeyListRef = React.useRef(routeKeyList);
  React.useEffect(function () {
    previousRouteKeyListRef.current = routeKeyList;
  });
  var previousRouteKeyList = previousRouteKeyListRef.current;
  var state = isStateInitialized(currentState) ? currentState : initializedState;
  var nextState = state;

  if (!(0, _isArrayEqual.default)(state.routeNames, routeNames) || !(0, _isRecordEqual.default)(routeKeyList, previousRouteKeyList)) {
    nextState = router.getStateForRouteNamesChange(state, {
      routeNames: routeNames,
      routeParamList: routeParamList,
      routeGetIdList: routeGetIdList,
      routeKeyChanges: Object.keys(routeKeyList).filter(function (name) {
        return previousRouteKeyList.hasOwnProperty(name) && routeKeyList[name] !== previousRouteKeyList[name];
      })
    });
  }

  var previousNestedParamsRef = React.useRef(route === null || route === void 0 ? void 0 : route.params);
  React.useEffect(function () {
    previousNestedParamsRef.current = route === null || route === void 0 ? void 0 : route.params;
  }, [route === null || route === void 0 ? void 0 : route.params]);

  if (route !== null && route !== void 0 && route.params) {
    var previousParams = previousNestedParamsRef.current;
    var action;

    if (typeof route.params.state === 'object' && route.params.state != null && route.params !== previousParams) {
      action = _routers.CommonActions.reset(route.params.state);
    } else if (typeof route.params.screen === 'string' && (route.params.initial === false && isFirstStateInitialization || route.params !== previousParams)) {
      action = _routers.CommonActions.navigate({
        name: route.params.screen,
        params: route.params.params,
        path: route.params.path
      });
    }

    var updatedState = action ? router.getStateForAction(nextState, action, {
      routeNames: routeNames,
      routeParamList: routeParamList,
      routeGetIdList: routeGetIdList
    }) : null;
    nextState = updatedState !== null ? router.getRehydratedState(updatedState, {
      routeNames: routeNames,
      routeParamList: routeParamList,
      routeGetIdList: routeGetIdList
    }) : nextState;
  }

  var shouldUpdate = state !== nextState;
  (0, _useScheduleUpdate.default)(function () {
    if (shouldUpdate) {
      setState(nextState);
    }
  });
  state = nextState;
  React.useEffect(function () {
    setKey(navigatorKey);

    if (!getIsInitial()) {
      setState(nextState);
    }

    return function () {
      setTimeout(function () {
        if (getCurrentState() !== undefined && getKey() === navigatorKey) {
          cleanUpState();
        }
      }, 0);
    };
  }, []);
  var initializedStateRef = React.useRef();
  initializedStateRef.current = initializedState;
  var getState = React.useCallback(function () {
    var currentState = getCurrentState();
    return isStateInitialized(currentState) ? currentState : initializedStateRef.current;
  }, [getCurrentState, isStateInitialized]);
  var emitter = (0, _useEventEmitter.default)(function (e) {
    var _ref;

    var routeNames = [];
    var route;

    if (e.target) {
      var _route;

      route = state.routes.find(function (route) {
        return route.key === e.target;
      });

      if ((_route = route) !== null && _route !== void 0 && _route.name) {
        routeNames.push(route.name);
      }
    } else {
      route = state.routes[state.index];
      routeNames.push.apply(routeNames, (0, _toConsumableArray2.default)(Object.keys(screens).filter(function (name) {
        var _route2;

        return ((_route2 = route) === null || _route2 === void 0 ? void 0 : _route2.name) === name;
      })));
    }

    if (route == null) {
      return;
    }

    var navigation = descriptors[route.key].navigation;

    var listeners = (_ref = []).concat.apply(_ref, (0, _toConsumableArray2.default)([screenListeners].concat((0, _toConsumableArray2.default)(routeNames.map(function (name) {
      var listeners = screens[name].props.listeners;
      return listeners;
    }))).map(function (listeners) {
      var map = typeof listeners === 'function' ? listeners({
        route: route,
        navigation: navigation
      }) : listeners;
      return map ? Object.keys(map).filter(function (type) {
        return type === e.type;
      }).map(function (type) {
        return map === null || map === void 0 ? void 0 : map[type];
      }) : undefined;
    }))).filter(function (cb, i, self) {
      return cb && self.lastIndexOf(cb) === i;
    });

    listeners.forEach(function (listener) {
      return listener === null || listener === void 0 ? void 0 : listener(e);
    });
  });
  (0, _useFocusEvents.default)({
    state: state,
    emitter: emitter
  });
  React.useEffect(function () {
    emitter.emit({
      type: 'state',
      data: {
        state: state
      }
    });
  }, [emitter, state]);

  var _ref2 = (0, _useChildListeners.default)(),
      childListeners = _ref2.listeners,
      addListener = _ref2.addListener;

  var _ref3 = (0, _useKeyedChildListeners.default)(),
      keyedListeners = _ref3.keyedListeners,
      addKeyedListener = _ref3.addKeyedListener;

  var onAction = (0, _useOnAction.default)({
    router: router,
    getState: getState,
    setState: setState,
    key: route === null || route === void 0 ? void 0 : route.key,
    actionListeners: childListeners.action,
    beforeRemoveListeners: keyedListeners.beforeRemove,
    routerConfigOptions: {
      routeNames: routeNames,
      routeParamList: routeParamList,
      routeGetIdList: routeGetIdList
    },
    emitter: emitter
  });
  var onRouteFocus = (0, _useOnRouteFocus.default)({
    router: router,
    key: route === null || route === void 0 ? void 0 : route.key,
    getState: getState,
    setState: setState
  });
  var navigation = (0, _useNavigationHelpers.default)({
    onAction: onAction,
    getState: getState,
    emitter: emitter,
    router: router
  });
  (0, _useFocusedListenersChildrenAdapter.default)({
    navigation: navigation,
    focusedListeners: childListeners.focus
  });
  (0, _useOnGetState.default)({
    getState: getState,
    getStateListeners: keyedListeners.getState
  });
  var descriptors = (0, _useDescriptors.default)({
    state: state,
    screens: screens,
    navigation: navigation,
    screenOptions: options.screenOptions,
    defaultScreenOptions: options.defaultScreenOptions,
    onAction: onAction,
    getState: getState,
    setState: setState,
    onRouteFocus: onRouteFocus,
    addListener: addListener,
    addKeyedListener: addKeyedListener,
    router: router,
    emitter: emitter
  });
  (0, _useCurrentRender.default)({
    state: state,
    navigation: navigation,
    descriptors: descriptors
  });
  var NavigationContent = (0, _useComponent.default)(_NavigationHelpersContext.default.Provider, {
    value: navigation
  });
  return {
    state: state,
    navigation: navigation,
    descriptors: descriptors,
    NavigationContent: NavigationContent
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixvQkFBZ0IsRUFBRVYsY0FBYyxDQUFDVztBQUZBLEdBQW5DO0FBS0EsOEJBQWM7QUFDWmpFLFlBRFksRUFDWkEsUUFEWTtBQUVaa0UscUJBQWlCLEVBQUVWLGNBQWMsQ0FBQ3hEO0FBRnRCLEdBQWQ7QUFLQSxNQUFNNEMsV0FBVyxHQUFHLDZCQUtsQjtBQUNBdEUsU0FEQSxFQUNBQSxLQURBO0FBRUFPLFdBRkEsRUFFQUEsT0FGQTtBQUdBOEQsY0FIQSxFQUdBQSxVQUhBO0FBSUE1RixpQkFBYSxFQUFFSCxPQUFPLENBQUNHLGFBSnZCO0FBS0FvSCx3QkFBb0IsRUFBRXZILE9BQU8sQ0FBQ3VILG9CQUw5QjtBQU1BVCxZQU5BLEVBTUFBLFFBTkE7QUFPQTFELFlBUEEsRUFPQUEsUUFQQTtBQVFBRSxZQVJBLEVBUUFBLFFBUkE7QUFTQTZELGdCQVRBLEVBU0FBLFlBVEE7QUFVQVIsZUFWQSxFQVVBQSxXQVZBO0FBV0FFLG9CQVhBLEVBV0FBLGdCQVhBO0FBWUEvRSxVQVpBLEVBWUFBLE1BWkE7QUFjQTBEO0FBZEEsR0FMa0IsQ0FBcEI7QUFzQkEsaUNBQWlCO0FBQ2Y5RCxTQURlLEVBQ2ZBLEtBRGU7QUFFZnFFLGNBRmUsRUFFZkEsVUFGZTtBQUdmQztBQUhlLEdBQWpCO0FBTUEsTUFBTXdCLGlCQUFpQixHQUFHLDJCQUFhQyxrQ0FBeUJDLFFBQXRDLEVBQWdEO0FBQ3hFQyxTQUFLLEVBQUU1QjtBQURpRSxHQUFoRCxDQUExQjtBQUlBLFNBQU87QUFDTHJFLFNBREssRUFDTEEsS0FESztBQUVMcUUsY0FGSyxFQUVMQSxVQUZLO0FBR0xDLGVBSEssRUFHTEEsV0FISztBQUlMd0I7QUFKSyxHQUFQO0FBTUQiLCJuYW1lcyI6WyJQcml2YXRlVmFsdWVTdG9yZSIsImlzVmFsaWRLZXkiLCJrZXkiLCJ1bmRlZmluZWQiLCJnZXRSb3V0ZUNvbmZpZ3NGcm9tQ2hpbGRyZW4iLCJjaGlsZHJlbiIsImdyb3VwS2V5IiwiZ3JvdXBPcHRpb25zIiwiY29uZmlncyIsIlJlYWN0IiwiQ2hpbGRyZW4iLCJ0b0FycmF5IiwicmVkdWNlIiwiYWNjIiwiY2hpbGQiLCJpc1ZhbGlkRWxlbWVudCIsInR5cGUiLCJTY3JlZW4iLCJwcm9wcyIsIm5hdmlnYXRpb25LZXkiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJuYW1lIiwicHVzaCIsImtleXMiLCJvcHRpb25zIiwiRnJhZ21lbnQiLCJHcm91cCIsInNjcmVlbk9wdGlvbnMiLCJfY2hpbGQkdHlwZSIsIlN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImZvckVhY2giLCJjb25maWciLCJjb21wb25lbnQiLCJnZXRDb21wb25lbnQiLCJjb25zb2xlIiwid2FybiIsInRlc3QiLCJ1c2VOYXZpZ2F0aW9uQnVpbGRlciIsImNyZWF0ZVJvdXRlciIsIm5hdmlnYXRvcktleSIsInJvdXRlIiwidXNlQ29udGV4dCIsIk5hdmlnYXRpb25Sb3V0ZUNvbnRleHQiLCJzY3JlZW5MaXN0ZW5lcnMiLCJyZXN0IiwidXNlUmVmIiwicGFyYW1zIiwic3RhdGUiLCJpbml0aWFsIiwic2NyZWVuIiwiaW5pdGlhbFJvdXRlTmFtZSIsInJvdXRlciIsImN1cnJlbnQiLCJyb3V0ZUNvbmZpZ3MiLCJzY3JlZW5zIiwicm91dGVOYW1lcyIsIm1hcCIsInJvdXRlS2V5TGlzdCIsImN1cnIiLCJqb2luIiwicm91dGVQYXJhbUxpc3QiLCJpbml0aWFsUGFyYW1zIiwicm91dGVHZXRJZExpc3QiLCJPYmplY3QiLCJnZXRJZCIsImxlbmd0aCIsImlzU3RhdGVWYWxpZCIsInVzZUNhbGxiYWNrIiwiaXNTdGF0ZUluaXRpYWxpemVkIiwic3RhbGUiLCJOYXZpZ2F0aW9uU3RhdGVDb250ZXh0IiwiY3VycmVudFN0YXRlIiwiZ2V0Q3VycmVudFN0YXRlIiwiZ2V0U3RhdGUiLCJzZXRDdXJyZW50U3RhdGUiLCJzZXRTdGF0ZSIsInNldEtleSIsImdldEtleSIsImdldElzSW5pdGlhbCIsInN0YXRlQ2xlYW5lZFVwIiwiY2xlYW5VcFN0YXRlIiwidXNlTWVtbyIsImluaXRpYWxSb3V0ZVBhcmFtTGlzdCIsImluaXRpYWxQYXJhbXNGcm9tUGFyYW1zIiwiZ2V0SW5pdGlhbFN0YXRlIiwiZ2V0UmVoeWRyYXRlZFN0YXRlIiwiX3JvdXRlJHBhcmFtczUiLCJpbml0aWFsaXplZFN0YXRlIiwiaXNGaXJzdFN0YXRlSW5pdGlhbGl6YXRpb24iLCJwcmV2aW91c1JvdXRlS2V5TGlzdFJlZiIsInVzZUVmZmVjdCIsInByZXZpb3VzUm91dGVLZXlMaXN0IiwibmV4dFN0YXRlIiwiZ2V0U3RhdGVGb3JSb3V0ZU5hbWVzQ2hhbmdlIiwicm91dGVLZXlDaGFuZ2VzIiwiZmlsdGVyIiwiaGFzT3duUHJvcGVydHkiLCJwcmV2aW91c05lc3RlZFBhcmFtc1JlZiIsInByZXZpb3VzUGFyYW1zIiwiYWN0aW9uIiwiQ29tbW9uQWN0aW9ucyIsInJlc2V0IiwibmF2aWdhdGUiLCJwYXRoIiwidXBkYXRlZFN0YXRlIiwiZ2V0U3RhdGVGb3JBY3Rpb24iLCJzaG91bGRVcGRhdGUiLCJzZXRUaW1lb3V0IiwiaW5pdGlhbGl6ZWRTdGF0ZVJlZiIsImVtaXR0ZXIiLCJlIiwidGFyZ2V0Iiwicm91dGVzIiwiZmluZCIsIl9yb3V0ZSIsImluZGV4IiwibmF2aWdhdGlvbiIsImRlc2NyaXB0b3JzIiwibGlzdGVuZXJzIiwiY29uY2F0IiwiY2IiLCJpIiwic2VsZiIsImxhc3RJbmRleE9mIiwibGlzdGVuZXIiLCJlbWl0IiwiZGF0YSIsImNoaWxkTGlzdGVuZXJzIiwiYWRkTGlzdGVuZXIiLCJrZXllZExpc3RlbmVycyIsImFkZEtleWVkTGlzdGVuZXIiLCJvbkFjdGlvbiIsImFjdGlvbkxpc3RlbmVycyIsImJlZm9yZVJlbW92ZUxpc3RlbmVycyIsImJlZm9yZVJlbW92ZSIsInJvdXRlckNvbmZpZ09wdGlvbnMiLCJvblJvdXRlRm9jdXMiLCJmb2N1c2VkTGlzdGVuZXJzIiwiZm9jdXMiLCJnZXRTdGF0ZUxpc3RlbmVycyIsImRlZmF1bHRTY3JlZW5PcHRpb25zIiwiTmF2aWdhdGlvbkNvbnRlbnQiLCJOYXZpZ2F0aW9uSGVscGVyc0NvbnRleHQiLCJQcm92aWRlciIsInZhbHVlIl0sInNvdXJjZXMiOlsidXNlTmF2aWdhdGlvbkJ1aWxkZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbW1vbkFjdGlvbnMsXG4gIERlZmF1bHRSb3V0ZXJPcHRpb25zLFxuICBOYXZpZ2F0aW9uQWN0aW9uLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcmFtTGlzdEJhc2UsXG4gIFBhcnRpYWxTdGF0ZSxcbiAgUm91dGUsXG4gIFJvdXRlcixcbiAgUm91dGVyQ29uZmlnT3B0aW9ucyxcbiAgUm91dGVyRmFjdG9yeSxcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBpc1ZhbGlkRWxlbWVudFR5cGUgfSBmcm9tICdyZWFjdC1pcyc7XG5cbmltcG9ydCBHcm91cCBmcm9tICcuL0dyb3VwJztcbmltcG9ydCBpc0FycmF5RXF1YWwgZnJvbSAnLi9pc0FycmF5RXF1YWwnO1xuaW1wb3J0IGlzUmVjb3JkRXF1YWwgZnJvbSAnLi9pc1JlY29yZEVxdWFsJztcbmltcG9ydCBOYXZpZ2F0aW9uSGVscGVyc0NvbnRleHQgZnJvbSAnLi9OYXZpZ2F0aW9uSGVscGVyc0NvbnRleHQnO1xuaW1wb3J0IE5hdmlnYXRpb25Sb3V0ZUNvbnRleHQgZnJvbSAnLi9OYXZpZ2F0aW9uUm91dGVDb250ZXh0JztcbmltcG9ydCBOYXZpZ2F0aW9uU3RhdGVDb250ZXh0IGZyb20gJy4vTmF2aWdhdGlvblN0YXRlQ29udGV4dCc7XG5pbXBvcnQgU2NyZWVuIGZyb20gJy4vU2NyZWVuJztcbmltcG9ydCB7XG4gIERlZmF1bHROYXZpZ2F0b3JPcHRpb25zLFxuICBFdmVudE1hcEJhc2UsXG4gIEV2ZW50TWFwQ29yZSxcbiAgTmF2aWdhdG9yU2NyZWVuUGFyYW1zLFxuICBQcml2YXRlVmFsdWVTdG9yZSxcbiAgUm91dGVDb25maWcsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHVzZUNoaWxkTGlzdGVuZXJzIGZyb20gJy4vdXNlQ2hpbGRMaXN0ZW5lcnMnO1xuaW1wb3J0IHVzZUNvbXBvbmVudCBmcm9tICcuL3VzZUNvbXBvbmVudCc7XG5pbXBvcnQgdXNlQ3VycmVudFJlbmRlciBmcm9tICcuL3VzZUN1cnJlbnRSZW5kZXInO1xuaW1wb3J0IHVzZURlc2NyaXB0b3JzLCB7IFNjcmVlbkNvbmZpZ1dpdGhQYXJlbnQgfSBmcm9tICcuL3VzZURlc2NyaXB0b3JzJztcbmltcG9ydCB1c2VFdmVudEVtaXR0ZXIgZnJvbSAnLi91c2VFdmVudEVtaXR0ZXInO1xuaW1wb3J0IHVzZUZvY3VzZWRMaXN0ZW5lcnNDaGlsZHJlbkFkYXB0ZXIgZnJvbSAnLi91c2VGb2N1c2VkTGlzdGVuZXJzQ2hpbGRyZW5BZGFwdGVyJztcbmltcG9ydCB1c2VGb2N1c0V2ZW50cyBmcm9tICcuL3VzZUZvY3VzRXZlbnRzJztcbmltcG9ydCB1c2VLZXllZENoaWxkTGlzdGVuZXJzIGZyb20gJy4vdXNlS2V5ZWRDaGlsZExpc3RlbmVycyc7XG5pbXBvcnQgdXNlTmF2aWdhdGlvbkhlbHBlcnMgZnJvbSAnLi91c2VOYXZpZ2F0aW9uSGVscGVycyc7XG5pbXBvcnQgdXNlT25BY3Rpb24gZnJvbSAnLi91c2VPbkFjdGlvbic7XG5pbXBvcnQgdXNlT25HZXRTdGF0ZSBmcm9tICcuL3VzZU9uR2V0U3RhdGUnO1xuaW1wb3J0IHVzZU9uUm91dGVGb2N1cyBmcm9tICcuL3VzZU9uUm91dGVGb2N1cyc7XG5pbXBvcnQgdXNlUmVnaXN0ZXJOYXZpZ2F0b3IgZnJvbSAnLi91c2VSZWdpc3Rlck5hdmlnYXRvcic7XG5pbXBvcnQgdXNlU2NoZWR1bGVVcGRhdGUgZnJvbSAnLi91c2VTY2hlZHVsZVVwZGF0ZSc7XG5cbi8vIFRoaXMgaXMgdG8gbWFrZSBUeXBlU2NyaXB0IGNvbXBpbGVyIGhhcHB5XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgYmFiZWwvbm8tdW51c2VkLWV4cHJlc3Npb25zXG5Qcml2YXRlVmFsdWVTdG9yZTtcblxudHlwZSBOYXZpZ2F0b3JSb3V0ZTxTdGF0ZSBleHRlbmRzIE5hdmlnYXRpb25TdGF0ZT4gPSB7XG4gIGtleTogc3RyaW5nO1xuICBwYXJhbXM/OiBOYXZpZ2F0b3JTY3JlZW5QYXJhbXM8UGFyYW1MaXN0QmFzZSwgU3RhdGU+O1xufTtcblxuY29uc3QgaXNWYWxpZEtleSA9IChrZXk6IHVua25vd24pID0+XG4gIGtleSA9PT0gdW5kZWZpbmVkIHx8ICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiBrZXkgIT09ICcnKTtcblxuLyoqXG4gKiBFeHRyYWN0IHJvdXRlIGNvbmZpZyBvYmplY3QgZnJvbSBSZWFjdCBjaGlsZHJlbiBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gY2hpbGRyZW4gUmVhY3QgRWxlbWVudHMgdG8gZXh0cmFjdCB0aGUgY29uZmlnIGZyb20uXG4gKi9cbmNvbnN0IGdldFJvdXRlQ29uZmlnc0Zyb21DaGlsZHJlbiA9IDxcbiAgU3RhdGUgZXh0ZW5kcyBOYXZpZ2F0aW9uU3RhdGUsXG4gIFNjcmVlbk9wdGlvbnMgZXh0ZW5kcyB7fSxcbiAgRXZlbnRNYXAgZXh0ZW5kcyBFdmVudE1hcEJhc2Vcbj4oXG4gIGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGUsXG4gIGdyb3VwS2V5Pzogc3RyaW5nLFxuICBncm91cE9wdGlvbnM/OiBTY3JlZW5Db25maWdXaXRoUGFyZW50PFxuICAgIFN0YXRlLFxuICAgIFNjcmVlbk9wdGlvbnMsXG4gICAgRXZlbnRNYXBcbiAgPlsnb3B0aW9ucyddXG4pID0+IHtcbiAgY29uc3QgY29uZmlncyA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pLnJlZHVjZTxcbiAgICBTY3JlZW5Db25maWdXaXRoUGFyZW50PFN0YXRlLCBTY3JlZW5PcHRpb25zLCBFdmVudE1hcD5bXVxuICA+KChhY2MsIGNoaWxkKSA9PiB7XG4gICAgaWYgKFJlYWN0LmlzVmFsaWRFbGVtZW50KGNoaWxkKSkge1xuICAgICAgaWYgKGNoaWxkLnR5cGUgPT09IFNjcmVlbikge1xuICAgICAgICAvLyBXZSBjYW4gb25seSBleHRyYWN0IHRoZSBjb25maWcgZnJvbSBgU2NyZWVuYCBlbGVtZW50c1xuICAgICAgICAvLyBJZiBzb21ldGhpbmcgZWxzZSB3YXMgcmVuZGVyZWQsIGl0J3MgcHJvYmFibHkgYSBidWdcblxuICAgICAgICBpZiAoIWlzVmFsaWRLZXkoY2hpbGQucHJvcHMubmF2aWdhdGlvbktleSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgR290IGFuIGludmFsaWQgJ25hdmlnYXRpb25LZXknIHByb3AgKCR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgIGNoaWxkLnByb3BzLm5hdmlnYXRpb25LZXlcbiAgICAgICAgICAgICl9KSBmb3IgdGhlIHNjcmVlbiAnJHtcbiAgICAgICAgICAgICAgY2hpbGQucHJvcHMubmFtZVxuICAgICAgICAgICAgfScuIEl0IG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nIG9yICd1bmRlZmluZWQnLmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgYWNjLnB1c2goe1xuICAgICAgICAgIGtleXM6IFtncm91cEtleSwgY2hpbGQucHJvcHMubmF2aWdhdGlvbktleV0sXG4gICAgICAgICAgb3B0aW9uczogZ3JvdXBPcHRpb25zLFxuICAgICAgICAgIHByb3BzOiBjaGlsZC5wcm9wcyBhcyBSb3V0ZUNvbmZpZzxcbiAgICAgICAgICAgIFBhcmFtTGlzdEJhc2UsXG4gICAgICAgICAgICBzdHJpbmcsXG4gICAgICAgICAgICBTdGF0ZSxcbiAgICAgICAgICAgIFNjcmVlbk9wdGlvbnMsXG4gICAgICAgICAgICBFdmVudE1hcFxuICAgICAgICAgID4sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2hpbGQudHlwZSA9PT0gUmVhY3QuRnJhZ21lbnQgfHwgY2hpbGQudHlwZSA9PT0gR3JvdXApIHtcbiAgICAgICAgaWYgKCFpc1ZhbGlkS2V5KGNoaWxkLnByb3BzLm5hdmlnYXRpb25LZXkpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEdvdCBhbiBpbnZhbGlkICduYXZpZ2F0aW9uS2V5JyBwcm9wICgke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICBjaGlsZC5wcm9wcy5uYXZpZ2F0aW9uS2V5XG4gICAgICAgICAgICApfSkgZm9yIHRoZSBncm91cC4gSXQgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcgb3IgJ3VuZGVmaW5lZCcuYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHdlIGVuY291bnRlciBhIGZyYWdtZW50IG9yIGdyb3VwLCB3ZSBuZWVkIHRvIGRpdmUgaW50byBpdHMgY2hpbGRyZW4gdG8gZXh0cmFjdCB0aGUgY29uZmlnc1xuICAgICAgICAvLyBUaGlzIGlzIGhhbmR5IHRvIGNvbmRpdGlvbmFsbHkgZGVmaW5lIGEgZ3JvdXAgb2Ygc2NyZWVuc1xuICAgICAgICBhY2MucHVzaChcbiAgICAgICAgICAuLi5nZXRSb3V0ZUNvbmZpZ3NGcm9tQ2hpbGRyZW48U3RhdGUsIFNjcmVlbk9wdGlvbnMsIEV2ZW50TWFwPihcbiAgICAgICAgICAgIGNoaWxkLnByb3BzLmNoaWxkcmVuLFxuICAgICAgICAgICAgY2hpbGQucHJvcHMubmF2aWdhdGlvbktleSxcbiAgICAgICAgICAgIGNoaWxkLnR5cGUgIT09IEdyb3VwXG4gICAgICAgICAgICAgID8gZ3JvdXBPcHRpb25zXG4gICAgICAgICAgICAgIDogZ3JvdXBPcHRpb25zICE9IG51bGxcbiAgICAgICAgICAgICAgPyBbLi4uZ3JvdXBPcHRpb25zLCBjaGlsZC5wcm9wcy5zY3JlZW5PcHRpb25zXVxuICAgICAgICAgICAgICA6IFtjaGlsZC5wcm9wcy5zY3JlZW5PcHRpb25zXVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgQSBuYXZpZ2F0b3IgY2FuIG9ubHkgY29udGFpbiAnU2NyZWVuJywgJ0dyb3VwJyBvciAnUmVhY3QuRnJhZ21lbnQnIGFzIGl0cyBkaXJlY3QgY2hpbGRyZW4gKGZvdW5kICR7XG4gICAgICAgIFJlYWN0LmlzVmFsaWRFbGVtZW50KGNoaWxkKVxuICAgICAgICAgID8gYCcke1xuICAgICAgICAgICAgICB0eXBlb2YgY2hpbGQudHlwZSA9PT0gJ3N0cmluZycgPyBjaGlsZC50eXBlIDogY2hpbGQudHlwZT8ubmFtZVxuICAgICAgICAgICAgfScke1xuICAgICAgICAgICAgICBjaGlsZC5wcm9wcz8ubmFtZSA/IGAgZm9yIHRoZSBzY3JlZW4gJyR7Y2hpbGQucHJvcHMubmFtZX0nYCA6ICcnXG4gICAgICAgICAgICB9YFxuICAgICAgICAgIDogdHlwZW9mIGNoaWxkID09PSAnb2JqZWN0J1xuICAgICAgICAgID8gSlNPTi5zdHJpbmdpZnkoY2hpbGQpXG4gICAgICAgICAgOiBgJyR7U3RyaW5nKGNoaWxkKX0nYFxuICAgICAgfSkuIFRvIHJlbmRlciB0aGlzIGNvbXBvbmVudCBpbiB0aGUgbmF2aWdhdG9yLCBwYXNzIGl0IGluIHRoZSAnY29tcG9uZW50JyBwcm9wIHRvICdTY3JlZW4nLmBcbiAgICApO1xuICB9LCBbXSk7XG5cbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICBjb25maWdzLmZvckVhY2goKGNvbmZpZykgPT4ge1xuICAgICAgY29uc3QgeyBuYW1lLCBjaGlsZHJlbiwgY29tcG9uZW50LCBnZXRDb21wb25lbnQgfSA9IGNvbmZpZy5wcm9wcztcblxuICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyB8fCAhbmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEdvdCBhbiBpbnZhbGlkIG5hbWUgKCR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICBuYW1lXG4gICAgICAgICAgKX0pIGZvciB0aGUgc2NyZWVuLiBJdCBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZy5gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgY2hpbGRyZW4gIT0gbnVsbCB8fFxuICAgICAgICBjb21wb25lbnQgIT09IHVuZGVmaW5lZCB8fFxuICAgICAgICBnZXRDb21wb25lbnQgIT09IHVuZGVmaW5lZFxuICAgICAgKSB7XG4gICAgICAgIGlmIChjaGlsZHJlbiAhPSBudWxsICYmIGNvbXBvbmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEdvdCBib3RoICdjb21wb25lbnQnIGFuZCAnY2hpbGRyZW4nIHByb3BzIGZvciB0aGUgc2NyZWVuICcke25hbWV9Jy4gWW91IG11c3QgcGFzcyBvbmx5IG9uZSBvZiB0aGVtLmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoaWxkcmVuICE9IG51bGwgJiYgZ2V0Q29tcG9uZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgR290IGJvdGggJ2dldENvbXBvbmVudCcgYW5kICdjaGlsZHJlbicgcHJvcHMgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBZb3UgbXVzdCBwYXNzIG9ubHkgb25lIG9mIHRoZW0uYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcG9uZW50ICE9PSB1bmRlZmluZWQgJiYgZ2V0Q29tcG9uZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgR290IGJvdGggJ2NvbXBvbmVudCcgYW5kICdnZXRDb21wb25lbnQnIHByb3BzIGZvciB0aGUgc2NyZWVuICcke25hbWV9Jy4gWW91IG11c3QgcGFzcyBvbmx5IG9uZSBvZiB0aGVtLmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoaWxkcmVuICE9IG51bGwgJiYgdHlwZW9mIGNoaWxkcmVuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEdvdCBhbiBpbnZhbGlkIHZhbHVlIGZvciAnY2hpbGRyZW4nIHByb3AgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBJdCBtdXN0IGJlIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGEgUmVhY3QgRWxlbWVudC5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wb25lbnQgIT09IHVuZGVmaW5lZCAmJiAhaXNWYWxpZEVsZW1lbnRUeXBlKGNvbXBvbmVudCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgR290IGFuIGludmFsaWQgdmFsdWUgZm9yICdjb21wb25lbnQnIHByb3AgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBJdCBtdXN0IGJlIGEgdmFsaWQgUmVhY3QgQ29tcG9uZW50LmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdldENvbXBvbmVudCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBnZXRDb21wb25lbnQgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgR290IGFuIGludmFsaWQgdmFsdWUgZm9yICdnZXRDb21wb25lbnQnIHByb3AgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBJdCBtdXN0IGJlIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGEgUmVhY3QgQ29tcG9uZW50LmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjb21wb25lbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgPT09ICdjb21wb25lbnQnKSB7XG4gICAgICAgICAgICAvLyBJbmxpbmUgYW5vbnltb3VzIGZ1bmN0aW9ucyBwYXNzZWQgaW4gdGhlIGBjb21wb25lbnRgIHByb3Agd2lsbCBoYXZlIHRoZSBuYW1lIG9mIHRoZSBwcm9wXG4gICAgICAgICAgICAvLyBJdCdzIHJlbGF0aXZlbHkgc2FmZSB0byBhc3N1bWUgdGhhdCBpdCdzIG5vdCBhIGNvbXBvbmVudCBzaW5jZSBpdCBzaG91bGQgYWxzbyBoYXZlIFBhc2NhbENhc2UgbmFtZVxuICAgICAgICAgICAgLy8gV2Ugd29uJ3QgY2F0Y2ggYWxsIHNjZW5hcmlvcyBoZXJlLCBidXQgdGhpcyBzaG91bGQgY2F0Y2ggYSBnb29kIGNodW5rIG9mIGluY29ycmVjdCB1c2UuXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgIGBMb29rcyBsaWtlIHlvdSdyZSBwYXNzaW5nIGFuIGlubGluZSBmdW5jdGlvbiBmb3IgJ2NvbXBvbmVudCcgcHJvcCBmb3IgdGhlIHNjcmVlbiAnJHtuYW1lfScgKGUuZy4gY29tcG9uZW50PXsoKSA9PiA8U29tZUNvbXBvbmVudCAvPn0pLiBQYXNzaW5nIGFuIGlubGluZSBmdW5jdGlvbiB3aWxsIGNhdXNlIHRoZSBjb21wb25lbnQgc3RhdGUgdG8gYmUgbG9zdCBvbiByZS1yZW5kZXIgYW5kIGNhdXNlIHBlcmYgaXNzdWVzIHNpbmNlIGl0J3MgcmUtY3JlYXRlZCBldmVyeSByZW5kZXIuIFlvdSBjYW4gcGFzcyB0aGUgZnVuY3Rpb24gYXMgY2hpbGRyZW4gdG8gJ1NjcmVlbicgaW5zdGVhZCB0byBhY2hpZXZlIHRoZSBkZXNpcmVkIGJlaGF2aW91ci5gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoL15bYS16XS8udGVzdChjb21wb25lbnQubmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgYEdvdCBhIGNvbXBvbmVudCB3aXRoIHRoZSBuYW1lICcke2NvbXBvbmVudC5uYW1lfScgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBSZWFjdCBDb21wb25lbnRzIG11c3Qgc3RhcnQgd2l0aCBhbiB1cHBlcmNhc2UgbGV0dGVyLiBJZiB5b3UncmUgcGFzc2luZyBhIHJlZ3VsYXIgZnVuY3Rpb24gYW5kIG5vdCBhIGNvbXBvbmVudCwgcGFzcyBpdCBhcyBjaGlsZHJlbiB0byAnU2NyZWVuJyBpbnN0ZWFkLiBPdGhlcndpc2UgY2FwaXRhbGl6ZSB5b3VyIGNvbXBvbmVudCdzIG5hbWUuYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ291bGRuJ3QgZmluZCBhICdjb21wb25lbnQnLCAnZ2V0Q29tcG9uZW50JyBvciAnY2hpbGRyZW4nIHByb3AgZm9yIHRoZSBzY3JlZW4gJyR7bmFtZX0nLiBUaGlzIGNhbiBoYXBwZW4gaWYgeW91IHBhc3NlZCAndW5kZWZpbmVkJy4gWW91IGxpa2VseSBmb3Jnb3QgdG8gZXhwb3J0IHlvdXIgY29tcG9uZW50IGZyb20gdGhlIGZpbGUgaXQncyBkZWZpbmVkIGluLCBvciBtaXhlZCB1cCBkZWZhdWx0IGltcG9ydCBhbmQgbmFtZWQgaW1wb3J0IHdoZW4gaW1wb3J0aW5nLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBjb25maWdzO1xufTtcblxuLyoqXG4gKiBIb29rIGZvciBidWlsZGluZyBuYXZpZ2F0b3JzLlxuICpcbiAqIEBwYXJhbSBjcmVhdGVSb3V0ZXIgRmFjdG9yeSBtZXRob2Qgd2hpY2ggcmV0dXJucyByb3V0ZXIgb2JqZWN0LlxuICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBvYmplY3QgY29udGFpbmluZyBgY2hpbGRyZW5gIGFuZCBhZGRpdGlvbmFsIG9wdGlvbnMgZm9yIHRoZSByb3V0ZXIuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBgc3RhdGVgLCBgbmF2aWdhdGlvbmAsIGBkZXNjcmlwdG9yc2Agb2JqZWN0cy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXNlTmF2aWdhdGlvbkJ1aWxkZXI8XG4gIFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlLFxuICBSb3V0ZXJPcHRpb25zIGV4dGVuZHMgRGVmYXVsdFJvdXRlck9wdGlvbnMsXG4gIEFjdGlvbkhlbHBlcnMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCAoKSA9PiB2b2lkPixcbiAgU2NyZWVuT3B0aW9ucyBleHRlbmRzIHt9LFxuICBFdmVudE1hcCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT5cbj4oXG4gIGNyZWF0ZVJvdXRlcjogUm91dGVyRmFjdG9yeTxTdGF0ZSwgYW55LCBSb3V0ZXJPcHRpb25zPixcbiAgb3B0aW9uczogRGVmYXVsdE5hdmlnYXRvck9wdGlvbnM8XG4gICAgUGFyYW1MaXN0QmFzZSxcbiAgICBTdGF0ZSxcbiAgICBTY3JlZW5PcHRpb25zLFxuICAgIEV2ZW50TWFwXG4gID4gJlxuICAgIFJvdXRlck9wdGlvbnNcbikge1xuICBjb25zdCBuYXZpZ2F0b3JLZXkgPSB1c2VSZWdpc3Rlck5hdmlnYXRvcigpO1xuXG4gIGNvbnN0IHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uUm91dGVDb250ZXh0KSBhc1xuICAgIHwgTmF2aWdhdG9yUm91dGU8U3RhdGU+XG4gICAgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3QgeyBjaGlsZHJlbiwgc2NyZWVuTGlzdGVuZXJzLCAuLi5yZXN0IH0gPSBvcHRpb25zO1xuICBjb25zdCB7IGN1cnJlbnQ6IHJvdXRlciB9ID0gUmVhY3QudXNlUmVmPFJvdXRlcjxTdGF0ZSwgYW55Pj4oXG4gICAgY3JlYXRlUm91dGVyKHtcbiAgICAgIC4uLihyZXN0IGFzIHVua25vd24gYXMgUm91dGVyT3B0aW9ucyksXG4gICAgICAuLi4ocm91dGU/LnBhcmFtcyAmJlxuICAgICAgcm91dGUucGFyYW1zLnN0YXRlID09IG51bGwgJiZcbiAgICAgIHJvdXRlLnBhcmFtcy5pbml0aWFsICE9PSBmYWxzZSAmJlxuICAgICAgdHlwZW9mIHJvdXRlLnBhcmFtcy5zY3JlZW4gPT09ICdzdHJpbmcnXG4gICAgICAgID8geyBpbml0aWFsUm91dGVOYW1lOiByb3V0ZS5wYXJhbXMuc2NyZWVuIH1cbiAgICAgICAgOiBudWxsKSxcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0IHJvdXRlQ29uZmlncyA9IGdldFJvdXRlQ29uZmlnc0Zyb21DaGlsZHJlbjxcbiAgICBTdGF0ZSxcbiAgICBTY3JlZW5PcHRpb25zLFxuICAgIEV2ZW50TWFwXG4gID4oY2hpbGRyZW4pO1xuXG4gIGNvbnN0IHNjcmVlbnMgPSByb3V0ZUNvbmZpZ3MucmVkdWNlPFxuICAgIFJlY29yZDxzdHJpbmcsIFNjcmVlbkNvbmZpZ1dpdGhQYXJlbnQ8U3RhdGUsIFNjcmVlbk9wdGlvbnMsIEV2ZW50TWFwPj5cbiAgPigoYWNjLCBjb25maWcpID0+IHtcbiAgICBpZiAoY29uZmlnLnByb3BzLm5hbWUgaW4gYWNjKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBBIG5hdmlnYXRvciBjYW5ub3QgY29udGFpbiBtdWx0aXBsZSAnU2NyZWVuJyBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgbmFtZSAoZm91bmQgZHVwbGljYXRlIHNjcmVlbiBuYW1lZCAnJHtjb25maWcucHJvcHMubmFtZX0nKWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgYWNjW2NvbmZpZy5wcm9wcy5uYW1lXSA9IGNvbmZpZztcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG5cbiAgY29uc3Qgcm91dGVOYW1lcyA9IHJvdXRlQ29uZmlncy5tYXAoKGNvbmZpZykgPT4gY29uZmlnLnByb3BzLm5hbWUpO1xuICBjb25zdCByb3V0ZUtleUxpc3QgPSByb3V0ZU5hbWVzLnJlZHVjZTxSZWNvcmQ8c3RyaW5nLCBSZWFjdC5LZXkgfCB1bmRlZmluZWQ+PihcbiAgICAoYWNjLCBjdXJyKSA9PiB7XG4gICAgICBhY2NbY3Vycl0gPSBzY3JlZW5zW2N1cnJdLmtleXMubWFwKChrZXkpID0+IGtleSA/PyAnJykuam9pbignOicpO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIGNvbnN0IHJvdXRlUGFyYW1MaXN0ID0gcm91dGVOYW1lcy5yZWR1Y2U8UmVjb3JkPHN0cmluZywgb2JqZWN0IHwgdW5kZWZpbmVkPj4oXG4gICAgKGFjYywgY3VycikgPT4ge1xuICAgICAgY29uc3QgeyBpbml0aWFsUGFyYW1zIH0gPSBzY3JlZW5zW2N1cnJdLnByb3BzO1xuICAgICAgYWNjW2N1cnJdID0gaW5pdGlhbFBhcmFtcztcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICB7fVxuICApO1xuICBjb25zdCByb3V0ZUdldElkTGlzdCA9IHJvdXRlTmFtZXMucmVkdWNlPFxuICAgIFJvdXRlckNvbmZpZ09wdGlvbnNbJ3JvdXRlR2V0SWRMaXN0J11cbiAgPihcbiAgICAoYWNjLCBjdXJyKSA9PlxuICAgICAgT2JqZWN0LmFzc2lnbihhY2MsIHtcbiAgICAgICAgW2N1cnJdOiBzY3JlZW5zW2N1cnJdLnByb3BzLmdldElkLFxuICAgICAgfSksXG4gICAge31cbiAgKTtcblxuICBpZiAoIXJvdXRlTmFtZXMubGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJDb3VsZG4ndCBmaW5kIGFueSBzY3JlZW5zIGZvciB0aGUgbmF2aWdhdG9yLiBIYXZlIHlvdSBkZWZpbmVkIGFueSBzY3JlZW5zIGFzIGl0cyBjaGlsZHJlbj9cIlxuICAgICk7XG4gIH1cblxuICBjb25zdCBpc1N0YXRlVmFsaWQgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICAoc3RhdGUpID0+IHN0YXRlLnR5cGUgPT09IHVuZGVmaW5lZCB8fCBzdGF0ZS50eXBlID09PSByb3V0ZXIudHlwZSxcbiAgICBbcm91dGVyLnR5cGVdXG4gICk7XG5cbiAgY29uc3QgaXNTdGF0ZUluaXRpYWxpemVkID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgKHN0YXRlKSA9PlxuICAgICAgc3RhdGUgIT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5zdGFsZSA9PT0gZmFsc2UgJiYgaXNTdGF0ZVZhbGlkKHN0YXRlKSxcbiAgICBbaXNTdGF0ZVZhbGlkXVxuICApO1xuXG4gIGNvbnN0IHtcbiAgICBzdGF0ZTogY3VycmVudFN0YXRlLFxuICAgIGdldFN0YXRlOiBnZXRDdXJyZW50U3RhdGUsXG4gICAgc2V0U3RhdGU6IHNldEN1cnJlbnRTdGF0ZSxcbiAgICBzZXRLZXksXG4gICAgZ2V0S2V5LFxuICAgIGdldElzSW5pdGlhbCxcbiAgfSA9IFJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvblN0YXRlQ29udGV4dCk7XG5cbiAgY29uc3Qgc3RhdGVDbGVhbmVkVXAgPSBSZWFjdC51c2VSZWYoZmFsc2UpO1xuXG4gIGNvbnN0IGNsZWFuVXBTdGF0ZSA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRDdXJyZW50U3RhdGUodW5kZWZpbmVkKTtcbiAgICBzdGF0ZUNsZWFuZWRVcC5jdXJyZW50ID0gdHJ1ZTtcbiAgfSwgW3NldEN1cnJlbnRTdGF0ZV0pO1xuXG4gIGNvbnN0IHNldFN0YXRlID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgKHN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUgfCBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiB8IHVuZGVmaW5lZCkgPT4ge1xuICAgICAgaWYgKHN0YXRlQ2xlYW5lZFVwLmN1cnJlbnQpIHtcbiAgICAgICAgLy8gU3RhdGUgbWlnaHQgaGF2ZSBiZWVuIGFscmVhZHkgY2xlYW5lZCB1cCBkdWUgdG8gdW5tb3VudFxuICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCB0byBleHBvc2UgQVBJIGFsbG93aW5nIHRvIG92ZXJyaWRlIHRoaXNcbiAgICAgICAgLy8gVGhpcyB3b3VsZCBsZWFkIHRvIG9sZCBkYXRhIHByZXNlcnZhdGlvbiBvbiBtYWluIG5hdmlnYXRvciB1bm1vdW50XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNldEN1cnJlbnRTdGF0ZShzdGF0ZSk7XG4gICAgfSxcbiAgICBbc2V0Q3VycmVudFN0YXRlXVxuICApO1xuXG4gIGNvbnN0IFtpbml0aWFsaXplZFN0YXRlLCBpc0ZpcnN0U3RhdGVJbml0aWFsaXphdGlvbl0gPSBSZWFjdC51c2VNZW1vKCgpID0+IHtcbiAgICBjb25zdCBpbml0aWFsUm91dGVQYXJhbUxpc3QgPSByb3V0ZU5hbWVzLnJlZHVjZTxcbiAgICAgIFJlY29yZDxzdHJpbmcsIG9iamVjdCB8IHVuZGVmaW5lZD5cbiAgICA+KChhY2MsIGN1cnIpID0+IHtcbiAgICAgIGNvbnN0IHsgaW5pdGlhbFBhcmFtcyB9ID0gc2NyZWVuc1tjdXJyXS5wcm9wcztcbiAgICAgIGNvbnN0IGluaXRpYWxQYXJhbXNGcm9tUGFyYW1zID1cbiAgICAgICAgcm91dGU/LnBhcmFtcz8uc3RhdGUgPT0gbnVsbCAmJlxuICAgICAgICByb3V0ZT8ucGFyYW1zPy5pbml0aWFsICE9PSBmYWxzZSAmJlxuICAgICAgICByb3V0ZT8ucGFyYW1zPy5zY3JlZW4gPT09IGN1cnJcbiAgICAgICAgICA/IHJvdXRlLnBhcmFtcy5wYXJhbXNcbiAgICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgICAgYWNjW2N1cnJdID1cbiAgICAgICAgaW5pdGlhbFBhcmFtcyAhPT0gdW5kZWZpbmVkIHx8IGluaXRpYWxQYXJhbXNGcm9tUGFyYW1zICE9PSB1bmRlZmluZWRcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgLi4uaW5pdGlhbFBhcmFtcyxcbiAgICAgICAgICAgICAgLi4uaW5pdGlhbFBhcmFtc0Zyb21QYXJhbXMsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuXG4gICAgLy8gSWYgdGhlIGN1cnJlbnQgc3RhdGUgaXNuJ3QgaW5pdGlhbGl6ZWQgb24gZmlyc3QgcmVuZGVyLCB3ZSBpbml0aWFsaXplIGl0XG4gICAgLy8gV2UgYWxzbyBuZWVkIHRvIHJlLWluaXRpYWxpemUgaXQgaWYgdGhlIHN0YXRlIHBhc3NlZCBmcm9tIHBhcmVudCB3YXMgY2hhbmdlZCAobWF5YmUgZHVlIHRvIHJlc2V0KVxuICAgIC8vIE90aGVyd2lzZSBhc3N1bWUgdGhhdCB0aGUgc3RhdGUgd2FzIHByb3ZpZGVkIGFzIGluaXRpYWwgc3RhdGVcbiAgICAvLyBTbyB3ZSBuZWVkIHRvIHJlaHlkcmF0ZSBpdCB0byBtYWtlIGl0IHVzYWJsZVxuICAgIGlmIChcbiAgICAgIChjdXJyZW50U3RhdGUgPT09IHVuZGVmaW5lZCB8fCAhaXNTdGF0ZVZhbGlkKGN1cnJlbnRTdGF0ZSkpICYmXG4gICAgICByb3V0ZT8ucGFyYW1zPy5zdGF0ZSA9PSBudWxsXG4gICAgKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICByb3V0ZXIuZ2V0SW5pdGlhbFN0YXRlKHtcbiAgICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICAgIHJvdXRlUGFyYW1MaXN0OiBpbml0aWFsUm91dGVQYXJhbUxpc3QsXG4gICAgICAgICAgcm91dGVHZXRJZExpc3QsXG4gICAgICAgIH0pLFxuICAgICAgICB0cnVlLFxuICAgICAgXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgcm91dGVyLmdldFJlaHlkcmF0ZWRTdGF0ZShcbiAgICAgICAgICByb3V0ZT8ucGFyYW1zPy5zdGF0ZSA/PyAoY3VycmVudFN0YXRlIGFzIFBhcnRpYWxTdGF0ZTxTdGF0ZT4pLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgICAgICByb3V0ZVBhcmFtTGlzdDogaW5pdGlhbFJvdXRlUGFyYW1MaXN0LFxuICAgICAgICAgICAgcm91dGVHZXRJZExpc3QsXG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICBmYWxzZSxcbiAgICAgIF07XG4gICAgfVxuICAgIC8vIFdlIGV4cGxpY2l0bHkgZG9uJ3QgaW5jbHVkZSByb3V0ZU5hbWVzLCByb3V0ZS5wYXJhbXMgZXRjLiBpbiB0aGUgZGVwIGxpc3RcbiAgICAvLyBiZWxvdy4gV2Ugd2FudCB0byBhdm9pZCBmb3JjaW5nIGEgbmV3IHN0YXRlIHRvIGJlIGNhbGN1bGF0ZWQgaW4gdGhvc2UgY2FzZXNcbiAgICAvLyBJbnN0ZWFkLCB3ZSBoYW5kbGUgY2hhbmdlcyB0byB0aGVzZSBpbiB0aGUgbmV4dFN0YXRlIGNvZGUgYmVsb3cuIE5vdGVcbiAgICAvLyB0aGF0IHNvbWUgY2hhbmdlcyB0byByb3V0ZUNvbmZpZ3MgYXJlIGV4cGxpY2l0bHkgaWdub3JlZCwgc3VjaCBhcyBjaGFuZ2VzXG4gICAgLy8gdG8gaW5pdGlhbFBhcmFtc1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW2N1cnJlbnRTdGF0ZSwgcm91dGVyLCBpc1N0YXRlVmFsaWRdKTtcblxuICBjb25zdCBwcmV2aW91c1JvdXRlS2V5TGlzdFJlZiA9IFJlYWN0LnVzZVJlZihyb3V0ZUtleUxpc3QpO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcHJldmlvdXNSb3V0ZUtleUxpc3RSZWYuY3VycmVudCA9IHJvdXRlS2V5TGlzdDtcbiAgfSk7XG5cbiAgY29uc3QgcHJldmlvdXNSb3V0ZUtleUxpc3QgPSBwcmV2aW91c1JvdXRlS2V5TGlzdFJlZi5jdXJyZW50O1xuXG4gIGxldCBzdGF0ZSA9XG4gICAgLy8gSWYgdGhlIHN0YXRlIGlzbid0IGluaXRpYWxpemVkLCBvciBzdGFsZSwgdXNlIHRoZSBzdGF0ZSB3ZSBpbml0aWFsaXplZCBpbnN0ZWFkXG4gICAgLy8gVGhlIHN0YXRlIHdvbid0IHVwZGF0ZSB1bnRpbCB0aGVyZSdzIGEgY2hhbmdlIG5lZWRlZCBpbiB0aGUgc3RhdGUgd2UgaGF2ZSBpbml0YWxpemVkIGxvY2FsbHlcbiAgICAvLyBTbyBpdCdsbCBiZSBgdW5kZWZpbmVkYCBvciBzdGFsZSB1bnRpbCB0aGUgZmlyc3QgbmF2aWdhdGlvbiBldmVudCBoYXBwZW5zXG4gICAgaXNTdGF0ZUluaXRpYWxpemVkKGN1cnJlbnRTdGF0ZSlcbiAgICAgID8gKGN1cnJlbnRTdGF0ZSBhcyBTdGF0ZSlcbiAgICAgIDogKGluaXRpYWxpemVkU3RhdGUgYXMgU3RhdGUpO1xuXG4gIGxldCBuZXh0U3RhdGU6IFN0YXRlID0gc3RhdGU7XG5cbiAgaWYgKFxuICAgICFpc0FycmF5RXF1YWwoc3RhdGUucm91dGVOYW1lcywgcm91dGVOYW1lcykgfHxcbiAgICAhaXNSZWNvcmRFcXVhbChyb3V0ZUtleUxpc3QsIHByZXZpb3VzUm91dGVLZXlMaXN0KVxuICApIHtcbiAgICAvLyBXaGVuIHRoZSBsaXN0IG9mIHJvdXRlIG5hbWVzIGNoYW5nZSwgdGhlIHJvdXRlciBzaG91bGQgaGFuZGxlIGl0IHRvIHJlbW92ZSBpbnZhbGlkIHJvdXRlc1xuICAgIG5leHRTdGF0ZSA9IHJvdXRlci5nZXRTdGF0ZUZvclJvdXRlTmFtZXNDaGFuZ2Uoc3RhdGUsIHtcbiAgICAgIHJvdXRlTmFtZXMsXG4gICAgICByb3V0ZVBhcmFtTGlzdCxcbiAgICAgIHJvdXRlR2V0SWRMaXN0LFxuICAgICAgcm91dGVLZXlDaGFuZ2VzOiBPYmplY3Qua2V5cyhyb3V0ZUtleUxpc3QpLmZpbHRlcihcbiAgICAgICAgKG5hbWUpID0+XG4gICAgICAgICAgcHJldmlvdXNSb3V0ZUtleUxpc3QuaGFzT3duUHJvcGVydHkobmFtZSkgJiZcbiAgICAgICAgICByb3V0ZUtleUxpc3RbbmFtZV0gIT09IHByZXZpb3VzUm91dGVLZXlMaXN0W25hbWVdXG4gICAgICApLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgcHJldmlvdXNOZXN0ZWRQYXJhbXNSZWYgPSBSZWFjdC51c2VSZWYocm91dGU/LnBhcmFtcyk7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBwcmV2aW91c05lc3RlZFBhcmFtc1JlZi5jdXJyZW50ID0gcm91dGU/LnBhcmFtcztcbiAgfSwgW3JvdXRlPy5wYXJhbXNdKTtcblxuICBpZiAocm91dGU/LnBhcmFtcykge1xuICAgIGNvbnN0IHByZXZpb3VzUGFyYW1zID0gcHJldmlvdXNOZXN0ZWRQYXJhbXNSZWYuY3VycmVudDtcblxuICAgIGxldCBhY3Rpb246IENvbW1vbkFjdGlvbnMuQWN0aW9uIHwgdW5kZWZpbmVkO1xuXG4gICAgaWYgKFxuICAgICAgdHlwZW9mIHJvdXRlLnBhcmFtcy5zdGF0ZSA9PT0gJ29iamVjdCcgJiZcbiAgICAgIHJvdXRlLnBhcmFtcy5zdGF0ZSAhPSBudWxsICYmXG4gICAgICByb3V0ZS5wYXJhbXMgIT09IHByZXZpb3VzUGFyYW1zXG4gICAgKSB7XG4gICAgICAvLyBJZiB0aGUgcm91dGUgd2FzIHVwZGF0ZWQgd2l0aCBuZXcgc3RhdGUsIHdlIHNob3VsZCByZXNldCB0byBpdFxuICAgICAgYWN0aW9uID0gQ29tbW9uQWN0aW9ucy5yZXNldChyb3V0ZS5wYXJhbXMuc3RhdGUpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICB0eXBlb2Ygcm91dGUucGFyYW1zLnNjcmVlbiA9PT0gJ3N0cmluZycgJiZcbiAgICAgICgocm91dGUucGFyYW1zLmluaXRpYWwgPT09IGZhbHNlICYmIGlzRmlyc3RTdGF0ZUluaXRpYWxpemF0aW9uKSB8fFxuICAgICAgICByb3V0ZS5wYXJhbXMgIT09IHByZXZpb3VzUGFyYW1zKVxuICAgICkge1xuICAgICAgLy8gSWYgdGhlIHJvdXRlIHdhcyB1cGRhdGVkIHdpdGggbmV3IHNjcmVlbiBuYW1lIGFuZC9vciBwYXJhbXMsIHdlIHNob3VsZCBuYXZpZ2F0ZSB0aGVyZVxuICAgICAgYWN0aW9uID0gQ29tbW9uQWN0aW9ucy5uYXZpZ2F0ZSh7XG4gICAgICAgIG5hbWU6IHJvdXRlLnBhcmFtcy5zY3JlZW4sXG4gICAgICAgIHBhcmFtczogcm91dGUucGFyYW1zLnBhcmFtcyxcbiAgICAgICAgcGF0aDogcm91dGUucGFyYW1zLnBhdGgsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUaGUgdXBkYXRlIHNob3VsZCBiZSBsaW1pdGVkIHRvIGN1cnJlbnQgbmF2aWdhdG9yIG9ubHksIHNvIHdlIGNhbGwgdGhlIHJvdXRlciBtYW51YWxseVxuICAgIGNvbnN0IHVwZGF0ZWRTdGF0ZSA9IGFjdGlvblxuICAgICAgPyByb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24obmV4dFN0YXRlLCBhY3Rpb24sIHtcbiAgICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICAgIHJvdXRlUGFyYW1MaXN0LFxuICAgICAgICAgIHJvdXRlR2V0SWRMaXN0LFxuICAgICAgICB9KVxuICAgICAgOiBudWxsO1xuXG4gICAgbmV4dFN0YXRlID1cbiAgICAgIHVwZGF0ZWRTdGF0ZSAhPT0gbnVsbFxuICAgICAgICA/IHJvdXRlci5nZXRSZWh5ZHJhdGVkU3RhdGUodXBkYXRlZFN0YXRlLCB7XG4gICAgICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICAgICAgcm91dGVQYXJhbUxpc3QsXG4gICAgICAgICAgICByb3V0ZUdldElkTGlzdCxcbiAgICAgICAgICB9KVxuICAgICAgICA6IG5leHRTdGF0ZTtcbiAgfVxuXG4gIGNvbnN0IHNob3VsZFVwZGF0ZSA9IHN0YXRlICE9PSBuZXh0U3RhdGU7XG5cbiAgdXNlU2NoZWR1bGVVcGRhdGUoKCkgPT4ge1xuICAgIGlmIChzaG91bGRVcGRhdGUpIHtcbiAgICAgIC8vIElmIHRoZSBzdGF0ZSBuZWVkcyB0byBiZSB1cGRhdGVkLCB3ZSdsbCBzY2hlZHVsZSBhbiB1cGRhdGVcbiAgICAgIHNldFN0YXRlKG5leHRTdGF0ZSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBUaGUgdXAtdG8tZGF0ZSBzdGF0ZSB3aWxsIGNvbWUgaW4gbmV4dCByZW5kZXIsIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIHdhaXQgZm9yIGl0XG4gIC8vIFdlIGNhbid0IHVzZSB0aGUgb3V0ZGF0ZWQgc3RhdGUgc2luY2UgdGhlIHNjcmVlbnMgaGF2ZSBjaGFuZ2VkLCB3aGljaCB3aWxsIGNhdXNlIGVycm9yIGR1ZSB0byBtaXNtYXRjaGVkIGNvbmZpZ1xuICAvLyBTbyB3ZSBvdmVycmlkZSB0aGUgc3RhdGUgb2JqZWN0IHdlIHJldHVybiB0byB1c2UgdGhlIGxhdGVzdCBzdGF0ZSBhcyBzb29uIGFzIHBvc3NpYmxlXG4gIHN0YXRlID0gbmV4dFN0YXRlO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0S2V5KG5hdmlnYXRvcktleSk7XG5cbiAgICBpZiAoIWdldElzSW5pdGlhbCgpKSB7XG4gICAgICAvLyBJZiBpdCdzIG5vdCBpbml0aWFsIHJlbmRlciwgd2UgbmVlZCB0byB1cGRhdGUgdGhlIHN0YXRlXG4gICAgICAvLyBUaGlzIHdpbGwgbWFrZSBzdXJlIHRoYXQgb3VyIGNvbnRhaW5lciBnZXRzIG5vdGlmaWVyIG9mIHN0YXRlIGNoYW5nZXMgZHVlIHRvIG5ldyBtb3VudHNcbiAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGZvciBwcm9wZXIgc2NyZWVuIHRyYWNraW5nLCBVUkwgdXBkYXRlcyBldGMuXG4gICAgICBzZXRTdGF0ZShuZXh0U3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAvLyBXZSBuZWVkIHRvIGNsZWFuIHVwIHN0YXRlIGZvciB0aGlzIG5hdmlnYXRvciBvbiB1bm1vdW50XG4gICAgICAvLyBXZSBkbyBpdCBpbiBhIHRpbWVvdXQgYmVjYXVzZSB3ZSBuZWVkIHRvIGRldGVjdCBpZiBhbm90aGVyIG5hdmlnYXRvciBtb3VudGVkIGluIHRoZSBtZWFudGltZVxuICAgICAgLy8gRm9yIGV4YW1wbGUsIGlmIGFub3RoZXIgbmF2aWdhdG9yIGhhcyBzdGFydGVkIHJlbmRlcmluZywgd2Ugc2hvdWxkIHNraXAgY2xlYW51cFxuICAgICAgLy8gT3RoZXJ3aXNlLCBvdXIgY2xlYW51cCBzdGVwIHdpbGwgY2xlYW51cCBzdGF0ZSBmb3IgdGhlIG90aGVyIG5hdmlnYXRvciBhbmQgcmUtaW5pdGlhbGl6ZSBpdFxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmIChnZXRDdXJyZW50U3RhdGUoKSAhPT0gdW5kZWZpbmVkICYmIGdldEtleSgpID09PSBuYXZpZ2F0b3JLZXkpIHtcbiAgICAgICAgICBjbGVhblVwU3RhdGUoKTtcbiAgICAgICAgfVxuICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtdKTtcblxuICAvLyBXZSBpbml0aWFsaXplIHRoaXMgcmVmIGhlcmUgdG8gYXZvaWQgYSBuZXcgZ2V0U3RhdGUgZ2V0dGluZyBpbml0aWFsaXplZFxuICAvLyB3aGVuZXZlciBpbml0aWFsaXplZFN0YXRlIGNoYW5nZXMuIFdlIHdhbnQgZ2V0U3RhdGUgdG8gaGF2ZSBhY2Nlc3MgdG8gdGhlXG4gIC8vIGxhdGVzdCBpbml0aWFsaXplZFN0YXRlLCBidXQgZG9uJ3QgbmVlZCBpdCB0byBjaGFuZ2Ugd2hlbiB0aGF0IGhhcHBlbnNcbiAgY29uc3QgaW5pdGlhbGl6ZWRTdGF0ZVJlZiA9IFJlYWN0LnVzZVJlZjxTdGF0ZT4oKTtcbiAgaW5pdGlhbGl6ZWRTdGF0ZVJlZi5jdXJyZW50ID0gaW5pdGlhbGl6ZWRTdGF0ZTtcblxuICBjb25zdCBnZXRTdGF0ZSA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpOiBTdGF0ZSA9PiB7XG4gICAgY29uc3QgY3VycmVudFN0YXRlID0gZ2V0Q3VycmVudFN0YXRlKCk7XG5cbiAgICByZXR1cm4gaXNTdGF0ZUluaXRpYWxpemVkKGN1cnJlbnRTdGF0ZSlcbiAgICAgID8gKGN1cnJlbnRTdGF0ZSBhcyBTdGF0ZSlcbiAgICAgIDogKGluaXRpYWxpemVkU3RhdGVSZWYuY3VycmVudCBhcyBTdGF0ZSk7XG4gIH0sIFtnZXRDdXJyZW50U3RhdGUsIGlzU3RhdGVJbml0aWFsaXplZF0pO1xuXG4gIGNvbnN0IGVtaXR0ZXIgPSB1c2VFdmVudEVtaXR0ZXI8RXZlbnRNYXBDb3JlPFN0YXRlPj4oKGUpID0+IHtcbiAgICBsZXQgcm91dGVOYW1lcyA9IFtdO1xuXG4gICAgbGV0IHJvdXRlOiBSb3V0ZTxzdHJpbmc+IHwgdW5kZWZpbmVkO1xuXG4gICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICByb3V0ZSA9IHN0YXRlLnJvdXRlcy5maW5kKChyb3V0ZSkgPT4gcm91dGUua2V5ID09PSBlLnRhcmdldCk7XG5cbiAgICAgIGlmIChyb3V0ZT8ubmFtZSkge1xuICAgICAgICByb3V0ZU5hbWVzLnB1c2gocm91dGUubmFtZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlID0gc3RhdGUucm91dGVzW3N0YXRlLmluZGV4XTtcbiAgICAgIHJvdXRlTmFtZXMucHVzaChcbiAgICAgICAgLi4uT2JqZWN0LmtleXMoc2NyZWVucykuZmlsdGVyKChuYW1lKSA9PiByb3V0ZT8ubmFtZSA9PT0gbmFtZSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHJvdXRlID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuYXZpZ2F0aW9uID0gZGVzY3JpcHRvcnNbcm91dGUua2V5XS5uYXZpZ2F0aW9uO1xuXG4gICAgY29uc3QgbGlzdGVuZXJzID0gKFtdIGFzICgoKGU6IGFueSkgPT4gdm9pZCkgfCB1bmRlZmluZWQpW10pXG4gICAgICAuY29uY2F0KFxuICAgICAgICAvLyBHZXQgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIGZvciBhbGwgc2NyZWVucyArIGNvbW1vbiBsaXN0ZW5lcnMgb24gbmF2aWdhdG9yXG4gICAgICAgIC4uLltcbiAgICAgICAgICBzY3JlZW5MaXN0ZW5lcnMsXG4gICAgICAgICAgLi4ucm91dGVOYW1lcy5tYXAoKG5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbGlzdGVuZXJzIH0gPSBzY3JlZW5zW25hbWVdLnByb3BzO1xuICAgICAgICAgICAgcmV0dXJuIGxpc3RlbmVycztcbiAgICAgICAgICB9KSxcbiAgICAgICAgXS5tYXAoKGxpc3RlbmVycykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1hcCA9XG4gICAgICAgICAgICB0eXBlb2YgbGlzdGVuZXJzID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgID8gbGlzdGVuZXJzKHsgcm91dGU6IHJvdXRlIGFzIGFueSwgbmF2aWdhdGlvbiB9KVxuICAgICAgICAgICAgICA6IGxpc3RlbmVycztcblxuICAgICAgICAgIHJldHVybiBtYXBcbiAgICAgICAgICAgID8gT2JqZWN0LmtleXMobWFwKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHR5cGUpID0+IHR5cGUgPT09IGUudHlwZSlcbiAgICAgICAgICAgICAgICAubWFwKCh0eXBlKSA9PiBtYXA/Llt0eXBlXSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLy8gV2UgZG9uJ3Qgd2FudCBzYW1lIGxpc3RlbmVyIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBmb3Igc2FtZSBldmVudFxuICAgICAgLy8gU28gd2UgcmVtb3ZlIGFueSBkdXBsaWNhdGUgZnVuY3Rpb25zIGZyb20gdGhlIGFycmF5XG4gICAgICAuZmlsdGVyKChjYiwgaSwgc2VsZikgPT4gY2IgJiYgc2VsZi5sYXN0SW5kZXhPZihjYikgPT09IGkpO1xuXG4gICAgbGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcj8uKGUpKTtcbiAgfSk7XG5cbiAgdXNlRm9jdXNFdmVudHMoeyBzdGF0ZSwgZW1pdHRlciB9KTtcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGVtaXR0ZXIuZW1pdCh7IHR5cGU6ICdzdGF0ZScsIGRhdGE6IHsgc3RhdGUgfSB9KTtcbiAgfSwgW2VtaXR0ZXIsIHN0YXRlXSk7XG5cbiAgY29uc3QgeyBsaXN0ZW5lcnM6IGNoaWxkTGlzdGVuZXJzLCBhZGRMaXN0ZW5lciB9ID0gdXNlQ2hpbGRMaXN0ZW5lcnMoKTtcblxuICBjb25zdCB7IGtleWVkTGlzdGVuZXJzLCBhZGRLZXllZExpc3RlbmVyIH0gPSB1c2VLZXllZENoaWxkTGlzdGVuZXJzKCk7XG5cbiAgY29uc3Qgb25BY3Rpb24gPSB1c2VPbkFjdGlvbih7XG4gICAgcm91dGVyLFxuICAgIGdldFN0YXRlLFxuICAgIHNldFN0YXRlLFxuICAgIGtleTogcm91dGU/LmtleSxcbiAgICBhY3Rpb25MaXN0ZW5lcnM6IGNoaWxkTGlzdGVuZXJzLmFjdGlvbixcbiAgICBiZWZvcmVSZW1vdmVMaXN0ZW5lcnM6IGtleWVkTGlzdGVuZXJzLmJlZm9yZVJlbW92ZSxcbiAgICByb3V0ZXJDb25maWdPcHRpb25zOiB7XG4gICAgICByb3V0ZU5hbWVzLFxuICAgICAgcm91dGVQYXJhbUxpc3QsXG4gICAgICByb3V0ZUdldElkTGlzdCxcbiAgICB9LFxuICAgIGVtaXR0ZXIsXG4gIH0pO1xuXG4gIGNvbnN0IG9uUm91dGVGb2N1cyA9IHVzZU9uUm91dGVGb2N1cyh7XG4gICAgcm91dGVyLFxuICAgIGtleTogcm91dGU/LmtleSxcbiAgICBnZXRTdGF0ZSxcbiAgICBzZXRTdGF0ZSxcbiAgfSk7XG5cbiAgY29uc3QgbmF2aWdhdGlvbiA9IHVzZU5hdmlnYXRpb25IZWxwZXJzPFxuICAgIFN0YXRlLFxuICAgIEFjdGlvbkhlbHBlcnMsXG4gICAgTmF2aWdhdGlvbkFjdGlvbixcbiAgICBFdmVudE1hcFxuICA+KHtcbiAgICBvbkFjdGlvbixcbiAgICBnZXRTdGF0ZSxcbiAgICBlbWl0dGVyLFxuICAgIHJvdXRlcixcbiAgfSk7XG5cbiAgdXNlRm9jdXNlZExpc3RlbmVyc0NoaWxkcmVuQWRhcHRlcih7XG4gICAgbmF2aWdhdGlvbixcbiAgICBmb2N1c2VkTGlzdGVuZXJzOiBjaGlsZExpc3RlbmVycy5mb2N1cyxcbiAgfSk7XG5cbiAgdXNlT25HZXRTdGF0ZSh7XG4gICAgZ2V0U3RhdGUsXG4gICAgZ2V0U3RhdGVMaXN0ZW5lcnM6IGtleWVkTGlzdGVuZXJzLmdldFN0YXRlLFxuICB9KTtcblxuICBjb25zdCBkZXNjcmlwdG9ycyA9IHVzZURlc2NyaXB0b3JzPFxuICAgIFN0YXRlLFxuICAgIEFjdGlvbkhlbHBlcnMsXG4gICAgU2NyZWVuT3B0aW9ucyxcbiAgICBFdmVudE1hcFxuICA+KHtcbiAgICBzdGF0ZSxcbiAgICBzY3JlZW5zLFxuICAgIG5hdmlnYXRpb24sXG4gICAgc2NyZWVuT3B0aW9uczogb3B0aW9ucy5zY3JlZW5PcHRpb25zLFxuICAgIGRlZmF1bHRTY3JlZW5PcHRpb25zOiBvcHRpb25zLmRlZmF1bHRTY3JlZW5PcHRpb25zLFxuICAgIG9uQWN0aW9uLFxuICAgIGdldFN0YXRlLFxuICAgIHNldFN0YXRlLFxuICAgIG9uUm91dGVGb2N1cyxcbiAgICBhZGRMaXN0ZW5lcixcbiAgICBhZGRLZXllZExpc3RlbmVyLFxuICAgIHJvdXRlcixcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yOiB0aGlzIHNob3VsZCBoYXZlIGJvdGggY29yZSBhbmQgY3VzdG9tIGV2ZW50cywgYnV0IHRvbyBtdWNoIHdvcmsgcmlnaHQgbm93XG4gICAgZW1pdHRlcixcbiAgfSk7XG5cbiAgdXNlQ3VycmVudFJlbmRlcih7XG4gICAgc3RhdGUsXG4gICAgbmF2aWdhdGlvbixcbiAgICBkZXNjcmlwdG9ycyxcbiAgfSk7XG5cbiAgY29uc3QgTmF2aWdhdGlvbkNvbnRlbnQgPSB1c2VDb21wb25lbnQoTmF2aWdhdGlvbkhlbHBlcnNDb250ZXh0LlByb3ZpZGVyLCB7XG4gICAgdmFsdWU6IG5hdmlnYXRpb24sXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgc3RhdGUsXG4gICAgbmF2aWdhdGlvbixcbiAgICBkZXNjcmlwdG9ycyxcbiAgICBOYXZpZ2F0aW9uQ29udGVudCxcbiAgfTtcbn1cbiJdfQ==