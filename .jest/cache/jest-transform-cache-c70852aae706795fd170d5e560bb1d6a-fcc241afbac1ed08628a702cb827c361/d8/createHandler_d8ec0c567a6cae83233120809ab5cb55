13429e87ffa45fb33f7e9cd292c8be3b
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault2(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault2(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault2(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault2(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault2(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault2(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty3 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _stateToPropMappings;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createHandler;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _RNGestureHandlerModule = _interopRequireDefault(require("../RNGestureHandlerModule"));

var _State = require("../State");

var _handlersRegistry = require("./handlersRegistry");

var _gestureHandlerCommon = require("./gestureHandlerCommon");

var _utils = require("../utils");

var _ActionType = require("../ActionType");

var _UIManagerAny$getView, _UIManagerAny$getView2, _UIManagerAny$getCons;

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var UIManagerAny = _reactNative.UIManager;
var customGHEventsConfigFabricAndroid = {
  topOnGestureHandlerEvent: {
    registrationName: 'onGestureHandlerEvent'
  },
  topOnGestureHandlerStateChange: {
    registrationName: 'onGestureHandlerStateChange'
  }
};
var customGHEventsConfig = (0, _extends2.default)({
  onGestureHandlerEvent: {
    registrationName: 'onGestureHandlerEvent'
  },
  onGestureHandlerStateChange: {
    registrationName: 'onGestureHandlerStateChange'
  }
}, (0, _utils.isFabric)() && _reactNative.Platform.OS === 'android' && customGHEventsConfigFabricAndroid);
UIManagerAny.genericDirectEventTypes = (0, _extends2.default)({}, UIManagerAny.genericDirectEventTypes, customGHEventsConfig);
var UIManagerConstants = (_UIManagerAny$getView = (_UIManagerAny$getView2 = UIManagerAny.getViewManagerConfig) === null || _UIManagerAny$getView2 === void 0 ? void 0 : _UIManagerAny$getView2.call(UIManagerAny, 'getConstants')) !== null && _UIManagerAny$getView !== void 0 ? _UIManagerAny$getView : (_UIManagerAny$getCons = UIManagerAny.getConstants) === null || _UIManagerAny$getCons === void 0 ? void 0 : _UIManagerAny$getCons.call(UIManagerAny);

if (UIManagerConstants) {
  UIManagerConstants.genericDirectEventTypes = (0, _extends2.default)({}, UIManagerConstants.genericDirectEventTypes, customGHEventsConfig);
}

var _UIManagerAny$setJSRe = UIManagerAny.setJSResponder,
    oldSetJSResponder = _UIManagerAny$setJSRe === void 0 ? function () {} : _UIManagerAny$setJSRe,
    _UIManagerAny$clearJS = UIManagerAny.clearJSResponder,
    oldClearJSResponder = _UIManagerAny$clearJS === void 0 ? function () {} : _UIManagerAny$clearJS;

UIManagerAny.setJSResponder = function (tag, blockNativeResponder) {
  _RNGestureHandlerModule.default.handleSetJSResponder(tag, blockNativeResponder);

  oldSetJSResponder(tag, blockNativeResponder);
};

UIManagerAny.clearJSResponder = function () {
  _RNGestureHandlerModule.default.handleClearJSResponder();

  oldClearJSResponder();
};

var allowTouches = true;
var DEV_ON_ANDROID = __DEV__ && _reactNative.Platform.OS === 'android';

if (DEV_ON_ANDROID) {
  _reactNative.DeviceEventEmitter.addListener('toggleElementInspector', function () {
    allowTouches = !allowTouches;
  });
}

function hasUnresolvedRefs(props) {
  var extract = function extract(refs) {
    if (!Array.isArray(refs)) {
      return refs && refs.current === null;
    }

    return refs.some(function (r) {
      return r && r.current === null;
    });
  };

  return extract(props['simultaneousHandlers']) || extract(props['waitFor']);
}

var stateToPropMappings = (_stateToPropMappings = {}, (0, _defineProperty3.default)(_stateToPropMappings, _State.State.UNDETERMINED, undefined), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.BEGAN, 'onBegan'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.FAILED, 'onFailed'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.CANCELLED, 'onCancelled'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.ACTIVE, 'onActivated'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.END, 'onEnded'), _stateToPropMappings);
var showedRngh2Notice = false;

function showRngh2NoticeIfNeeded() {
  if (!showedRngh2Notice) {
    console.warn((0, _utils.tagMessage)("Seems like you're using an old API with gesture components, check out new Gestures system!"));
    showedRngh2Notice = true;
  }
}

function createHandler(_ref) {
  var name = _ref.name,
      _ref$allowedProps = _ref.allowedProps,
      allowedProps = _ref$allowedProps === void 0 ? [] : _ref$allowedProps,
      _ref$config = _ref.config,
      config = _ref$config === void 0 ? {} : _ref$config,
      transformProps = _ref.transformProps,
      _ref$customNativeProp = _ref.customNativeProps,
      customNativeProps = _ref$customNativeProp === void 0 ? [] : _ref$customNativeProp;

  var Handler = function (_React$Component) {
    (0, _inherits2.default)(Handler, _React$Component);

    var _super = _createSuper(Handler);

    function Handler(props) {
      var _this;

      (0, _classCallCheck2.default)(this, Handler);
      _this = _super.call(this, props);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "handlerTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "config", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "propsRef", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewNode", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateEnqueued", null);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "inspectorToggleListener", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerEvent", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          if (typeof _this.props.onGestureEvent === 'function') {
            var _this$props$onGesture, _this$props;

            (_this$props$onGesture = (_this$props = _this.props).onGestureEvent) === null || _this$props$onGesture === void 0 ? void 0 : _this$props$onGesture.call(_this$props, event);
          }
        } else {
          var _this$props$onGesture2, _this$props2;

          (_this$props$onGesture2 = (_this$props2 = _this.props).onGestureHandlerEvent) === null || _this$props$onGesture2 === void 0 ? void 0 : _this$props$onGesture2.call(_this$props2, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerStateChange", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          if (typeof _this.props.onHandlerStateChange === 'function') {
            var _this$props$onHandler, _this$props3;

            (_this$props$onHandler = (_this$props3 = _this.props).onHandlerStateChange) === null || _this$props$onHandler === void 0 ? void 0 : _this$props$onHandler.call(_this$props3, event);
          }

          var state = event.nativeEvent.state;
          var stateEventName = stateToPropMappings[state];
          var eventHandler = stateEventName && _this.props[stateEventName];

          if (eventHandler && typeof eventHandler === 'function') {
            eventHandler(event);
          }
        } else {
          var _this$props$onGesture3, _this$props4;

          (_this$props$onGesture3 = (_this$props4 = _this.props).onGestureHandlerStateChange) === null || _this$props$onGesture3 === void 0 ? void 0 : _this$props$onGesture3.call(_this$props4, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "refHandler", function (node) {
        _this.viewNode = node;
        var child = React.Children.only(_this.props.children);
        var ref = child.ref;

        if (ref !== null) {
          if (typeof ref === 'function') {
            ref(node);
          } else {
            ref.current = node;
          }
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "createGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.createGestureHandler(name, _this.handlerTag, newConfig);
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "attachGestureHandler", function (newViewTag) {
        _this.viewTag = newViewTag;

        if (_reactNative.Platform.OS === 'web') {
          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag, _ActionType.ActionType.JS_FUNCTION_OLD_API, _this.propsRef);
        } else {
          (0, _handlersRegistry.registerOldGestureHandler)(_this.handlerTag, {
            onGestureEvent: _this.onGestureHandlerEvent,
            onGestureStateChange: _this.onGestureHandlerStateChange
          });

          var actionType = function () {
            var _this$props5, _this$props6;

            if ((_this$props5 = _this.props) !== null && _this$props5 !== void 0 && _this$props5.onGestureEvent && 'current' in _this.props.onGestureEvent) {
              return _ActionType.ActionType.REANIMATED_WORKLET;
            } else if ((_this$props6 = _this.props) !== null && _this$props6 !== void 0 && _this$props6.onGestureEvent && '__isNative' in _this.props.onGestureEvent) {
              return _ActionType.ActionType.NATIVE_ANIMATED_EVENT;
            } else {
              return _ActionType.ActionType.JS_FUNCTION_OLD_API;
            }
          }();

          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag, actionType);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.updateGestureHandler(_this.handlerTag, newConfig);
      });

      _this.handlerTag = (0, _handlersRegistry.getNextHandlerTag)();
      _this.config = {};
      _this.propsRef = React.createRef();
      _this.state = {
        allowTouches: allowTouches
      };

      if (props.id) {
        if (_handlersRegistry.handlerIDToTag[props.id] !== undefined) {
          throw new Error("Handler with ID \"" + props.id + "\" already registered");
        }

        _handlersRegistry.handlerIDToTag[props.id] = _this.handlerTag;
      }

      if (__DEV__ && !(0, _utils.isJestEnv)()) {
        showRngh2NoticeIfNeeded();
      }

      return _this;
    }

    (0, _createClass2.default)(Handler, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        var props = this.props;

        if (DEV_ON_ANDROID) {
          this.inspectorToggleListener = _reactNative.DeviceEventEmitter.addListener('toggleElementInspector', function () {
            _this2.setState(function (_) {
              return {
                allowTouches: allowTouches
              };
            });

            _this2.update();
          });
        }

        if (hasUnresolvedRefs(props)) {
          this.updateEnqueued = setImmediate(function () {
            _this2.updateEnqueued = null;

            _this2.update();
          });
        }

        this.createGestureHandler((0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config));
        this.attachGestureHandler((0, _gestureHandlerCommon.findNodeHandle)(this.viewNode));
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate() {
        var viewTag = (0, _gestureHandlerCommon.findNodeHandle)(this.viewNode);

        if (this.viewTag !== viewTag) {
          this.attachGestureHandler(viewTag);
        }

        this.update();
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        var _this$inspectorToggle;

        (_this$inspectorToggle = this.inspectorToggleListener) === null || _this$inspectorToggle === void 0 ? void 0 : _this$inspectorToggle.remove();

        _RNGestureHandlerModule.default.dropGestureHandler(this.handlerTag);

        if (this.updateEnqueued) {
          clearImmediate(this.updateEnqueued);
        }

        var handlerID = this.props.id;

        if (handlerID) {
          delete _handlersRegistry.handlerIDToTag[handlerID];
        }
      }
    }, {
      key: "update",
      value: function update() {
        var newConfig = (0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);

        if (!(0, _isEqual.default)(this.config, newConfig)) {
          this.updateGestureHandler(newConfig);
        }
      }
    }, {
      key: "setNativeProps",
      value: function setNativeProps(updates) {
        var mergedProps = (0, _extends2.default)({}, this.props, updates);
        var newConfig = (0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(mergedProps) : mergedProps, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);
        this.updateGestureHandler(newConfig);
      }
    }, {
      key: "render",
      value: function render() {
        var _this$props$testID;

        var gestureEventHandler = this.onGestureHandlerEvent;
        var _this$props7 = this.props,
            onGestureEvent = _this$props7.onGestureEvent,
            onGestureHandlerEvent = _this$props7.onGestureHandlerEvent;

        if (onGestureEvent && typeof onGestureEvent !== 'function') {
          if (onGestureHandlerEvent) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureEventHandler = onGestureEvent;
        } else {
          if (onGestureHandlerEvent && typeof onGestureHandlerEvent !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var gestureStateEventHandler = this.onGestureHandlerStateChange;
        var _this$props8 = this.props,
            onHandlerStateChange = _this$props8.onHandlerStateChange,
            onGestureHandlerStateChange = _this$props8.onGestureHandlerStateChange;

        if (onHandlerStateChange && typeof onHandlerStateChange !== 'function') {
          if (onGestureHandlerStateChange) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureStateEventHandler = onHandlerStateChange;
        } else {
          if (onGestureHandlerStateChange && typeof onGestureHandlerStateChange !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var events = {
          onGestureHandlerEvent: this.state.allowTouches ? gestureEventHandler : undefined,
          onGestureHandlerStateChange: this.state.allowTouches ? gestureStateEventHandler : undefined
        };
        this.propsRef.current = events;
        var child = React.Children.only(this.props.children);
        var grandChildren = child.props.children;

        if (_reactNative.Touchable.TOUCH_TARGET_DEBUG && child.type && (child.type === 'RNGestureHandlerButton' || child.type.name === 'View' || child.type.displayName === 'View')) {
          grandChildren = React.Children.toArray(grandChildren);
          grandChildren.push(_reactNative.Touchable.renderDebugView({
            color: 'mediumspringgreen',
            hitSlop: child.props.hitSlop
          }));
        }

        return React.cloneElement(child, (0, _extends2.default)({
          ref: this.refHandler,
          collapsable: false
        }, (0, _utils.isJestEnv)() ? {
          handlerType: name,
          handlerTag: this.handlerTag
        } : {}, {
          testID: (_this$props$testID = this.props.testID) !== null && _this$props$testID !== void 0 ? _this$props$testID : child.props.testID
        }, events), grandChildren);
      }
    }]);
    return Handler;
  }(React.Component);

  _defineProperty(Handler, "displayName", name);

  return Handler;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWEsR0FBRzFDLEtBQUssQ0FBQ0MsUUFBTkQsQ0FBZStDLE9BQWYvQyxDQUF1QjBDLGFBQXZCMUMsQ0FBaEIwQztBQUNBQSx1QkFBYSxDQUFDTSxJQUFkTixDQUNFQyx1QkFBVU0sZUFBVk4sQ0FBMEI7QUFDeEJPLGlCQUFLLEVBQUUsbUJBRGlCO0FBRXhCQyxtQkFBTyxFQUFFcEQsS0FBSyxDQUFDeEMsS0FBTndDLENBQVlvRDtBQUZHLFdBQTFCUixDQURGRDtBQU1EOztBQUVELGVBQU8xQyxLQUFLLENBQUNvRCxZQUFOcEQsQ0FDTEQsS0FES0M7QUFHSEksYUFBRyxFQUFFLEtBQUtpRCxVQUhQckQ7QUFJSHNELHFCQUFXLEVBQUU7QUFKVnRELFdBS0MsMEJBQ0E7QUFDRXVELHFCQUFXLEVBQUUxRSxJQURmO0FBRUVVLG9CQUFVLEVBQUUsS0FBS0E7QUFGbkIsU0FEQSxHQUtBLEVBVkRTO0FBV0h3RCxnQkFBTSx3QkFBRSxLQUFLakcsS0FBTCxDQUFXaUcsTUFBYixtRUFBdUJ6RCxLQUFLLENBQUN4QyxLQUFOd0MsQ0FBWXlEO0FBWHRDeEQsV0FZQXlDLE1BWkF6QyxHQWNMMEMsYUFkSzFDLENBQVA7QUFnQkQ7QUExVXVFO0FBQUE7QUFBQSxJQUlwREEsS0FBSyxDQUFDeUQsU0FKOEM7O0FBQUFyRSxrQkFJcEVGLE9BSm9FLGlCQVFuREwsSUFSbUQ7O0FBNFUxRSxTQUFPSyxPQUFQO0FBQ0QiLCJuYW1lcyI6WyJVSU1hbmFnZXJBbnkiLCJVSU1hbmFnZXIiLCJjdXN0b21HSEV2ZW50c0NvbmZpZ0ZhYnJpY0FuZHJvaWQiLCJ0b3BPbkdlc3R1cmVIYW5kbGVyRXZlbnQiLCJyZWdpc3RyYXRpb25OYW1lIiwidG9wT25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlIiwiY3VzdG9tR0hFdmVudHNDb25maWciLCJvbkdlc3R1cmVIYW5kbGVyRXZlbnQiLCJvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UiLCJQbGF0Zm9ybSIsIk9TIiwiZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMiLCJVSU1hbmFnZXJDb25zdGFudHMiLCJnZXRWaWV3TWFuYWdlckNvbmZpZyIsIl9VSU1hbmFnZXJBbnkkZ2V0VmlldzIiLCJnZXRDb25zdGFudHMiLCJfVUlNYW5hZ2VyQW55JGdldENvbnMiLCJzZXRKU1Jlc3BvbmRlciIsIm9sZFNldEpTUmVzcG9uZGVyIiwiY2xlYXJKU1Jlc3BvbmRlciIsIm9sZENsZWFySlNSZXNwb25kZXIiLCJ0YWciLCJibG9ja05hdGl2ZVJlc3BvbmRlciIsIlJOR2VzdHVyZUhhbmRsZXJNb2R1bGUiLCJoYW5kbGVTZXRKU1Jlc3BvbmRlciIsImhhbmRsZUNsZWFySlNSZXNwb25kZXIiLCJhbGxvd1RvdWNoZXMiLCJERVZfT05fQU5EUk9JRCIsIl9fREVWX18iLCJEZXZpY2VFdmVudEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImhhc1VucmVzb2x2ZWRSZWZzIiwicHJvcHMiLCJleHRyYWN0IiwicmVmcyIsIkFycmF5IiwiaXNBcnJheSIsImN1cnJlbnQiLCJzb21lIiwiciIsInN0YXRlVG9Qcm9wTWFwcGluZ3MiLCJTdGF0ZSIsIlVOREVURVJNSU5FRCIsInVuZGVmaW5lZCIsIkJFR0FOIiwiRkFJTEVEIiwiQ0FOQ0VMTEVEIiwiQUNUSVZFIiwiRU5EIiwic2hvd2VkUm5naDJOb3RpY2UiLCJzaG93Um5naDJOb3RpY2VJZk5lZWRlZCIsImNvbnNvbGUiLCJ3YXJuIiwiY3JlYXRlSGFuZGxlciIsIm5hbWUiLCJhbGxvd2VkUHJvcHMiLCJjb25maWciLCJ0cmFuc2Zvcm1Qcm9wcyIsImN1c3RvbU5hdGl2ZVByb3BzIiwiSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiX2RlZmluZVByb3BlcnR5IiwiZXZlbnQiLCJuYXRpdmVFdmVudCIsImhhbmRsZXJUYWciLCJvbkdlc3R1cmVFdmVudCIsIm9uSGFuZGxlclN0YXRlQ2hhbmdlIiwic3RhdGUiLCJzdGF0ZUV2ZW50TmFtZSIsImV2ZW50SGFuZGxlciIsIm5vZGUiLCJ2aWV3Tm9kZSIsImNoaWxkIiwiUmVhY3QiLCJDaGlsZHJlbiIsIm9ubHkiLCJjaGlsZHJlbiIsInJlZiIsIm5ld0NvbmZpZyIsImNyZWF0ZUdlc3R1cmVIYW5kbGVyIiwibmV3Vmlld1RhZyIsInZpZXdUYWciLCJhdHRhY2hHZXN0dXJlSGFuZGxlciIsIkFjdGlvblR5cGUiLCJKU19GVU5DVElPTl9PTERfQVBJIiwicHJvcHNSZWYiLCJvbkdlc3R1cmVTdGF0ZUNoYW5nZSIsImFjdGlvblR5cGUiLCJSRUFOSU1BVEVEX1dPUktMRVQiLCJOQVRJVkVfQU5JTUFURURfRVZFTlQiLCJ1cGRhdGVHZXN0dXJlSGFuZGxlciIsImNyZWF0ZVJlZiIsImlkIiwiaGFuZGxlcklEVG9UYWciLCJFcnJvciIsImNvbXBvbmVudERpZE1vdW50IiwiaW5zcGVjdG9yVG9nZ2xlTGlzdGVuZXIiLCJzZXRTdGF0ZSIsIl8iLCJ1cGRhdGUiLCJ1cGRhdGVFbnF1ZXVlZCIsInNldEltbWVkaWF0ZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlIiwiZHJvcEdlc3R1cmVIYW5kbGVyIiwiY2xlYXJJbW1lZGlhdGUiLCJoYW5kbGVySUQiLCJzZXROYXRpdmVQcm9wcyIsInVwZGF0ZXMiLCJtZXJnZWRQcm9wcyIsInJlbmRlciIsImdlc3R1cmVFdmVudEhhbmRsZXIiLCJnZXN0dXJlU3RhdGVFdmVudEhhbmRsZXIiLCJldmVudHMiLCJncmFuZENoaWxkcmVuIiwiVG91Y2hhYmxlIiwiVE9VQ0hfVEFSR0VUX0RFQlVHIiwidHlwZSIsImRpc3BsYXlOYW1lIiwidG9BcnJheSIsInB1c2giLCJyZW5kZXJEZWJ1Z1ZpZXciLCJjb2xvciIsImhpdFNsb3AiLCJjbG9uZUVsZW1lbnQiLCJyZWZIYW5kbGVyIiwiY29sbGFwc2FibGUiLCJoYW5kbGVyVHlwZSIsInRlc3RJRCIsIkNvbXBvbmVudCJdLCJzb3VyY2VzIjpbImNyZWF0ZUhhbmRsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgUGxhdGZvcm0sXG4gIFRvdWNoYWJsZSxcbiAgVUlNYW5hZ2VyLFxuICBEZXZpY2VFdmVudEVtaXR0ZXIsXG4gIEVtaXR0ZXJTdWJzY3JpcHRpb24sXG59IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG4vLyBAdHMtaWdub3JlIC0gaXQgaXNuJ3QgdHlwZWQgYnkgVFMgJiBkb24ndCBoYXZlIGRlZmluaXRlbHlUeXBlZCB0eXBlc1xuaW1wb3J0IGRlZXBFcXVhbCBmcm9tICdsb2Rhc2gvaXNFcXVhbCc7XG5pbXBvcnQgUk5HZXN0dXJlSGFuZGxlck1vZHVsZSBmcm9tICcuLi9STkdlc3R1cmVIYW5kbGVyTW9kdWxlJztcbmltcG9ydCB0eXBlIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGVXZWIgZnJvbSAnLi4vUk5HZXN0dXJlSGFuZGxlck1vZHVsZS53ZWInO1xuaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi9TdGF0ZSc7XG5pbXBvcnQge1xuICBoYW5kbGVySURUb1RhZyxcbiAgZ2V0TmV4dEhhbmRsZXJUYWcsXG4gIHJlZ2lzdGVyT2xkR2VzdHVyZUhhbmRsZXIsXG59IGZyb20gJy4vaGFuZGxlcnNSZWdpc3RyeSc7XG5cbmltcG9ydCB7XG4gIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzLFxuICBmaWx0ZXJDb25maWcsXG4gIEdlc3R1cmVFdmVudCxcbiAgSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQsXG4gIGZpbmROb2RlSGFuZGxlLFxufSBmcm9tICcuL2dlc3R1cmVIYW5kbGVyQ29tbW9uJztcbmltcG9ydCB7IFZhbHVlT2YgfSBmcm9tICcuLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgaXNGYWJyaWMsIGlzSmVzdEVudiwgdGFnTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IEFjdGlvblR5cGUgfSBmcm9tICcuLi9BY3Rpb25UeXBlJztcblxuY29uc3QgVUlNYW5hZ2VyQW55ID0gVUlNYW5hZ2VyIGFzIGFueTtcblxuY29uc3QgY3VzdG9tR0hFdmVudHNDb25maWdGYWJyaWNBbmRyb2lkID0ge1xuICB0b3BPbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IHsgcmVnaXN0cmF0aW9uTmFtZTogJ29uR2VzdHVyZUhhbmRsZXJFdmVudCcgfSxcbiAgdG9wT25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlOiB7XG4gICAgcmVnaXN0cmF0aW9uTmFtZTogJ29uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZScsXG4gIH0sXG59O1xuXG5jb25zdCBjdXN0b21HSEV2ZW50c0NvbmZpZyA9IHtcbiAgb25HZXN0dXJlSGFuZGxlckV2ZW50OiB7IHJlZ2lzdHJhdGlvbk5hbWU6ICdvbkdlc3R1cmVIYW5kbGVyRXZlbnQnIH0sXG4gIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZToge1xuICAgIHJlZ2lzdHJhdGlvbk5hbWU6ICdvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnLFxuICB9LFxuXG4gIC8vIFdoZW4gdXNpbmcgUmVhY3QgTmF0aXZlIEdlc3R1cmUgSGFuZGxlciBmb3IgQW5pbWF0ZWQuZXZlbnQgd2l0aCB1c2VOYXRpdmVEcml2ZXI6IHRydWVcbiAgLy8gb24gQW5kcm9pZCB3aXRoIEZhYnJpYyBlbmFibGVkLCB0aGUgbmF0aXZlIHBhcnQgc3RpbGwgc2VuZHMgdGhlIG5hdGl2ZSBldmVudHMgdG8gSlNcbiAgLy8gYnV0IHByZWZpeGVkIHdpdGggXCJ0b3BcIi4gV2UgY2Fubm90IHNpbXBseSByZW5hbWUgdGhlIGV2ZW50cyBhYm92ZSBzbyB0aGV5IGFyZSBwcmVmaXhlZFxuICAvLyB3aXRoIFwidG9wXCIgaW5zdGVhZCBvZiBcIm9uXCIgYmVjYXVzZSBpbiBzdWNoIGNhc2UgQW5pbWF0ZWQuZXZlbnRzIHdvdWxkIG5vdCBiZSByZWdpc3RlcmVkLlxuICAvLyBUaGF0J3Mgd2h5IHdlIG5lZWQgdG8gcmVnaXN0ZXIgYW5vdGhlciBwYWlyIG9mIGV2ZW50IG5hbWVzLlxuICAvLyBUaGUgaW5jb21pbmcgZXZlbnRzIHdpbGwgYmUgcXVldWVkIGJ1dCBuZXZlciBoYW5kbGVkLlxuICAvLyBXaXRob3V0IHRoaXMgcGllY2Ugb2YgY29kZSBiZWxvdywgeW91J2xsIGdldCB0aGUgZm9sbG93aW5nIEpTIGVycm9yOlxuICAvLyBVbnN1cHBvcnRlZCB0b3AgbGV2ZWwgZXZlbnQgdHlwZSBcInRvcE9uR2VzdHVyZUhhbmRsZXJFdmVudFwiIGRpc3BhdGNoZWRcbiAgLi4uKGlzRmFicmljKCkgJiZcbiAgICBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnICYmXG4gICAgY3VzdG9tR0hFdmVudHNDb25maWdGYWJyaWNBbmRyb2lkKSxcbn07XG5cbi8vIEFkZCBnZXN0dXJlIHNwZWNpZmljIGV2ZW50cyB0byBnZW5lcmljRGlyZWN0RXZlbnRUeXBlcyBvYmplY3QgZXhwb3J0ZWQgZnJvbSBVSU1hbmFnZXJcbi8vIG5hdGl2ZSBtb2R1bGUuXG4vLyBPbmNlIG5ldyBldmVudCB0eXBlcyBhcmUgcmVnaXN0ZXJlZCB3aXRoIHJlYWN0IGl0IGlzIHBvc3NpYmxlIHRvIGRpc3BhdGNoIHRoZXNlXG4vLyBldmVudHMgdG8gYWxsIGtpbmQgb2YgbmF0aXZlIHZpZXdzLlxuVUlNYW5hZ2VyQW55LmdlbmVyaWNEaXJlY3RFdmVudFR5cGVzID0ge1xuICAuLi5VSU1hbmFnZXJBbnkuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMsXG4gIC4uLmN1c3RvbUdIRXZlbnRzQ29uZmlnLFxufTtcbi8vIEluIG5ld2VyIHZlcnNpb25zIG9mIFJOIHRoZSBgZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXNgIGlzIGxvY2F0ZWQgaW4gdGhlIG9iamVjdFxuLy8gcmV0dXJuZWQgYnkgVUlNYW5hZ2VyLmdldFZpZXdNYW5hZ2VyQ29uZmlnKCdnZXRDb25zdGFudHMnKSBvciBpbiBvbGRlciBSTiBVSU1hbmFnZXIuZ2V0Q29uc3RhbnRzKCksIHdlIG5lZWQgdG8gYWRkIGl0IHRoZXJlIGFzIHdlbGwgdG8gbWFrZVxuLy8gaXQgY29tcGF0aWJsZSB3aXRoIFJOIDYxK1xuY29uc3QgVUlNYW5hZ2VyQ29uc3RhbnRzID1cbiAgVUlNYW5hZ2VyQW55LmdldFZpZXdNYW5hZ2VyQ29uZmlnPy4oJ2dldENvbnN0YW50cycpID8/XG4gIFVJTWFuYWdlckFueS5nZXRDb25zdGFudHM/LigpO1xuXG5pZiAoVUlNYW5hZ2VyQ29uc3RhbnRzKSB7XG4gIFVJTWFuYWdlckNvbnN0YW50cy5nZW5lcmljRGlyZWN0RXZlbnRUeXBlcyA9IHtcbiAgICAuLi5VSU1hbmFnZXJDb25zdGFudHMuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMsXG4gICAgLi4uY3VzdG9tR0hFdmVudHNDb25maWcsXG4gIH07XG59XG5cbi8vIFdyYXAgSlMgcmVzcG9uZGVyIGNhbGxzIGFuZCBub3RpZnkgZ2VzdHVyZSBoYW5kbGVyIG1hbmFnZXJcbmNvbnN0IHtcbiAgc2V0SlNSZXNwb25kZXI6IG9sZFNldEpTUmVzcG9uZGVyID0gKCkgPT4ge1xuICAgIC8vbm8gb3BlcmF0aW9uXG4gIH0sXG4gIGNsZWFySlNSZXNwb25kZXI6IG9sZENsZWFySlNSZXNwb25kZXIgPSAoKSA9PiB7XG4gICAgLy9ubyBvcGVyYXRpb25cbiAgfSxcbn0gPSBVSU1hbmFnZXJBbnk7XG5VSU1hbmFnZXJBbnkuc2V0SlNSZXNwb25kZXIgPSAodGFnOiBudW1iZXIsIGJsb2NrTmF0aXZlUmVzcG9uZGVyOiBib29sZWFuKSA9PiB7XG4gIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuaGFuZGxlU2V0SlNSZXNwb25kZXIodGFnLCBibG9ja05hdGl2ZVJlc3BvbmRlcik7XG4gIG9sZFNldEpTUmVzcG9uZGVyKHRhZywgYmxvY2tOYXRpdmVSZXNwb25kZXIpO1xufTtcblVJTWFuYWdlckFueS5jbGVhckpTUmVzcG9uZGVyID0gKCkgPT4ge1xuICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmhhbmRsZUNsZWFySlNSZXNwb25kZXIoKTtcbiAgb2xkQ2xlYXJKU1Jlc3BvbmRlcigpO1xufTtcblxubGV0IGFsbG93VG91Y2hlcyA9IHRydWU7XG5jb25zdCBERVZfT05fQU5EUk9JRCA9IF9fREVWX18gJiYgUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJztcbi8vIFRvZ2dsZWQgaW5zcGVjdG9yIGJsb2NrcyB0b3VjaCBldmVudHMgaW4gb3JkZXIgdG8gYWxsb3cgaW5zcGVjdGluZyBvbiBBbmRyb2lkXG4vLyBUaGlzIG5lZWRzIHRvIGJlIGEgZ2xvYmFsIHZhcmlhYmxlIGluIG9yZGVyIHRvIHNldCBpbml0aWFsIHN0YXRlIGZvciBgYWxsb3dUb3VjaGVzYCBwcm9wZXJ0eSBpbiBIYW5kbGVyIGNvbXBvbmVudFxuaWYgKERFVl9PTl9BTkRST0lEKSB7XG4gIERldmljZUV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcigndG9nZ2xlRWxlbWVudEluc3BlY3RvcicsICgpID0+IHtcbiAgICBhbGxvd1RvdWNoZXMgPSAhYWxsb3dUb3VjaGVzO1xuICB9KTtcbn1cblxudHlwZSBIYW5kbGVyUHJvcHM8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PiA9IFJlYWRvbmx5PFxuICBSZWFjdC5Qcm9wc1dpdGhDaGlsZHJlbjxCYXNlR2VzdHVyZUhhbmRsZXJQcm9wczxUPj5cbj47XG5mdW5jdGlvbiBoYXNVbnJlc29sdmVkUmVmczxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+KFxuICBwcm9wczogSGFuZGxlclByb3BzPFQ+XG4pIHtcbiAgLy8gVE9ETyhUUykgLSBhZGQgdHlwZSBmb3IgZXh0cmFjdCBhcmdcbiAgY29uc3QgZXh0cmFjdCA9IChyZWZzOiBhbnkgfCBhbnlbXSkgPT4ge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShyZWZzKSkge1xuICAgICAgcmV0dXJuIHJlZnMgJiYgcmVmcy5jdXJyZW50ID09PSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVmcy5zb21lKChyKSA9PiByICYmIHIuY3VycmVudCA9PT0gbnVsbCk7XG4gIH07XG4gIHJldHVybiBleHRyYWN0KHByb3BzWydzaW11bHRhbmVvdXNIYW5kbGVycyddKSB8fCBleHRyYWN0KHByb3BzWyd3YWl0Rm9yJ10pO1xufVxuXG5jb25zdCBzdGF0ZVRvUHJvcE1hcHBpbmdzID0ge1xuICBbU3RhdGUuVU5ERVRFUk1JTkVEXTogdW5kZWZpbmVkLFxuICBbU3RhdGUuQkVHQU5dOiAnb25CZWdhbicsXG4gIFtTdGF0ZS5GQUlMRURdOiAnb25GYWlsZWQnLFxuICBbU3RhdGUuQ0FOQ0VMTEVEXTogJ29uQ2FuY2VsbGVkJyxcbiAgW1N0YXRlLkFDVElWRV06ICdvbkFjdGl2YXRlZCcsXG4gIFtTdGF0ZS5FTkRdOiAnb25FbmRlZCcsXG59IGFzIGNvbnN0O1xuXG50eXBlIENyZWF0ZUhhbmRsZXJBcmdzPFxuICBIYW5kbGVyUHJvcHNUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbj4gPSBSZWFkb25seTx7XG4gIG5hbWU6IHN0cmluZztcbiAgYWxsb3dlZFByb3BzOiBSZWFkb25seTxFeHRyYWN0PGtleW9mIEhhbmRsZXJQcm9wc1QsIHN0cmluZz5bXT47XG4gIGNvbmZpZzogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+O1xuICB0cmFuc2Zvcm1Qcm9wcz86IChwcm9wczogSGFuZGxlclByb3BzVCkgPT4gSGFuZGxlclByb3BzVDtcbiAgY3VzdG9tTmF0aXZlUHJvcHM/OiBSZWFkb25seTxzdHJpbmdbXT47XG59PjtcblxuLy8gVE9ETyhUUykgZml4IGV2ZW50IHR5cGVzXG50eXBlIEludGVybmFsRXZlbnRIYW5kbGVycyA9IHtcbiAgb25HZXN0dXJlSGFuZGxlckV2ZW50PzogKGV2ZW50OiBhbnkpID0+IHZvaWQ7XG4gIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZT86IChldmVudDogYW55KSA9PiB2b2lkO1xufTtcblxubGV0IHNob3dlZFJuZ2gyTm90aWNlID0gZmFsc2U7XG5mdW5jdGlvbiBzaG93Um5naDJOb3RpY2VJZk5lZWRlZCgpIHtcbiAgaWYgKCFzaG93ZWRSbmdoMk5vdGljZSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIHRhZ01lc3NhZ2UoXG4gICAgICAgIFwiU2VlbXMgbGlrZSB5b3UncmUgdXNpbmcgYW4gb2xkIEFQSSB3aXRoIGdlc3R1cmUgY29tcG9uZW50cywgY2hlY2sgb3V0IG5ldyBHZXN0dXJlcyBzeXN0ZW0hXCJcbiAgICAgIClcbiAgICApO1xuICAgIHNob3dlZFJuZ2gyTm90aWNlID0gdHJ1ZTtcbiAgfVxufVxuXG4vLyBUT0RPKFRTKSAtIG1ha2Ugc3VyZSB0aGF0IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzIGRvZXNuJ3QgbmVlZCBvdGhlciBnZW5lcmljIHBhcmFtZXRlciB0byB3b3JrIHdpdGggY3VzdG9tIHByb3BlcnRpZXMuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVIYW5kbGVyPFxuICBUIGV4dGVuZHMgQmFzZUdlc3R1cmVIYW5kbGVyUHJvcHM8VT4sXG4gIFUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPih7XG4gIG5hbWUsXG4gIGFsbG93ZWRQcm9wcyA9IFtdLFxuICBjb25maWcgPSB7fSxcbiAgdHJhbnNmb3JtUHJvcHMsXG4gIGN1c3RvbU5hdGl2ZVByb3BzID0gW10sXG59OiBDcmVhdGVIYW5kbGVyQXJnczxUPik6IFJlYWN0LkNvbXBvbmVudFR5cGU8VCAmIFJlYWN0LlJlZkF0dHJpYnV0ZXM8YW55Pj4ge1xuICBpbnRlcmZhY2UgSGFuZGxlclN0YXRlIHtcbiAgICBhbGxvd1RvdWNoZXM6IGJvb2xlYW47XG4gIH1cbiAgY2xhc3MgSGFuZGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxcbiAgICBUICYgSW50ZXJuYWxFdmVudEhhbmRsZXJzLFxuICAgIEhhbmRsZXJTdGF0ZVxuICA+IHtcbiAgICBzdGF0aWMgZGlzcGxheU5hbWUgPSBuYW1lO1xuXG4gICAgcHJpdmF0ZSBoYW5kbGVyVGFnOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBjb25maWc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIHByaXZhdGUgcHJvcHNSZWY6IFJlYWN0Lk11dGFibGVSZWZPYmplY3Q8dW5rbm93bj47XG4gICAgcHJpdmF0ZSB2aWV3Tm9kZTogYW55O1xuICAgIHByaXZhdGUgdmlld1RhZz86IG51bWJlcjtcbiAgICBwcml2YXRlIHVwZGF0ZUVucXVldWVkOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbW1lZGlhdGU+IHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBpbnNwZWN0b3JUb2dnbGVMaXN0ZW5lcj86IEVtaXR0ZXJTdWJzY3JpcHRpb247XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVCAmIEludGVybmFsRXZlbnRIYW5kbGVycykge1xuICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgdGhpcy5oYW5kbGVyVGFnID0gZ2V0TmV4dEhhbmRsZXJUYWcoKTtcbiAgICAgIHRoaXMuY29uZmlnID0ge307XG4gICAgICB0aGlzLnByb3BzUmVmID0gUmVhY3QuY3JlYXRlUmVmKCk7XG4gICAgICB0aGlzLnN0YXRlID0geyBhbGxvd1RvdWNoZXMgfTtcbiAgICAgIGlmIChwcm9wcy5pZCkge1xuICAgICAgICBpZiAoaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgd2l0aCBJRCBcIiR7cHJvcHMuaWR9XCIgYWxyZWFkeSByZWdpc3RlcmVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdID0gdGhpcy5oYW5kbGVyVGFnO1xuICAgICAgfVxuICAgICAgaWYgKF9fREVWX18gJiYgIWlzSmVzdEVudigpKSB7XG4gICAgICAgIHNob3dSbmdoMk5vdGljZUlmTmVlZGVkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICBjb25zdCBwcm9wczogSGFuZGxlclByb3BzPFU+ID0gdGhpcy5wcm9wcztcblxuICAgICAgaWYgKERFVl9PTl9BTkRST0lEKSB7XG4gICAgICAgIHRoaXMuaW5zcGVjdG9yVG9nZ2xlTGlzdGVuZXIgPSBEZXZpY2VFdmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ3RvZ2dsZUVsZW1lbnRJbnNwZWN0b3InLFxuICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoKF8pID0+ICh7IGFsbG93VG91Y2hlcyB9KSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChoYXNVbnJlc29sdmVkUmVmcyhwcm9wcykpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIHVucmVzb2x2ZWQgcmVmcyAoZS5nLiBcIi5jdXJyZW50XCIgaGFzIG5vdCB5ZXQgYmVlbiBzZXQpXG4gICAgICAgIC8vIHBhc3NlZCBhcyBgc2ltdWx0YW5lb3VzSGFuZGxlcnNgIG9yIGB3YWl0Rm9yYCwgd2UgZW5xdWV1ZSBhIGNhbGwgdG9cbiAgICAgICAgLy8gX3VwZGF0ZSBtZXRob2QgdGhhdCB3aWxsIHRyeSB0byB1cGRhdGUgbmF0aXZlIGhhbmRsZXIgcHJvcHMgdXNpbmdcbiAgICAgICAgLy8gc2V0SW1tZWRpYXRlLiBUaGlzIG1ha2VzIGl0IHNvIHVwZGF0ZSgpIGZ1bmN0aW9uIGdldHMgY2FsbGVkIGFmdGVyIGFsbFxuICAgICAgICAvLyByZWFjdCBjb21wb25lbnRzIGFyZSBtb3VudGVkIGFuZCB3ZSBleHBlY3QgdGhlIG1pc3NpbmcgcmVmIG9iamVjdCB0b1xuICAgICAgICAvLyBiZSByZXNvbHZlZCBieSB0aGVuLlxuICAgICAgICB0aGlzLnVwZGF0ZUVucXVldWVkID0gc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUVucXVldWVkID0gbnVsbDtcbiAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jcmVhdGVHZXN0dXJlSGFuZGxlcihcbiAgICAgICAgZmlsdGVyQ29uZmlnKFxuICAgICAgICAgIHRyYW5zZm9ybVByb3BzID8gdHJhbnNmb3JtUHJvcHModGhpcy5wcm9wcykgOiB0aGlzLnByb3BzLFxuICAgICAgICAgIFsuLi5hbGxvd2VkUHJvcHMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzXSxcbiAgICAgICAgICBjb25maWdcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgdGhpcy5hdHRhY2hHZXN0dXJlSGFuZGxlcihmaW5kTm9kZUhhbmRsZSh0aGlzLnZpZXdOb2RlKSBhcyBudW1iZXIpOyAvLyBUT0RPKFRTKSAtIGNoZWNrIGlmIHRoaXMgY2FuIGJlIG51bGxcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICBjb25zdCB2aWV3VGFnID0gZmluZE5vZGVIYW5kbGUodGhpcy52aWV3Tm9kZSk7XG4gICAgICBpZiAodGhpcy52aWV3VGFnICE9PSB2aWV3VGFnKSB7XG4gICAgICAgIHRoaXMuYXR0YWNoR2VzdHVyZUhhbmRsZXIodmlld1RhZyBhcyBudW1iZXIpOyAvLyBUT0RPKFRTKSAtIGNoZWNrIGludGVyYWN0aW9uIGJldHdlZW4gX3ZpZXdUYWcgJiBmaW5kTm9kZUhhbmRsZVxuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIHRoaXMuaW5zcGVjdG9yVG9nZ2xlTGlzdGVuZXI/LnJlbW92ZSgpO1xuICAgICAgUk5HZXN0dXJlSGFuZGxlck1vZHVsZS5kcm9wR2VzdHVyZUhhbmRsZXIodGhpcy5oYW5kbGVyVGFnKTtcbiAgICAgIGlmICh0aGlzLnVwZGF0ZUVucXVldWVkKSB7XG4gICAgICAgIGNsZWFySW1tZWRpYXRlKHRoaXMudXBkYXRlRW5xdWV1ZWQpO1xuICAgICAgfVxuICAgICAgLy8gV2UgY2FuJ3QgdXNlIHRoaXMucHJvcHMuaWQgZGlyZWN0bHkgZHVlIHRvIFRTIGdlbmVyaWMgdHlwZSBuYXJyb3dpbmcgYnVnLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk5NSBmb3IgbW9yZSBjb250ZXh0XG4gICAgICBjb25zdCBoYW5kbGVySUQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMucHJvcHMuaWQ7XG4gICAgICBpZiAoaGFuZGxlcklEKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZHluYW1pYy1kZWxldGVcbiAgICAgICAgZGVsZXRlIGhhbmRsZXJJRFRvVGFnW2hhbmRsZXJJRF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkdlc3R1cmVIYW5kbGVyRXZlbnQgPSAoZXZlbnQ6IEdlc3R1cmVFdmVudDxVPikgPT4ge1xuICAgICAgaWYgKGV2ZW50Lm5hdGl2ZUV2ZW50LmhhbmRsZXJUYWcgPT09IHRoaXMuaGFuZGxlclRhZykge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMub25HZXN0dXJlRXZlbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUV2ZW50Py4oZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJFdmVudD8uKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gVE9ETyhUUykgLSBtYWtlIHN1cmUgdGhpcyBpcyByaWdodCB0eXBlIGZvciBldmVudFxuICAgIHByaXZhdGUgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlID0gKFxuICAgICAgZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PFU+XG4gICAgKSA9PiB7XG4gICAgICBpZiAoZXZlbnQubmF0aXZlRXZlbnQuaGFuZGxlclRhZyA9PT0gdGhpcy5oYW5kbGVyVGFnKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wcm9wcy5vbkhhbmRsZXJTdGF0ZUNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHRoaXMucHJvcHMub25IYW5kbGVyU3RhdGVDaGFuZ2U/LihldmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+ID0gZXZlbnQubmF0aXZlRXZlbnQuc3RhdGU7XG4gICAgICAgIGNvbnN0IHN0YXRlRXZlbnROYW1lID0gc3RhdGVUb1Byb3BNYXBwaW5nc1tzdGF0ZV07XG4gICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IHN0YXRlRXZlbnROYW1lICYmIHRoaXMucHJvcHNbc3RhdGVFdmVudE5hbWVdO1xuICAgICAgICBpZiAoZXZlbnRIYW5kbGVyICYmIHR5cGVvZiBldmVudEhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBldmVudEhhbmRsZXIoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZT8uKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZWZIYW5kbGVyID0gKG5vZGU6IGFueSkgPT4ge1xuICAgICAgdGhpcy52aWV3Tm9kZSA9IG5vZGU7XG5cbiAgICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIC8vIFRPRE8oVFMpIGZpeCByZWYgdHlwZVxuICAgICAgY29uc3QgeyByZWYgfTogYW55ID0gY2hpbGQ7XG4gICAgICBpZiAocmVmICE9PSBudWxsKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcmVmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmVmKG5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlZi5jdXJyZW50ID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGNyZWF0ZUdlc3R1cmVIYW5kbGVyID0gKFxuICAgICAgbmV3Q29uZmlnOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj5cbiAgICApID0+IHtcbiAgICAgIHRoaXMuY29uZmlnID0gbmV3Q29uZmlnO1xuXG4gICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmNyZWF0ZUdlc3R1cmVIYW5kbGVyKFxuICAgICAgICBuYW1lLFxuICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgIG5ld0NvbmZpZ1xuICAgICAgKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBhdHRhY2hHZXN0dXJlSGFuZGxlciA9IChuZXdWaWV3VGFnOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMudmlld1RhZyA9IG5ld1ZpZXdUYWc7XG5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICAgICAgLy8gdHlwZWNhc3QgZHVlIHRvIGR5bmFtaWMgcmVzb2x1dGlvbiwgYXR0YWNoR2VzdHVyZUhhbmRsZXIgc2hvdWxkIGhhdmUgd2ViIHZlcnNpb24gc2lnbmF0dXJlIGluIHRoaXMgYnJhbmNoXG4gICAgICAgIChSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmF0dGFjaEdlc3R1cmVIYW5kbGVyIGFzIHR5cGVvZiBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlV2ViLmF0dGFjaEdlc3R1cmVIYW5kbGVyKShcbiAgICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgICAgbmV3Vmlld1RhZyxcbiAgICAgICAgICBBY3Rpb25UeXBlLkpTX0ZVTkNUSU9OX09MRF9BUEksIC8vIGlnbm9yZWQgb24gd2ViXG4gICAgICAgICAgdGhpcy5wcm9wc1JlZlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVnaXN0ZXJPbGRHZXN0dXJlSGFuZGxlcih0aGlzLmhhbmRsZXJUYWcsIHtcbiAgICAgICAgICBvbkdlc3R1cmVFdmVudDogdGhpcy5vbkdlc3R1cmVIYW5kbGVyRXZlbnQsXG4gICAgICAgICAgb25HZXN0dXJlU3RhdGVDaGFuZ2U6IHRoaXMub25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBhY3Rpb25UeXBlID0gKCgpID0+IHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLnByb3BzPy5vbkdlc3R1cmVFdmVudCAmJlxuICAgICAgICAgICAgJ2N1cnJlbnQnIGluIHRoaXMucHJvcHMub25HZXN0dXJlRXZlbnRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIFJlYW5pbWF0ZWQgd29ya2xldFxuICAgICAgICAgICAgcmV0dXJuIEFjdGlvblR5cGUuUkVBTklNQVRFRF9XT1JLTEVUO1xuICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICB0aGlzLnByb3BzPy5vbkdlc3R1cmVFdmVudCAmJlxuICAgICAgICAgICAgJ19faXNOYXRpdmUnIGluIHRoaXMucHJvcHMub25HZXN0dXJlRXZlbnRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIEFuaW1hdGVkLmV2ZW50IHdpdGggdXNlTmF0aXZlRHJpdmVyOiB0cnVlXG4gICAgICAgICAgICByZXR1cm4gQWN0aW9uVHlwZS5OQVRJVkVfQU5JTUFURURfRVZFTlQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEpTIGNhbGxiYWNrIG9yIEFuaW1hdGVkLmV2ZW50IHdpdGggdXNlTmF0aXZlRHJpdmVyOiBmYWxzZVxuICAgICAgICAgICAgcmV0dXJuIEFjdGlvblR5cGUuSlNfRlVOQ1RJT05fT0xEX0FQSTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgUk5HZXN0dXJlSGFuZGxlck1vZHVsZS5hdHRhY2hHZXN0dXJlSGFuZGxlcihcbiAgICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgICAgbmV3Vmlld1RhZyxcbiAgICAgICAgICBhY3Rpb25UeXBlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgdXBkYXRlR2VzdHVyZUhhbmRsZXIgPSAoXG4gICAgICBuZXdDb25maWc6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PlxuICAgICkgPT4ge1xuICAgICAgdGhpcy5jb25maWcgPSBuZXdDb25maWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUudXBkYXRlR2VzdHVyZUhhbmRsZXIodGhpcy5oYW5kbGVyVGFnLCBuZXdDb25maWcpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZSgpIHtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyh0aGlzLnByb3BzKSA6IHRoaXMucHJvcHMsXG4gICAgICAgIFsuLi5hbGxvd2VkUHJvcHMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzXSxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgICAgaWYgKCFkZWVwRXF1YWwodGhpcy5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgdGhpcy51cGRhdGVHZXN0dXJlSGFuZGxlcihuZXdDb25maWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldE5hdGl2ZVByb3BzKHVwZGF0ZXM6IGFueSkge1xuICAgICAgY29uc3QgbWVyZ2VkUHJvcHMgPSB7IC4uLnRoaXMucHJvcHMsIC4uLnVwZGF0ZXMgfTtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyhtZXJnZWRQcm9wcykgOiBtZXJnZWRQcm9wcyxcbiAgICAgICAgWy4uLmFsbG93ZWRQcm9wcywgLi4uY3VzdG9tTmF0aXZlUHJvcHNdLFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgICB0aGlzLnVwZGF0ZUdlc3R1cmVIYW5kbGVyKG5ld0NvbmZpZyk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgbGV0IGdlc3R1cmVFdmVudEhhbmRsZXIgPSB0aGlzLm9uR2VzdHVyZUhhbmRsZXJFdmVudDtcbiAgICAgIC8vIEFub3RoZXIgaW5zdGFuY2Ugb2YgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk5NVxuICAgICAgdHlwZSBPbkdlc3R1cmVFdmVudEhhbmRsZXJzID0ge1xuICAgICAgICBvbkdlc3R1cmVFdmVudD86IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFU+Wydvbkdlc3R1cmVFdmVudCddO1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ/OiBJbnRlcm5hbEV2ZW50SGFuZGxlcnNbJ29uR2VzdHVyZUhhbmRsZXJFdmVudCddO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgb25HZXN0dXJlRXZlbnQsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJFdmVudCxcbiAgICAgIH06IE9uR2VzdHVyZUV2ZW50SGFuZGxlcnMgPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uR2VzdHVyZUV2ZW50ICYmIHR5cGVvZiBvbkdlc3R1cmVFdmVudCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiBpdCdzIG5vdCBhIG1ldGhvZCBpdCBzaG91bGQgYmUgYW4gbmF0aXZlIEFuaW1hdGVkLmV2ZW50XG4gICAgICAgIC8vIG9iamVjdC4gV2Ugc2V0IGl0IGRpcmVjdGx5IGFzIHRoZSBoYW5kbGVyIGZvciB0aGUgdmlld1xuICAgICAgICAvLyBJbiB0aGlzIGNhc2UgbmVzdGVkIGhhbmRsZXJzIGFyZSBub3QgZ29pbmcgdG8gYmUgc3VwcG9ydGVkXG4gICAgICAgIGlmIChvbkdlc3R1cmVIYW5kbGVyRXZlbnQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnZXN0dXJlRXZlbnRIYW5kbGVyID0gb25HZXN0dXJlRXZlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlckV2ZW50ICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJFdmVudCAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsZXQgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gdGhpcy5vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICAvLyBBbm90aGVyIGluc3RhbmNlIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5OTVcbiAgICAgIHR5cGUgT25HZXN0dXJlU3RhdGVDaGFuZ2VIYW5kbGVycyA9IHtcbiAgICAgICAgb25IYW5kbGVyU3RhdGVDaGFuZ2U/OiBCYXNlR2VzdHVyZUhhbmRsZXJQcm9wczxVPlsnb25IYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlPzogSW50ZXJuYWxFdmVudEhhbmRsZXJzWydvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgIH07XG4gICAgICBjb25zdCB7XG4gICAgICAgIG9uSGFuZGxlclN0YXRlQ2hhbmdlLFxuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UsXG4gICAgICB9OiBPbkdlc3R1cmVTdGF0ZUNoYW5nZUhhbmRsZXJzID0gdGhpcy5wcm9wcztcbiAgICAgIGlmIChvbkhhbmRsZXJTdGF0ZUNoYW5nZSAmJiB0eXBlb2Ygb25IYW5kbGVyU3RhdGVDaGFuZ2UgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgaXQncyBub3QgYSBtZXRob2QgaXQgc2hvdWxkIGJlIGFuIG5hdGl2ZSBBbmltYXRlZC5ldmVudFxuICAgICAgICAvLyBvYmplY3QuIFdlIHNldCBpdCBkaXJlY3RseSBhcyB0aGUgaGFuZGxlciBmb3IgdGhlIHZpZXdcbiAgICAgICAgLy8gSW4gdGhpcyBjYXNlIG5lc3RlZCBoYW5kbGVycyBhcmUgbm90IGdvaW5nIHRvIGJlIHN1cHBvcnRlZFxuICAgICAgICBpZiAob25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ05lc3RpbmcgdG91Y2ggaGFuZGxlcnMgd2l0aCBuYXRpdmUgYW5pbWF0ZWQgZHJpdmVyIGlzIG5vdCBzdXBwb3J0ZWQgeWV0J1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gb25IYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgZXZlbnRzID0ge1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IHRoaXMuc3RhdGUuYWxsb3dUb3VjaGVzXG4gICAgICAgICAgPyBnZXN0dXJlRXZlbnRIYW5kbGVyXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZTogdGhpcy5zdGF0ZS5hbGxvd1RvdWNoZXNcbiAgICAgICAgICA/IGdlc3R1cmVTdGF0ZUV2ZW50SGFuZGxlclxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgdGhpcy5wcm9wc1JlZi5jdXJyZW50ID0gZXZlbnRzO1xuXG4gICAgICBjb25zdCBjaGlsZDogYW55ID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIGxldCBncmFuZENoaWxkcmVuID0gY2hpbGQucHJvcHMuY2hpbGRyZW47XG4gICAgICBpZiAoXG4gICAgICAgIFRvdWNoYWJsZS5UT1VDSF9UQVJHRVRfREVCVUcgJiZcbiAgICAgICAgY2hpbGQudHlwZSAmJlxuICAgICAgICAoY2hpbGQudHlwZSA9PT0gJ1JOR2VzdHVyZUhhbmRsZXJCdXR0b24nIHx8XG4gICAgICAgICAgY2hpbGQudHlwZS5uYW1lID09PSAnVmlldycgfHxcbiAgICAgICAgICBjaGlsZC50eXBlLmRpc3BsYXlOYW1lID09PSAnVmlldycpXG4gICAgICApIHtcbiAgICAgICAgZ3JhbmRDaGlsZHJlbiA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoZ3JhbmRDaGlsZHJlbik7XG4gICAgICAgIGdyYW5kQ2hpbGRyZW4ucHVzaChcbiAgICAgICAgICBUb3VjaGFibGUucmVuZGVyRGVidWdWaWV3KHtcbiAgICAgICAgICAgIGNvbG9yOiAnbWVkaXVtc3ByaW5nZ3JlZW4nLFxuICAgICAgICAgICAgaGl0U2xvcDogY2hpbGQucHJvcHMuaGl0U2xvcCxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KFxuICAgICAgICBjaGlsZCxcbiAgICAgICAge1xuICAgICAgICAgIHJlZjogdGhpcy5yZWZIYW5kbGVyLFxuICAgICAgICAgIGNvbGxhcHNhYmxlOiBmYWxzZSxcbiAgICAgICAgICAuLi4oaXNKZXN0RW52KClcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIGhhbmRsZXJUeXBlOiBuYW1lLFxuICAgICAgICAgICAgICAgIGhhbmRsZXJUYWc6IHRoaXMuaGFuZGxlclRhZyxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgICAgdGVzdElEOiB0aGlzLnByb3BzLnRlc3RJRCA/PyBjaGlsZC5wcm9wcy50ZXN0SUQsXG4gICAgICAgICAgLi4uZXZlbnRzLFxuICAgICAgICB9LFxuICAgICAgICBncmFuZENoaWxkcmVuXG4gICAgICApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gSGFuZGxlcjtcbn1cbiJdfQ==