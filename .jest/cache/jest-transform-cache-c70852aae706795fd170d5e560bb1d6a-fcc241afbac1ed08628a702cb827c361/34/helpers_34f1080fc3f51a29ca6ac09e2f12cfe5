3676fe8d4af9ae3fc57cf09ce1b79259
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateFlatAffixTopPosition = calculateFlatAffixTopPosition;
exports.calculateOutlinedIconAndAffixTopPosition = calculateOutlinedIconAndAffixTopPosition;
exports.areLabelsEqual = areLabelsEqual;
exports.calculateFlatInputHorizontalPadding = exports.interpolatePlaceholder = exports.adjustPaddingFlat = exports.adjustPaddingOut = exports.calculatePadding = exports.calculateInputHeight = exports.calculateLabelTopPosition = void 0;

var _constants = require("./constants");

var _enums = require("./Adornment/enums");

var calculateLabelTopPosition = function calculateLabelTopPosition(labelHeight) {
  var height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var optionalPadding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
  var customHeight = height > 0 ? height : 0;
  return Math.floor((customHeight - labelHeight) / 2 + optionalPadding);
};

exports.calculateLabelTopPosition = calculateLabelTopPosition;

var calculateInputHeight = function calculateInputHeight(labelHeight) {
  var height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var minHeight = arguments.length > 2 ? arguments[2] : undefined;
  var finalHeight = height > 0 ? height : labelHeight;
  if (height > 0) return height;
  return finalHeight < minHeight ? minHeight : finalHeight;
};

exports.calculateInputHeight = calculateInputHeight;

var calculatePadding = function calculatePadding(props) {
  var height = props.height,
      _props$multiline = props.multiline,
      multiline = _props$multiline === void 0 ? false : _props$multiline;
  var result = 0;

  if (multiline) {
    if (height && multiline) {
      result = calculateTextAreaPadding(props);
    } else {
      result = calculateInputPadding(props);
    }
  }

  return Math.max(0, result);
};

exports.calculatePadding = calculatePadding;

var calculateTextAreaPadding = function calculateTextAreaPadding(props) {
  var dense = props.dense;
  return dense ? 10 : 20;
};

var calculateInputPadding = function calculateInputPadding(_ref) {
  var topPosition = _ref.topPosition,
      fontSize = _ref.fontSize,
      multiline = _ref.multiline,
      scale = _ref.scale,
      dense = _ref.dense,
      offset = _ref.offset,
      isAndroid = _ref.isAndroid;
  var refFontSize = scale * fontSize;
  var result = Math.floor(topPosition / 2);
  result = result + Math.floor((refFontSize - fontSize) / 2) - (scale < 1 ? offset / 2 : 0);
  if (multiline && isAndroid) result = Math.min(dense ? offset / 2 : offset, result);
  return result;
};

var adjustPaddingOut = function adjustPaddingOut(_ref2) {
  var pad = _ref2.pad,
      multiline = _ref2.multiline,
      label = _ref2.label,
      scale = _ref2.scale,
      height = _ref2.height,
      fontSize = _ref2.fontSize,
      lineHeight = _ref2.lineHeight,
      dense = _ref2.dense,
      offset = _ref2.offset,
      isAndroid = _ref2.isAndroid;
  var fontHeight = lineHeight !== null && lineHeight !== void 0 ? lineHeight : fontSize;
  var refFontHeight = scale * fontSize;
  var result = pad;

  if (height && !multiline) {
    return {
      paddingTop: Math.max(0, (height - fontHeight) / 2),
      paddingBottom: Math.max(0, (height - fontHeight) / 2)
    };
  }

  if (!isAndroid && multiline) {
    if (dense) {
      if (label) {
        result += scale < 1 ? Math.min(offset, refFontHeight / 2 * scale) : 0;
      } else {
        result += 0;
      }
    }

    if (!dense) {
      if (label) {
        result += scale < 1 ? Math.min(offset, refFontHeight * scale) : Math.min(offset / 2, refFontHeight * scale);
      } else {
        result += scale < 1 ? Math.min(offset / 2, refFontHeight * scale) : 0;
      }
    }

    result = Math.floor(result);
  }

  return {
    paddingTop: result,
    paddingBottom: result
  };
};

exports.adjustPaddingOut = adjustPaddingOut;

var adjustPaddingFlat = function adjustPaddingFlat(_ref3) {
  var pad = _ref3.pad,
      scale = _ref3.scale,
      multiline = _ref3.multiline,
      label = _ref3.label,
      height = _ref3.height,
      offset = _ref3.offset,
      dense = _ref3.dense,
      fontSize = _ref3.fontSize,
      isAndroid = _ref3.isAndroid,
      styles = _ref3.styles;
  var result = pad;
  var topResult = result;
  var bottomResult = result;
  var paddingTop = styles.paddingTop,
      paddingBottom = styles.paddingBottom;
  var refFontSize = scale * fontSize;

  if (!multiline) {
    if (label) {
      return {
        paddingTop: paddingTop,
        paddingBottom: paddingBottom
      };
    }

    return {
      paddingTop: result,
      paddingBottom: result
    };
  }

  if (label) {
    topResult = paddingTop;
    bottomResult = paddingBottom;

    if (!isAndroid) {
      if (dense) {
        topResult += scale < 1 ? Math.min(result, refFontSize * scale) - result / 2 : Math.min(result, refFontSize * scale) - result / 2;
      }

      if (!dense) {
        topResult += scale < 1 ? Math.min(offset / 2, refFontSize * scale) : Math.min(result, refFontSize * scale) - offset / 2;
      }
    }

    topResult = Math.floor(topResult);
  } else {
    if (height) {
      return {
        paddingTop: Math.max(0, (height - fontSize) / 2),
        paddingBottom: Math.max(0, (height - fontSize) / 2)
      };
    }

    if (!isAndroid) {
      if (dense) {
        result += scale < 1 ? Math.min(offset / 2, fontSize / 2 * scale) : Math.min(offset / 2, scale);
      }

      if (!dense) {
        result += scale < 1 ? Math.min(offset, fontSize * scale) : Math.min(fontSize, offset / 2 * scale);
      }

      result = Math.floor(result);
      topResult = result;
      bottomResult = result;
    }
  }

  return {
    paddingTop: Math.max(0, topResult),
    paddingBottom: Math.max(0, bottomResult)
  };
};

exports.adjustPaddingFlat = adjustPaddingFlat;

var interpolatePlaceholder = function interpolatePlaceholder(labeled, hasActiveOutline) {
  return labeled.interpolate({
    inputRange: [0, 1],
    outputRange: [hasActiveOutline ? 0 : 1, 1]
  });
};

exports.interpolatePlaceholder = interpolatePlaceholder;

function calculateFlatAffixTopPosition(_ref4) {
  var height = _ref4.height,
      paddingTop = _ref4.paddingTop,
      paddingBottom = _ref4.paddingBottom,
      affixHeight = _ref4.affixHeight;
  var inputHeightWithoutPadding = height - paddingTop - paddingBottom;
  var halfOfTheInputHeightDecreasedByAffixHeight = (inputHeightWithoutPadding - affixHeight) / 2;
  return paddingTop + halfOfTheInputHeightDecreasedByAffixHeight;
}

function calculateOutlinedIconAndAffixTopPosition(_ref5) {
  var height = _ref5.height,
      affixHeight = _ref5.affixHeight,
      labelYOffset = _ref5.labelYOffset;
  return (height - affixHeight + labelYOffset) / 2;
}

var calculateFlatInputHorizontalPadding = function calculateFlatInputHorizontalPadding(_ref6) {
  var adornmentConfig = _ref6.adornmentConfig;
  var paddingLeft = _constants.LABEL_PADDING_HORIZONTAL;
  var paddingRight = _constants.LABEL_PADDING_HORIZONTAL;
  adornmentConfig.forEach(function (_ref7) {
    var type = _ref7.type,
        side = _ref7.side;

    if (type === _enums.AdornmentType.Icon && side === _enums.AdornmentSide.Left) {
      paddingLeft = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
    } else if (side === _enums.AdornmentSide.Right) {
      if (type === _enums.AdornmentType.Affix) {
        paddingRight = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
      } else if (type === _enums.AdornmentType.Icon) {
        paddingRight = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
      }
    }
  });
  return {
    paddingLeft: paddingLeft,
    paddingRight: paddingRight
  };
};

exports.calculateFlatInputHorizontalPadding = calculateFlatInputHorizontalPadding;

function areLabelsEqual(label1, label2) {
  if (label1 === label2) {
    return true;
  }

  if (!(label1 || label2)) {
    return true;
  }

  if (!(label1 && label2)) {
    return false;
  }

  if (typeof label1 !== typeof label2) {
    return false;
  }

  if (typeof label1 === 'string' || label1 instanceof String || typeof label2 === 'string' || label2 instanceof String) {
    return false;
  }

  if (label1.type !== label2.type) {
    return false;
  }

  var label1Props = label1.props || {};
  var label2Props = label2.props || {};

  if (JSON.stringify(label1Props) !== JSON.stringify(label2Props)) {
    return false;
  }

  if (!(label1Props.children || label2Props.children)) {
    return true;
  }

  if (!(label1Props.children && label2Props.children)) {
    return false;
  }

  var label1IsArray = Array.isArray(label1Props.children);
  var label2IsArray = Array.isArray(label2Props.children);

  if (label1IsArray && label2IsArray) {
    var children1 = label1Props.children;
    var children2 = label2Props.children;

    if (children1.length !== children2.length) {
      return false;
    }

    for (var i = 0; i < children1.length; i++) {
      if (!areLabelsEqual(children1[i], children2[i])) {
        return false;
      }
    }

    return true;
  }

  if (label1IsArray || label2IsArray) {
    return false;
  }

  return areLabelsEqual(label1Props.children, label2Props.children);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QztBQUNsQyxRQUFNQyxTQUFTLEdBQUdULFdBQVcsQ0FBQ0ksUUFBOUI7QUFDQSxRQUFNTSxTQUFTLEdBQUdULFdBQVcsQ0FBQ0csUUFBOUI7O0FBQ0EsUUFBSUssU0FBUyxDQUFDRSxNQUFWRixLQUFxQkMsU0FBUyxDQUFDQyxNQUFuQyxFQUEyQztBQUN6QyxhQUFPLEtBQVA7QUFKZ0M7O0FBUWxDLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsU0FBUyxDQUFDRSxNQUE5QixFQUFzQ0MsQ0FBQyxFQUF2QyxFQUEyQztBQUN6QyxVQUFJLENBQUNoQixjQUFjLENBQUNhLFNBQVMsQ0FBQ0csQ0FBRCxDQUFWLEVBQWVGLFNBQVMsQ0FBQ0UsQ0FBRCxDQUF4QixDQUFuQixFQUFpRDtBQUMvQyxlQUFPLEtBQVA7QUFDRDtBQUNGOztBQUVELFdBQU8sSUFBUDtBQTdFTzs7QUFpRlQsTUFBSVAsYUFBYSxJQUFJRyxhQUFyQixFQUFvQztBQUNsQyxXQUFPLEtBQVA7QUFsRk87O0FBc0ZULFNBQU9aLGNBQWMsQ0FBQ0ksV0FBVyxDQUFDSSxRQUFiLEVBQXVCSCxXQUFXLENBQUNHLFFBQW5DLENBQXJCO0FBQ0QiLCJuYW1lcyI6WyJjYWxjdWxhdGVMYWJlbFRvcFBvc2l0aW9uIiwibGFiZWxIZWlnaHQiLCJoZWlnaHQiLCJvcHRpb25hbFBhZGRpbmciLCJjdXN0b21IZWlnaHQiLCJNYXRoIiwiZmxvb3IiLCJjYWxjdWxhdGVJbnB1dEhlaWdodCIsIm1pbkhlaWdodCIsImZpbmFsSGVpZ2h0IiwiY2FsY3VsYXRlUGFkZGluZyIsInByb3BzIiwibXVsdGlsaW5lIiwicmVzdWx0IiwiY2FsY3VsYXRlVGV4dEFyZWFQYWRkaW5nIiwiY2FsY3VsYXRlSW5wdXRQYWRkaW5nIiwibWF4IiwiZGVuc2UiLCJ0b3BQb3NpdGlvbiIsImZvbnRTaXplIiwic2NhbGUiLCJvZmZzZXQiLCJpc0FuZHJvaWQiLCJyZWZGb250U2l6ZSIsIm1pbiIsImFkanVzdFBhZGRpbmdPdXQiLCJwYWQiLCJsYWJlbCIsImxpbmVIZWlnaHQiLCJmb250SGVpZ2h0IiwicmVmRm9udEhlaWdodCIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIiwiYWRqdXN0UGFkZGluZ0ZsYXQiLCJzdHlsZXMiLCJ0b3BSZXN1bHQiLCJib3R0b21SZXN1bHQiLCJpbnRlcnBvbGF0ZVBsYWNlaG9sZGVyIiwibGFiZWxlZCIsImhhc0FjdGl2ZU91dGxpbmUiLCJpbnRlcnBvbGF0ZSIsImlucHV0UmFuZ2UiLCJvdXRwdXRSYW5nZSIsImNhbGN1bGF0ZUZsYXRBZmZpeFRvcFBvc2l0aW9uIiwiYWZmaXhIZWlnaHQiLCJpbnB1dEhlaWdodFdpdGhvdXRQYWRkaW5nIiwiaGFsZk9mVGhlSW5wdXRIZWlnaHREZWNyZWFzZWRCeUFmZml4SGVpZ2h0IiwiY2FsY3VsYXRlT3V0bGluZWRJY29uQW5kQWZmaXhUb3BQb3NpdGlvbiIsImxhYmVsWU9mZnNldCIsImNhbGN1bGF0ZUZsYXRJbnB1dEhvcml6b250YWxQYWRkaW5nIiwiYWRvcm5tZW50Q29uZmlnIiwicGFkZGluZ0xlZnQiLCJMQUJFTF9QQURESU5HX0hPUklaT05UQUwiLCJwYWRkaW5nUmlnaHQiLCJmb3JFYWNoIiwidHlwZSIsInNpZGUiLCJBZG9ybm1lbnRUeXBlIiwiSWNvbiIsIkFkb3JubWVudFNpZGUiLCJMZWZ0IiwiQURPUk5NRU5UX1NJWkUiLCJBRE9STk1FTlRfT0ZGU0VUIiwiRkxBVF9JTlBVVF9PRkZTRVQiLCJSaWdodCIsIkFmZml4IiwiYXJlTGFiZWxzRXF1YWwiLCJsYWJlbDEiLCJsYWJlbDIiLCJTdHJpbmciLCJsYWJlbDFQcm9wcyIsImxhYmVsMlByb3BzIiwiSlNPTiIsInN0cmluZ2lmeSIsImNoaWxkcmVuIiwibGFiZWwxSXNBcnJheSIsIkFycmF5IiwiaXNBcnJheSIsImxhYmVsMklzQXJyYXkiLCJjaGlsZHJlbjEiLCJjaGlsZHJlbjIiLCJsZW5ndGgiLCJpIl0sInNvdXJjZXMiOlsiaGVscGVycy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBBbmltYXRlZCB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5pbXBvcnQgdHlwZSB7IEFkb3JubWVudENvbmZpZyB9IGZyb20gJy4vQWRvcm5tZW50L3R5cGVzJztcbmltcG9ydCB7XG4gIExBQkVMX1BBRERJTkdfSE9SSVpPTlRBTCxcbiAgQURPUk5NRU5UX09GRlNFVCxcbiAgQURPUk5NRU5UX1NJWkUsXG4gIEZMQVRfSU5QVVRfT0ZGU0VULFxufSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBBZG9ybm1lbnRUeXBlLCBBZG9ybm1lbnRTaWRlIH0gZnJvbSAnLi9BZG9ybm1lbnQvZW51bXMnO1xuaW1wb3J0IHR5cGUgeyBUZXh0SW5wdXRMYWJlbFByb3AgfSBmcm9tICcuL3R5cGVzJztcblxudHlwZSBQYWRkaW5nUHJvcHMgPSB7XG4gIGhlaWdodDogbnVtYmVyIHwgbnVsbDtcbiAgbGFiZWxIYWxmSGVpZ2h0OiBudW1iZXI7XG4gIG11bHRpbGluZTogYm9vbGVhbiB8IG51bGw7XG4gIGRlbnNlOiBib29sZWFuIHwgbnVsbDtcbiAgdG9wUG9zaXRpb246IG51bWJlcjtcbiAgZm9udFNpemU6IG51bWJlcjtcbiAgbGluZUhlaWdodD86IG51bWJlcjtcbiAgbGFiZWw/OiBUZXh0SW5wdXRMYWJlbFByb3AgfCBudWxsO1xuICBzY2FsZTogbnVtYmVyO1xuICBvZmZzZXQ6IG51bWJlcjtcbiAgaXNBbmRyb2lkOiBib29sZWFuO1xuICBzdHlsZXM6IHsgcGFkZGluZ1RvcDogbnVtYmVyOyBwYWRkaW5nQm90dG9tOiBudW1iZXIgfTtcbn07XG5cbnR5cGUgQWRqUHJvcHMgPSBQYWRkaW5nUHJvcHMgJiB7XG4gIHBhZDogbnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgUGFkZGluZyA9IHsgcGFkZGluZ1RvcDogbnVtYmVyOyBwYWRkaW5nQm90dG9tOiBudW1iZXIgfTtcblxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZUxhYmVsVG9wUG9zaXRpb24gPSAoXG4gIGxhYmVsSGVpZ2h0OiBudW1iZXIsXG4gIGhlaWdodDogbnVtYmVyID0gMCxcbiAgb3B0aW9uYWxQYWRkaW5nOiBudW1iZXIgPSAwXG4pOiBudW1iZXIgPT4ge1xuICBjb25zdCBjdXN0b21IZWlnaHQgPSBoZWlnaHQgPiAwID8gaGVpZ2h0IDogMDtcblxuICByZXR1cm4gTWF0aC5mbG9vcigoY3VzdG9tSGVpZ2h0IC0gbGFiZWxIZWlnaHQpIC8gMiArIG9wdGlvbmFsUGFkZGluZyk7XG59O1xuXG5leHBvcnQgY29uc3QgY2FsY3VsYXRlSW5wdXRIZWlnaHQgPSAoXG4gIGxhYmVsSGVpZ2h0OiBudW1iZXIsXG4gIGhlaWdodDogYW55ID0gMCxcbiAgbWluSGVpZ2h0OiBudW1iZXJcbik6IG51bWJlciA9PiB7XG4gIGNvbnN0IGZpbmFsSGVpZ2h0ID0gaGVpZ2h0ID4gMCA/IGhlaWdodCA6IGxhYmVsSGVpZ2h0O1xuXG4gIGlmIChoZWlnaHQgPiAwKSByZXR1cm4gaGVpZ2h0O1xuICByZXR1cm4gZmluYWxIZWlnaHQgPCBtaW5IZWlnaHQgPyBtaW5IZWlnaHQgOiBmaW5hbEhlaWdodDtcbn07XG5cbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVQYWRkaW5nID0gKHByb3BzOiBQYWRkaW5nUHJvcHMpOiBudW1iZXIgPT4ge1xuICBjb25zdCB7IGhlaWdodCwgbXVsdGlsaW5lID0gZmFsc2UgfSA9IHByb3BzO1xuXG4gIGxldCByZXN1bHQgPSAwO1xuXG4gIGlmIChtdWx0aWxpbmUpIHtcbiAgICBpZiAoaGVpZ2h0ICYmIG11bHRpbGluZSkge1xuICAgICAgcmVzdWx0ID0gY2FsY3VsYXRlVGV4dEFyZWFQYWRkaW5nKHByb3BzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0ID0gY2FsY3VsYXRlSW5wdXRQYWRkaW5nKHByb3BzKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gTWF0aC5tYXgoMCwgcmVzdWx0KTtcbn07XG5cbmNvbnN0IGNhbGN1bGF0ZVRleHRBcmVhUGFkZGluZyA9IChwcm9wczogUGFkZGluZ1Byb3BzKSA9PiB7XG4gIGNvbnN0IHsgZGVuc2UgfSA9IHByb3BzO1xuXG4gIHJldHVybiBkZW5zZSA/IDEwIDogMjA7XG59O1xuXG5jb25zdCBjYWxjdWxhdGVJbnB1dFBhZGRpbmcgPSAoe1xuICB0b3BQb3NpdGlvbixcbiAgZm9udFNpemUsXG4gIG11bHRpbGluZSxcbiAgc2NhbGUsXG4gIGRlbnNlLFxuICBvZmZzZXQsXG4gIGlzQW5kcm9pZCxcbn06IFBhZGRpbmdQcm9wcyk6IG51bWJlciA9PiB7XG4gIGNvbnN0IHJlZkZvbnRTaXplID0gc2NhbGUgKiBmb250U2l6ZTtcbiAgbGV0IHJlc3VsdCA9IE1hdGguZmxvb3IodG9wUG9zaXRpb24gLyAyKTtcblxuICByZXN1bHQgPVxuICAgIHJlc3VsdCArXG4gICAgTWF0aC5mbG9vcigocmVmRm9udFNpemUgLSBmb250U2l6ZSkgLyAyKSAtXG4gICAgKHNjYWxlIDwgMSA/IG9mZnNldCAvIDIgOiAwKTtcblxuICBpZiAobXVsdGlsaW5lICYmIGlzQW5kcm9pZClcbiAgICByZXN1bHQgPSBNYXRoLm1pbihkZW5zZSA/IG9mZnNldCAvIDIgOiBvZmZzZXQsIHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmV4cG9ydCBjb25zdCBhZGp1c3RQYWRkaW5nT3V0ID0gKHtcbiAgcGFkLFxuICBtdWx0aWxpbmUsXG4gIGxhYmVsLFxuICBzY2FsZSxcbiAgaGVpZ2h0LFxuICBmb250U2l6ZSxcbiAgbGluZUhlaWdodCxcbiAgZGVuc2UsXG4gIG9mZnNldCxcbiAgaXNBbmRyb2lkLFxufTogQWRqUHJvcHMpOiBQYWRkaW5nID0+IHtcbiAgY29uc3QgZm9udEhlaWdodCA9IGxpbmVIZWlnaHQgPz8gZm9udFNpemU7XG4gIGNvbnN0IHJlZkZvbnRIZWlnaHQgPSBzY2FsZSAqIGZvbnRTaXplO1xuICBsZXQgcmVzdWx0ID0gcGFkO1xuXG4gIGlmIChoZWlnaHQgJiYgIW11bHRpbGluZSkge1xuICAgIHJldHVybiB7XG4gICAgICBwYWRkaW5nVG9wOiBNYXRoLm1heCgwLCAoaGVpZ2h0IC0gZm9udEhlaWdodCkgLyAyKSxcbiAgICAgIHBhZGRpbmdCb3R0b206IE1hdGgubWF4KDAsIChoZWlnaHQgLSBmb250SGVpZ2h0KSAvIDIpLFxuICAgIH07XG4gIH1cbiAgaWYgKCFpc0FuZHJvaWQgJiYgbXVsdGlsaW5lKSB7XG4gICAgaWYgKGRlbnNlKSB7XG4gICAgICBpZiAobGFiZWwpIHtcbiAgICAgICAgcmVzdWx0ICs9IHNjYWxlIDwgMSA/IE1hdGgubWluKG9mZnNldCwgKHJlZkZvbnRIZWlnaHQgLyAyKSAqIHNjYWxlKSA6IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFkZW5zZSkge1xuICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQsIHJlZkZvbnRIZWlnaHQgKiBzY2FsZSlcbiAgICAgICAgICAgIDogTWF0aC5taW4ob2Zmc2V0IC8gMiwgcmVmRm9udEhlaWdodCAqIHNjYWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCArPSBzY2FsZSA8IDEgPyBNYXRoLm1pbihvZmZzZXQgLyAyLCByZWZGb250SGVpZ2h0ICogc2NhbGUpIDogMDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzdWx0ID0gTWF0aC5mbG9vcihyZXN1bHQpO1xuICB9XG4gIHJldHVybiB7IHBhZGRpbmdUb3A6IHJlc3VsdCwgcGFkZGluZ0JvdHRvbTogcmVzdWx0IH07XG59O1xuXG5leHBvcnQgY29uc3QgYWRqdXN0UGFkZGluZ0ZsYXQgPSAoe1xuICBwYWQsXG4gIHNjYWxlLFxuICBtdWx0aWxpbmUsXG4gIGxhYmVsLFxuICBoZWlnaHQsXG4gIG9mZnNldCxcbiAgZGVuc2UsXG4gIGZvbnRTaXplLFxuICBpc0FuZHJvaWQsXG4gIHN0eWxlcyxcbn06IEFkalByb3BzKTogUGFkZGluZyA9PiB7XG4gIGxldCByZXN1bHQgPSBwYWQ7XG4gIGxldCB0b3BSZXN1bHQgPSByZXN1bHQ7XG4gIGxldCBib3R0b21SZXN1bHQgPSByZXN1bHQ7XG4gIGNvbnN0IHsgcGFkZGluZ1RvcCwgcGFkZGluZ0JvdHRvbSB9ID0gc3R5bGVzO1xuICBjb25zdCByZWZGb250U2l6ZSA9IHNjYWxlICogZm9udFNpemU7XG5cbiAgaWYgKCFtdWx0aWxpbmUpIHtcbiAgICAvLyBkbyBub3QgbW9kaWZ5IHBhZGRpbmcgaWYgaW5wdXQgaXMgbm90IG11bHRpbGluZVxuICAgIGlmIChsYWJlbCkge1xuICAgICAgLy8gcmV0dXJuIGNvbnN0IHN0eWxlIGZvciBmbGF0IGlucHV0IHdpdGggbGFiZWxcbiAgICAgIHJldHVybiB7IHBhZGRpbmdUb3AsIHBhZGRpbmdCb3R0b20gfTtcbiAgICB9XG4gICAgLy8gcmV0dXJuIHBhZCBmb3IgZmxhdCBpbnB1dCB3aXRob3V0IGxhYmVsXG4gICAgcmV0dXJuIHsgcGFkZGluZ1RvcDogcmVzdWx0LCBwYWRkaW5nQm90dG9tOiByZXN1bHQgfTtcbiAgfVxuXG4gIGlmIChsYWJlbCkge1xuICAgIC8vIGFkZCBwYWRkaW5ncyBwYXNzZWQgZnJvbSBzdHlsZXNcbiAgICB0b3BSZXN1bHQgPSBwYWRkaW5nVG9wO1xuICAgIGJvdHRvbVJlc3VsdCA9IHBhZGRpbmdCb3R0b207XG5cbiAgICAvLyBhZGp1c3QgdG9wIHBhZGRpbmcgZm9yIGlPU1xuICAgIGlmICghaXNBbmRyb2lkKSB7XG4gICAgICBpZiAoZGVuc2UpIHtcbiAgICAgICAgdG9wUmVzdWx0ICs9XG4gICAgICAgICAgc2NhbGUgPCAxXG4gICAgICAgICAgICA/IE1hdGgubWluKHJlc3VsdCwgcmVmRm9udFNpemUgKiBzY2FsZSkgLSByZXN1bHQgLyAyXG4gICAgICAgICAgICA6IE1hdGgubWluKHJlc3VsdCwgcmVmRm9udFNpemUgKiBzY2FsZSkgLSByZXN1bHQgLyAyO1xuICAgICAgfVxuICAgICAgaWYgKCFkZW5zZSkge1xuICAgICAgICB0b3BSZXN1bHQgKz1cbiAgICAgICAgICBzY2FsZSA8IDFcbiAgICAgICAgICAgID8gTWF0aC5taW4ob2Zmc2V0IC8gMiwgcmVmRm9udFNpemUgKiBzY2FsZSlcbiAgICAgICAgICAgIDogTWF0aC5taW4ocmVzdWx0LCByZWZGb250U2l6ZSAqIHNjYWxlKSAtIG9mZnNldCAvIDI7XG4gICAgICB9XG4gICAgfVxuICAgIHRvcFJlc3VsdCA9IE1hdGguZmxvb3IodG9wUmVzdWx0KTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoaGVpZ2h0KSB7XG4gICAgICAvLyBjZW50ZXIgdGV4dCB3aGVuIGhlaWdodCBpcyBwYXNzZWRcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhZGRpbmdUb3A6IE1hdGgubWF4KDAsIChoZWlnaHQgLSBmb250U2l6ZSkgLyAyKSxcbiAgICAgICAgcGFkZGluZ0JvdHRvbTogTWF0aC5tYXgoMCwgKGhlaWdodCAtIGZvbnRTaXplKSAvIDIpLFxuICAgICAgfTtcbiAgICB9XG4gICAgLy8gYWRqdXN0IHBhZGRpbmdzIGZvciBpT1MgaWYgbm8gbGFiZWxcbiAgICBpZiAoIWlzQW5kcm9pZCkge1xuICAgICAgaWYgKGRlbnNlKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQgLyAyLCAoZm9udFNpemUgLyAyKSAqIHNjYWxlKVxuICAgICAgICAgICAgOiBNYXRoLm1pbihvZmZzZXQgLyAyLCBzY2FsZSk7XG4gICAgICB9XG4gICAgICBpZiAoIWRlbnNlKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQsIGZvbnRTaXplICogc2NhbGUpXG4gICAgICAgICAgICA6IE1hdGgubWluKGZvbnRTaXplLCAob2Zmc2V0IC8gMikgKiBzY2FsZSk7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdCA9IE1hdGguZmxvb3IocmVzdWx0KTtcbiAgICAgIHRvcFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgIGJvdHRvbVJlc3VsdCA9IHJlc3VsdDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBhZGRpbmdUb3A6IE1hdGgubWF4KDAsIHRvcFJlc3VsdCksXG4gICAgcGFkZGluZ0JvdHRvbTogTWF0aC5tYXgoMCwgYm90dG9tUmVzdWx0KSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbnRlcnBvbGF0ZVBsYWNlaG9sZGVyID0gKFxuICBsYWJlbGVkOiBBbmltYXRlZC5WYWx1ZSxcbiAgaGFzQWN0aXZlT3V0bGluZTogYm9vbGVhbiB8IHVuZGVmaW5lZFxuKSA9PlxuICBsYWJlbGVkLmludGVycG9sYXRlKHtcbiAgICBpbnB1dFJhbmdlOiBbMCwgMV0sXG4gICAgb3V0cHV0UmFuZ2U6IFtoYXNBY3RpdmVPdXRsaW5lID8gMCA6IDEsIDFdLFxuICB9KTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUZsYXRBZmZpeFRvcFBvc2l0aW9uKHtcbiAgaGVpZ2h0LFxuICBwYWRkaW5nVG9wLFxuICBwYWRkaW5nQm90dG9tLFxuICBhZmZpeEhlaWdodCxcbn06IHtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHBhZGRpbmdUb3A6IG51bWJlcjtcbiAgcGFkZGluZ0JvdHRvbTogbnVtYmVyO1xuICBhZmZpeEhlaWdodDogbnVtYmVyO1xufSk6IG51bWJlciB7XG4gIGNvbnN0IGlucHV0SGVpZ2h0V2l0aG91dFBhZGRpbmcgPSBoZWlnaHQgLSBwYWRkaW5nVG9wIC0gcGFkZGluZ0JvdHRvbTtcblxuICBjb25zdCBoYWxmT2ZUaGVJbnB1dEhlaWdodERlY3JlYXNlZEJ5QWZmaXhIZWlnaHQgPVxuICAgIChpbnB1dEhlaWdodFdpdGhvdXRQYWRkaW5nIC0gYWZmaXhIZWlnaHQpIC8gMjtcblxuICByZXR1cm4gcGFkZGluZ1RvcCArIGhhbGZPZlRoZUlucHV0SGVpZ2h0RGVjcmVhc2VkQnlBZmZpeEhlaWdodDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU91dGxpbmVkSWNvbkFuZEFmZml4VG9wUG9zaXRpb24oe1xuICBoZWlnaHQsXG4gIGFmZml4SGVpZ2h0LFxuICBsYWJlbFlPZmZzZXQsXG59OiB7XG4gIGhlaWdodDogbnVtYmVyO1xuICBhZmZpeEhlaWdodDogbnVtYmVyO1xuICBsYWJlbFlPZmZzZXQ6IG51bWJlcjtcbn0pOiBudW1iZXIge1xuICByZXR1cm4gKGhlaWdodCAtIGFmZml4SGVpZ2h0ICsgbGFiZWxZT2Zmc2V0KSAvIDI7XG59XG5cbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVGbGF0SW5wdXRIb3Jpem9udGFsUGFkZGluZyA9ICh7XG4gIGFkb3JubWVudENvbmZpZyxcbn06IHtcbiAgYWRvcm5tZW50Q29uZmlnOiBBZG9ybm1lbnRDb25maWdbXTtcbn0pID0+IHtcbiAgbGV0IHBhZGRpbmdMZWZ0ID0gTEFCRUxfUEFERElOR19IT1JJWk9OVEFMO1xuICBsZXQgcGFkZGluZ1JpZ2h0ID0gTEFCRUxfUEFERElOR19IT1JJWk9OVEFMO1xuXG4gIGFkb3JubWVudENvbmZpZy5mb3JFYWNoKCh7IHR5cGUsIHNpZGUgfSkgPT4ge1xuICAgIGlmICh0eXBlID09PSBBZG9ybm1lbnRUeXBlLkljb24gJiYgc2lkZSA9PT0gQWRvcm5tZW50U2lkZS5MZWZ0KSB7XG4gICAgICBwYWRkaW5nTGVmdCA9IEFET1JOTUVOVF9TSVpFICsgQURPUk5NRU5UX09GRlNFVCArIEZMQVRfSU5QVVRfT0ZGU0VUO1xuICAgIH0gZWxzZSBpZiAoc2lkZSA9PT0gQWRvcm5tZW50U2lkZS5SaWdodCkge1xuICAgICAgaWYgKHR5cGUgPT09IEFkb3JubWVudFR5cGUuQWZmaXgpIHtcbiAgICAgICAgcGFkZGluZ1JpZ2h0ID0gQURPUk5NRU5UX1NJWkUgKyBBRE9STk1FTlRfT0ZGU0VUICsgRkxBVF9JTlBVVF9PRkZTRVQ7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEFkb3JubWVudFR5cGUuSWNvbikge1xuICAgICAgICBwYWRkaW5nUmlnaHQgPSBBRE9STk1FTlRfU0laRSArIEFET1JOTUVOVF9PRkZTRVQgKyBGTEFUX0lOUFVUX09GRlNFVDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7IHBhZGRpbmdMZWZ0LCBwYWRkaW5nUmlnaHQgfTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBhcmVMYWJlbHNFcXVhbChcbiAgbGFiZWwxPzogVGV4dElucHV0TGFiZWxQcm9wLFxuICBsYWJlbDI/OiBUZXh0SW5wdXRMYWJlbFByb3Bcbik6IGJvb2xlYW4ge1xuICBpZiAobGFiZWwxID09PSBsYWJlbDIpIHtcbiAgICAvLyB3aWxsIGFsc28gdGFrZSBjYXJlIG9mIGVxdWFsaXR5IGZvciBgc3RyaW5nYCB0eXBlLCBvciBpZiBib3RoIGFyZSB1bmRlZmluZWQuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBSZXR1cm4gdHJ1ZSBpZiBib3RoIG9mIHRoZW0gYXJlIGZhbHN5LlxuICBpZiAoIShsYWJlbDEgfHwgbGFiZWwyKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gQXQgdGhpcyBwb2ludCwgYm90aCBvZiB0aGVtIGNhbm5vdCBiZSBmYWxzZS5cbiAgLy8gU28sIHJldHVybiBmYWxzZSBpZiBhbnkgb2YgdGhlbSBpcyBmYWxzeS5cbiAgaWYgKCEobGFiZWwxICYmIGxhYmVsMikpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBBdCB0aGlzIHBvaW50LCBib3RoIG9mIHRoZW0gaGFzIHRvIGJlIHRydXRoeS5cbiAgLy8gU28sIHJldHVybiBmYWxzZSBpZiB0aGV5IGFyZSBub3Qgb2YgdGhlIHNhbWUgdHlwZS5cbiAgaWYgKHR5cGVvZiBsYWJlbDEgIT09IHR5cGVvZiBsYWJlbDIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBBdCB0aGlzIHBvaW50LCBib3RoIG9mIHRoZW0gaGFzIHRvIGJlIG9mIHRoZSBzYW1lIGRhdGF0eXBlLlxuICBpZiAoXG4gICAgdHlwZW9mIGxhYmVsMSA9PT0gJ3N0cmluZycgfHxcbiAgICBsYWJlbDEgaW5zdGFuY2VvZiBTdHJpbmcgfHxcbiAgICAvLyBUaGVzZSBsYXN0IHR3byBPUiBjaGVja3MgYXJlIG9ubHkgaGVyZSBmb3IgVHlwZXNjcmlwdCdzIHNha2UuXG4gICAgdHlwZW9mIGxhYmVsMiA9PT0gJ3N0cmluZycgfHxcbiAgICBsYWJlbDIgaW5zdGFuY2VvZiBTdHJpbmdcbiAgKSB7XG4gICAgLy8gVGhleSdyZSBzdHJpbmdzLCBzbyB0aGV5IHdvbid0IGJlIGVxdWFsOyBvdGhlcndpc2VcbiAgICAvLyAgd2Ugd291bGQgaGF2ZSByZXR1cm5lZCAndHJ1ZScgZWFybGllci5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBBdCB0aGlzIHBvaW50LCBib3RoIG9mIHRoZW0gaGFzIHRvIGJlIG9mIHRoZSBkYXRhdHlwZTogYFJlYWN0LlJlYWN0RWxlbWVudGAuXG4gIGlmIChsYWJlbDEudHlwZSAhPT0gbGFiZWwyLnR5cGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBQcmVsaW1pbmFyeSBlcXVhbGl0eSBjaGVjazogZG8gdGhleSBzdHJpbmdpZnkgdG8gdGhlIHNhbWUgc3RyaW5nP1xuICBjb25zdCBsYWJlbDFQcm9wcyA9IGxhYmVsMS5wcm9wcyB8fCB7fTtcbiAgY29uc3QgbGFiZWwyUHJvcHMgPSBsYWJlbDIucHJvcHMgfHwge307XG4gIGlmIChKU09OLnN0cmluZ2lmeShsYWJlbDFQcm9wcykgIT09IEpTT04uc3RyaW5naWZ5KGxhYmVsMlByb3BzKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFdlIG5vdyBrbm93IHRoZXkgc3RyaW5naWZ5IHRvIHRoZSBzYW1lIHN0cmluZy5cbiAgLy8gUmV0dXJuIHRydWUgaWYgYm90aCBvZiB0aGVtIERPIE5PVCBoYXZlIGNoaWxkcmVuXG4gIGlmICghKGxhYmVsMVByb3BzLmNoaWxkcmVuIHx8IGxhYmVsMlByb3BzLmNoaWxkcmVuKSkge1xuICAgIHJldHVybiB0cnVlOyAvLyBzaW5jZSB0aGVyZSdzIG5vdGhpbmcgZWxzZSB0byBjaGVja1xuICB9XG5cbiAgLy8gUmV0dXJuIGZhbHNlIGlmIG9ubHkgb25lIG9mIHRoZW0gaGFzIGNoaWxkcmVuXG4gIGlmICghKGxhYmVsMVByb3BzLmNoaWxkcmVuICYmIGxhYmVsMlByb3BzLmNoaWxkcmVuKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIEJvdGggaGF2ZSBjaGlsZHJlbi4uLlxuICAvLyBIYW5kbGUgZm9yIHdoZW4gYm90aCB0aGUgY2hpbGRyZW4gYXJlIGFycmF5c1xuICBjb25zdCBsYWJlbDFJc0FycmF5ID0gQXJyYXkuaXNBcnJheShsYWJlbDFQcm9wcy5jaGlsZHJlbik7XG4gIGNvbnN0IGxhYmVsMklzQXJyYXkgPSBBcnJheS5pc0FycmF5KGxhYmVsMlByb3BzLmNoaWxkcmVuKTtcbiAgaWYgKGxhYmVsMUlzQXJyYXkgJiYgbGFiZWwySXNBcnJheSkge1xuICAgIGNvbnN0IGNoaWxkcmVuMSA9IGxhYmVsMVByb3BzLmNoaWxkcmVuIGFzIGFueVtdO1xuICAgIGNvbnN0IGNoaWxkcmVuMiA9IGxhYmVsMlByb3BzLmNoaWxkcmVuIGFzIGFueVtdO1xuICAgIGlmIChjaGlsZHJlbjEubGVuZ3RoICE9PSBjaGlsZHJlbjIubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIG5vIHBvaW50IHByb2NlZWRpbmdcbiAgICB9XG5cbiAgICAvLyBhbGwgdGhlIGNoaWxkcmVuIG11c3QgYWxzbyBiZSBlcXVhbFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4xLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWFyZUxhYmVsc0VxdWFsKGNoaWxkcmVuMVtpXSwgY2hpbGRyZW4yW2ldKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBPbmx5IG9uZSBvZiB0aGVtIGNhbiBiZSBhbiBhcnJheSBhdCB0aGlzIHBvaW50LiBJZiBhbnkgaXMgYXJyYXksIHJldHVybiBmYWxzZVxuICBpZiAobGFiZWwxSXNBcnJheSB8fCBsYWJlbDJJc0FycmF5KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gYm90aCBjaGlsZHJlbiBhcmUgbm90IGFycmF5cywgc28gcmVjdXIuXG4gIHJldHVybiBhcmVMYWJlbHNFcXVhbChsYWJlbDFQcm9wcy5jaGlsZHJlbiwgbGFiZWwyUHJvcHMuY2hpbGRyZW4pO1xufVxuIl19