95ddd4094e9285826bcfaceecb27bc44
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filterConfig = filterConfig;
exports.findNodeHandle = findNodeHandle;
exports.baseGestureHandlerWithMonitorProps = exports.baseGestureHandlerProps = void 0;

var _reactNative = require("react-native");

var _handlersRegistry = require("./handlersRegistry");

var _utils = require("../utils");

var commonProps = ['id', 'enabled', 'shouldCancelWhenOutside', 'hitSlop'];
var componentInteractionProps = ['waitFor', 'simultaneousHandlers'];
var baseGestureHandlerProps = [].concat(commonProps, componentInteractionProps, ['onBegan', 'onFailed', 'onCancelled', 'onActivated', 'onEnded', 'onGestureEvent', 'onHandlerStateChange']);
exports.baseGestureHandlerProps = baseGestureHandlerProps;
var baseGestureHandlerWithMonitorProps = [].concat(commonProps, ['needsPointerData', 'manualActivation']);
exports.baseGestureHandlerWithMonitorProps = baseGestureHandlerWithMonitorProps;

function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}

function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var filteredConfig = (0, _extends2.default)({}, defaults);

  for (var _iterator = _createForOfIteratorHelperLoose(validProps), _step; !(_step = _iterator()).done;) {
    var key = _step.value;
    var value = props[key];

    if (isConfigParam(value, key)) {
      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop' && typeof value !== 'object') {
        value = {
          top: value,
          left: value,
          bottom: value,
          right: value
        };
      }

      filteredConfig[key] = value;
    }
  }

  return filteredConfig;
}

function transformIntoHandlerTags(handlerIDs) {
  handlerIDs = (0, _utils.toArray)(handlerIDs);

  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }

  return handlerIDs.map(function (handlerID) {
    var _handlerID$current;

    return _handlersRegistry.handlerIDToTag[handlerID] || ((_handlerID$current = handlerID.current) === null || _handlerID$current === void 0 ? void 0 : _handlerID$current.handlerTag) || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}

function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') return node;
  return (0, _reactNative.findNodeHandle)(node);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TyxpQ0FBaUJBLElBQWpCLENBQVA7QUFDRCIsIm5hbWVzIjpbImNvbW1vblByb3BzIiwiY29tcG9uZW50SW50ZXJhY3Rpb25Qcm9wcyIsImJhc2VHZXN0dXJlSGFuZGxlclByb3BzIiwiYmFzZUdlc3R1cmVIYW5kbGVyV2l0aE1vbml0b3JQcm9wcyIsImlzQ29uZmlnUGFyYW0iLCJwYXJhbSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJmaWx0ZXJDb25maWciLCJwcm9wcyIsInZhbGlkUHJvcHMiLCJkZWZhdWx0cyIsImZpbHRlcmVkQ29uZmlnIiwia2V5IiwidmFsdWUiLCJ0cmFuc2Zvcm1JbnRvSGFuZGxlclRhZ3MiLCJ0b3AiLCJsZWZ0IiwiYm90dG9tIiwicmlnaHQiLCJoYW5kbGVySURzIiwiUGxhdGZvcm0iLCJPUyIsIm1hcCIsImN1cnJlbnQiLCJmaWx0ZXIiLCJoYW5kbGUiLCJoYW5kbGVySUQiLCJoYW5kbGVySURUb1RhZyIsIl9oYW5kbGVySUQkY3VycmVudCIsImhhbmRsZXJUYWciLCJmaW5kTm9kZUhhbmRsZSIsIm5vZGUiXSwic291cmNlcyI6WyJnZXN0dXJlSGFuZGxlckNvbW1vbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQcmV2aW91cyB0eXBlcyBleHBvcnRlZCBnZXN0dXJlIGhhbmRsZXJzIGFzIGNsYXNzZXMgd2hpY2ggY3JlYXRlcyBhbiBpbnRlcmZhY2UgYW5kIHZhcmlhYmxlLCBib3RoIG5hbWVkIHRoZSBzYW1lIGFzIGNsYXNzLlxuLy8gV2l0aG91dCB0aG9zZSB0eXBlcywgd2UnZCBpbnRyb2R1Y2UgYnJlYWtpbmcgY2hhbmdlLCBmb3JjaW5nIHVzZXJzIHRvIHByZWZpeCBldmVyeSBoYW5kbGVyIHR5cGUgc3BlY2lmaWNhdGlvbiB3aXRoIHR5cGVvZlxuLy8gZS5nLiBSZWFjdC5jcmVhdGVSZWY8VGFwR2VzdHVyZUhhbmRsZXI+IC0+IFJlYWN0LmNyZWF0ZVJlZjx0eXBlb2YgVGFwR2VzdHVyZUhhbmRsZXI+LlxuLy8gU2VlIGh0dHBzOi8vd3d3LnR5cGVzY3JpcHRsYW5nLm9yZy9kb2NzL2hhbmRib29rL2NsYXNzZXMuaHRtbCNjb25zdHJ1Y3Rvci1mdW5jdGlvbnMgZm9yIHJlZmVyZW5jZS5cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFBsYXRmb3JtLCBmaW5kTm9kZUhhbmRsZSBhcyBmaW5kTm9kZUhhbmRsZVJOIH0gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi9TdGF0ZSc7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tICcuLi9FdmVudFR5cGUnO1xuaW1wb3J0IHsgVmFsdWVPZiB9IGZyb20gJy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBoYW5kbGVySURUb1RhZyB9IGZyb20gJy4vaGFuZGxlcnNSZWdpc3RyeSc7XG5pbXBvcnQgeyB0b0FycmF5IH0gZnJvbSAnLi4vdXRpbHMnO1xuXG5jb25zdCBjb21tb25Qcm9wcyA9IFtcbiAgJ2lkJyxcbiAgJ2VuYWJsZWQnLFxuICAnc2hvdWxkQ2FuY2VsV2hlbk91dHNpZGUnLFxuICAnaGl0U2xvcCcsXG5dIGFzIGNvbnN0O1xuXG5jb25zdCBjb21wb25lbnRJbnRlcmFjdGlvblByb3BzID0gWyd3YWl0Rm9yJywgJ3NpbXVsdGFuZW91c0hhbmRsZXJzJ10gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBiYXNlR2VzdHVyZUhhbmRsZXJQcm9wcyA9IFtcbiAgLi4uY29tbW9uUHJvcHMsXG4gIC4uLmNvbXBvbmVudEludGVyYWN0aW9uUHJvcHMsXG4gICdvbkJlZ2FuJyxcbiAgJ29uRmFpbGVkJyxcbiAgJ29uQ2FuY2VsbGVkJyxcbiAgJ29uQWN0aXZhdGVkJyxcbiAgJ29uRW5kZWQnLFxuICAnb25HZXN0dXJlRXZlbnQnLFxuICAnb25IYW5kbGVyU3RhdGVDaGFuZ2UnLFxuXSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IGJhc2VHZXN0dXJlSGFuZGxlcldpdGhNb25pdG9yUHJvcHMgPSBbXG4gIC4uLmNvbW1vblByb3BzLFxuICAnbmVlZHNQb2ludGVyRGF0YScsXG4gICdtYW51YWxBY3RpdmF0aW9uJyxcbl07XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VzdHVyZUV2ZW50UGF5bG9hZCB7XG4gIGhhbmRsZXJUYWc6IG51bWJlcjtcbiAgbnVtYmVyT2ZQb2ludGVyczogbnVtYmVyO1xuICBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+O1xufVxuZXhwb3J0IGludGVyZmFjZSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgZXh0ZW5kcyBHZXN0dXJlRXZlbnRQYXlsb2FkIHtcbiAgb2xkU3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbn1cblxuZXhwb3J0IHR5cGUgSGl0U2xvcCA9XG4gIHwgbnVtYmVyXG4gIHwgUGFydGlhbDxcbiAgICAgIFJlY29yZDxcbiAgICAgICAgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnLFxuICAgICAgICBudW1iZXJcbiAgICAgID5cbiAgICA+XG4gIHwgUmVjb3JkPCd3aWR0aCcgfCAnbGVmdCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J3dpZHRoJyB8ICdyaWdodCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J2hlaWdodCcgfCAndG9wJywgbnVtYmVyPlxuICB8IFJlY29yZDwnaGVpZ2h0JyB8ICdib3R0b20nLCBudW1iZXI+O1xuXG4vL1RPRE8oVFMpIGV2ZW50cyBpbiBoYW5kbGVyc1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlc3R1cmVFdmVudDxFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICBuYXRpdmVFdmVudDogUmVhZG9ubHk8R2VzdHVyZUV2ZW50UGF5bG9hZCAmIEV4dHJhRXZlbnRQYXlsb2FkVD47XG59XG5leHBvcnQgaW50ZXJmYWNlIEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiB7XG4gIG5hdGl2ZUV2ZW50OiBSZWFkb25seTxIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgJiBFeHRyYUV2ZW50UGF5bG9hZFQ+O1xufVxuXG5leHBvcnQgdHlwZSBUb3VjaERhdGEgPSB7XG4gIGlkOiBudW1iZXI7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICBhYnNvbHV0ZVg6IG51bWJlcjtcbiAgYWJzb2x1dGVZOiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlVG91Y2hFdmVudCA9IHtcbiAgaGFuZGxlclRhZzogbnVtYmVyO1xuICBudW1iZXJPZlRvdWNoZXM6IG51bWJlcjtcbiAgc3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbiAgZXZlbnRUeXBlOiBFdmVudFR5cGU7XG4gIGFsbFRvdWNoZXM6IFRvdWNoRGF0YVtdO1xuICBjaGFuZ2VkVG91Y2hlczogVG91Y2hEYXRhW107XG59O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlVXBkYXRlRXZlbnQ8XG4gIEdlc3R1cmVFdmVudFBheWxvYWRUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbj4gPSBHZXN0dXJlRXZlbnRQYXlsb2FkICYgR2VzdHVyZUV2ZW50UGF5bG9hZFQ7XG5cbmV4cG9ydCB0eXBlIEdlc3R1cmVTdGF0ZUNoYW5nZUV2ZW50PFxuICBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudFBheWxvYWRUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbj4gPSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgJiBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudFBheWxvYWRUO1xuXG5leHBvcnQgdHlwZSBDb21tb25HZXN0dXJlQ29uZmlnID0ge1xuICBlbmFibGVkPzogYm9vbGVhbjtcbiAgc2hvdWxkQ2FuY2VsV2hlbk91dHNpZGU/OiBib29sZWFuO1xuICBoaXRTbG9wPzogSGl0U2xvcDtcbn07XG5cbi8vIEV2ZW50cyBwYXlsb2FkcyBhcmUgdHlwZXMgaW5zdGVhZCBvZiBpbnRlcmZhY2VzIGR1ZSB0byBUUyBsaW1pdGF0aW9uLlxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTUzMDAgZm9yIG1vcmUgaW5mby5cbmV4cG9ydCB0eXBlIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+ID0gQ29tbW9uR2VzdHVyZUNvbmZpZyAmIHtcbiAgaWQ/OiBzdHJpbmc7XG4gIHdhaXRGb3I/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgc2ltdWx0YW5lb3VzSGFuZGxlcnM/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgdGVzdElEPzogc3RyaW5nO1xuICAvLyBUT0RPKFRTKSAtIGZpeCBldmVudCB0eXBlc1xuICBvbkJlZ2FuPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcbiAgb25GYWlsZWQ/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkNhbmNlbGxlZD86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG4gIG9uQWN0aXZhdGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcbiAgb25FbmRlZD86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG5cbiAgLy9UT0RPKFRTKSBjb25zaWRlciB1c2luZyBOYXRpdmVTeW50aGV0aWNFdmVudFxuICBvbkdlc3R1cmVFdmVudD86IChldmVudDogR2VzdHVyZUV2ZW50PEV4dHJhRXZlbnRQYXlsb2FkVD4pID0+IHZvaWQ7XG4gIG9uSGFuZGxlclN0YXRlQ2hhbmdlPzogKFxuICAgIGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudDxFeHRyYUV2ZW50UGF5bG9hZFQ+XG4gICkgPT4gdm9pZDtcbn07XG5cbmZ1bmN0aW9uIGlzQ29uZmlnUGFyYW0ocGFyYW06IHVua25vd24sIG5hbWU6IHN0cmluZykge1xuICAvLyBwYXJhbSAhPT0gT2JqZWN0KHBhcmFtKSByZXR1cm5zIGZhbHNlIGlmIGBwYXJhbWAgaXMgYSBmdW5jdGlvblxuICAvLyBvciBhbiBvYmplY3QgYW5kIHJldHVybnMgdHJ1ZSBpZiBgcGFyYW1gIGlzIG51bGxcbiAgcmV0dXJuIChcbiAgICBwYXJhbSAhPT0gdW5kZWZpbmVkICYmXG4gICAgKHBhcmFtICE9PSBPYmplY3QocGFyYW0pIHx8XG4gICAgICAhKCdfX2lzTmF0aXZlJyBpbiAocGFyYW0gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pKSkgJiZcbiAgICBuYW1lICE9PSAnb25IYW5kbGVyU3RhdGVDaGFuZ2UnICYmXG4gICAgbmFtZSAhPT0gJ29uR2VzdHVyZUV2ZW50J1xuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyQ29uZmlnKFxuICBwcm9wczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIHZhbGlkUHJvcHM6IHN0cmluZ1tdLFxuICBkZWZhdWx0czogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuKSB7XG4gIGNvbnN0IGZpbHRlcmVkQ29uZmlnID0geyAuLi5kZWZhdWx0cyB9O1xuICBmb3IgKGNvbnN0IGtleSBvZiB2YWxpZFByb3BzKSB7XG4gICAgbGV0IHZhbHVlID0gcHJvcHNba2V5XTtcbiAgICBpZiAoaXNDb25maWdQYXJhbSh2YWx1ZSwga2V5KSkge1xuICAgICAgaWYgKGtleSA9PT0gJ3NpbXVsdGFuZW91c0hhbmRsZXJzJyB8fCBrZXkgPT09ICd3YWl0Rm9yJykge1xuICAgICAgICB2YWx1ZSA9IHRyYW5zZm9ybUludG9IYW5kbGVyVGFncyhwcm9wc1trZXldKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnaGl0U2xvcCcgJiYgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICB2YWx1ZSA9IHsgdG9wOiB2YWx1ZSwgbGVmdDogdmFsdWUsIGJvdHRvbTogdmFsdWUsIHJpZ2h0OiB2YWx1ZSB9O1xuICAgICAgfVxuICAgICAgZmlsdGVyZWRDb25maWdba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmlsdGVyZWRDb25maWc7XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybUludG9IYW5kbGVyVGFncyhoYW5kbGVySURzOiBhbnkpIHtcbiAgaGFuZGxlcklEcyA9IHRvQXJyYXkoaGFuZGxlcklEcyk7XG5cbiAgaWYgKFBsYXRmb3JtLk9TID09PSAnd2ViJykge1xuICAgIHJldHVybiBoYW5kbGVySURzXG4gICAgICAubWFwKCh7IGN1cnJlbnQgfTogeyBjdXJyZW50OiBhbnkgfSkgPT4gY3VycmVudClcbiAgICAgIC5maWx0ZXIoKGhhbmRsZTogYW55KSA9PiBoYW5kbGUpO1xuICB9XG4gIC8vIGNvbnZlcnRzIGhhbmRsZXIgc3RyaW5nIElEcyBpbnRvIHRoZWlyIG51bWVyaWMgdGFnc1xuICByZXR1cm4gaGFuZGxlcklEc1xuICAgIC5tYXAoXG4gICAgICAoaGFuZGxlcklEOiBhbnkpID0+XG4gICAgICAgIGhhbmRsZXJJRFRvVGFnW2hhbmRsZXJJRF0gfHwgaGFuZGxlcklELmN1cnJlbnQ/LmhhbmRsZXJUYWcgfHwgLTFcbiAgICApXG4gICAgLmZpbHRlcigoaGFuZGxlclRhZzogbnVtYmVyKSA9PiBoYW5kbGVyVGFnID4gMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kTm9kZUhhbmRsZShcbiAgbm9kZTogbnVsbCB8IG51bWJlciB8IFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4gfCBSZWFjdC5Db21wb25lbnRDbGFzczxhbnk+XG4pOiBudWxsIHwgbnVtYmVyIHwgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiB8IFJlYWN0LkNvbXBvbmVudENsYXNzPGFueT4ge1xuICBpZiAoUGxhdGZvcm0uT1MgPT09ICd3ZWInKSByZXR1cm4gbm9kZTtcbiAgcmV0dXJuIGZpbmROb2RlSGFuZGxlUk4obm9kZSk7XG59XG4iXX0=