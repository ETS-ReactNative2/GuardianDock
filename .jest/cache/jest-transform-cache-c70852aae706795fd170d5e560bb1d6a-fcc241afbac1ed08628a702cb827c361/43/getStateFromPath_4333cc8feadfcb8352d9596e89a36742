91c216f4c278e095b8560427bcd8eb52
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends4 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getStateFromPath;

var _escapeStringRegexp = _interopRequireDefault(require("escape-string-regexp"));

var queryString = _interopRequireWildcard(require("query-string"));

var _findFocusedRoute = _interopRequireDefault(require("./findFocusedRoute"));

var _validatePathConfig = _interopRequireDefault(require("./validatePathConfig"));

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getStateFromPath(path, options) {
  var _ref;

  if (options) {
    (0, _validatePathConfig.default)(options);
  }

  var initialRoutes = [];

  if (options !== null && options !== void 0 && options.initialRouteName) {
    initialRoutes.push({
      initialRouteName: options.initialRouteName,
      parentScreens: []
    });
  }

  var screens = options === null || options === void 0 ? void 0 : options.screens;
  var remaining = path.replace(/\/+/g, '/').replace(/^\//, '').replace(/\?.*$/, '');
  remaining = remaining.endsWith('/') ? remaining : remaining + "/";

  if (screens === undefined) {
    var _routes = remaining.split('/').filter(Boolean).map(function (segment) {
      var name = decodeURIComponent(segment);
      return {
        name: name
      };
    });

    if (_routes.length) {
      return createNestedStateObject(path, _routes, initialRoutes);
    }

    return undefined;
  }

  var configs = (_ref = []).concat.apply(_ref, (0, _toConsumableArray2.default)(Object.keys(screens).map(function (key) {
    return createNormalizedConfigs(key, screens, [], initialRoutes, []);
  }))).sort(function (a, b) {
    if (a.pattern === b.pattern) {
      return b.routeNames.join('>').localeCompare(a.routeNames.join('>'));
    }

    if (a.pattern.startsWith(b.pattern)) {
      return -1;
    }

    if (b.pattern.startsWith(a.pattern)) {
      return 1;
    }

    var aParts = a.pattern.split('/');
    var bParts = b.pattern.split('/');

    for (var i = 0; i < Math.max(aParts.length, bParts.length); i++) {
      if (aParts[i] == null) {
        return 1;
      }

      if (bParts[i] == null) {
        return -1;
      }

      var aWildCard = aParts[i] === '*' || aParts[i].startsWith(':');
      var bWildCard = bParts[i] === '*' || bParts[i].startsWith(':');

      if (aWildCard && bWildCard) {
        continue;
      }

      if (aWildCard) {
        return 1;
      }

      if (bWildCard) {
        return -1;
      }
    }

    return bParts.length - aParts.length;
  });

  configs.reduce(function (acc, config) {
    if (acc[config.pattern]) {
      var a = acc[config.pattern].routeNames;
      var b = config.routeNames;
      var intersects = a.length > b.length ? b.every(function (it, i) {
        return a[i] === it;
      }) : a.every(function (it, i) {
        return b[i] === it;
      });

      if (!intersects) {
        throw new Error("Found conflicting screens with the same pattern. The pattern '" + config.pattern + "' resolves to both '" + a.join(' > ') + "' and '" + b.join(' > ') + "'. Patterns must be unique and cannot resolve to more than one screen.");
      }
    }

    return (0, _extends4.default)(acc, (0, _defineProperty2.default)({}, config.pattern, config));
  }, {});

  if (remaining === '/') {
    var match = configs.find(function (config) {
      return config.path === '' && config.routeNames.every(function (name) {
        var _configs$find;

        return !((_configs$find = configs.find(function (c) {
          return c.screen === name;
        })) !== null && _configs$find !== void 0 && _configs$find.path);
      });
    });

    if (match) {
      return createNestedStateObject(path, match.routeNames.map(function (name) {
        return {
          name: name
        };
      }), initialRoutes, configs);
    }

    return undefined;
  }

  var result;
  var current;

  var _matchAgainstConfigs = matchAgainstConfigs(remaining, configs.map(function (c) {
    return (0, _extends4.default)({}, c, {
      regex: c.regex ? new RegExp(c.regex.source + '$') : undefined
    });
  })),
      routes = _matchAgainstConfigs.routes,
      remainingPath = _matchAgainstConfigs.remainingPath;

  if (routes !== undefined) {
    current = createNestedStateObject(path, routes, initialRoutes, configs);
    remaining = remainingPath;
    result = current;
  }

  if (current == null || result == null) {
    return undefined;
  }

  return result;
}

var joinPaths = function joinPaths() {
  var _ref2;

  for (var _len = arguments.length, paths = new Array(_len), _key = 0; _key < _len; _key++) {
    paths[_key] = arguments[_key];
  }

  return (_ref2 = []).concat.apply(_ref2, (0, _toConsumableArray2.default)(paths.map(function (p) {
    return p.split('/');
  }))).filter(Boolean).join('/');
};

var matchAgainstConfigs = function matchAgainstConfigs(remaining, configs) {
  var routes;
  var remainingPath = remaining;

  var _loop = function _loop(config) {
    if (!config.regex) {
      return "continue";
    }

    var match = remainingPath.match(config.regex);

    if (match) {
      var matchedParams = (_config$pattern = config.pattern) === null || _config$pattern === void 0 ? void 0 : _config$pattern.split('/').filter(function (p) {
        return p.startsWith(':');
      }).reduce(function (acc, p, i) {
        return (0, _extends4.default)(acc, (0, _defineProperty2.default)({}, p, match[(i + 1) * 2].replace(/\//, '')));
      }, {});
      routes = config.routeNames.map(function (name) {
        var _config$path;

        var config = configs.find(function (c) {
          return c.screen === name;
        });
        var params = config === null || config === void 0 ? void 0 : (_config$path = config.path) === null || _config$path === void 0 ? void 0 : _config$path.split('/').filter(function (p) {
          return p.startsWith(':');
        }).reduce(function (acc, p) {
          var value = matchedParams[p];

          if (value) {
            var _config$parse;

            var key = p.replace(/^:/, '').replace(/\?$/, '');
            acc[key] = (_config$parse = config.parse) !== null && _config$parse !== void 0 && _config$parse[key] ? config.parse[key](value) : value;
          }

          return acc;
        }, {});

        if (params && Object.keys(params).length) {
          return {
            name: name,
            params: params
          };
        }

        return {
          name: name
        };
      });
      remainingPath = remainingPath.replace(match[1], '');
      return "break";
    }
  };

  for (var _iterator = _createForOfIteratorHelperLoose(configs), _step; !(_step = _iterator()).done;) {
    var config = _step.value;

    var _config$pattern;

    var _ret = _loop(config);

    if (_ret === "continue") continue;
    if (_ret === "break") break;
  }

  return {
    routes: routes,
    remainingPath: remainingPath
  };
};

var createNormalizedConfigs = function createNormalizedConfigs(screen, routeConfig) {
  var routeNames = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  var initials = arguments.length > 3 ? arguments[3] : undefined;
  var parentScreens = arguments.length > 4 ? arguments[4] : undefined;
  var parentPattern = arguments.length > 5 ? arguments[5] : undefined;
  var configs = [];
  routeNames.push(screen);
  parentScreens.push(screen);
  var config = routeConfig[screen];

  if (typeof config === 'string') {
    var pattern = parentPattern ? joinPaths(parentPattern, config) : config;
    configs.push(createConfigItem(screen, routeNames, pattern, config));
  } else if (typeof config === 'object') {
    var _pattern2;

    if (typeof config.path === 'string') {
      if (config.exact && config.path === undefined) {
        throw new Error("A 'path' needs to be specified when specifying 'exact: true'. If you don't want this screen in the URL, specify it as empty string, e.g. `path: ''`.");
      }

      _pattern2 = config.exact !== true ? joinPaths(parentPattern || '', config.path || '') : config.path || '';
      configs.push(createConfigItem(screen, routeNames, _pattern2, config.path, config.parse));
    }

    if (config.screens) {
      if (config.initialRouteName) {
        initials.push({
          initialRouteName: config.initialRouteName,
          parentScreens: parentScreens
        });
      }

      Object.keys(config.screens).forEach(function (nestedConfig) {
        var _pattern;

        var result = createNormalizedConfigs(nestedConfig, config.screens, routeNames, initials, (0, _toConsumableArray2.default)(parentScreens), (_pattern = _pattern2) !== null && _pattern !== void 0 ? _pattern : parentPattern);
        configs.push.apply(configs, (0, _toConsumableArray2.default)(result));
      });
    }
  }

  routeNames.pop();
  return configs;
};

var createConfigItem = function createConfigItem(screen, routeNames, pattern, path, parse) {
  pattern = pattern.split('/').filter(Boolean).join('/');
  var regex = pattern ? new RegExp("^(" + pattern.split('/').map(function (it) {
    if (it.startsWith(':')) {
      return "(([^/]+\\/)" + (it.endsWith('?') ? '?' : '') + ")";
    }

    return (it === '*' ? '.*' : (0, _escapeStringRegexp.default)(it)) + "\\/";
  }).join('') + ")") : undefined;
  return {
    screen: screen,
    regex: regex,
    pattern: pattern,
    path: path,
    routeNames: (0, _toConsumableArray2.default)(routeNames),
    parse: parse
  };
};

var findParseConfigForRoute = function findParseConfigForRoute(routeName, flatConfig) {
  for (var _iterator2 = _createForOfIteratorHelperLoose(flatConfig), _step2; !(_step2 = _iterator2()).done;) {
    var config = _step2.value;

    if (routeName === config.routeNames[config.routeNames.length - 1]) {
      return config.parse;
    }
  }

  return undefined;
};

var findInitialRoute = function findInitialRoute(routeName, parentScreens, initialRoutes) {
  for (var _iterator3 = _createForOfIteratorHelperLoose(initialRoutes), _step3; !(_step3 = _iterator3()).done;) {
    var config = _step3.value;

    if (parentScreens.length === config.parentScreens.length) {
      var sameParents = true;

      for (var i = 0; i < parentScreens.length; i++) {
        if (parentScreens[i].localeCompare(config.parentScreens[i]) !== 0) {
          sameParents = false;
          break;
        }
      }

      if (sameParents) {
        return routeName !== config.initialRouteName ? config.initialRouteName : undefined;
      }
    }
  }

  return undefined;
};

var createStateObject = function createStateObject(initialRoute, route, isEmpty) {
  if (isEmpty) {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, route]
      };
    } else {
      return {
        routes: [route]
      };
    }
  } else {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, (0, _extends4.default)({}, route, {
          state: {
            routes: []
          }
        })]
      };
    } else {
      return {
        routes: [(0, _extends4.default)({}, route, {
          state: {
            routes: []
          }
        })]
      };
    }
  }
};

var createNestedStateObject = function createNestedStateObject(path, routes, initialRoutes, flatConfig) {
  var state;
  var route = routes.shift();
  var parentScreens = [];
  var initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
  parentScreens.push(route.name);
  state = createStateObject(initialRoute, route, routes.length === 0);

  if (routes.length > 0) {
    var nestedState = state;

    while (route = routes.shift()) {
      initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
      var nestedStateIndex = nestedState.index || nestedState.routes.length - 1;
      nestedState.routes[nestedStateIndex].state = createStateObject(initialRoute, route, routes.length === 0);

      if (routes.length > 0) {
        nestedState = nestedState.routes[nestedStateIndex].state;
      }

      parentScreens.push(route.name);
    }
  }

  route = (0, _findFocusedRoute.default)(state);
  route.path = path;
  var params = parseQueryParams(path, flatConfig ? findParseConfigForRoute(route.name, flatConfig) : undefined);

  if (params) {
    route.params = (0, _extends4.default)({}, route.params, params);
  }

  return state;
};

var parseQueryParams = function parseQueryParams(path, parseConfig) {
  var query = path.split('?')[1];
  var params = queryString.parse(query);

  if (parseConfig) {
    Object.keys(params).forEach(function (name) {
      if (parseConfig[name] && typeof params[name] === 'string') {
        params[name] = parseConfig[name](params[name]);
      }
    });
  }

  return Object.keys(params).length ? params : undefined;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0E7O0FBQ0E7O0FBRUE7O0FBRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzRGUsU0FBU0EsZ0JBQVQsQ0FDYkMsSUFEYSxFQUViQyxPQUZhLEVBR1k7QUFBQTs7QUFDekIsTUFBSUEsT0FBSixFQUFhO0FBQ1gscUNBQW1CQSxPQUFuQjtBQUNEOztBQUVELE1BQUlDLGFBQW1DLEdBQUcsRUFBMUM7O0FBRUEsTUFBSUQsT0FBSixTQUFJQSxXQUFKLFdBQUlBLFdBQU8sQ0FBRUUsZ0JBQWIsRUFBK0I7QUFDN0JELGlCQUFhLENBQUNFLElBQWRGLENBQW1CO0FBQ2pCQyxzQkFBZ0IsRUFBRUYsT0FBTyxDQUFDRSxnQkFEVDtBQUVqQkUsbUJBQWEsRUFBRTtBQUZFLEtBQW5CSDtBQUlEOztBQUVELE1BQU1JLE9BQU8sR0FBR0wsT0FBSCxTQUFHQSxXQUFILFdBQUdBLEdBQUgsTUFBR0EsVUFBTyxDQUFFSyxPQUF6QjtBQUVBLE1BQUlDLFNBQVMsR0FBR1AsSUFBSSxDQUNqQlEsT0FEYVIsQ0FDTCxNQURLQSxFQUNHLEdBREhBLEVBRWJRLE9BRmFSLENBRUwsS0FGS0EsRUFFRSxFQUZGQSxFQUdiUSxPQUhhUixDQUdMLE9BSEtBLEVBR0ksRUFISkEsQ0FBaEI7QUFNQU8sV0FBUyxHQUFHQSxTQUFTLENBQUNFLFFBQVZGLENBQW1CLEdBQW5CQSxJQUEwQkEsU0FBMUJBLEdBQXlDQSxTQUF6Q0EsTUFBWkE7O0FBRUEsTUFBSUQsT0FBTyxLQUFLSSxTQUFoQixFQUEyQjtBQUV6QixRQUFNQyxPQUFNLEdBQUdKLFNBQVMsQ0FDckJLLEtBRFlMLENBQ04sR0FETUEsRUFFWk0sTUFGWU4sQ0FFTE8sT0FGS1AsRUFHWlEsR0FIWVIsQ0FHUFMsaUJBQUQsRUFBYTtBQUNoQixVQUFNQyxJQUFJLEdBQUdDLGtCQUFrQixDQUFDRixPQUFELENBQS9CO0FBQ0EsYUFBTztBQUFFQztBQUFGLE9BQVA7QUFMVyxNQUFmOztBQVFBLFFBQUlOLE9BQU0sQ0FBQ1EsTUFBWCxFQUFtQjtBQUNqQixhQUFPQyx1QkFBdUIsQ0FBQ3BCLElBQUQsRUFBT1csT0FBUCxFQUFlVCxhQUFmLENBQTlCO0FBQ0Q7O0FBRUQsV0FBT1EsU0FBUDtBQXRDdUI7O0FBMEN6QixNQUFNVyxPQUFPLEdBQUksWUFDZEMsTUFEYyw4Q0FFVkMsTUFBTSxDQUFDQyxJQUFQRCxDQUFZakIsT0FBWmlCLEVBQXFCUixHQUFyQlEsQ0FBMEJFLGFBQUQ7QUFBQSxXQUMxQkMsdUJBQXVCLENBQ3JCRCxHQURxQixFQUVyQm5CLE9BRnFCLEVBR3JCLEVBSHFCLEVBSXJCSixhQUpxQixFQUtyQixFQUxxQixDQURHO0FBQUEsR0FBekJxQixDQUZVLEdBWWRJLElBWmMsQ0FZVCxVQUFDQyxDQUFELEVBQUlDLENBQUosRUFBVTtBQU9kLFFBQUlELENBQUMsQ0FBQ0UsT0FBRkYsS0FBY0MsQ0FBQyxDQUFDQyxPQUFwQixFQUE2QjtBQUMzQixhQUFPRCxDQUFDLENBQUNFLFVBQUZGLENBQWFHLElBQWJILENBQWtCLEdBQWxCQSxFQUF1QkksYUFBdkJKLENBQXFDRCxDQUFDLENBQUNHLFVBQUZILENBQWFJLElBQWJKLENBQWtCLEdBQWxCQSxDQUFyQ0MsQ0FBUDtBQVJZOztBQWFkLFFBQUlELENBQUMsQ0FBQ0UsT0FBRkYsQ0FBVU0sVUFBVk4sQ0FBcUJDLENBQUMsQ0FBQ0MsT0FBdkJGLENBQUosRUFBcUM7QUFDbkMsYUFBTyxDQUFDLENBQVI7QUFDRDs7QUFFRCxRQUFJQyxDQUFDLENBQUNDLE9BQUZELENBQVVLLFVBQVZMLENBQXFCRCxDQUFDLENBQUNFLE9BQXZCRCxDQUFKLEVBQXFDO0FBQ25DLGFBQU8sQ0FBUDtBQUNEOztBQUVELFFBQU1NLE1BQU0sR0FBR1AsQ0FBQyxDQUFDRSxPQUFGRixDQUFVaEIsS0FBVmdCLENBQWdCLEdBQWhCQSxDQUFmO0FBQ0EsUUFBTVEsTUFBTSxHQUFHUCxDQUFDLENBQUNDLE9BQUZELENBQVVqQixLQUFWaUIsQ0FBZ0IsR0FBaEJBLENBQWY7O0FBRUEsU0FBSyxJQUFJUSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHQyxJQUFJLENBQUNDLEdBQUxELENBQVNILE1BQU0sQ0FBQ2hCLE1BQWhCbUIsRUFBd0JGLE1BQU0sQ0FBQ2pCLE1BQS9CbUIsQ0FBcEIsRUFBNERELENBQUMsRUFBN0QsRUFBaUU7QUFFL0QsVUFBSUYsTUFBTSxDQUFDRSxDQUFELENBQU5GLElBQWEsSUFBakIsRUFBdUI7QUFDckIsZUFBTyxDQUFQO0FBSDZEOztBQU0vRCxVQUFJQyxNQUFNLENBQUNDLENBQUQsQ0FBTkQsSUFBYSxJQUFqQixFQUF1QjtBQUNyQixlQUFPLENBQUMsQ0FBUjtBQUNEOztBQUNELFVBQU1JLFNBQVMsR0FBR0wsTUFBTSxDQUFDRSxDQUFELENBQU5GLEtBQWMsR0FBZEEsSUFBcUJBLE1BQU0sQ0FBQ0UsQ0FBRCxDQUFORixDQUFVRCxVQUFWQyxDQUFxQixHQUFyQkEsQ0FBdkM7QUFDQSxVQUFNTSxTQUFTLEdBQUdMLE1BQU0sQ0FBQ0MsQ0FBRCxDQUFORCxLQUFjLEdBQWRBLElBQXFCQSxNQUFNLENBQUNDLENBQUQsQ0FBTkQsQ0FBVUYsVUFBVkUsQ0FBcUIsR0FBckJBLENBQXZDOztBQUVBLFVBQUlJLFNBQVMsSUFBSUMsU0FBakIsRUFBNEI7QUFDMUI7QUFiNkQ7O0FBZ0IvRCxVQUFJRCxTQUFKLEVBQWU7QUFDYixlQUFPLENBQVA7QUFqQjZEOztBQW9CL0QsVUFBSUMsU0FBSixFQUFlO0FBQ2IsZUFBTyxDQUFDLENBQVI7QUFDRDtBQUNGOztBQUNELFdBQU9MLE1BQU0sQ0FBQ2pCLE1BQVBpQixHQUFnQkQsTUFBTSxDQUFDaEIsTUFBOUI7QUE1RFksR0FBQyxDQUFqQjs7QUFnRUFFLFNBQU8sQ0FBQ3FCLE1BQVJyQixDQUE0QyxVQUFDc0IsR0FBRCxFQUFNQyxNQUFOLEVBQWlCO0FBQzNELFFBQUlELEdBQUcsQ0FBQ0MsTUFBTSxDQUFDZCxPQUFSLENBQVAsRUFBeUI7QUFDdkIsVUFBTUYsQ0FBQyxHQUFHZSxHQUFHLENBQUNDLE1BQU0sQ0FBQ2QsT0FBUixDQUFIYSxDQUFvQlosVUFBOUI7QUFDQSxVQUFNRixDQUFDLEdBQUdlLE1BQU0sQ0FBQ2IsVUFBakI7QUFJQSxVQUFNYyxVQUFVLEdBQ2RqQixDQUFDLENBQUNULE1BQUZTLEdBQVdDLENBQUMsQ0FBQ1YsTUFBYlMsR0FDSUMsQ0FBQyxDQUFDaUIsS0FBRmpCLENBQVEsVUFBQ2tCLEVBQUQsRUFBS1YsQ0FBTDtBQUFBLGVBQVdULENBQUMsQ0FBQ1MsQ0FBRCxDQUFEVCxLQUFTbUIsRUFBcEI7QUFBQSxPQUFSbEIsQ0FESkQsR0FFSUEsQ0FBQyxDQUFDa0IsS0FBRmxCLENBQVEsVUFBQ21CLEVBQUQsRUFBS1YsQ0FBTDtBQUFBLGVBQVdSLENBQUMsQ0FBQ1EsQ0FBRCxDQUFEUixLQUFTa0IsRUFBcEI7QUFBQSxPQUFSbkIsQ0FITjs7QUFLQSxVQUFJLENBQUNpQixVQUFMLEVBQWlCO0FBQ2YsY0FBTSxJQUFJRyxLQUFKLG9FQUVGSixNQUFNLENBQUNkLE9BRkwsNEJBR21CRixDQUFDLENBQUNJLElBQUZKLENBQU8sS0FBUEEsQ0FIbkIsZUFHMENDLENBQUMsQ0FBQ0csSUFBRkgsQ0FDNUMsS0FENENBLENBSDFDLDRFQUFOO0FBT0Q7QUFDRjs7QUFFRCxXQUFPTix1QkFBY29CLEdBQWRwQixvQ0FDSnFCLE1BQU0sQ0FBQ2QsT0FESFAsRUFDYXFCLE1BRGJyQixFQUFQO0FBdkJGLEtBMEJHLEVBMUJIRjs7QUE0QkEsTUFBSWQsU0FBUyxLQUFLLEdBQWxCLEVBQXVCO0FBR3JCLFFBQU0wQyxLQUFLLEdBQUc1QixPQUFPLENBQUM2QixJQUFSN0IsQ0FDWHVCLGdCQUFEO0FBQUEsYUFDRUEsTUFBTSxDQUFDNUMsSUFBUDRDLEtBQWdCLEVBQWhCQSxJQUNBQSxNQUFNLENBQUNiLFVBQVBhLENBQWtCRSxLQUFsQkYsQ0FFRzNCLGNBQUQ7QUFBQTs7QUFBQSxlQUFVLG1CQUFDSSxPQUFPLENBQUM2QixJQUFSN0IsQ0FBYzhCLFdBQUQ7QUFBQSxpQkFBT0EsQ0FBQyxDQUFDQyxNQUFGRCxLQUFhbEMsSUFBcEI7QUFBQSxTQUFiSSxDQUFELDBDQUFDZ0MsY0FBd0NyRCxJQUF6QyxDQUFWO0FBRkYsUUFGRjtBQUFBLEtBRFlxQixDQUFkOztBQVNBLFFBQUk0QixLQUFKLEVBQVc7QUFDVCxhQUFPN0IsdUJBQXVCLENBQzVCcEIsSUFENEIsRUFFNUJpRCxLQUFLLENBQUNsQixVQUFOa0IsQ0FBaUJsQyxHQUFqQmtDLENBQXNCaEMsY0FBRDtBQUFBLGVBQVc7QUFBRUE7QUFBRixTQUFYO0FBQUEsT0FBckJnQyxDQUY0QixFQUc1Qi9DLGFBSDRCLEVBSTVCbUIsT0FKNEIsQ0FBOUI7QUFNRDs7QUFFRCxXQUFPWCxTQUFQO0FBQ0Q7O0FBRUQsTUFBSTRDLE1BQUo7QUFDQSxNQUFJQyxPQUFKOztBQUlBLDZCQUFrQ0MsbUJBQW1CLENBQ25EakQsU0FEbUQsRUFFbkRjLE9BQU8sQ0FBQ04sR0FBUk0sQ0FBYThCLFdBQUQ7QUFBQSxzQ0FDUEEsQ0FETztBQUdWTSxXQUFLLEVBQUVOLENBQUMsQ0FBQ00sS0FBRk4sR0FBVSxJQUFJTyxNQUFKLENBQVdQLENBQUMsQ0FBQ00sS0FBRk4sQ0FBUVEsTUFBUlIsR0FBaUIsR0FBNUIsQ0FBVkEsR0FBNkN6QztBQUgxQztBQUFBLEdBQVpXLENBRm1ELENBQXJEO0FBQUEsTUFBUVYsTUFBUix3QkFBUUEsTUFBUjtBQUFBLE1BQWdCaUQsYUFBaEIsd0JBQWdCQSxhQUFoQjs7QUFTQSxNQUFJakQsTUFBTSxLQUFLRCxTQUFmLEVBQTBCO0FBRXhCNkMsV0FBTyxHQUFHbkMsdUJBQXVCLENBQUNwQixJQUFELEVBQU9XLE1BQVAsRUFBZVQsYUFBZixFQUE4Qm1CLE9BQTlCLENBQWpDa0M7QUFDQWhELGFBQVMsR0FBR3FELGFBQVpyRDtBQUNBK0MsVUFBTSxHQUFHQyxPQUFURDtBQUNEOztBQUVELE1BQUlDLE9BQU8sSUFBSSxJQUFYQSxJQUFtQkQsTUFBTSxJQUFJLElBQWpDLEVBQXVDO0FBQ3JDLFdBQU81QyxTQUFQO0FBQ0Q7O0FBRUQsU0FBTzRDLE1BQVA7QUFDRDs7QUFFRCxJQUFNTyxTQUFTLEdBQUcsU0FBWkEsU0FBWTtBQUFBOztBQUFBLG9DQUFJQyxLQUFKO0FBQUlBLFNBQUosTUFBSUEsR0FBSkMsZUFBSUQ7QUFBSjs7QUFBQSxTQUNmLGFBQ0V4QyxNQURGLCtDQUNZd0MsS0FBSyxDQUFDL0MsR0FBTitDLENBQVdFLFdBQUQ7QUFBQSxXQUFPQSxDQUFDLENBQUNwRCxLQUFGb0QsQ0FBUSxHQUFSQSxDQUFQO0FBQUEsR0FBVkYsQ0FEWixHQUVFakQsTUFGRixDQUVTQyxPQUZULEVBR0VrQixJQUhGLENBR08sR0FIUCxDQURlO0FBQWxCOztBQU1BLElBQU13QixtQkFBbUIsR0FBRyxTQUF0QkEsbUJBQXNCLENBQUNqRCxTQUFELEVBQW9CYyxPQUFwQixFQUErQztBQUN6RSxNQUFJVixNQUFKO0FBQ0EsTUFBSWlELGFBQWEsR0FBR3JELFNBQXBCOztBQUZ5RSw2QkFLOURxQyxNQUw4RDtBQU12RSxRQUFJLENBQUNBLE1BQU0sQ0FBQ2EsS0FBWixFQUFtQjtBQUNqQjtBQUNEOztBQUVELFFBQU1SLEtBQUssR0FBR1csYUFBYSxDQUFDWCxLQUFkVyxDQUFvQmhCLE1BQU0sQ0FBQ2EsS0FBM0JHLENBQWQ7O0FBR0EsUUFBSVgsS0FBSixFQUFXO0FBQ1QsVUFBTWdCLGFBQWEsc0JBQUdyQixNQUFNLENBQUNkLE9BQVYsb0RBQUdvQyxnQkFDbEJ0RCxLQURrQixDQUNaLEdBRFksRUFFbkJDLE1BRm1CLENBRVhtRCxXQUFEO0FBQUEsZUFBT0EsQ0FBQyxDQUFDOUIsVUFBRjhCLENBQWEsR0FBYkEsQ0FBUDtBQUFBLE9BRlksRUFHbkJ0QixNQUhtQixDQUlsQixVQUFDQyxHQUFELEVBQU1xQixDQUFOLEVBQVMzQixDQUFUO0FBQUEsZUFDRWQsdUJBQWNvQixHQUFkcEIsb0NBRUd5QyxDQUZIekMsRUFFTzBCLEtBQUssQ0FBRSxDQUFDWixDQUFDLEdBQUcsQ0FBTCxJQUFVLENBQVosQ0FBTFksQ0FBb0J6QyxPQUFwQnlDLENBQTRCLElBQTVCQSxFQUFrQyxFQUFsQ0EsQ0FGUDFCLEVBREY7QUFBQSxPQUprQixFQVNsQixFQVRrQixDQUF0QjtBQVlBWixZQUFNLEdBQUdpQyxNQUFNLENBQUNiLFVBQVBhLENBQWtCN0IsR0FBbEI2QixDQUF1QjNCLGNBQUQsRUFBVTtBQUFBOztBQUN2QyxZQUFNMkIsTUFBTSxHQUFHdkIsT0FBTyxDQUFDNkIsSUFBUjdCLENBQWM4QixXQUFEO0FBQUEsaUJBQU9BLENBQUMsQ0FBQ0MsTUFBRkQsS0FBYWxDLElBQXBCO0FBQUEsU0FBYkksQ0FBZjtBQUNBLFlBQU04QyxNQUFNLEdBQUd2QixNQUFILFNBQUdBLFVBQUgsV0FBR0EsR0FBSCxNQUFHQSxHQUFILGdCQUFHQSxNQUFNLENBQUU1QyxJQUFYLGlEQUFHb0UsYUFDWHhELEtBRFcsQ0FDTCxHQURLLEVBRVpDLE1BRlksQ0FFSm1ELFdBQUQ7QUFBQSxpQkFBT0EsQ0FBQyxDQUFDOUIsVUFBRjhCLENBQWEsR0FBYkEsQ0FBUDtBQUFBLFNBRkssRUFHWnRCLE1BSFksQ0FHZ0IsVUFBQ0MsR0FBRCxFQUFNcUIsQ0FBTixFQUFZO0FBQ3ZDLGNBQU1LLEtBQUssR0FBR0osYUFBYSxDQUFDRCxDQUFELENBQTNCOztBQUVBLGNBQUlLLEtBQUosRUFBVztBQUFBOztBQUNULGdCQUFNNUMsR0FBRyxHQUFHdUMsQ0FBQyxDQUFDeEQsT0FBRndELENBQVUsSUFBVkEsRUFBZ0IsRUFBaEJBLEVBQW9CeEQsT0FBcEJ3RCxDQUE0QixLQUE1QkEsRUFBbUMsRUFBbkNBLENBQVo7QUFDQXJCLGVBQUcsQ0FBQ2xCLEdBQUQsQ0FBSGtCLEdBQVcsdUJBQU0sQ0FBQzJCLEtBQVAsd0RBQWU3QyxHQUFmLElBQXNCbUIsTUFBTSxDQUFDMEIsS0FBUDFCLENBQWFuQixHQUFibUIsRUFBa0J5QixLQUFsQnpCLENBQXRCLEdBQWlEeUIsS0FBNUQxQjtBQUNEOztBQUVELGlCQUFPQSxHQUFQO0FBWFcsV0FZVixFQVpVLENBQWY7O0FBY0EsWUFBSXdCLE1BQU0sSUFBSTVDLE1BQU0sQ0FBQ0MsSUFBUEQsQ0FBWTRDLE1BQVo1QyxFQUFvQkosTUFBbEMsRUFBMEM7QUFDeEMsaUJBQU87QUFBRUYsZ0JBQUYsRUFBRUEsSUFBRjtBQUFRa0Q7QUFBUixXQUFQO0FBQ0Q7O0FBRUQsZUFBTztBQUFFbEQ7QUFBRixTQUFQO0FBcEJPLFFBQVROO0FBdUJBaUQsbUJBQWEsR0FBR0EsYUFBYSxDQUFDcEQsT0FBZG9ELENBQXNCWCxLQUFLLENBQUMsQ0FBRCxDQUEzQlcsRUFBZ0MsRUFBaENBLENBQWhCQTtBQUVBO0FBQ0Q7QUFwRHNFOztBQUt6RSx1REFBcUJ2QyxPQUFyQix3Q0FBOEI7QUFBQSxRQUFuQnVCLE1BQW1COztBQUFBLFFBUWpCc0IsZUFSaUI7O0FBQUEscUJBQW5CdEIsTUFBbUI7O0FBQUEsNkJBRTFCO0FBRjBCLDBCQThDMUI7QUFFSDs7QUFFRCxTQUFPO0FBQUVqQyxVQUFGLEVBQUVBLE1BQUY7QUFBVWlEO0FBQVYsR0FBUDtBQXZERjs7QUEwREEsSUFBTWxDLHVCQUF1QixHQUFHLFNBQTFCQSx1QkFBMEIsQ0FDOUIwQixNQUQ4QixFQUU5Qm1CLFdBRjhCLEVBT1o7QUFBQSxNQUpsQnhDLFVBSWtCLHVFQUpLLEVBSUw7QUFBQSxNQUhsQnlDLFFBR2tCO0FBQUEsTUFGbEJuRSxhQUVrQjtBQUFBLE1BRGxCb0UsYUFDa0I7QUFDbEIsTUFBTXBELE9BQXNCLEdBQUcsRUFBL0I7QUFFQVUsWUFBVSxDQUFDM0IsSUFBWDJCLENBQWdCcUIsTUFBaEJyQjtBQUVBMUIsZUFBYSxDQUFDRCxJQUFkQyxDQUFtQitDLE1BQW5CL0M7QUFHQSxNQUFNdUMsTUFBTSxHQUFHMkIsV0FBVyxDQUFDbkIsTUFBRCxDQUExQjs7QUFFQSxNQUFJLE9BQU9SLE1BQVAsS0FBa0IsUUFBdEIsRUFBZ0M7QUFFOUIsUUFBTWQsT0FBTyxHQUFHMkMsYUFBYSxHQUFHWixTQUFTLENBQUNZLGFBQUQsRUFBZ0I3QixNQUFoQixDQUFaLEdBQXNDQSxNQUFuRTtBQUVBdkIsV0FBTyxDQUFDakIsSUFBUmlCLENBQWFxRCxnQkFBZ0IsQ0FBQ3RCLE1BQUQsRUFBU3JCLFVBQVQsRUFBcUJELE9BQXJCLEVBQThCYyxNQUE5QixDQUE3QnZCO0FBSkYsU0FLTyxJQUFJLE9BQU91QixNQUFQLEtBQWtCLFFBQXRCLEVBQWdDO0FBQ3JDLFFBQUlkLFNBQUo7O0FBS0EsUUFBSSxPQUFPYyxNQUFNLENBQUM1QyxJQUFkLEtBQXVCLFFBQTNCLEVBQXFDO0FBQ25DLFVBQUk0QyxNQUFNLENBQUMrQixLQUFQL0IsSUFBZ0JBLE1BQU0sQ0FBQzVDLElBQVA0QyxLQUFnQmxDLFNBQXBDLEVBQStDO0FBQzdDLGNBQU0sSUFBSXNDLEtBQUosQ0FDSixzSkFESSxDQUFOO0FBR0Q7O0FBRURsQixlQUFPLEdBQ0xjLE1BQU0sQ0FBQytCLEtBQVAvQixLQUFpQixJQUFqQkEsR0FDSWlCLFNBQVMsQ0FBQ1ksYUFBYSxJQUFJLEVBQWxCLEVBQXNCN0IsTUFBTSxDQUFDNUMsSUFBUDRDLElBQWUsRUFBckMsQ0FEYkEsR0FFSUEsTUFBTSxDQUFDNUMsSUFBUDRDLElBQWUsRUFIckJkO0FBS0FULGFBQU8sQ0FBQ2pCLElBQVJpQixDQUNFcUQsZ0JBQWdCLENBQ2R0QixNQURjLEVBRWRyQixVQUZjLEVBR2RELFNBSGMsRUFJZGMsTUFBTSxDQUFDNUMsSUFKTyxFQUtkNEMsTUFBTSxDQUFDMEIsS0FMTyxDQURsQmpEO0FBU0Q7O0FBRUQsUUFBSXVCLE1BQU0sQ0FBQ3RDLE9BQVgsRUFBb0I7QUFFbEIsVUFBSXNDLE1BQU0sQ0FBQ3pDLGdCQUFYLEVBQTZCO0FBQzNCcUUsZ0JBQVEsQ0FBQ3BFLElBQVRvRSxDQUFjO0FBQ1pyRSwwQkFBZ0IsRUFBRXlDLE1BQU0sQ0FBQ3pDLGdCQURiO0FBRVpFO0FBRlksU0FBZG1FO0FBSUQ7O0FBRURqRCxZQUFNLENBQUNDLElBQVBELENBQVlxQixNQUFNLENBQUN0QyxPQUFuQmlCLEVBQTRCcUQsT0FBNUJyRCxDQUFxQ3NELHNCQUFELEVBQWtCO0FBQUE7O0FBQ3BELFlBQU12QixNQUFNLEdBQUc1Qix1QkFBdUIsQ0FDcENtRCxZQURvQyxFQUVwQ2pDLE1BQU0sQ0FBQ3RDLE9BRjZCLEVBR3BDeUIsVUFIb0MsRUFJcEN5QyxRQUpvQyxtQ0FLaENuRSxhQUxnQyxlQU1wQ3lCLFNBTm9DLCtDQU16QjJDLGFBTnlCLENBQXRDO0FBU0FwRCxlQUFPLENBQUNqQixJQUFSaUIsY0FBTyxtQ0FBU2lDLE1BQVQsRUFBUGpDO0FBVkY7QUFZRDtBQUNGOztBQUVEVSxZQUFVLENBQUMrQyxHQUFYL0M7QUFFQSxTQUFPVixPQUFQO0FBN0VGOztBQWdGQSxJQUFNcUQsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFtQixDQUN2QnRCLE1BRHVCLEVBRXZCckIsVUFGdUIsRUFHdkJELE9BSHVCLEVBSXZCOUIsSUFKdUIsRUFLdkJzRSxLQUx1QixFQU1QO0FBRWhCeEMsU0FBTyxHQUFHQSxPQUFPLENBQUNsQixLQUFSa0IsQ0FBYyxHQUFkQSxFQUFtQmpCLE1BQW5CaUIsQ0FBMEJoQixPQUExQmdCLEVBQW1DRSxJQUFuQ0YsQ0FBd0MsR0FBeENBLENBQVZBO0FBRUEsTUFBTTJCLEtBQUssR0FBRzNCLE9BQU8sR0FDakIsSUFBSTRCLE1BQUosUUFDTzVCLE9BQU8sQ0FDVGxCLEtBREVrQixDQUNJLEdBREpBLEVBRUZmLEdBRkVlLENBRUdpQixZQUFELEVBQVE7QUFDWCxRQUFJQSxFQUFFLENBQUNiLFVBQUhhLENBQWMsR0FBZEEsQ0FBSixFQUF3QjtBQUN0Qiw4QkFBcUJBLEVBQUUsQ0FBQ3RDLFFBQUhzQyxDQUFZLEdBQVpBLElBQW1CLEdBQW5CQSxHQUF5QixFQUE5QztBQUNEOztBQUVELFlBQVVBLEVBQUUsS0FBSyxHQUFQQSxHQUFhLElBQWJBLEdBQW9CLGlDQUFPQSxFQUFQLENBQTlCO0FBUEMsS0FTRmYsSUFURUYsQ0FTRyxFQVRIQSxDQURQLE9BRGlCLEdBYWpCcEIsU0FiSjtBQWVBLFNBQU87QUFDTDBDLFVBREssRUFDTEEsTUFESztBQUVMSyxTQUZLLEVBRUxBLEtBRks7QUFHTDNCLFdBSEssRUFHTEEsT0FISztBQUlMOUIsUUFKSyxFQUlMQSxJQUpLO0FBTUwrQixjQUFVLG1DQUFNQSxVQUFOLENBTkw7QUFPTHVDO0FBUEssR0FBUDtBQXpCRjs7QUFvQ0EsSUFBTVMsdUJBQXVCLEdBQUcsU0FBMUJBLHVCQUEwQixDQUM5QkMsU0FEOEIsRUFFOUJDLFVBRjhCLEVBR0Y7QUFDNUIsd0RBQXFCQSxVQUFyQiwyQ0FBaUM7QUFBQSxRQUF0QnJDLE1BQXNCOztBQUMvQixRQUFJb0MsU0FBUyxLQUFLcEMsTUFBTSxDQUFDYixVQUFQYSxDQUFrQkEsTUFBTSxDQUFDYixVQUFQYSxDQUFrQnpCLE1BQWxCeUIsR0FBMkIsQ0FBN0NBLENBQWxCLEVBQW1FO0FBQ2pFLGFBQU9BLE1BQU0sQ0FBQzBCLEtBQWQ7QUFDRDtBQUNGOztBQUVELFNBQU81RCxTQUFQO0FBVkY7O0FBY0EsSUFBTXdFLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUIsQ0FDdkJGLFNBRHVCLEVBRXZCM0UsYUFGdUIsRUFHdkJILGFBSHVCLEVBSUE7QUFDdkIsd0RBQXFCQSxhQUFyQiwyQ0FBb0M7QUFBQSxRQUF6QjBDLE1BQXlCOztBQUNsQyxRQUFJdkMsYUFBYSxDQUFDYyxNQUFkZCxLQUF5QnVDLE1BQU0sQ0FBQ3ZDLGFBQVB1QyxDQUFxQnpCLE1BQWxELEVBQTBEO0FBQ3hELFVBQUlnRSxXQUFXLEdBQUcsSUFBbEI7O0FBQ0EsV0FBSyxJQUFJOUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR2hDLGFBQWEsQ0FBQ2MsTUFBbEMsRUFBMENrQixDQUFDLEVBQTNDLEVBQStDO0FBQzdDLFlBQUloQyxhQUFhLENBQUNnQyxDQUFELENBQWJoQyxDQUFpQjRCLGFBQWpCNUIsQ0FBK0J1QyxNQUFNLENBQUN2QyxhQUFQdUMsQ0FBcUJQLENBQXJCTyxDQUEvQnZDLE1BQTRELENBQWhFLEVBQW1FO0FBQ2pFOEUscUJBQVcsR0FBRyxLQUFkQTtBQUNBO0FBQ0Q7QUFDRjs7QUFDRCxVQUFJQSxXQUFKLEVBQWlCO0FBQ2YsZUFBT0gsU0FBUyxLQUFLcEMsTUFBTSxDQUFDekMsZ0JBQXJCNkUsR0FDSHBDLE1BQU0sQ0FBQ3pDLGdCQURKNkUsR0FFSHRFLFNBRko7QUFHRDtBQUNGO0FBQ0Y7O0FBQ0QsU0FBT0EsU0FBUDtBQXJCRjs7QUEwQkEsSUFBTTBFLGlCQUFpQixHQUFHLFNBQXBCQSxpQkFBb0IsQ0FDeEJDLFlBRHdCLEVBRXhCQyxLQUZ3QixFQUd4QkMsT0FId0IsRUFJUDtBQUNqQixNQUFJQSxPQUFKLEVBQWE7QUFDWCxRQUFJRixZQUFKLEVBQWtCO0FBQ2hCLGFBQU87QUFDTEcsYUFBSyxFQUFFLENBREY7QUFFTDdFLGNBQU0sRUFBRSxDQUFDO0FBQUVNLGNBQUksRUFBRW9FO0FBQVIsU0FBRCxFQUF5QkMsS0FBekI7QUFGSCxPQUFQO0FBREYsV0FLTztBQUNMLGFBQU87QUFDTDNFLGNBQU0sRUFBRSxDQUFDMkUsS0FBRDtBQURILE9BQVA7QUFHRDtBQVZILFNBV087QUFDTCxRQUFJRCxZQUFKLEVBQWtCO0FBQ2hCLGFBQU87QUFDTEcsYUFBSyxFQUFFLENBREY7QUFFTDdFLGNBQU0sRUFBRSxDQUFDO0FBQUVNLGNBQUksRUFBRW9FO0FBQVIsU0FBRCw2QkFBOEJDLEtBQTlCO0FBQXFDRyxlQUFLLEVBQUU7QUFBRTlFLGtCQUFNLEVBQUU7QUFBVjtBQUE1QztBQUZILE9BQVA7QUFERixXQUtPO0FBQ0wsYUFBTztBQUNMQSxjQUFNLEVBQUUsNEJBQU0yRSxLQUFOO0FBQWFHLGVBQUssRUFBRTtBQUFFOUUsa0JBQU0sRUFBRTtBQUFWO0FBQXBCO0FBREgsT0FBUDtBQUdEO0FBQ0Y7QUEzQkg7O0FBOEJBLElBQU1TLHVCQUF1QixHQUFHLFNBQTFCQSx1QkFBMEIsQ0FDOUJwQixJQUQ4QixFQUU5QlcsTUFGOEIsRUFHOUJULGFBSDhCLEVBSTlCK0UsVUFKOEIsRUFLM0I7QUFDSCxNQUFJUSxLQUFKO0FBQ0EsTUFBSUgsS0FBSyxHQUFHM0UsTUFBTSxDQUFDK0UsS0FBUC9FLEVBQVo7QUFDQSxNQUFNTixhQUF1QixHQUFHLEVBQWhDO0FBRUEsTUFBSWdGLFlBQVksR0FBR0gsZ0JBQWdCLENBQUNJLEtBQUssQ0FBQ3JFLElBQVAsRUFBYVosYUFBYixFQUE0QkgsYUFBNUIsQ0FBbkM7QUFFQUcsZUFBYSxDQUFDRCxJQUFkQyxDQUFtQmlGLEtBQUssQ0FBQ3JFLElBQXpCWjtBQUVBb0YsT0FBSyxHQUFHTCxpQkFBaUIsQ0FBQ0MsWUFBRCxFQUFlQyxLQUFmLEVBQXNCM0UsTUFBTSxDQUFDUSxNQUFQUixLQUFrQixDQUF4QyxDQUF6QjhFOztBQUVBLE1BQUk5RSxNQUFNLENBQUNRLE1BQVBSLEdBQWdCLENBQXBCLEVBQXVCO0FBQ3JCLFFBQUlnRixXQUFXLEdBQUdGLEtBQWxCOztBQUVBLFdBQVFILEtBQUssR0FBRzNFLE1BQU0sQ0FBQytFLEtBQVAvRSxFQUFoQixFQUFnRDtBQUM5QzBFLGtCQUFZLEdBQUdILGdCQUFnQixDQUFDSSxLQUFLLENBQUNyRSxJQUFQLEVBQWFaLGFBQWIsRUFBNEJILGFBQTVCLENBQS9CbUY7QUFFQSxVQUFNTyxnQkFBZ0IsR0FDcEJELFdBQVcsQ0FBQ0gsS0FBWkcsSUFBcUJBLFdBQVcsQ0FBQ2hGLE1BQVpnRixDQUFtQnhFLE1BQW5Cd0UsR0FBNEIsQ0FEbkQ7QUFHQUEsaUJBQVcsQ0FBQ2hGLE1BQVpnRixDQUFtQkMsZ0JBQW5CRCxFQUFxQ0YsS0FBckNFLEdBQTZDUCxpQkFBaUIsQ0FDNURDLFlBRDRELEVBRTVEQyxLQUY0RCxFQUc1RDNFLE1BQU0sQ0FBQ1EsTUFBUFIsS0FBa0IsQ0FIMEMsQ0FBOURnRjs7QUFNQSxVQUFJaEYsTUFBTSxDQUFDUSxNQUFQUixHQUFnQixDQUFwQixFQUF1QjtBQUNyQmdGLG1CQUFXLEdBQUdBLFdBQVcsQ0FBQ2hGLE1BQVpnRixDQUFtQkMsZ0JBQW5CRCxFQUNYRixLQURIRTtBQUVEOztBQUVEdEYsbUJBQWEsQ0FBQ0QsSUFBZEMsQ0FBbUJpRixLQUFLLENBQUNyRSxJQUF6Qlo7QUFDRDtBQUNGOztBQUVEaUYsT0FBSyxHQUFHLCtCQUFpQkcsS0FBakIsQ0FBUkg7QUFDQUEsT0FBSyxDQUFDdEYsSUFBTnNGLEdBQWF0RixJQUFic0Y7QUFFQSxNQUFNbkIsTUFBTSxHQUFHMEIsZ0JBQWdCLENBQzdCN0YsSUFENkIsRUFFN0JpRixVQUFVLEdBQUdGLHVCQUF1QixDQUFDTyxLQUFLLENBQUNyRSxJQUFQLEVBQWFnRSxVQUFiLENBQTFCLEdBQXFEdkUsU0FGbEMsQ0FBL0I7O0FBS0EsTUFBSXlELE1BQUosRUFBWTtBQUNWbUIsU0FBSyxDQUFDbkIsTUFBTm1CLDhCQUFvQkEsS0FBSyxDQUFDbkIsTUFBMUJtQixFQUFxQ25CLE1BQXJDbUI7QUFDRDs7QUFFRCxTQUFPRyxLQUFQO0FBcERGOztBQXVEQSxJQUFNSSxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQW1CLENBQ3ZCN0YsSUFEdUIsRUFFdkI4RixXQUZ1QixFQUdwQjtBQUNILE1BQU1DLEtBQUssR0FBRy9GLElBQUksQ0FBQ1ksS0FBTFosQ0FBVyxHQUFYQSxFQUFnQixDQUFoQkEsQ0FBZDtBQUNBLE1BQU1tRSxNQUFNLEdBQUc2QixXQUFXLENBQUMxQixLQUFaMEIsQ0FBa0JELEtBQWxCQyxDQUFmOztBQUVBLE1BQUlGLFdBQUosRUFBaUI7QUFDZnZFLFVBQU0sQ0FBQ0MsSUFBUEQsQ0FBWTRDLE1BQVo1QyxFQUFvQnFELE9BQXBCckQsQ0FBNkJOLGNBQUQsRUFBVTtBQUNwQyxVQUFJNkUsV0FBVyxDQUFDN0UsSUFBRCxDQUFYNkUsSUFBcUIsT0FBTzNCLE1BQU0sQ0FBQ2xELElBQUQsQ0FBYixLQUF3QixRQUFqRCxFQUEyRDtBQUN6RGtELGNBQU0sQ0FBQ2xELElBQUQsQ0FBTmtELEdBQWUyQixXQUFXLENBQUM3RSxJQUFELENBQVg2RSxDQUFrQjNCLE1BQU0sQ0FBQ2xELElBQUQsQ0FBeEI2RSxDQUFmM0I7QUFDRDtBQUhIO0FBS0Q7O0FBRUQsU0FBTzVDLE1BQU0sQ0FBQ0MsSUFBUEQsQ0FBWTRDLE1BQVo1QyxFQUFvQkosTUFBcEJJLEdBQTZCNEMsTUFBN0I1QyxHQUFzQ2IsU0FBN0M7QUFmRiIsIm5hbWVzIjpbImdldFN0YXRlRnJvbVBhdGgiLCJwYXRoIiwib3B0aW9ucyIsImluaXRpYWxSb3V0ZXMiLCJpbml0aWFsUm91dGVOYW1lIiwicHVzaCIsInBhcmVudFNjcmVlbnMiLCJzY3JlZW5zIiwicmVtYWluaW5nIiwicmVwbGFjZSIsImVuZHNXaXRoIiwidW5kZWZpbmVkIiwicm91dGVzIiwic3BsaXQiLCJmaWx0ZXIiLCJCb29sZWFuIiwibWFwIiwic2VnbWVudCIsIm5hbWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJsZW5ndGgiLCJjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdCIsImNvbmZpZ3MiLCJjb25jYXQiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MiLCJzb3J0IiwiYSIsImIiLCJwYXR0ZXJuIiwicm91dGVOYW1lcyIsImpvaW4iLCJsb2NhbGVDb21wYXJlIiwic3RhcnRzV2l0aCIsImFQYXJ0cyIsImJQYXJ0cyIsImkiLCJNYXRoIiwibWF4IiwiYVdpbGRDYXJkIiwiYldpbGRDYXJkIiwicmVkdWNlIiwiYWNjIiwiY29uZmlnIiwiaW50ZXJzZWN0cyIsImV2ZXJ5IiwiaXQiLCJFcnJvciIsIm1hdGNoIiwiZmluZCIsImMiLCJzY3JlZW4iLCJfY29uZmlncyRmaW5kIiwicmVzdWx0IiwiY3VycmVudCIsIm1hdGNoQWdhaW5zdENvbmZpZ3MiLCJyZWdleCIsIlJlZ0V4cCIsInNvdXJjZSIsInJlbWFpbmluZ1BhdGgiLCJqb2luUGF0aHMiLCJwYXRocyIsImFyZ3VtZW50cyIsInAiLCJtYXRjaGVkUGFyYW1zIiwiX2NvbmZpZyRwYXR0ZXJuIiwicGFyYW1zIiwiX2NvbmZpZyRwYXRoIiwidmFsdWUiLCJwYXJzZSIsInJvdXRlQ29uZmlnIiwiaW5pdGlhbHMiLCJwYXJlbnRQYXR0ZXJuIiwiY3JlYXRlQ29uZmlnSXRlbSIsImV4YWN0IiwiZm9yRWFjaCIsIm5lc3RlZENvbmZpZyIsInBvcCIsImZpbmRQYXJzZUNvbmZpZ0ZvclJvdXRlIiwicm91dGVOYW1lIiwiZmxhdENvbmZpZyIsImZpbmRJbml0aWFsUm91dGUiLCJzYW1lUGFyZW50cyIsImNyZWF0ZVN0YXRlT2JqZWN0IiwiaW5pdGlhbFJvdXRlIiwicm91dGUiLCJpc0VtcHR5IiwiaW5kZXgiLCJzdGF0ZSIsInNoaWZ0IiwibmVzdGVkU3RhdGUiLCJuZXN0ZWRTdGF0ZUluZGV4IiwicGFyc2VRdWVyeVBhcmFtcyIsInBhcnNlQ29uZmlnIiwicXVlcnkiLCJxdWVyeVN0cmluZyJdLCJzb3VyY2VzIjpbImdldFN0YXRlRnJvbVBhdGgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgSW5pdGlhbFN0YXRlLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcnRpYWxTdGF0ZSxcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5pbXBvcnQgZXNjYXBlIGZyb20gJ2VzY2FwZS1zdHJpbmctcmVnZXhwJztcbmltcG9ydCAqIGFzIHF1ZXJ5U3RyaW5nIGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5cbmltcG9ydCBmaW5kRm9jdXNlZFJvdXRlIGZyb20gJy4vZmluZEZvY3VzZWRSb3V0ZSc7XG5pbXBvcnQgdHlwZSB7IFBhdGhDb25maWdNYXAgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB2YWxpZGF0ZVBhdGhDb25maWcgZnJvbSAnLi92YWxpZGF0ZVBhdGhDb25maWcnO1xuXG50eXBlIE9wdGlvbnM8UGFyYW1MaXN0IGV4dGVuZHMge30+ID0ge1xuICBpbml0aWFsUm91dGVOYW1lPzogc3RyaW5nO1xuICBzY3JlZW5zOiBQYXRoQ29uZmlnTWFwPFBhcmFtTGlzdD47XG59O1xuXG50eXBlIFBhcnNlQ29uZmlnID0gUmVjb3JkPHN0cmluZywgKHZhbHVlOiBzdHJpbmcpID0+IGFueT47XG5cbnR5cGUgUm91dGVDb25maWcgPSB7XG4gIHNjcmVlbjogc3RyaW5nO1xuICByZWdleD86IFJlZ0V4cDtcbiAgcGF0aDogc3RyaW5nO1xuICBwYXR0ZXJuOiBzdHJpbmc7XG4gIHJvdXRlTmFtZXM6IHN0cmluZ1tdO1xuICBwYXJzZT86IFBhcnNlQ29uZmlnO1xufTtcblxudHlwZSBJbml0aWFsUm91dGVDb25maWcgPSB7XG4gIGluaXRpYWxSb3V0ZU5hbWU6IHN0cmluZztcbiAgcGFyZW50U2NyZWVuczogc3RyaW5nW107XG59O1xuXG50eXBlIFJlc3VsdFN0YXRlID0gUGFydGlhbFN0YXRlPE5hdmlnYXRpb25TdGF0ZT4gJiB7XG4gIHN0YXRlPzogUmVzdWx0U3RhdGU7XG59O1xuXG50eXBlIFBhcnNlZFJvdXRlID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBhdGg/OiBzdHJpbmc7XG4gIHBhcmFtcz86IFJlY29yZDxzdHJpbmcsIGFueT4gfCB1bmRlZmluZWQ7XG59O1xuXG4vKipcbiAqIFV0aWxpdHkgdG8gcGFyc2UgYSBwYXRoIHN0cmluZyB0byBpbml0aWFsIHN0YXRlIG9iamVjdCBhY2NlcHRlZCBieSB0aGUgY29udGFpbmVyLlxuICogVGhpcyBpcyB1c2VmdWwgZm9yIGRlZXAgbGlua2luZyB3aGVuIHdlIG5lZWQgdG8gaGFuZGxlIHRoZSBpbmNvbWluZyBVUkwuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBnZXRTdGF0ZUZyb21QYXRoKFxuICogICAnL2NoYXQvamFuZS80MicsXG4gKiAgIHtcbiAqICAgICBzY3JlZW5zOiB7XG4gKiAgICAgICBDaGF0OiB7XG4gKiAgICAgICAgIHBhdGg6ICdjaGF0LzphdXRob3IvOmlkJyxcbiAqICAgICAgICAgcGFyc2U6IHsgaWQ6IE51bWJlciB9XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICogICB9XG4gKiApXG4gKiBgYGBcbiAqIEBwYXJhbSBwYXRoIFBhdGggc3RyaW5nIHRvIHBhcnNlIGFuZCBjb252ZXJ0LCBlLmcuIC9mb28vYmFyP2NvdW50PTQyLlxuICogQHBhcmFtIG9wdGlvbnMgRXh0cmEgb3B0aW9ucyB0byBmaW5lLXR1bmUgaG93IHRvIHBhcnNlIHRoZSBwYXRoLlxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRTdGF0ZUZyb21QYXRoPFBhcmFtTGlzdCBleHRlbmRzIHt9PihcbiAgcGF0aDogc3RyaW5nLFxuICBvcHRpb25zPzogT3B0aW9uczxQYXJhbUxpc3Q+XG4pOiBSZXN1bHRTdGF0ZSB8IHVuZGVmaW5lZCB7XG4gIGlmIChvcHRpb25zKSB7XG4gICAgdmFsaWRhdGVQYXRoQ29uZmlnKG9wdGlvbnMpO1xuICB9XG5cbiAgbGV0IGluaXRpYWxSb3V0ZXM6IEluaXRpYWxSb3V0ZUNvbmZpZ1tdID0gW107XG5cbiAgaWYgKG9wdGlvbnM/LmluaXRpYWxSb3V0ZU5hbWUpIHtcbiAgICBpbml0aWFsUm91dGVzLnB1c2goe1xuICAgICAgaW5pdGlhbFJvdXRlTmFtZTogb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lLFxuICAgICAgcGFyZW50U2NyZWVuczogW10sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBzY3JlZW5zID0gb3B0aW9ucz8uc2NyZWVucztcblxuICBsZXQgcmVtYWluaW5nID0gcGF0aFxuICAgIC5yZXBsYWNlKC9cXC8rL2csICcvJykgLy8gUmVwbGFjZSBtdWx0aXBsZSBzbGFzaCAoLy8pIHdpdGggc2luZ2xlIG9uZXNcbiAgICAucmVwbGFjZSgvXlxcLy8sICcnKSAvLyBSZW1vdmUgZXh0cmEgbGVhZGluZyBzbGFzaFxuICAgIC5yZXBsYWNlKC9cXD8uKiQvLCAnJyk7IC8vIFJlbW92ZSBxdWVyeSBwYXJhbXMgd2hpY2ggd2Ugd2lsbCBoYW5kbGUgbGF0ZXJcblxuICAvLyBNYWtlIHN1cmUgdGhlcmUgaXMgYSB0cmFpbGluZyBzbGFzaFxuICByZW1haW5pbmcgPSByZW1haW5pbmcuZW5kc1dpdGgoJy8nKSA/IHJlbWFpbmluZyA6IGAke3JlbWFpbmluZ30vYDtcblxuICBpZiAoc2NyZWVucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gV2hlbiBubyBjb25maWcgaXMgc3BlY2lmaWVkLCB1c2UgdGhlIHBhdGggc2VnbWVudHMgYXMgcm91dGUgbmFtZXNcbiAgICBjb25zdCByb3V0ZXMgPSByZW1haW5pbmdcbiAgICAgIC5zcGxpdCgnLycpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAubWFwKChzZWdtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQoc2VnbWVudCk7XG4gICAgICAgIHJldHVybiB7IG5hbWUgfTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKHJvdXRlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdChwYXRoLCByb3V0ZXMsIGluaXRpYWxSb3V0ZXMpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBDcmVhdGUgYSBub3JtYWxpemVkIGNvbmZpZ3MgYXJyYXkgd2hpY2ggd2lsbCBiZSBlYXNpZXIgdG8gdXNlXG4gIGNvbnN0IGNvbmZpZ3MgPSAoW10gYXMgUm91dGVDb25maWdbXSlcbiAgICAuY29uY2F0KFxuICAgICAgLi4uT2JqZWN0LmtleXMoc2NyZWVucykubWFwKChrZXkpID0+XG4gICAgICAgIGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzKFxuICAgICAgICAgIGtleSxcbiAgICAgICAgICBzY3JlZW5zIGFzIFBhdGhDb25maWdNYXA8b2JqZWN0PixcbiAgICAgICAgICBbXSxcbiAgICAgICAgICBpbml0aWFsUm91dGVzLFxuICAgICAgICAgIFtdXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIC8vIFNvcnQgY29uZmlnIHNvIHRoYXQ6XG4gICAgICAvLyAtIHRoZSBtb3N0IGV4aGF1c3RpdmUgb25lcyBhcmUgYWx3YXlzIGF0IHRoZSBiZWdpbm5pbmdcbiAgICAgIC8vIC0gcGF0dGVybnMgd2l0aCB3aWxkY2FyZCBhcmUgYWx3YXlzIGF0IHRoZSBlbmRcblxuICAgICAgLy8gSWYgMiBwYXR0ZXJucyBhcmUgc2FtZSwgbW92ZSB0aGUgb25lIHdpdGggbGVzcyByb3V0ZSBuYW1lcyB1cFxuICAgICAgLy8gVGhpcyBpcyBhbiBlcnJvciBzdGF0ZSwgc28gaXQncyBvbmx5IHVzZWZ1bCBmb3IgY29uc2lzdGVudCBlcnJvciBtZXNzYWdlc1xuICAgICAgaWYgKGEucGF0dGVybiA9PT0gYi5wYXR0ZXJuKSB7XG4gICAgICAgIHJldHVybiBiLnJvdXRlTmFtZXMuam9pbignPicpLmxvY2FsZUNvbXBhcmUoYS5yb3V0ZU5hbWVzLmpvaW4oJz4nKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIG9uZSBvZiB0aGUgcGF0dGVybnMgc3RhcnRzIHdpdGggdGhlIG90aGVyLCBpdCdzIG1vcmUgZXhoYXVzdGl2ZVxuICAgICAgLy8gU28gbW92ZSBpdCB1cFxuICAgICAgaWYgKGEucGF0dGVybi5zdGFydHNXaXRoKGIucGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuXG4gICAgICBpZiAoYi5wYXR0ZXJuLnN0YXJ0c1dpdGgoYS5wYXR0ZXJuKSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYVBhcnRzID0gYS5wYXR0ZXJuLnNwbGl0KCcvJyk7XG4gICAgICBjb25zdCBiUGFydHMgPSBiLnBhdHRlcm4uc3BsaXQoJy8nKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLm1heChhUGFydHMubGVuZ3RoLCBiUGFydHMubGVuZ3RoKTsgaSsrKSB7XG4gICAgICAgIC8vIGlmIGIgaXMgbG9uZ2VyLCBiIGdldCBoaWdoZXIgcHJpb3JpdHlcbiAgICAgICAgaWYgKGFQYXJ0c1tpXSA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgYSBpcyBsb25nZXIsIGEgZ2V0IGhpZ2hlciBwcmlvcml0eVxuICAgICAgICBpZiAoYlBhcnRzW2ldID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYVdpbGRDYXJkID0gYVBhcnRzW2ldID09PSAnKicgfHwgYVBhcnRzW2ldLnN0YXJ0c1dpdGgoJzonKTtcbiAgICAgICAgY29uc3QgYldpbGRDYXJkID0gYlBhcnRzW2ldID09PSAnKicgfHwgYlBhcnRzW2ldLnN0YXJ0c1dpdGgoJzonKTtcbiAgICAgICAgLy8gaWYgYm90aCBhcmUgd2lsZGNhcmQgd2UgY29tcGFyZSBuZXh0IGNvbXBvbmVudFxuICAgICAgICBpZiAoYVdpbGRDYXJkICYmIGJXaWxkQ2FyZCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIG9ubHkgYSBpcyB3aWxkIGNhcmQsIGIgZ2V0IGhpZ2hlciBwcmlvcml0eVxuICAgICAgICBpZiAoYVdpbGRDYXJkKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgb25seSBiIGlzIHdpbGQgY2FyZCwgYSBnZXQgaGlnaGVyIHByaW9yaXR5XG4gICAgICAgIGlmIChiV2lsZENhcmQpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBiUGFydHMubGVuZ3RoIC0gYVBhcnRzLmxlbmd0aDtcbiAgICB9KTtcblxuICAvLyBDaGVjayBmb3IgZHVwbGljYXRlIHBhdHRlcm5zIGluIHRoZSBjb25maWdcbiAgY29uZmlncy5yZWR1Y2U8UmVjb3JkPHN0cmluZywgUm91dGVDb25maWc+PigoYWNjLCBjb25maWcpID0+IHtcbiAgICBpZiAoYWNjW2NvbmZpZy5wYXR0ZXJuXSkge1xuICAgICAgY29uc3QgYSA9IGFjY1tjb25maWcucGF0dGVybl0ucm91dGVOYW1lcztcbiAgICAgIGNvbnN0IGIgPSBjb25maWcucm91dGVOYW1lcztcblxuICAgICAgLy8gSXQncyBub3QgYSBwcm9ibGVtIGlmIHRoZSBwYXRoIHN0cmluZyBvbWl0dGVkIGZyb20gYSBpbm5lciBtb3N0IHNjcmVlblxuICAgICAgLy8gRm9yIGV4YW1wbGUsIGl0J3Mgb2sgaWYgYSBwYXRoIHJlc29sdmVzIHRvIGBBID4gQiA+IENgIG9yIGBBID4gQmBcbiAgICAgIGNvbnN0IGludGVyc2VjdHMgPVxuICAgICAgICBhLmxlbmd0aCA+IGIubGVuZ3RoXG4gICAgICAgICAgPyBiLmV2ZXJ5KChpdCwgaSkgPT4gYVtpXSA9PT0gaXQpXG4gICAgICAgICAgOiBhLmV2ZXJ5KChpdCwgaSkgPT4gYltpXSA9PT0gaXQpO1xuXG4gICAgICBpZiAoIWludGVyc2VjdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBGb3VuZCBjb25mbGljdGluZyBzY3JlZW5zIHdpdGggdGhlIHNhbWUgcGF0dGVybi4gVGhlIHBhdHRlcm4gJyR7XG4gICAgICAgICAgICBjb25maWcucGF0dGVyblxuICAgICAgICAgIH0nIHJlc29sdmVzIHRvIGJvdGggJyR7YS5qb2luKCcgPiAnKX0nIGFuZCAnJHtiLmpvaW4oXG4gICAgICAgICAgICAnID4gJ1xuICAgICAgICAgICl9Jy4gUGF0dGVybnMgbXVzdCBiZSB1bmlxdWUgYW5kIGNhbm5vdCByZXNvbHZlIHRvIG1vcmUgdGhhbiBvbmUgc2NyZWVuLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIHtcbiAgICAgIFtjb25maWcucGF0dGVybl06IGNvbmZpZyxcbiAgICB9KTtcbiAgfSwge30pO1xuXG4gIGlmIChyZW1haW5pbmcgPT09ICcvJykge1xuICAgIC8vIFdlIG5lZWQgdG8gYWRkIHNwZWNpYWwgaGFuZGxpbmcgb2YgZW1wdHkgcGF0aCBzbyBuYXZpZ2F0aW9uIHRvIGVtcHR5IHBhdGggYWxzbyB3b3Jrc1xuICAgIC8vIFdoZW4gaGFuZGxpbmcgZW1wdHkgcGF0aCwgd2Ugc2hvdWxkIG9ubHkgbG9vayBhdCB0aGUgcm9vdCBsZXZlbCBjb25maWdcbiAgICBjb25zdCBtYXRjaCA9IGNvbmZpZ3MuZmluZChcbiAgICAgIChjb25maWcpID0+XG4gICAgICAgIGNvbmZpZy5wYXRoID09PSAnJyAmJlxuICAgICAgICBjb25maWcucm91dGVOYW1lcy5ldmVyeShcbiAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBub25lIG9mIHRoZSBwYXJlbnQgY29uZmlncyBoYXZlIGEgbm9uLWVtcHR5IHBhdGggZGVmaW5lZFxuICAgICAgICAgIChuYW1lKSA9PiAhY29uZmlncy5maW5kKChjKSA9PiBjLnNjcmVlbiA9PT0gbmFtZSk/LnBhdGhcbiAgICAgICAgKVxuICAgICk7XG5cbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdChcbiAgICAgICAgcGF0aCxcbiAgICAgICAgbWF0Y2gucm91dGVOYW1lcy5tYXAoKG5hbWUpID0+ICh7IG5hbWUgfSkpLFxuICAgICAgICBpbml0aWFsUm91dGVzLFxuICAgICAgICBjb25maWdzXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBsZXQgcmVzdWx0OiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiB8IHVuZGVmaW5lZDtcbiAgbGV0IGN1cnJlbnQ6IFBhcnRpYWxTdGF0ZTxOYXZpZ2F0aW9uU3RhdGU+IHwgdW5kZWZpbmVkO1xuXG4gIC8vIFdlIG1hdGNoIHRoZSB3aG9sZSBwYXRoIGFnYWluc3QgdGhlIHJlZ2V4IGluc3RlYWQgb2Ygc2VnbWVudHNcbiAgLy8gVGhpcyBtYWtlcyBzdXJlIG1hdGNoZXMgc3VjaCBhcyB3aWxkY2FyZCB3aWxsIGNhdGNoIGFueSB1bm1hdGNoZWQgcm91dGVzLCBldmVuIGlmIG5lc3RlZFxuICBjb25zdCB7IHJvdXRlcywgcmVtYWluaW5nUGF0aCB9ID0gbWF0Y2hBZ2FpbnN0Q29uZmlncyhcbiAgICByZW1haW5pbmcsXG4gICAgY29uZmlncy5tYXAoKGMpID0+ICh7XG4gICAgICAuLi5jLFxuICAgICAgLy8gQWRkIGAkYCB0byB0aGUgcmVnZXggdG8gbWFrZSBzdXJlIGl0IG1hdGNoZXMgdGlsbCBlbmQgb2YgdGhlIHBhdGggYW5kIG5vdCBqdXN0IGJlZ2lubmluZ1xuICAgICAgcmVnZXg6IGMucmVnZXggPyBuZXcgUmVnRXhwKGMucmVnZXguc291cmNlICsgJyQnKSA6IHVuZGVmaW5lZCxcbiAgICB9KSlcbiAgKTtcblxuICBpZiAocm91dGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBUaGlzIHdpbGwgYWx3YXlzIGJlIGVtcHR5IGlmIGZ1bGwgcGF0aCBtYXRjaGVkXG4gICAgY3VycmVudCA9IGNyZWF0ZU5lc3RlZFN0YXRlT2JqZWN0KHBhdGgsIHJvdXRlcywgaW5pdGlhbFJvdXRlcywgY29uZmlncyk7XG4gICAgcmVtYWluaW5nID0gcmVtYWluaW5nUGF0aDtcbiAgICByZXN1bHQgPSBjdXJyZW50O1xuICB9XG5cbiAgaWYgKGN1cnJlbnQgPT0gbnVsbCB8fCByZXN1bHQgPT0gbnVsbCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5jb25zdCBqb2luUGF0aHMgPSAoLi4ucGF0aHM6IHN0cmluZ1tdKTogc3RyaW5nID0+XG4gIChbXSBhcyBzdHJpbmdbXSlcbiAgICAuY29uY2F0KC4uLnBhdGhzLm1hcCgocCkgPT4gcC5zcGxpdCgnLycpKSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgLmpvaW4oJy8nKTtcblxuY29uc3QgbWF0Y2hBZ2FpbnN0Q29uZmlncyA9IChyZW1haW5pbmc6IHN0cmluZywgY29uZmlnczogUm91dGVDb25maWdbXSkgPT4ge1xuICBsZXQgcm91dGVzOiBQYXJzZWRSb3V0ZVtdIHwgdW5kZWZpbmVkO1xuICBsZXQgcmVtYWluaW5nUGF0aCA9IHJlbWFpbmluZztcblxuICAvLyBHbyB0aHJvdWdoIGFsbCBjb25maWdzLCBhbmQgc2VlIGlmIHRoZSBuZXh0IHBhdGggc2VnbWVudCBtYXRjaGVzIG91ciByZWdleFxuICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBjb25maWdzKSB7XG4gICAgaWYgKCFjb25maWcucmVnZXgpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG1hdGNoID0gcmVtYWluaW5nUGF0aC5tYXRjaChjb25maWcucmVnZXgpO1xuXG4gICAgLy8gSWYgb3VyIHJlZ2V4IG1hdGNoZXMsIHdlIG5lZWQgdG8gZXh0cmFjdCBwYXJhbXMgZnJvbSB0aGUgcGF0aFxuICAgIGlmIChtYXRjaCkge1xuICAgICAgY29uc3QgbWF0Y2hlZFBhcmFtcyA9IGNvbmZpZy5wYXR0ZXJuXG4gICAgICAgID8uc3BsaXQoJy8nKVxuICAgICAgICAuZmlsdGVyKChwKSA9PiBwLnN0YXJ0c1dpdGgoJzonKSlcbiAgICAgICAgLnJlZHVjZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgICAgICAgICAoYWNjLCBwLCBpKSA9PlxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihhY2MsIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHBhcmFtIHNlZ21lbnRzIGFwcGVhciBldmVyeSBzZWNvbmQgaXRlbSBzdGFydGluZyBmcm9tIDIgaW4gdGhlIHJlZ2V4IG1hdGNoIHJlc3VsdFxuICAgICAgICAgICAgICBbcF06IG1hdGNoIVsoaSArIDEpICogMl0ucmVwbGFjZSgvXFwvLywgJycpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAge31cbiAgICAgICAgKTtcblxuICAgICAgcm91dGVzID0gY29uZmlnLnJvdXRlTmFtZXMubWFwKChuYW1lKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGNvbmZpZ3MuZmluZCgoYykgPT4gYy5zY3JlZW4gPT09IG5hbWUpO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBjb25maWc/LnBhdGhcbiAgICAgICAgICA/LnNwbGl0KCcvJylcbiAgICAgICAgICAuZmlsdGVyKChwKSA9PiBwLnN0YXJ0c1dpdGgoJzonKSlcbiAgICAgICAgICAucmVkdWNlPFJlY29yZDxzdHJpbmcsIGFueT4+KChhY2MsIHApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWF0Y2hlZFBhcmFtc1twXTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGtleSA9IHAucmVwbGFjZSgvXjovLCAnJykucmVwbGFjZSgvXFw/JC8sICcnKTtcbiAgICAgICAgICAgICAgYWNjW2tleV0gPSBjb25maWcucGFyc2U/LltrZXldID8gY29uZmlnLnBhcnNlW2tleV0odmFsdWUpIDogdmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30pO1xuXG4gICAgICAgIGlmIChwYXJhbXMgJiYgT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4geyBuYW1lLCBwYXJhbXMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IG5hbWUgfTtcbiAgICAgIH0pO1xuXG4gICAgICByZW1haW5pbmdQYXRoID0gcmVtYWluaW5nUGF0aC5yZXBsYWNlKG1hdGNoWzFdLCAnJyk7XG5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IHJvdXRlcywgcmVtYWluaW5nUGF0aCB9O1xufTtcblxuY29uc3QgY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MgPSAoXG4gIHNjcmVlbjogc3RyaW5nLFxuICByb3V0ZUNvbmZpZzogUGF0aENvbmZpZ01hcDxvYmplY3Q+LFxuICByb3V0ZU5hbWVzOiBzdHJpbmdbXSA9IFtdLFxuICBpbml0aWFsczogSW5pdGlhbFJvdXRlQ29uZmlnW10sXG4gIHBhcmVudFNjcmVlbnM6IHN0cmluZ1tdLFxuICBwYXJlbnRQYXR0ZXJuPzogc3RyaW5nXG4pOiBSb3V0ZUNvbmZpZ1tdID0+IHtcbiAgY29uc3QgY29uZmlnczogUm91dGVDb25maWdbXSA9IFtdO1xuXG4gIHJvdXRlTmFtZXMucHVzaChzY3JlZW4pO1xuXG4gIHBhcmVudFNjcmVlbnMucHVzaChzY3JlZW4pO1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3I6IHdlIGNhbid0IHN0cm9uZ2x5IHR5cGVjaGVjayB0aGlzIGZvciBub3dcbiAgY29uc3QgY29uZmlnID0gcm91dGVDb25maWdbc2NyZWVuXTtcblxuICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBJZiBhIHN0cmluZyBpcyBzcGVjaWZpZWQgYXMgdGhlIHZhbHVlIG9mIHRoZSBrZXkoZS5nLiBGb286ICcvcGF0aCcpLCB1c2UgaXQgYXMgdGhlIHBhdHRlcm5cbiAgICBjb25zdCBwYXR0ZXJuID0gcGFyZW50UGF0dGVybiA/IGpvaW5QYXRocyhwYXJlbnRQYXR0ZXJuLCBjb25maWcpIDogY29uZmlnO1xuXG4gICAgY29uZmlncy5wdXNoKGNyZWF0ZUNvbmZpZ0l0ZW0oc2NyZWVuLCByb3V0ZU5hbWVzLCBwYXR0ZXJuLCBjb25maWcpKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnID09PSAnb2JqZWN0Jykge1xuICAgIGxldCBwYXR0ZXJuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICAvLyBpZiBhbiBvYmplY3QgaXMgc3BlY2lmaWVkIGFzIHRoZSB2YWx1ZSAoZS5nLiBGb286IHsgLi4uIH0pLFxuICAgIC8vIGl0IGNhbiBoYXZlIGBwYXRoYCBwcm9wZXJ0eSBhbmRcbiAgICAvLyBpdCBjb3VsZCBoYXZlIGBzY3JlZW5zYCBwcm9wIHdoaWNoIGhhcyBuZXN0ZWQgY29uZmlnc1xuICAgIGlmICh0eXBlb2YgY29uZmlnLnBhdGggPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoY29uZmlnLmV4YWN0ICYmIGNvbmZpZy5wYXRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQSAncGF0aCcgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIHdoZW4gc3BlY2lmeWluZyAnZXhhY3Q6IHRydWUnLiBJZiB5b3UgZG9uJ3Qgd2FudCB0aGlzIHNjcmVlbiBpbiB0aGUgVVJMLCBzcGVjaWZ5IGl0IGFzIGVtcHR5IHN0cmluZywgZS5nLiBgcGF0aDogJydgLlwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHBhdHRlcm4gPVxuICAgICAgICBjb25maWcuZXhhY3QgIT09IHRydWVcbiAgICAgICAgICA/IGpvaW5QYXRocyhwYXJlbnRQYXR0ZXJuIHx8ICcnLCBjb25maWcucGF0aCB8fCAnJylcbiAgICAgICAgICA6IGNvbmZpZy5wYXRoIHx8ICcnO1xuXG4gICAgICBjb25maWdzLnB1c2goXG4gICAgICAgIGNyZWF0ZUNvbmZpZ0l0ZW0oXG4gICAgICAgICAgc2NyZWVuLFxuICAgICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgICAgcGF0dGVybiEsXG4gICAgICAgICAgY29uZmlnLnBhdGgsXG4gICAgICAgICAgY29uZmlnLnBhcnNlXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5zY3JlZW5zKSB7XG4gICAgICAvLyBwcm9wZXJ0eSBgaW5pdGlhbFJvdXRlTmFtZWAgd2l0aG91dCBgc2NyZWVuc2AgaGFzIG5vIHB1cnBvc2VcbiAgICAgIGlmIChjb25maWcuaW5pdGlhbFJvdXRlTmFtZSkge1xuICAgICAgICBpbml0aWFscy5wdXNoKHtcbiAgICAgICAgICBpbml0aWFsUm91dGVOYW1lOiBjb25maWcuaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgICAgICBwYXJlbnRTY3JlZW5zLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgT2JqZWN0LmtleXMoY29uZmlnLnNjcmVlbnMpLmZvckVhY2goKG5lc3RlZENvbmZpZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGVOb3JtYWxpemVkQ29uZmlncyhcbiAgICAgICAgICBuZXN0ZWRDb25maWcsXG4gICAgICAgICAgY29uZmlnLnNjcmVlbnMgYXMgUGF0aENvbmZpZ01hcDxvYmplY3Q+LFxuICAgICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgICAgaW5pdGlhbHMsXG4gICAgICAgICAgWy4uLnBhcmVudFNjcmVlbnNdLFxuICAgICAgICAgIHBhdHRlcm4gPz8gcGFyZW50UGF0dGVyblxuICAgICAgICApO1xuXG4gICAgICAgIGNvbmZpZ3MucHVzaCguLi5yZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcm91dGVOYW1lcy5wb3AoKTtcblxuICByZXR1cm4gY29uZmlncztcbn07XG5cbmNvbnN0IGNyZWF0ZUNvbmZpZ0l0ZW0gPSAoXG4gIHNjcmVlbjogc3RyaW5nLFxuICByb3V0ZU5hbWVzOiBzdHJpbmdbXSxcbiAgcGF0dGVybjogc3RyaW5nLFxuICBwYXRoOiBzdHJpbmcsXG4gIHBhcnNlPzogUGFyc2VDb25maWdcbik6IFJvdXRlQ29uZmlnID0+IHtcbiAgLy8gTm9ybWFsaXplIHBhdHRlcm4gdG8gcmVtb3ZlIGFueSBsZWFkaW5nLCB0cmFpbGluZyBzbGFzaGVzLCBkdXBsaWNhdGUgc2xhc2hlcyBldGMuXG4gIHBhdHRlcm4gPSBwYXR0ZXJuLnNwbGl0KCcvJykuZmlsdGVyKEJvb2xlYW4pLmpvaW4oJy8nKTtcblxuICBjb25zdCByZWdleCA9IHBhdHRlcm5cbiAgICA/IG5ldyBSZWdFeHAoXG4gICAgICAgIGBeKCR7cGF0dGVyblxuICAgICAgICAgIC5zcGxpdCgnLycpXG4gICAgICAgICAgLm1hcCgoaXQpID0+IHtcbiAgICAgICAgICAgIGlmIChpdC5zdGFydHNXaXRoKCc6JykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGAoKFteL10rXFxcXC8pJHtpdC5lbmRzV2l0aCgnPycpID8gJz8nIDogJyd9KWA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBgJHtpdCA9PT0gJyonID8gJy4qJyA6IGVzY2FwZShpdCl9XFxcXC9gO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmpvaW4oJycpfSlgXG4gICAgICApXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgcmV0dXJuIHtcbiAgICBzY3JlZW4sXG4gICAgcmVnZXgsXG4gICAgcGF0dGVybixcbiAgICBwYXRoLFxuICAgIC8vIFRoZSByb3V0ZU5hbWVzIGFycmF5IGlzIG11dGF0ZWQsIHNvIGNvcHkgaXQgdG8ga2VlcCB0aGUgY3VycmVudCBzdGF0ZVxuICAgIHJvdXRlTmFtZXM6IFsuLi5yb3V0ZU5hbWVzXSxcbiAgICBwYXJzZSxcbiAgfTtcbn07XG5cbmNvbnN0IGZpbmRQYXJzZUNvbmZpZ0ZvclJvdXRlID0gKFxuICByb3V0ZU5hbWU6IHN0cmluZyxcbiAgZmxhdENvbmZpZzogUm91dGVDb25maWdbXVxuKTogUGFyc2VDb25maWcgfCB1bmRlZmluZWQgPT4ge1xuICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBmbGF0Q29uZmlnKSB7XG4gICAgaWYgKHJvdXRlTmFtZSA9PT0gY29uZmlnLnJvdXRlTmFtZXNbY29uZmlnLnJvdXRlTmFtZXMubGVuZ3RoIC0gMV0pIHtcbiAgICAgIHJldHVybiBjb25maWcucGFyc2U7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbi8vIFRyeSB0byBmaW5kIGFuIGluaXRpYWwgcm91dGUgY29ubmVjdGVkIHdpdGggdGhlIG9uZSBwYXNzZWRcbmNvbnN0IGZpbmRJbml0aWFsUm91dGUgPSAoXG4gIHJvdXRlTmFtZTogc3RyaW5nLFxuICBwYXJlbnRTY3JlZW5zOiBzdHJpbmdbXSxcbiAgaW5pdGlhbFJvdXRlczogSW5pdGlhbFJvdXRlQ29uZmlnW11cbik6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG4gIGZvciAoY29uc3QgY29uZmlnIG9mIGluaXRpYWxSb3V0ZXMpIHtcbiAgICBpZiAocGFyZW50U2NyZWVucy5sZW5ndGggPT09IGNvbmZpZy5wYXJlbnRTY3JlZW5zLmxlbmd0aCkge1xuICAgICAgbGV0IHNhbWVQYXJlbnRzID0gdHJ1ZTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyZW50U2NyZWVucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAocGFyZW50U2NyZWVuc1tpXS5sb2NhbGVDb21wYXJlKGNvbmZpZy5wYXJlbnRTY3JlZW5zW2ldKSAhPT0gMCkge1xuICAgICAgICAgIHNhbWVQYXJlbnRzID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzYW1lUGFyZW50cykge1xuICAgICAgICByZXR1cm4gcm91dGVOYW1lICE9PSBjb25maWcuaW5pdGlhbFJvdXRlTmFtZVxuICAgICAgICAgID8gY29uZmlnLmluaXRpYWxSb3V0ZU5hbWVcbiAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbi8vIHJldHVybnMgc3RhdGUgb2JqZWN0IHdpdGggdmFsdWVzIGRlcGVuZGluZyBvbiB3aGV0aGVyXG4vLyBpdCBpcyB0aGUgZW5kIG9mIHN0YXRlIGFuZCBpZiB0aGVyZSBpcyBpbml0aWFsUm91dGUgZm9yIHRoaXMgbGV2ZWxcbmNvbnN0IGNyZWF0ZVN0YXRlT2JqZWN0ID0gKFxuICBpbml0aWFsUm91dGU6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgcm91dGU6IFBhcnNlZFJvdXRlLFxuICBpc0VtcHR5OiBib29sZWFuXG4pOiBJbml0aWFsU3RhdGUgPT4ge1xuICBpZiAoaXNFbXB0eSkge1xuICAgIGlmIChpbml0aWFsUm91dGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGluZGV4OiAxLFxuICAgICAgICByb3V0ZXM6IFt7IG5hbWU6IGluaXRpYWxSb3V0ZSB9LCByb3V0ZV0sXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3V0ZXM6IFtyb3V0ZV0sXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoaW5pdGlhbFJvdXRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbmRleDogMSxcbiAgICAgICAgcm91dGVzOiBbeyBuYW1lOiBpbml0aWFsUm91dGUgfSwgeyAuLi5yb3V0ZSwgc3RhdGU6IHsgcm91dGVzOiBbXSB9IH1dLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm91dGVzOiBbeyAuLi5yb3V0ZSwgc3RhdGU6IHsgcm91dGVzOiBbXSB9IH1dLFxuICAgICAgfTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGNyZWF0ZU5lc3RlZFN0YXRlT2JqZWN0ID0gKFxuICBwYXRoOiBzdHJpbmcsXG4gIHJvdXRlczogUGFyc2VkUm91dGVbXSxcbiAgaW5pdGlhbFJvdXRlczogSW5pdGlhbFJvdXRlQ29uZmlnW10sXG4gIGZsYXRDb25maWc/OiBSb3V0ZUNvbmZpZ1tdXG4pID0+IHtcbiAgbGV0IHN0YXRlOiBJbml0aWFsU3RhdGU7XG4gIGxldCByb3V0ZSA9IHJvdXRlcy5zaGlmdCgpIGFzIFBhcnNlZFJvdXRlO1xuICBjb25zdCBwYXJlbnRTY3JlZW5zOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGxldCBpbml0aWFsUm91dGUgPSBmaW5kSW5pdGlhbFJvdXRlKHJvdXRlLm5hbWUsIHBhcmVudFNjcmVlbnMsIGluaXRpYWxSb3V0ZXMpO1xuXG4gIHBhcmVudFNjcmVlbnMucHVzaChyb3V0ZS5uYW1lKTtcblxuICBzdGF0ZSA9IGNyZWF0ZVN0YXRlT2JqZWN0KGluaXRpYWxSb3V0ZSwgcm91dGUsIHJvdXRlcy5sZW5ndGggPT09IDApO1xuXG4gIGlmIChyb3V0ZXMubGVuZ3RoID4gMCkge1xuICAgIGxldCBuZXN0ZWRTdGF0ZSA9IHN0YXRlO1xuXG4gICAgd2hpbGUgKChyb3V0ZSA9IHJvdXRlcy5zaGlmdCgpIGFzIFBhcnNlZFJvdXRlKSkge1xuICAgICAgaW5pdGlhbFJvdXRlID0gZmluZEluaXRpYWxSb3V0ZShyb3V0ZS5uYW1lLCBwYXJlbnRTY3JlZW5zLCBpbml0aWFsUm91dGVzKTtcblxuICAgICAgY29uc3QgbmVzdGVkU3RhdGVJbmRleCA9XG4gICAgICAgIG5lc3RlZFN0YXRlLmluZGV4IHx8IG5lc3RlZFN0YXRlLnJvdXRlcy5sZW5ndGggLSAxO1xuXG4gICAgICBuZXN0ZWRTdGF0ZS5yb3V0ZXNbbmVzdGVkU3RhdGVJbmRleF0uc3RhdGUgPSBjcmVhdGVTdGF0ZU9iamVjdChcbiAgICAgICAgaW5pdGlhbFJvdXRlLFxuICAgICAgICByb3V0ZSxcbiAgICAgICAgcm91dGVzLmxlbmd0aCA9PT0gMFxuICAgICAgKTtcblxuICAgICAgaWYgKHJvdXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG5lc3RlZFN0YXRlID0gbmVzdGVkU3RhdGUucm91dGVzW25lc3RlZFN0YXRlSW5kZXhdXG4gICAgICAgICAgLnN0YXRlIGFzIEluaXRpYWxTdGF0ZTtcbiAgICAgIH1cblxuICAgICAgcGFyZW50U2NyZWVucy5wdXNoKHJvdXRlLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHJvdXRlID0gZmluZEZvY3VzZWRSb3V0ZShzdGF0ZSkgYXMgUGFyc2VkUm91dGU7XG4gIHJvdXRlLnBhdGggPSBwYXRoO1xuXG4gIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlQYXJhbXMoXG4gICAgcGF0aCxcbiAgICBmbGF0Q29uZmlnID8gZmluZFBhcnNlQ29uZmlnRm9yUm91dGUocm91dGUubmFtZSwgZmxhdENvbmZpZykgOiB1bmRlZmluZWRcbiAgKTtcblxuICBpZiAocGFyYW1zKSB7XG4gICAgcm91dGUucGFyYW1zID0geyAuLi5yb3V0ZS5wYXJhbXMsIC4uLnBhcmFtcyB9O1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufTtcblxuY29uc3QgcGFyc2VRdWVyeVBhcmFtcyA9IChcbiAgcGF0aDogc3RyaW5nLFxuICBwYXJzZUNvbmZpZz86IFJlY29yZDxzdHJpbmcsICh2YWx1ZTogc3RyaW5nKSA9PiBhbnk+XG4pID0+IHtcbiAgY29uc3QgcXVlcnkgPSBwYXRoLnNwbGl0KCc/JylbMV07XG4gIGNvbnN0IHBhcmFtcyA9IHF1ZXJ5U3RyaW5nLnBhcnNlKHF1ZXJ5KTtcblxuICBpZiAocGFyc2VDb25maWcpIHtcbiAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgIGlmIChwYXJzZUNvbmZpZ1tuYW1lXSAmJiB0eXBlb2YgcGFyYW1zW25hbWVdID09PSAnc3RyaW5nJykge1xuICAgICAgICBwYXJhbXNbbmFtZV0gPSBwYXJzZUNvbmZpZ1tuYW1lXShwYXJhbXNbbmFtZV0gYXMgc3RyaW5nKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBPYmplY3Qua2V5cyhwYXJhbXMpLmxlbmd0aCA/IHBhcmFtcyA6IHVuZGVmaW5lZDtcbn07XG4iXX0=