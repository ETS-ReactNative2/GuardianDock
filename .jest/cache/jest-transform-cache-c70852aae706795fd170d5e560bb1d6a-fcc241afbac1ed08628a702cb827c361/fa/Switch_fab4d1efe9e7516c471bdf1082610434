064bdd6516c8a6e212288f9a76cd048c
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _Platform = _interopRequireDefault(require("../../Utilities/Platform"));

var React = _interopRequireWildcard(require("react"));

var _StyleSheet = _interopRequireDefault(require("../../StyleSheet/StyleSheet"));

var _useMergeRefs = _interopRequireDefault(require("../../Utilities/useMergeRefs"));

var _AndroidSwitchNativeComponent = _interopRequireWildcard(require("./AndroidSwitchNativeComponent"));

var _SwitchNativeComponent = _interopRequireWildcard(require("./SwitchNativeComponent"));

var _jsxRuntime = require("react/jsx-runtime");

var _excluded = ["disabled", "ios_backgroundColor", "onChange", "onValueChange", "style", "thumbColor", "trackColor", "value"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var returnsFalse = function returnsFalse() {
  return false;
};

var returnsTrue = function returnsTrue() {
  return true;
};

var SwitchWithForwardedRef = React.forwardRef(function Switch(props, forwardedRef) {
  var disabled = props.disabled,
      ios_backgroundColor = props.ios_backgroundColor,
      onChange = props.onChange,
      onValueChange = props.onValueChange,
      style = props.style,
      thumbColor = props.thumbColor,
      trackColor = props.trackColor,
      value = props.value,
      restProps = (0, _objectWithoutProperties2.default)(props, _excluded);
  var trackColorForFalse = trackColor == null ? void 0 : trackColor.false;
  var trackColorForTrue = trackColor == null ? void 0 : trackColor.true;
  var nativeSwitchRef = React.useRef(null);
  var ref = (0, _useMergeRefs.default)(nativeSwitchRef, forwardedRef);

  var _React$useState = React.useState({
    value: null
  }),
      _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 2),
      native = _React$useState2[0],
      setNative = _React$useState2[1];

  var handleChange = function handleChange(event) {
    onChange == null ? void 0 : onChange(event);
    onValueChange == null ? void 0 : onValueChange(event.nativeEvent.value);
    setNative({
      value: event.nativeEvent.value
    });
  };

  React.useLayoutEffect(function () {
    var _nativeSwitchRef$curr;

    var jsValue = value === true;
    var shouldUpdateNativeSwitch = native.value != null && native.value !== jsValue;

    if (shouldUpdateNativeSwitch && ((_nativeSwitchRef$curr = nativeSwitchRef.current) == null ? void 0 : _nativeSwitchRef$curr.setNativeProps) != null) {
      if (_Platform.default.OS === 'android') {
        _AndroidSwitchNativeComponent.Commands.setNativeValue(nativeSwitchRef.current, jsValue);
      } else {
        _SwitchNativeComponent.Commands.setValue(nativeSwitchRef.current, jsValue);
      }
    }
  }, [value, native]);

  if (_Platform.default.OS === 'android') {
    var _props$accessibilityR;

    var platformProps = {
      enabled: disabled !== true,
      on: value === true,
      style: style,
      thumbTintColor: thumbColor,
      trackColorForFalse: trackColorForFalse,
      trackColorForTrue: trackColorForTrue,
      trackTintColor: value === true ? trackColorForTrue : trackColorForFalse
    };
    return (0, _jsxRuntime.jsx)(_AndroidSwitchNativeComponent.default, (0, _extends2.default)({}, restProps, platformProps, {
      accessibilityRole: (_props$accessibilityR = props.accessibilityRole) != null ? _props$accessibilityR : 'switch',
      onChange: handleChange,
      onResponderTerminationRequest: returnsFalse,
      onStartShouldSetResponder: returnsTrue,
      ref: ref
    }));
  } else {
    var _props$accessibilityR2;

    var _platformProps = {
      disabled: disabled,
      onTintColor: trackColorForTrue,
      style: _StyleSheet.default.compose({
        height: 31,
        width: 51
      }, _StyleSheet.default.compose(style, ios_backgroundColor == null ? null : {
        backgroundColor: ios_backgroundColor,
        borderRadius: 16
      })),
      thumbTintColor: thumbColor,
      tintColor: trackColorForFalse,
      value: value === true
    };
    return (0, _jsxRuntime.jsx)(_SwitchNativeComponent.default, (0, _extends2.default)({}, restProps, _platformProps, {
      accessibilityRole: (_props$accessibilityR2 = props.accessibilityRole) != null ? _props$accessibilityR2 : 'switch',
      onChange: handleChange,
      onResponderTerminationRequest: returnsFalse,
      onStartShouldSetResponder: returnsTrue,
      ref: ref
    }));
  }
});
var _default = SwitchWithForwardedRef;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN3aXRjaC5qcyJdLCJuYW1lcyI6WyJyZXR1cm5zRmFsc2UiLCJyZXR1cm5zVHJ1ZSIsIlN3aXRjaFdpdGhGb3J3YXJkZWRSZWYiLCJSZWFjdCIsImZvcndhcmRSZWYiLCJTd2l0Y2giLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsImRpc2FibGVkIiwiaW9zX2JhY2tncm91bmRDb2xvciIsIm9uQ2hhbmdlIiwib25WYWx1ZUNoYW5nZSIsInN0eWxlIiwidGh1bWJDb2xvciIsInRyYWNrQ29sb3IiLCJ2YWx1ZSIsInJlc3RQcm9wcyIsInRyYWNrQ29sb3JGb3JGYWxzZSIsImZhbHNlIiwidHJhY2tDb2xvckZvclRydWUiLCJ0cnVlIiwibmF0aXZlU3dpdGNoUmVmIiwidXNlUmVmIiwicmVmIiwidXNlU3RhdGUiLCJuYXRpdmUiLCJzZXROYXRpdmUiLCJoYW5kbGVDaGFuZ2UiLCJldmVudCIsIm5hdGl2ZUV2ZW50IiwidXNlTGF5b3V0RWZmZWN0IiwianNWYWx1ZSIsInNob3VsZFVwZGF0ZU5hdGl2ZVN3aXRjaCIsImN1cnJlbnQiLCJzZXROYXRpdmVQcm9wcyIsIlBsYXRmb3JtIiwiT1MiLCJBbmRyb2lkU3dpdGNoQ29tbWFuZHMiLCJzZXROYXRpdmVWYWx1ZSIsIlN3aXRjaENvbW1hbmRzIiwic2V0VmFsdWUiLCJwbGF0Zm9ybVByb3BzIiwiZW5hYmxlZCIsIm9uIiwidGh1bWJUaW50Q29sb3IiLCJ0cmFja1RpbnRDb2xvciIsImFjY2Vzc2liaWxpdHlSb2xlIiwib25UaW50Q29sb3IiLCJTdHlsZVNoZWV0IiwiY29tcG9zZSIsImhlaWdodCIsIndpZHRoIiwiYmFja2dyb3VuZENvbG9yIiwiYm9yZGVyUmFkaXVzIiwidGludENvbG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBV0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBR0E7Ozs7Ozs7Ozs7QUFxRUEsSUFBTUEsWUFBWSxHQUFHLFNBQWZBLFlBQWU7QUFBQSxTQUFNLEtBQU47QUFBQSxD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NkIsUUFIaEQ7QUFJRSxNQUFBLFFBQVEsRUFBRW5CLFlBSlo7QUFLRSxNQUFBLDZCQUE2QixFQUFFM0IsWUFMakM7QUFNRSxNQUFBLHlCQUF5QixFQUFFQyxXQU43QjtBQU9FLE1BQUEsR0FBRyxFQUFFc0I7QUFQUCxPQURGO0FBV0Q7QUFDRixDQXZHRyxDQUxKO2VBOEdlckIsc0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICogQGdlbmVyYXRlLWRvY3NcbiAqL1xuXG5pbXBvcnQgUGxhdGZvcm0gZnJvbSAnLi4vLi4vVXRpbGl0aWVzL1BsYXRmb3JtJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBTdHlsZVNoZWV0IGZyb20gJy4uLy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCc7XG5pbXBvcnQgdXNlTWVyZ2VSZWZzIGZyb20gJy4uLy4uL1V0aWxpdGllcy91c2VNZXJnZVJlZnMnO1xuXG5pbXBvcnQgQW5kcm9pZFN3aXRjaE5hdGl2ZUNvbXBvbmVudCwge1xuICBDb21tYW5kcyBhcyBBbmRyb2lkU3dpdGNoQ29tbWFuZHMsXG59IGZyb20gJy4vQW5kcm9pZFN3aXRjaE5hdGl2ZUNvbXBvbmVudCc7XG5pbXBvcnQgU3dpdGNoTmF0aXZlQ29tcG9uZW50LCB7XG4gIENvbW1hbmRzIGFzIFN3aXRjaENvbW1hbmRzLFxufSBmcm9tICcuL1N3aXRjaE5hdGl2ZUNvbXBvbmVudCc7XG5cbmltcG9ydCB0eXBlIHtDb2xvclZhbHVlfSBmcm9tICcuLi8uLi9TdHlsZVNoZWV0L1N0eWxlU2hlZXQnO1xuaW1wb3J0IHR5cGUge1N5bnRoZXRpY0V2ZW50fSBmcm9tICcuLi8uLi9UeXBlcy9Db3JlRXZlbnRUeXBlcyc7XG5pbXBvcnQgdHlwZSB7Vmlld1Byb3BzfSBmcm9tICcuLi9WaWV3L1ZpZXdQcm9wVHlwZXMnO1xuXG50eXBlIFN3aXRjaENoYW5nZUV2ZW50ID0gU3ludGhldGljRXZlbnQ8XG4gICRSZWFkT25seTx7fFxuICAgIHZhbHVlOiBib29sZWFuLFxuICB8fT4sXG4+O1xuXG5leHBvcnQgdHlwZSBQcm9wcyA9ICRSZWFkT25seTx7fFxuICAuLi5WaWV3UHJvcHMsXG5cbiAgLyoqXG4gICAgSWYgdHJ1ZSB0aGUgdXNlciB3b24ndCBiZSBhYmxlIHRvIHRvZ2dsZSB0aGUgc3dpdGNoLlxuXG4gICAgQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIGRpc2FibGVkPzogP2Jvb2xlYW4sXG5cbiAgLyoqXG4gICAgVGhlIHZhbHVlIG9mIHRoZSBzd2l0Y2guIElmIHRydWUgdGhlIHN3aXRjaCB3aWxsIGJlIHR1cm5lZCBvbi5cblxuICAgIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB2YWx1ZT86ID9ib29sZWFuLFxuXG4gIC8qKlxuICAgIENvbG9yIG9mIHRoZSBmb3JlZ3JvdW5kIHN3aXRjaCBncmlwLiBJZiB0aGlzIGlzIHNldCBvbiBpT1MsIHRoZSBzd2l0Y2ggZ3JpcCB3aWxsIGxvc2UgaXRzIGRyb3Agc2hhZG93LlxuICAgKi9cbiAgdGh1bWJDb2xvcj86ID9Db2xvclZhbHVlLFxuXG4gIC8qKlxuICAgIEN1c3RvbSBjb2xvcnMgZm9yIHRoZSBzd2l0Y2ggdHJhY2suXG5cbiAgICBfaU9TXzogV2hlbiB0aGUgc3dpdGNoIHZhbHVlIGlzIGZhbHNlLCB0aGUgdHJhY2sgc2hyaW5rcyBpbnRvIHRoZSBib3JkZXIuIElmIHlvdSB3YW50IHRvIGNoYW5nZSB0aGVcbiAgICBjb2xvciBvZiB0aGUgYmFja2dyb3VuZCBleHBvc2VkIGJ5IHRoZSBzaHJ1bmtlbiB0cmFjaywgdXNlXG4gICAgIFtgaW9zX2JhY2tncm91bmRDb2xvcmBdKGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3Mvc3dpdGNoI2lvc19iYWNrZ3JvdW5kQ29sb3IpLlxuICAgKi9cbiAgdHJhY2tDb2xvcj86ID8kUmVhZE9ubHk8e3xcbiAgICBmYWxzZT86ID9Db2xvclZhbHVlLFxuICAgIHRydWU/OiA/Q29sb3JWYWx1ZSxcbiAgfH0+LFxuXG4gIC8qKlxuICAgIE9uIGlPUywgY3VzdG9tIGNvbG9yIGZvciB0aGUgYmFja2dyb3VuZC4gVGhpcyBiYWNrZ3JvdW5kIGNvbG9yIGNhbiBiZVxuICAgIHNlZW4gZWl0aGVyIHdoZW4gdGhlIHN3aXRjaCB2YWx1ZSBpcyBmYWxzZSBvciB3aGVuIHRoZSBzd2l0Y2ggaXNcbiAgICBkaXNhYmxlZCAoYW5kIHRoZSBzd2l0Y2ggaXMgdHJhbnNsdWNlbnQpLlxuICAgKi9cbiAgaW9zX2JhY2tncm91bmRDb2xvcj86ID9Db2xvclZhbHVlLFxuXG4gIC8qKlxuICAgIEludm9rZWQgd2hlbiB0aGUgdXNlciB0cmllcyB0byBjaGFuZ2UgdGhlIHZhbHVlIG9mIHRoZSBzd2l0Y2guIFJlY2VpdmVzXG4gICAgdGhlIGNoYW5nZSBldmVudCBhcyBhbiBhcmd1bWVudC4gSWYgeW91IHdhbnQgdG8gb25seSByZWNlaXZlIHRoZSBuZXdcbiAgICB2YWx1ZSwgdXNlIGBvblZhbHVlQ2hhbmdlYCBpbnN0ZWFkLlxuICAgKi9cbiAgb25DaGFuZ2U/OiA/KGV2ZW50OiBTd2l0Y2hDaGFuZ2VFdmVudCkgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWQsXG5cbiAgLyoqXG4gICAgSW52b2tlZCB3aGVuIHRoZSB1c2VyIHRyaWVzIHRvIGNoYW5nZSB0aGUgdmFsdWUgb2YgdGhlIHN3aXRjaC4gUmVjZWl2ZXNcbiAgICB0aGUgbmV3IHZhbHVlIGFzIGFuIGFyZ3VtZW50LiBJZiB5b3Ugd2FudCB0byBpbnN0ZWFkIHJlY2VpdmUgYW4gZXZlbnQsXG4gICAgdXNlIGBvbkNoYW5nZWAuXG4gICAqL1xuICBvblZhbHVlQ2hhbmdlPzogPyh2YWx1ZTogYm9vbGVhbikgPT4gUHJvbWlzZTx2b2lkPiB8IHZvaWQsXG58fT47XG5jb25zdCByZXR1cm5zRmFsc2UgPSAoKSA9PiBmYWxzZTtcbmNvbnN0IHJldHVybnNUcnVlID0gKCkgPT4gdHJ1ZTtcblxuLyoqXG4gIFJlbmRlcnMgYSBib29sZWFuIGlucHV0LlxuXG4gIFRoaXMgaXMgYSBjb250cm9sbGVkIGNvbXBvbmVudCB0aGF0IHJlcXVpcmVzIGFuIGBvblZhbHVlQ2hhbmdlYFxuICBjYWxsYmFjayB0aGF0IHVwZGF0ZXMgdGhlIGB2YWx1ZWAgcHJvcCBpbiBvcmRlciBmb3IgdGhlIGNvbXBvbmVudCB0b1xuICByZWZsZWN0IHVzZXIgYWN0aW9ucy4gSWYgdGhlIGB2YWx1ZWAgcHJvcCBpcyBub3QgdXBkYXRlZCwgdGhlXG4gIGNvbXBvbmVudCB3aWxsIGNvbnRpbnVlIHRvIHJlbmRlciB0aGUgc3VwcGxpZWQgYHZhbHVlYCBwcm9wIGluc3RlYWQgb2ZcbiAgdGhlIGV4cGVjdGVkIHJlc3VsdCBvZiBhbnkgdXNlciBhY3Rpb25zLlxuXG4gIGBgYFNuYWNrUGxheWVyIG5hbWU9U3dpdGNoXG4gIGltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuICBpbXBvcnQgeyBWaWV3LCBTd2l0Y2gsIFN0eWxlU2hlZXQgfSBmcm9tIFwicmVhY3QtbmF0aXZlXCI7XG5cbiAgY29uc3QgQXBwID0gKCkgPT4ge1xuICAgIGNvbnN0IFtpc0VuYWJsZWQsIHNldElzRW5hYmxlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgdG9nZ2xlU3dpdGNoID0gKCkgPT4gc2V0SXNFbmFibGVkKHByZXZpb3VzU3RhdGUgPT4gIXByZXZpb3VzU3RhdGUpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IHN0eWxlPXtzdHlsZXMuY29udGFpbmVyfT5cbiAgICAgICAgPFN3aXRjaFxuICAgICAgICAgIHRyYWNrQ29sb3I9e3sgZmFsc2U6IFwiIzc2NzU3N1wiLCB0cnVlOiBcIiM4MWIwZmZcIiB9fVxuICAgICAgICAgIHRodW1iQ29sb3I9e2lzRW5hYmxlZCA/IFwiI2Y1ZGQ0YlwiIDogXCIjZjRmM2Y0XCJ9XG4gICAgICAgICAgaW9zX2JhY2tncm91bmRDb2xvcj1cIiMzZTNlM2VcIlxuICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e3RvZ2dsZVN3aXRjaH1cbiAgICAgICAgICB2YWx1ZT17aXNFbmFibGVkfVxuICAgICAgICAvPlxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICBjb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gICAgY29udGFpbmVyOiB7XG4gICAgICBmbGV4OiAxLFxuICAgICAgYWxpZ25JdGVtczogXCJjZW50ZXJcIixcbiAgICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiXG4gICAgfVxuICB9KTtcblxuICBleHBvcnQgZGVmYXVsdCBBcHA7XG4gIGBgYFxuICovXG5cbmNvbnN0IFN3aXRjaFdpdGhGb3J3YXJkZWRSZWY6IFJlYWN0LkFic3RyYWN0Q29tcG9uZW50PFxuICBQcm9wcyxcbiAgUmVhY3QuRWxlbWVudFJlZjxcbiAgICB0eXBlb2YgU3dpdGNoTmF0aXZlQ29tcG9uZW50IHwgdHlwZW9mIEFuZHJvaWRTd2l0Y2hOYXRpdmVDb21wb25lbnQsXG4gID4sXG4+ID0gUmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBTd2l0Y2gocHJvcHMsIGZvcndhcmRlZFJlZik6IFJlYWN0Lk5vZGUge1xuICBjb25zdCB7XG4gICAgZGlzYWJsZWQsXG4gICAgaW9zX2JhY2tncm91bmRDb2xvcixcbiAgICBvbkNoYW5nZSxcbiAgICBvblZhbHVlQ2hhbmdlLFxuICAgIHN0eWxlLFxuICAgIHRodW1iQ29sb3IsXG4gICAgdHJhY2tDb2xvcixcbiAgICB2YWx1ZSxcbiAgICAuLi5yZXN0UHJvcHNcbiAgfSA9IHByb3BzO1xuICBjb25zdCB0cmFja0NvbG9yRm9yRmFsc2UgPSB0cmFja0NvbG9yPy5mYWxzZTtcbiAgY29uc3QgdHJhY2tDb2xvckZvclRydWUgPSB0cmFja0NvbG9yPy50cnVlO1xuXG4gIGNvbnN0IG5hdGl2ZVN3aXRjaFJlZiA9IFJlYWN0LnVzZVJlZjxSZWFjdC5FbGVtZW50UmVmPFxuICAgIHR5cGVvZiBTd2l0Y2hOYXRpdmVDb21wb25lbnQgfCB0eXBlb2YgQW5kcm9pZFN3aXRjaE5hdGl2ZUNvbXBvbmVudCxcbiAgPiB8IG51bGw+KG51bGwpO1xuXG4gIGNvbnN0IHJlZiA9IHVzZU1lcmdlUmVmcyhuYXRpdmVTd2l0Y2hSZWYsIGZvcndhcmRlZFJlZik7XG5cbiAgY29uc3QgW25hdGl2ZSwgc2V0TmF0aXZlXSA9IFJlYWN0LnVzZVN0YXRlKHt2YWx1ZTogbnVsbH0pO1xuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZSA9IChldmVudDogU3dpdGNoQ2hhbmdlRXZlbnQpID0+IHtcbiAgICBvbkNoYW5nZT8uKGV2ZW50KTtcbiAgICBvblZhbHVlQ2hhbmdlPy4oZXZlbnQubmF0aXZlRXZlbnQudmFsdWUpO1xuICAgIHNldE5hdGl2ZSh7dmFsdWU6IGV2ZW50Lm5hdGl2ZUV2ZW50LnZhbHVlfSk7XG4gIH07XG5cbiAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSBpbiBjYXNlIG5hdGl2ZSB1cGRhdGVzIHRoZSBzd2l0Y2ggYW5kIEpTIGRlY2lkZXNcbiAgICAvLyB0aGF0IHRoZSB1cGRhdGUgc2hvdWxkIGJlIGlnbm9yZWQgYW5kIHdlIHNob3VsZCBzdGljayB3aXRoIHRoZSB2YWx1ZVxuICAgIC8vIHRoYXQgd2UgaGF2ZSBpbiBKUy5cbiAgICBjb25zdCBqc1ZhbHVlID0gdmFsdWUgPT09IHRydWU7XG4gICAgY29uc3Qgc2hvdWxkVXBkYXRlTmF0aXZlU3dpdGNoID1cbiAgICAgIG5hdGl2ZS52YWx1ZSAhPSBudWxsICYmIG5hdGl2ZS52YWx1ZSAhPT0ganNWYWx1ZTtcbiAgICBpZiAoXG4gICAgICBzaG91bGRVcGRhdGVOYXRpdmVTd2l0Y2ggJiZcbiAgICAgIG5hdGl2ZVN3aXRjaFJlZi5jdXJyZW50Py5zZXROYXRpdmVQcm9wcyAhPSBudWxsXG4gICAgKSB7XG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgICBBbmRyb2lkU3dpdGNoQ29tbWFuZHMuc2V0TmF0aXZlVmFsdWUobmF0aXZlU3dpdGNoUmVmLmN1cnJlbnQsIGpzVmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgU3dpdGNoQ29tbWFuZHMuc2V0VmFsdWUobmF0aXZlU3dpdGNoUmVmLmN1cnJlbnQsIGpzVmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW3ZhbHVlLCBuYXRpdmVdKTtcblxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgIGNvbnN0IHBsYXRmb3JtUHJvcHMgPSB7XG4gICAgICBlbmFibGVkOiBkaXNhYmxlZCAhPT0gdHJ1ZSxcbiAgICAgIG9uOiB2YWx1ZSA9PT0gdHJ1ZSxcbiAgICAgIHN0eWxlLFxuICAgICAgdGh1bWJUaW50Q29sb3I6IHRodW1iQ29sb3IsXG4gICAgICB0cmFja0NvbG9yRm9yRmFsc2U6IHRyYWNrQ29sb3JGb3JGYWxzZSxcbiAgICAgIHRyYWNrQ29sb3JGb3JUcnVlOiB0cmFja0NvbG9yRm9yVHJ1ZSxcbiAgICAgIHRyYWNrVGludENvbG9yOiB2YWx1ZSA9PT0gdHJ1ZSA/IHRyYWNrQ29sb3JGb3JUcnVlIDogdHJhY2tDb2xvckZvckZhbHNlLFxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEFuZHJvaWRTd2l0Y2hOYXRpdmVDb21wb25lbnRcbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgICAgey4uLnBsYXRmb3JtUHJvcHN9XG4gICAgICAgIGFjY2Vzc2liaWxpdHlSb2xlPXtwcm9wcy5hY2Nlc3NpYmlsaXR5Um9sZSA/PyAnc3dpdGNoJ31cbiAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cbiAgICAgICAgb25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q9e3JldHVybnNGYWxzZX1cbiAgICAgICAgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcj17cmV0dXJuc1RydWV9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgLz5cbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHBsYXRmb3JtUHJvcHMgPSB7XG4gICAgICBkaXNhYmxlZCxcbiAgICAgIG9uVGludENvbG9yOiB0cmFja0NvbG9yRm9yVHJ1ZSxcbiAgICAgIHN0eWxlOiBTdHlsZVNoZWV0LmNvbXBvc2UoXG4gICAgICAgIHtoZWlnaHQ6IDMxLCB3aWR0aDogNTF9LFxuICAgICAgICBTdHlsZVNoZWV0LmNvbXBvc2UoXG4gICAgICAgICAgc3R5bGUsXG4gICAgICAgICAgaW9zX2JhY2tncm91bmRDb2xvciA9PSBudWxsXG4gICAgICAgICAgICA/IG51bGxcbiAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaW9zX2JhY2tncm91bmRDb2xvcixcbiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDE2LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIHRodW1iVGludENvbG9yOiB0aHVtYkNvbG9yLFxuICAgICAgdGludENvbG9yOiB0cmFja0NvbG9yRm9yRmFsc2UsXG4gICAgICB2YWx1ZTogdmFsdWUgPT09IHRydWUsXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3dpdGNoTmF0aXZlQ29tcG9uZW50XG4gICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICAgIHsuLi5wbGF0Zm9ybVByb3BzfVxuICAgICAgICBhY2Nlc3NpYmlsaXR5Um9sZT17cHJvcHMuYWNjZXNzaWJpbGl0eVJvbGUgPz8gJ3N3aXRjaCd9XG4gICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9XG4gICAgICAgIG9uUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0PXtyZXR1cm5zRmFsc2V9XG4gICAgICAgIG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXI9e3JldHVybnNUcnVlfVxuICAgICAgICByZWY9e3JlZn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IFN3aXRjaFdpdGhGb3J3YXJkZWRSZWY7XG4iXX0=