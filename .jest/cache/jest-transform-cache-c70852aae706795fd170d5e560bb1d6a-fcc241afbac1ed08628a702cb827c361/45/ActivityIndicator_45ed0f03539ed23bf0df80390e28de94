fa1df484c0ddfbdcfc84e6aaf3cf6c07
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends3 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["animating", "color", "hidesWhenStopped", "size", "style", "theme"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _theming = require("../core/theming");

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

var DURATION = 2400;

var ActivityIndicator = function ActivityIndicator(_ref) {
  var _ref$animating = _ref.animating,
      animating = _ref$animating === void 0 ? true : _ref$animating,
      indicatorColor = _ref.color,
      _ref$hidesWhenStopped = _ref.hidesWhenStopped,
      hidesWhenStopped = _ref$hidesWhenStopped === void 0 ? true : _ref$hidesWhenStopped,
      _ref$size = _ref.size,
      indicatorSize = _ref$size === void 0 ? 'small' : _ref$size,
      style = _ref.style,
      theme = _ref.theme,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);

  var _React$useRef = React.useRef(new _reactNative.Animated.Value(0)),
      timer = _React$useRef.current;

  var _React$useRef2 = React.useRef(new _reactNative.Animated.Value(!animating && hidesWhenStopped ? 0 : 1)),
      fade = _React$useRef2.current;

  var rotation = React.useRef(undefined);
  var scale = theme.animation.scale;
  var startRotation = React.useCallback(function () {
    _reactNative.Animated.timing(fade, {
      duration: 200 * scale,
      toValue: 1,
      isInteraction: false,
      useNativeDriver: true
    }).start();

    if (rotation.current) {
      timer.setValue(0);

      _reactNative.Animated.loop(rotation.current).start();
    }
  }, [scale, fade, timer]);

  var stopRotation = function stopRotation() {
    if (rotation.current) {
      rotation.current.stop();
    }
  };

  React.useEffect(function () {
    if (rotation.current === undefined) {
      rotation.current = _reactNative.Animated.timing(timer, {
        duration: DURATION,
        easing: _reactNative.Easing.linear,
        useNativeDriver: _reactNative.Platform.OS !== 'web',
        toValue: 1,
        isInteraction: false
      });
    }

    if (animating) {
      startRotation();
    } else if (hidesWhenStopped) {
      _reactNative.Animated.timing(fade, {
        duration: 200 * scale,
        toValue: 0,
        useNativeDriver: true,
        isInteraction: false
      }).start(stopRotation);
    } else {
      stopRotation();
    }
  }, [animating, fade, hidesWhenStopped, startRotation, scale, timer]);
  var color = indicatorColor || theme.colors.primary;
  var size = typeof indicatorSize === 'string' ? indicatorSize === 'small' ? 24 : 48 : indicatorSize ? indicatorSize : 24;
  var frames = 60 * DURATION / 1000;

  var easing = _reactNative.Easing.bezier(0.4, 0.0, 0.7, 1.0);

  var containerStyle = {
    width: size,
    height: size / 2,
    overflow: 'hidden'
  };
  return React.createElement(_reactNative.View, _extends({
    style: [styles.container, style]
  }, rest, {
    accessible: true,
    accessibilityRole: "progressbar",
    accessibilityState: {
      busy: animating
    }
  }), React.createElement(_reactNative.Animated.View, {
    style: [{
      width: size,
      height: size,
      opacity: fade
    }],
    collapsable: false
  }, [0, 1].map(function (index) {
    var inputRange = Array.from(new Array(frames), function (_, frameIndex) {
      return frameIndex / (frames - 1);
    });
    var outputRange = Array.from(new Array(frames), function (_, frameIndex) {
      var progress = 2 * frameIndex / (frames - 1);
      var rotation = index ? +(360 - 15) : -(180 - 15);

      if (progress > 1.0) {
        progress = 2.0 - progress;
      }

      var direction = index ? -1 : +1;
      return direction * (180 - 30) * easing(progress) + rotation + "deg";
    });
    var layerStyle = {
      width: size,
      height: size,
      transform: [{
        rotate: timer.interpolate({
          inputRange: [0, 1],
          outputRange: [0 + 30 + 15 + "deg", 2 * 360 + 30 + 15 + "deg"]
        })
      }]
    };
    var viewportStyle = {
      width: size,
      height: size,
      transform: [{
        translateY: index ? -size / 2 : 0
      }, {
        rotate: timer.interpolate({
          inputRange: inputRange,
          outputRange: outputRange
        })
      }]
    };
    var offsetStyle = index ? {
      top: size / 2
    } : null;
    var lineStyle = {
      width: size,
      height: size,
      borderColor: color,
      borderWidth: size / 10,
      borderRadius: size / 2
    };
    return React.createElement(_reactNative.Animated.View, {
      key: index,
      style: [styles.layer]
    }, React.createElement(_reactNative.Animated.View, {
      style: layerStyle
    }, React.createElement(_reactNative.Animated.View, {
      style: [containerStyle, offsetStyle],
      collapsable: false
    }, React.createElement(_reactNative.Animated.View, {
      style: viewportStyle
    }, React.createElement(_reactNative.Animated.View, {
      style: containerStyle,
      collapsable: false
    }, React.createElement(_reactNative.Animated.View, {
      style: lineStyle
    }))))));
  })));
};

var styles = _reactNative.StyleSheet.create({
  container: {
    justifyContent: 'center',
    alignItems: 'center'
  },
  layer: (0, _extends3.default)({}, _reactNative.StyleSheet.absoluteFillObject, {
    justifyContent: 'center',
    alignItems: 'center'
  })
});

var _default = (0, _theming.withTheme)(ActivityIndicator);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNvQyxjQUFELEVBQWlCOEIsV0FBakIsQ0FEVDtBQUVFakIsaUJBQVcsRUFBRTtBQUZmLE9BSUU5QyxvQkFBQ3FDLHNCQUFTTyxJQUFWO0FBQWUvQyxXQUFLLEVBQUVnRTtBQUF0QixPQUNFN0Qsb0JBQUNxQyxzQkFBU08sSUFBVjtBQUFlL0MsV0FBSyxFQUFFb0MsY0FBdEI7QUFBc0NhLGlCQUFXLEVBQUU7QUFBbkQsT0FDRTlDLG9CQUFDcUMsc0JBQVNPLElBQVY7QUFBZS9DLFdBQUssRUFBRW9FO0FBQXRCLE1BREYsQ0FERixDQUpGLENBREYsQ0FERixDQURGO0FBdkRELElBSkgsQ0FQRixDQURGO0FBN0ZGOztBQXNMQSxJQUFNM0IsTUFBTSxHQUFHaUMsd0JBQVdDLE1BQVhELENBQWtCO0FBQy9CaEMsV0FBUyxFQUFFO0FBQ1RrQyxrQkFBYyxFQUFFLFFBRFA7QUFFVEMsY0FBVSxFQUFFO0FBRkgsR0FEb0I7QUFNL0JKLE9BQUssNkJBQ0FDLHdCQUFXSSxrQkFEWDtBQUdIRixrQkFBYyxFQUFFLFFBSGI7QUFJSEMsY0FBVSxFQUFFO0FBSlQ7QUFOMEIsQ0FBbEJILENBQWY7O2VBY2Usd0JBQVVqRixpQkFBViIsIm5hbWVzIjpbIkRVUkFUSU9OIiwiQWN0aXZpdHlJbmRpY2F0b3IiLCJhbmltYXRpbmciLCJpbmRpY2F0b3JDb2xvciIsImNvbG9yIiwiaGlkZXNXaGVuU3RvcHBlZCIsInNpemUiLCJpbmRpY2F0b3JTaXplIiwic3R5bGUiLCJ0aGVtZSIsInJlc3QiLCJSZWFjdCIsInVzZVJlZiIsIkFuaW1hdGVkIiwiVmFsdWUiLCJ0aW1lciIsImN1cnJlbnQiLCJmYWRlIiwicm90YXRpb24iLCJ1bmRlZmluZWQiLCJzY2FsZSIsImFuaW1hdGlvbiIsInN0YXJ0Um90YXRpb24iLCJ1c2VDYWxsYmFjayIsInRpbWluZyIsImR1cmF0aW9uIiwidG9WYWx1ZSIsImlzSW50ZXJhY3Rpb24iLCJ1c2VOYXRpdmVEcml2ZXIiLCJzdGFydCIsInNldFZhbHVlIiwibG9vcCIsInN0b3BSb3RhdGlvbiIsInN0b3AiLCJ1c2VFZmZlY3QiLCJlYXNpbmciLCJFYXNpbmciLCJsaW5lYXIiLCJQbGF0Zm9ybSIsIk9TIiwiY29sb3JzIiwicHJpbWFyeSIsImZyYW1lcyIsImJlemllciIsImNvbnRhaW5lclN0eWxlIiwid2lkdGgiLCJoZWlnaHQiLCJvdmVyZmxvdyIsIl9yZWFjdE5hdGl2ZSIsInN0eWxlcyIsImNvbnRhaW5lciIsImFjY2Vzc2libGUiLCJhY2Nlc3NpYmlsaXR5Um9sZSIsImFjY2Vzc2liaWxpdHlTdGF0ZSIsImJ1c3kiLCJWaWV3Iiwib3BhY2l0eSIsImNvbGxhcHNhYmxlIiwibWFwIiwiaW5kZXgiLCJpbnB1dFJhbmdlIiwiQXJyYXkiLCJmcm9tIiwiXyIsImZyYW1lSW5kZXgiLCJvdXRwdXRSYW5nZSIsInByb2dyZXNzIiwiZGlyZWN0aW9uIiwibGF5ZXJTdHlsZSIsInRyYW5zZm9ybSIsInJvdGF0ZSIsImludGVycG9sYXRlIiwidmlld3BvcnRTdHlsZSIsInRyYW5zbGF0ZVkiLCJvZmZzZXRTdHlsZSIsInRvcCIsImxpbmVTdHlsZSIsImJvcmRlckNvbG9yIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJrZXkiLCJsYXllciIsIlN0eWxlU2hlZXQiLCJjcmVhdGUiLCJqdXN0aWZ5Q29udGVudCIsImFsaWduSXRlbXMiLCJhYnNvbHV0ZUZpbGxPYmplY3QiXSwic291cmNlcyI6WyJBY3Rpdml0eUluZGljYXRvci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQW5pbWF0ZWQsXG4gIEVhc2luZyxcbiAgUGxhdGZvcm0sXG4gIFN0eWxlUHJvcCxcbiAgU3R5bGVTaGVldCxcbiAgVmlldyxcbiAgVmlld1N0eWxlLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IHsgd2l0aFRoZW1lIH0gZnJvbSAnLi4vY29yZS90aGVtaW5nJztcblxudHlwZSBQcm9wcyA9IFJlYWN0LkNvbXBvbmVudFByb3BzV2l0aFJlZjx0eXBlb2YgVmlldz4gJiB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHNob3cgdGhlIGluZGljYXRvciBvciBoaWRlIGl0LlxuICAgKi9cbiAgYW5pbWF0aW5nPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFRoZSBjb2xvciBvZiB0aGUgc3Bpbm5lci5cbiAgICovXG4gIGNvbG9yPzogc3RyaW5nO1xuICAvKipcbiAgICogU2l6ZSBvZiB0aGUgaW5kaWNhdG9yLlxuICAgKi9cbiAgc2l6ZT86ICdzbWFsbCcgfCAnbGFyZ2UnIHwgbnVtYmVyO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgaW5kaWNhdG9yIHNob3VsZCBoaWRlIHdoZW4gbm90IGFuaW1hdGluZy5cbiAgICovXG4gIGhpZGVzV2hlblN0b3BwZWQ/OiBib29sZWFuO1xuICBzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqL1xuICB0aGVtZTogUmVhY3ROYXRpdmVQYXBlci5UaGVtZTtcbn07XG5cbmNvbnN0IERVUkFUSU9OID0gMjQwMDtcblxuLyoqXG4gKiBBY3Rpdml0eSBpbmRpY2F0b3IgaXMgdXNlZCB0byBwcmVzZW50IHByb2dyZXNzIG9mIHNvbWUgYWN0aXZpdHkgaW4gdGhlIGFwcC5cbiAqIEl0IGNhbiBiZSB1c2VkIGFzIGEgZHJvcC1pbiBmb3IgdGhlIEFjdGl2aXR5SW5kaWNhdG9yIHNoaXBwZWQgd2l0aCBSZWFjdCBOYXRpdmUuXG4gKlxuICogPGRpdiBjbGFzcz1cInNjcmVlbnNob3RzXCI+XG4gKiAgIDxpbWcgc3JjPVwic2NyZWVuc2hvdHMvYWN0aXZpdHktaW5kaWNhdG9yLmdpZlwiIHN0eWxlPVwid2lkdGg6IDEwMHB4O1wiIC8+XG4gKiA8L2Rpdj5cbiAqXG4gKiAjIyBVc2FnZVxuICogYGBganNcbiAqIGltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbiAqIGltcG9ydCB7IEFjdGl2aXR5SW5kaWNhdG9yLCBDb2xvcnMgfSBmcm9tICdyZWFjdC1uYXRpdmUtcGFwZXInO1xuICpcbiAqIGNvbnN0IE15Q29tcG9uZW50ID0gKCkgPT4gKFxuICogICA8QWN0aXZpdHlJbmRpY2F0b3IgYW5pbWF0aW5nPXt0cnVlfSBjb2xvcj17Q29sb3JzLnJlZDgwMH0gLz5cbiAqICk7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgTXlDb21wb25lbnQ7XG4gKiBgYGBcbiAqL1xuY29uc3QgQWN0aXZpdHlJbmRpY2F0b3IgPSAoe1xuICBhbmltYXRpbmcgPSB0cnVlLFxuICBjb2xvcjogaW5kaWNhdG9yQ29sb3IsXG4gIGhpZGVzV2hlblN0b3BwZWQgPSB0cnVlLFxuICBzaXplOiBpbmRpY2F0b3JTaXplID0gJ3NtYWxsJyxcbiAgc3R5bGUsXG4gIHRoZW1lLFxuICAuLi5yZXN0XG59OiBQcm9wcykgPT4ge1xuICBjb25zdCB7IGN1cnJlbnQ6IHRpbWVyIH0gPSBSZWFjdC51c2VSZWY8QW5pbWF0ZWQuVmFsdWU+KFxuICAgIG5ldyBBbmltYXRlZC5WYWx1ZSgwKVxuICApO1xuICBjb25zdCB7IGN1cnJlbnQ6IGZhZGUgfSA9IFJlYWN0LnVzZVJlZjxBbmltYXRlZC5WYWx1ZT4oXG4gICAgbmV3IEFuaW1hdGVkLlZhbHVlKCFhbmltYXRpbmcgJiYgaGlkZXNXaGVuU3RvcHBlZCA/IDAgOiAxKVxuICApO1xuXG4gIGNvbnN0IHJvdGF0aW9uID0gUmVhY3QudXNlUmVmPEFuaW1hdGVkLkNvbXBvc2l0ZUFuaW1hdGlvbiB8IHVuZGVmaW5lZD4oXG4gICAgdW5kZWZpbmVkXG4gICk7XG5cbiAgY29uc3Qge1xuICAgIGFuaW1hdGlvbjogeyBzY2FsZSB9LFxuICB9ID0gdGhlbWU7XG5cbiAgY29uc3Qgc3RhcnRSb3RhdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAvLyBTaG93IGluZGljYXRvclxuICAgIEFuaW1hdGVkLnRpbWluZyhmYWRlLCB7XG4gICAgICBkdXJhdGlvbjogMjAwICogc2NhbGUsXG4gICAgICB0b1ZhbHVlOiAxLFxuICAgICAgaXNJbnRlcmFjdGlvbjogZmFsc2UsXG4gICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWUsXG4gICAgfSkuc3RhcnQoKTtcblxuICAgIC8vIENpcmN1bGFyIGFuaW1hdGlvbiBpbiBsb29wXG4gICAgaWYgKHJvdGF0aW9uLmN1cnJlbnQpIHtcbiAgICAgIHRpbWVyLnNldFZhbHVlKDApO1xuICAgICAgLy8gJEZsb3dGaXhNZVxuICAgICAgQW5pbWF0ZWQubG9vcChyb3RhdGlvbi5jdXJyZW50KS5zdGFydCgpO1xuICAgIH1cbiAgfSwgW3NjYWxlLCBmYWRlLCB0aW1lcl0pO1xuXG4gIGNvbnN0IHN0b3BSb3RhdGlvbiA9ICgpID0+IHtcbiAgICBpZiAocm90YXRpb24uY3VycmVudCkge1xuICAgICAgcm90YXRpb24uY3VycmVudC5zdG9wKCk7XG4gICAgfVxuICB9O1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHJvdGF0aW9uLmN1cnJlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gQ2lyY3VsYXIgYW5pbWF0aW9uIGluIGxvb3BcbiAgICAgIHJvdGF0aW9uLmN1cnJlbnQgPSBBbmltYXRlZC50aW1pbmcodGltZXIsIHtcbiAgICAgICAgZHVyYXRpb246IERVUkFUSU9OLFxuICAgICAgICBlYXNpbmc6IEVhc2luZy5saW5lYXIsXG4gICAgICAgIC8vIEFuaW1hdGVkLmxvb3AgZG9lcyBub3Qgd29yayBpZiB1c2VOYXRpdmVEcml2ZXIgaXMgdHJ1ZSBvbiB3ZWJcbiAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiBQbGF0Zm9ybS5PUyAhPT0gJ3dlYicsXG4gICAgICAgIHRvVmFsdWU6IDEsXG4gICAgICAgIGlzSW50ZXJhY3Rpb246IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFuaW1hdGluZykge1xuICAgICAgc3RhcnRSb3RhdGlvbigpO1xuICAgIH0gZWxzZSBpZiAoaGlkZXNXaGVuU3RvcHBlZCkge1xuICAgICAgLy8gSGlkZSBpbmRpY2F0b3IgZmlyc3QgYW5kIHRoZW4gc3RvcCByb3RhdGlvblxuICAgICAgQW5pbWF0ZWQudGltaW5nKGZhZGUsIHtcbiAgICAgICAgZHVyYXRpb246IDIwMCAqIHNjYWxlLFxuICAgICAgICB0b1ZhbHVlOiAwLFxuICAgICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWUsXG4gICAgICAgIGlzSW50ZXJhY3Rpb246IGZhbHNlLFxuICAgICAgfSkuc3RhcnQoc3RvcFJvdGF0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcFJvdGF0aW9uKCk7XG4gICAgfVxuICB9LCBbYW5pbWF0aW5nLCBmYWRlLCBoaWRlc1doZW5TdG9wcGVkLCBzdGFydFJvdGF0aW9uLCBzY2FsZSwgdGltZXJdKTtcblxuICBjb25zdCBjb2xvciA9IGluZGljYXRvckNvbG9yIHx8IHRoZW1lLmNvbG9ycy5wcmltYXJ5O1xuICBjb25zdCBzaXplID1cbiAgICB0eXBlb2YgaW5kaWNhdG9yU2l6ZSA9PT0gJ3N0cmluZydcbiAgICAgID8gaW5kaWNhdG9yU2l6ZSA9PT0gJ3NtYWxsJ1xuICAgICAgICA/IDI0XG4gICAgICAgIDogNDhcbiAgICAgIDogaW5kaWNhdG9yU2l6ZVxuICAgICAgPyBpbmRpY2F0b3JTaXplXG4gICAgICA6IDI0O1xuXG4gIGNvbnN0IGZyYW1lcyA9ICg2MCAqIERVUkFUSU9OKSAvIDEwMDA7XG4gIGNvbnN0IGVhc2luZyA9IEVhc2luZy5iZXppZXIoMC40LCAwLjAsIDAuNywgMS4wKTtcbiAgY29uc3QgY29udGFpbmVyU3R5bGUgPSB7XG4gICAgd2lkdGg6IHNpemUsXG4gICAgaGVpZ2h0OiBzaXplIC8gMixcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicgYXMgY29uc3QsXG4gIH07XG5cbiAgcmV0dXJuIChcbiAgICA8Vmlld1xuICAgICAgc3R5bGU9e1tzdHlsZXMuY29udGFpbmVyLCBzdHlsZV19XG4gICAgICB7Li4ucmVzdH1cbiAgICAgIGFjY2Vzc2libGVcbiAgICAgIGFjY2Vzc2liaWxpdHlSb2xlPVwicHJvZ3Jlc3NiYXJcIlxuICAgICAgYWNjZXNzaWJpbGl0eVN0YXRlPXt7IGJ1c3k6IGFuaW1hdGluZyB9fVxuICAgID5cbiAgICAgIDxBbmltYXRlZC5WaWV3XG4gICAgICAgIHN0eWxlPXtbeyB3aWR0aDogc2l6ZSwgaGVpZ2h0OiBzaXplLCBvcGFjaXR5OiBmYWRlIH1dfVxuICAgICAgICBjb2xsYXBzYWJsZT17ZmFsc2V9XG4gICAgICA+XG4gICAgICAgIHtbMCwgMV0ubWFwKChpbmRleCkgPT4ge1xuICAgICAgICAgIC8vIFRoYW5rcyB0byBodHRwczovL2dpdGh1Yi5jb20vbjRrei9yZWFjdC1uYXRpdmUtaW5kaWNhdG9ycyBmb3IgdGhlIGdyZWF0IHdvcmtcbiAgICAgICAgICBjb25zdCBpbnB1dFJhbmdlID0gQXJyYXkuZnJvbShcbiAgICAgICAgICAgIG5ldyBBcnJheShmcmFtZXMpLFxuICAgICAgICAgICAgKF8sIGZyYW1lSW5kZXgpID0+IGZyYW1lSW5kZXggLyAoZnJhbWVzIC0gMSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IG91dHB1dFJhbmdlID0gQXJyYXkuZnJvbShuZXcgQXJyYXkoZnJhbWVzKSwgKF8sIGZyYW1lSW5kZXgpID0+IHtcbiAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9ICgyICogZnJhbWVJbmRleCkgLyAoZnJhbWVzIC0gMSk7XG4gICAgICAgICAgICBjb25zdCByb3RhdGlvbiA9IGluZGV4ID8gKygzNjAgLSAxNSkgOiAtKDE4MCAtIDE1KTtcblxuICAgICAgICAgICAgaWYgKHByb2dyZXNzID4gMS4wKSB7XG4gICAgICAgICAgICAgIHByb2dyZXNzID0gMi4wIC0gcHJvZ3Jlc3M7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGluZGV4ID8gLTEgOiArMTtcblxuICAgICAgICAgICAgcmV0dXJuIGAke2RpcmVjdGlvbiAqICgxODAgLSAzMCkgKiBlYXNpbmcocHJvZ3Jlc3MpICsgcm90YXRpb259ZGVnYDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGxheWVyU3R5bGUgPSB7XG4gICAgICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgICAgIGhlaWdodDogc2l6ZSxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcm90YXRlOiB0aW1lci5pbnRlcnBvbGF0ZSh7XG4gICAgICAgICAgICAgICAgICBpbnB1dFJhbmdlOiBbMCwgMV0sXG4gICAgICAgICAgICAgICAgICBvdXRwdXRSYW5nZTogW2AkezAgKyAzMCArIDE1fWRlZ2AsIGAkezIgKiAzNjAgKyAzMCArIDE1fWRlZ2BdLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3Qgdmlld3BvcnRTdHlsZSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBzaXplLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGVZOiBpbmRleCA/IC1zaXplIC8gMiA6IDAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByb3RhdGU6IHRpbWVyLmludGVycG9sYXRlKHsgaW5wdXRSYW5nZSwgb3V0cHV0UmFuZ2UgfSksXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCBvZmZzZXRTdHlsZSA9IGluZGV4ID8geyB0b3A6IHNpemUgLyAyIH0gOiBudWxsO1xuXG4gICAgICAgICAgY29uc3QgbGluZVN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgICAgICBib3JkZXJDb2xvcjogY29sb3IsXG4gICAgICAgICAgICBib3JkZXJXaWR0aDogc2l6ZSAvIDEwLFxuICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiBzaXplIC8gMixcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3IGtleT17aW5kZXh9IHN0eWxlPXtbc3R5bGVzLmxheWVyXX0+XG4gICAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXtsYXllclN0eWxlfT5cbiAgICAgICAgICAgICAgICA8QW5pbWF0ZWQuVmlld1xuICAgICAgICAgICAgICAgICAgc3R5bGU9e1tjb250YWluZXJTdHlsZSwgb2Zmc2V0U3R5bGVdfVxuICAgICAgICAgICAgICAgICAgY29sbGFwc2FibGU9e2ZhbHNlfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXt2aWV3cG9ydFN0eWxlfT5cbiAgICAgICAgICAgICAgICAgICAgPEFuaW1hdGVkLlZpZXcgc3R5bGU9e2NvbnRhaW5lclN0eWxlfSBjb2xsYXBzYWJsZT17ZmFsc2V9PlxuICAgICAgICAgICAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXtsaW5lU3R5bGV9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICAgICAgICAgICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICAgICAgICAgICAgICA8L0FuaW1hdGVkLlZpZXc+XG4gICAgICAgICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICAgICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICAgICAgICApO1xuICAgICAgICB9KX1cbiAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICA8L1ZpZXc+XG4gICk7XG59O1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGNvbnRhaW5lcjoge1xuICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgfSxcblxuICBsYXllcjoge1xuICAgIC4uLlN0eWxlU2hlZXQuYWJzb2x1dGVGaWxsT2JqZWN0LFxuXG4gICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHdpdGhUaGVtZShBY3Rpdml0eUluZGljYXRvcik7XG4iXX0=