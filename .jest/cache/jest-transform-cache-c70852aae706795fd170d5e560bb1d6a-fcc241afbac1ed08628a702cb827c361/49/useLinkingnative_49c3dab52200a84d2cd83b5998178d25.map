{"version":3,"mappings":"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","names":["linkingHandlers","useLinking","ref","independent","enabled","prefixes","filter","config","getInitialURL","Promise","race","Linking","resolve","setTimeout","subscribe","listener","callback","url","subscription","addEventListener","remove","removeEventListener","getStateFromPath","getStateFromPathDefault","getActionFromState","getActionFromStateDefault","React","useEffect","process","env","NODE_ENV","undefined","length","console","error","Platform","OS","join","trim","handler","Symbol","push","index","indexOf","splice","enabledRef","useRef","prefixesRef","filterRef","configRef","getInitialURLRef","getStateFromPathRef","getActionFromStateRef","current","getStateFromURL","useCallback","path","getInitialState","state","then","thenable","onfulfilled","catch","navigation","rootState","getRootState","routes","some","r","routeNames","includes","name","warn","action","dispatch","e","message","resetRoot"],"sources":["useLinking.native.tsx"],"sourcesContent":["import {\n  getActionFromState as getActionFromStateDefault,\n  getStateFromPath as getStateFromPathDefault,\n  NavigationContainerRef,\n  ParamListBase,\n} from '@react-navigation/core';\nimport * as React from 'react';\nimport { Linking, Platform } from 'react-native';\n\nimport extractPathFromURL from './extractPathFromURL';\nimport type { LinkingOptions } from './types';\n\ntype ResultState = ReturnType<typeof getStateFromPathDefault>;\n\ntype Options = LinkingOptions<ParamListBase> & {\n  independent?: boolean;\n};\n\nlet linkingHandlers: Symbol[] = [];\n\nexport default function useLinking(\n  ref: React.RefObject<NavigationContainerRef<ParamListBase>>,\n  {\n    independent,\n    enabled = true,\n    prefixes,\n    filter,\n    config,\n    getInitialURL = () =>\n      Promise.race([\n        Linking.getInitialURL(),\n        new Promise<undefined>((resolve) =>\n          // Timeout in 150ms if `getInitialState` doesn't resolve\n          // Workaround for https://github.com/facebook/react-native/issues/25675\n          setTimeout(resolve, 150)\n        ),\n      ]),\n    subscribe = (listener) => {\n      const callback = ({ url }: { url: string }) => listener(url);\n\n      const subscription = Linking.addEventListener('url', callback) as\n        | { remove(): void }\n        | undefined;\n\n      return () => {\n        // https://github.com/facebook/react-native/commit/6d1aca806cee86ad76de771ed3a1cc62982ebcd7\n        if (subscription?.remove) {\n          subscription.remove();\n        } else {\n          Linking.removeEventListener('url', callback);\n        }\n      };\n    },\n    getStateFromPath = getStateFromPathDefault,\n    getActionFromState = getActionFromStateDefault,\n  }: Options\n) {\n  React.useEffect(() => {\n    if (process.env.NODE_ENV === 'production') {\n      return undefined;\n    }\n\n    if (independent) {\n      return undefined;\n    }\n\n    if (enabled !== false && linkingHandlers.length) {\n      console.error(\n        [\n          'Looks like you have configured linking in multiple places. This is likely an error since deep links should only be handled in one place to avoid conflicts. Make sure that:',\n          \"- You don't have multiple NavigationContainers in the app each with 'linking' enabled\",\n          '- Only a single instance of the root component is rendered',\n          Platform.OS === 'android'\n            ? \"- You have set 'android:launchMode=singleTask' in the '<activity />' section of the 'AndroidManifest.xml' file to avoid launching multiple instances\"\n            : '',\n        ]\n          .join('\\n')\n          .trim()\n      );\n    }\n\n    const handler = Symbol();\n\n    if (enabled !== false) {\n      linkingHandlers.push(handler);\n    }\n\n    return () => {\n      const index = linkingHandlers.indexOf(handler);\n\n      if (index > -1) {\n        linkingHandlers.splice(index, 1);\n      }\n    };\n  }, [enabled, independent]);\n\n  // We store these options in ref to avoid re-creating getInitialState and re-subscribing listeners\n  // This lets user avoid wrapping the items in `React.useCallback` or `React.useMemo`\n  // Not re-creating `getInitialState` is important coz it makes it easier for the user to use in an effect\n  const enabledRef = React.useRef(enabled);\n  const prefixesRef = React.useRef(prefixes);\n  const filterRef = React.useRef(filter);\n  const configRef = React.useRef(config);\n  const getInitialURLRef = React.useRef(getInitialURL);\n  const getStateFromPathRef = React.useRef(getStateFromPath);\n  const getActionFromStateRef = React.useRef(getActionFromState);\n\n  React.useEffect(() => {\n    enabledRef.current = enabled;\n    prefixesRef.current = prefixes;\n    filterRef.current = filter;\n    configRef.current = config;\n    getInitialURLRef.current = getInitialURL;\n    getStateFromPathRef.current = getStateFromPath;\n    getActionFromStateRef.current = getActionFromState;\n  });\n\n  const getStateFromURL = React.useCallback(\n    (url: string | null | undefined) => {\n      if (!url || (filterRef.current && !filterRef.current(url))) {\n        return undefined;\n      }\n\n      const path = extractPathFromURL(prefixesRef.current, url);\n\n      return path\n        ? getStateFromPathRef.current(path, configRef.current)\n        : undefined;\n    },\n    []\n  );\n\n  const getInitialState = React.useCallback(() => {\n    let state: ResultState | undefined;\n\n    if (enabledRef.current) {\n      const url = getInitialURLRef.current();\n\n      if (url != null && typeof url !== 'string') {\n        return url.then((url) => {\n          const state = getStateFromURL(url);\n\n          return state;\n        });\n      }\n\n      state = getStateFromURL(url);\n    }\n\n    const thenable = {\n      then(onfulfilled?: (state: ResultState | undefined) => void) {\n        return Promise.resolve(onfulfilled ? onfulfilled(state) : state);\n      },\n      catch() {\n        return thenable;\n      },\n    };\n\n    return thenable as PromiseLike<ResultState | undefined>;\n  }, [getStateFromURL]);\n\n  React.useEffect(() => {\n    const listener = (url: string) => {\n      if (!enabled) {\n        return;\n      }\n\n      const navigation = ref.current;\n      const state = navigation ? getStateFromURL(url) : undefined;\n\n      if (navigation && state) {\n        // Make sure that the routes in the state exist in the root navigator\n        // Otherwise there's an error in the linking configuration\n        const rootState = navigation.getRootState();\n\n        if (state.routes.some((r) => !rootState?.routeNames.includes(r.name))) {\n          console.warn(\n            \"The navigation state parsed from the URL contains routes not present in the root navigator. This usually means that the linking configuration doesn't match the navigation structure. See https://reactnavigation.org/docs/configuring-links for more details on how to specify a linking configuration.\"\n          );\n          return;\n        }\n\n        const action = getActionFromStateRef.current(state, configRef.current);\n\n        if (action !== undefined) {\n          try {\n            navigation.dispatch(action);\n          } catch (e) {\n            // Ignore any errors from deep linking.\n            // This could happen in case of malformed links, navigation object not being initialized etc.\n            console.warn(\n              `An error occurred when trying to handle the link '${url}': ${\n                typeof e === 'object' && e != null && 'message' in e\n                  ? // @ts-expect-error: we're already checking for this\n                    e.message\n                  : e\n              }`\n            );\n          }\n        } else {\n          navigation.resetRoot(state);\n        }\n      }\n    };\n\n    return subscribe(listener);\n  }, [enabled, getStateFromURL, ref, subscribe]);\n\n  return {\n    getInitialState,\n  };\n}\n"]}