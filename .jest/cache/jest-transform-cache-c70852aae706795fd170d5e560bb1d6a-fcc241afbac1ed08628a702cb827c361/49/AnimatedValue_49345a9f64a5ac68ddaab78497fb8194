77aee2f950828d7e045c05818b880a88
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var AnimatedInterpolation = require('./AnimatedInterpolation');

var AnimatedWithChildren = require('./AnimatedWithChildren');

var InteractionManager = require('../../Interaction/InteractionManager');

var NativeAnimatedHelper = require('../NativeAnimatedHelper');

var NativeAnimatedAPI = NativeAnimatedHelper.API;

function _flush(rootNode) {
  var animatedStyles = new Set();

  function findAnimatedStyles(node) {
    if (typeof node.update === 'function') {
      animatedStyles.add(node);
    } else {
      node.__getChildren().forEach(findAnimatedStyles);
    }
  }

  findAnimatedStyles(rootNode);
  animatedStyles.forEach(function (animatedStyle) {
    return animatedStyle.update();
  });
}

function _executeAsAnimatedBatch(id, operation) {
  NativeAnimatedAPI.setWaitingForIdentifier(id);
  operation();
  NativeAnimatedAPI.unsetWaitingForIdentifier(id);
}

var AnimatedValue = function (_AnimatedWithChildren) {
  (0, _inherits2.default)(AnimatedValue, _AnimatedWithChildren);

  var _super = _createSuper(AnimatedValue);

  function AnimatedValue(value) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedValue);
    _this = _super.call(this);

    if (typeof value !== 'number') {
      throw new Error('AnimatedValue: Attempting to set value to undefined');
    }

    _this._startingValue = _this._value = value;
    _this._offset = 0;
    _this._animation = null;
    return _this;
  }

  (0, _createClass2.default)(AnimatedValue, [{
    key: "__detach",
    value: function __detach() {
      var _this2 = this;

      if (this.__isNative) {
        NativeAnimatedAPI.getValue(this.__getNativeTag(), function (value) {
          _this2._value = value;
        });
      }

      this.stopAnimation();
      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedValue.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__getValue",
    value: function __getValue() {
      return this._value + this._offset;
    }
  }, {
    key: "setValue",
    value: function setValue(value) {
      var _this3 = this;

      if (this._animation) {
        this._animation.stop();

        this._animation = null;
      }

      this._updateValue(value, !this.__isNative);

      if (this.__isNative) {
        _executeAsAnimatedBatch(this.__getNativeTag().toString(), function () {
          NativeAnimatedAPI.setAnimatedNodeValue(_this3.__getNativeTag(), value);
        });
      }
    }
  }, {
    key: "setOffset",
    value: function setOffset(offset) {
      this._offset = offset;

      if (this.__isNative) {
        NativeAnimatedAPI.setAnimatedNodeOffset(this.__getNativeTag(), offset);
      }
    }
  }, {
    key: "flattenOffset",
    value: function flattenOffset() {
      this._value += this._offset;
      this._offset = 0;

      if (this.__isNative) {
        NativeAnimatedAPI.flattenAnimatedNodeOffset(this.__getNativeTag());
      }
    }
  }, {
    key: "extractOffset",
    value: function extractOffset() {
      this._offset += this._value;
      this._value = 0;

      if (this.__isNative) {
        NativeAnimatedAPI.extractAnimatedNodeOffset(this.__getNativeTag());
      }
    }
  }, {
    key: "stopAnimation",
    value: function stopAnimation(callback) {
      this.stopTracking();
      this._animation && this._animation.stop();
      this._animation = null;
      callback && callback(this.__getValue());
    }
  }, {
    key: "resetAnimation",
    value: function resetAnimation(callback) {
      this.stopAnimation(callback);
      this._value = this._startingValue;

      if (this.__isNative) {
        NativeAnimatedAPI.setAnimatedNodeValue(this.__getNativeTag(), this._startingValue);
      }
    }
  }, {
    key: "_onAnimatedValueUpdateReceived",
    value: function _onAnimatedValueUpdateReceived(value) {
      this._updateValue(value, false);
    }
  }, {
    key: "interpolate",
    value: function interpolate(config) {
      return new AnimatedInterpolation(this, config);
    }
  }, {
    key: "animate",
    value: function animate(animation, callback) {
      var _this4 = this;

      var handle = null;

      if (animation.__isInteraction) {
        handle = InteractionManager.createInteractionHandle();
      }

      var previousAnimation = this._animation;
      this._animation && this._animation.stop();
      this._animation = animation;
      animation.start(this._value, function (value) {
        _this4._updateValue(value, true);
      }, function (result) {
        _this4._animation = null;

        if (handle !== null) {
          InteractionManager.clearInteractionHandle(handle);
        }

        callback && callback(result);
      }, previousAnimation, this);
    }
  }, {
    key: "stopTracking",
    value: function stopTracking() {
      this._tracking && this._tracking.__detach();
      this._tracking = null;
    }
  }, {
    key: "track",
    value: function track(tracking) {
      this.stopTracking();
      this._tracking = tracking;
    }
  }, {
    key: "_updateValue",
    value: function _updateValue(value, flush) {
      if (value === undefined) {
        throw new Error('AnimatedValue: Attempting to set value to undefined');
      }

      this._value = value;

      if (flush) {
        _flush(this);
      }

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedValue.prototype), "__callListeners", this).call(this, this.__getValue());
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      return {
        type: 'value',
        value: this._value,
        offset: this._offset
      };
    }
  }]);
  return AnimatedValue;
}(AnimatedWithChildren);

module.exports = AnimatedValue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkVmFsdWUuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIiwicmVxdWlyZSIsIkFuaW1hdGVkV2l0aENoaWxkcmVuIiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwiTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJOYXRpdmVBbmltYXRlZEFQSSIsIkFQSSIsIl9mbHVzaCIsInJvb3ROb2RlIiwiYW5pbWF0ZWRTdHlsZXMiLCJTZXQiLCJmaW5kQW5pbWF0ZWRTdHlsZXMiLCJub2RlIiwidXBkYXRlIiwiYWRkIiwiX19nZXRDaGlsZHJlbiIsImZvckVhY2giLCJhbmltYXRlZFN0eWxlIiwiX2V4ZWN1dGVBc0FuaW1hdGVkQmF0Y2giLCJpZCIsIm9wZXJhdGlvbiIsInNldFdhaXRpbmdGb3JJZGVudGlmaWVyIiwidW5zZXRXYWl0aW5nRm9ySWRlbnRpZmllciIsIkFuaW1hdGVkVmFsdWUiLCJ2YWx1ZSIsIkVycm9yIiwiX3N0YXJ0aW5nVmFsdWUiLCJfdmFsdWUiLCJfb2Zmc2V0IiwiX2FuaW1hdGlvbiIsIl9faXNOYXRpdmUiLCJnZXRWYWx1ZSIsIl9fZ2V0TmF0aXZlVGFnIiwic3RvcEFuaW1hdGlvbiIsInN0b3AiLCJfdXBkYXRlVmFsdWUiLCJ0b1N0cmluZyIsInNldEFuaW1hdGVkTm9kZVZhbHVlIiwib2Zmc2V0Iiwic2V0QW5pbWF0ZWROb2RlT2Zmc2V0IiwiZmxhdHRlbkFuaW1hdGVkTm9kZU9mZnNldCIsImV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQiLCJjYWxsYmFjayIsInN0b3BUcmFja2luZyIsIl9fZ2V0VmFsdWUiLCJjb25maWciLCJhbmltYXRpb24iLCJoYW5kbGUiLCJfX2lzSW50ZXJhY3Rpb24iLCJjcmVhdGVJbnRlcmFjdGlvbkhhbmRsZSIsInByZXZpb3VzQW5pbWF0aW9uIiwic3RhcnQiLCJyZXN1bHQiLCJjbGVhckludGVyYWN0aW9uSGFuZGxlIiwiX3RyYWNraW5nIiwiX19kZXRhY2giLCJ0cmFja2luZyIsImZsdXNoIiwidW5kZWZpbmVkIiwidHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLHFCQUFxQixHQUFHQyxPQUFPLENBQUMseUJBQUQsQ0FBckM7O0FBQ0EsSUFBTUMsb0JBQW9CLEdBQUdELE9BQU8sQ0FBQyx3QkFBRCxDQUFwQzs7QUFDQSxJQUFNRSxrQkFBa0IsR0FBR0YsT0FBTyxDQUFDLHNDQUFELENBQWxDOztBQUNBLElBQU1HLG9CQUFvQixHQUFHSCxPQUFPLENBQUMseUJBQUQsQ0FBcEM7O0FBTUEsSUFBTUksaUJBQWlCLEdBQUdELG9CQUFvQixDQUFDRSxHQUEvQzs7QUF3QkEsU0FBU0MsTUFBVCxDQUFnQkMsUUFBaEIsRUFBK0M7QUFDN0MsTUFBTUMsY0FBYyxHQUFHLElBQUlDLEdBQUosRUFBdkI7O0FBQ0EsV0FBU0Msa0JBQVQsQ0FBNEJDLElBQTVCLEVBQWtDO0FBSWhDLFFBQUksT0FBT0EsSUFBSSxDQUFDQyxNQUFaLEtBQXVCLFVBQTNCLEVBQXVDO0FBQ3JDSixNQUFBQSxjQUFjLENBQUNLLEdBQWYsQ0FBbUJGLElBQW5CO0FBQ0QsS0FGRCxNQUVPO0FBQ0xBLE1BQUFBLElBQUksQ0FBQ0csYUFBTCxHQUFxQkMsT0FBckIsQ0FBNkJMLGtCQUE3QjtBQUNEO0FBQ0Y7O0FBQ0RBLEVBQUFBLGtCQUFrQixDQUFDSCxRQUFELENBQWxCO0FBRUFDLEVBQUFBLGNBQWMsQ0FBQ08sT0FBZixDQUF1QixVQUFBQyxhQUFhO0FBQUEsV0FBSUEsYUFBYSxDQUFDSixNQUFkLEVBQUo7QUFBQSxHQUFwQztBQUNEOztBQU9ELFNBQVNLLHVCQUFULENBQWlDQyxFQUFqQyxFQUE2Q0MsU0FBN0MsRUFBb0U7QUFDbEVmLEVBQUFBLGlCQUFpQixDQUFDZ0IsdUJBQWxCLENBQTBDRixFQUExQztBQUNBQyxFQUFBQSxTQUFTO0FBQ1RmLEVBQUFBLGlCQUFpQixDQUFDaUIseUJBQWxCLENBQTRDSCxFQUE1QztBQUNEOztJQVVLSSxhOzs7OztBQU9KLHlCQUFZQyxLQUFaLEVBQTJCO0FBQUE7O0FBQUE7QUFDekI7O0FBQ0EsUUFBSSxPQUFPQSxLQUFQLEtBQWlCLFFBQXJCLEVBQStCO0FBQzdCLFlBQU0sSUFBSUMsS0FBSixDQUFVLHFEQUFWLENBQU47QUFDRDs7QUFDRCxVQUFLQyxjQUFMLEdBQXNCLE1BQUtDLE1BQUwsR0FBY0gsS0FBcEM7QUFDQSxVQUFLSSxPQUFMLEdBQWUsQ0FBZjtBQUNBLFVBQUtDLFVBQUwsR0FBa0IsSUFBbEI7QUFQeUI7QUFRMUI7Ozs7V0FFRCxvQkFBVztBQUFBOztBQUNULFVBQUksS0FBS0MsVUFBVCxFQUFxQjtBQUNuQnpCLFFBQUFBLGlCQUFpQixDQUFDMEIsUUFBbEIsQ0FBMkIsS0FBS0MsY0FBTCxFQUEzQixFQUFrRCxVQUFBUixLQUFLLEVBQUk7QUFDekQsVUFBQSxNQUFJLENBQUNHLE1BQUwsR0FBY0gsS0FBZDtBQUNELFNBRkQ7QUFHRDs7QUFDRCxXQUFLUyxhQUFMO0FBQ0E7QUFDRDs7O1dBRUQsc0JBQXFCO0FBQ25CLGFBQU8sS0FBS04sTUFBTCxHQUFjLEtBQUtDLE9BQTFCO0FBQ0Q7OztXQVFELGtCQUFTSixLQUFULEVBQThCO0FBQUE7O0FBQzVCLFVBQUksS0FBS0ssVUFBVCxFQUFxQjtBQUNuQixhQUFLQSxVQUFMLENBQWdCSyxJQUFoQjs7QUFDQSxhQUFLTCxVQUFMLEdBQWtCLElBQWxCO0FBQ0Q7O0FBQ0QsV0FBS00sWUFBTCxDQUNFWCxLQURGLEVBRUUsQ0FBQyxLQUFLTSxVQUZSOztBQUlBLFVBQUksS0FBS0EsVUFBVCxFQUFxQjtBQUNuQlosUUFBQUEsdUJBQXVCLENBQUMsS0FBS2MsY0FBTCxHQUFzQkksUUFBdEIsRUFBRCxFQUFtQyxZQUFNO0FBQzlEL0IsVUFBQUEsaUJBQWlCLENBQUNnQyxvQkFBbEIsQ0FBdUMsTUFBSSxDQUFDTCxjQUFMLEVBQXZDLEVBQThEUixLQUE5RDtBQUNELFNBRnNCLENBQXZCO0FBR0Q7QUFDRjs7O1dBU0QsbUJBQVVjLE1BQVYsRUFBZ0M7QUFDOUIsV0FBS1YsT0FBTCxHQUFlVSxNQUFmOztBQUNBLFVBQUksS0FBS1IsVUFBVCxFQUFxQjtBQUNuQnpCLFFBQUFBLGlCQUFpQixDQUFDa0MscUJBQWxCLENBQXdDLEtBQUtQLGNBQUwsRUFBeEMsRUFBK0RNLE1BQS9EO0FBQ0Q7QUFDRjs7O1dBUUQseUJBQXNCO0FBQ3BCLFdBQUtYLE1BQUwsSUFBZSxLQUFLQyxPQUFwQjtBQUNBLFdBQUtBLE9BQUwsR0FBZSxDQUFmOztBQUNBLFVBQUksS0FBS0UsVUFBVCxFQUFxQjtBQUNuQnpCLFFBQUFBLGlCQUFpQixDQUFDbUMseUJBQWxCLENBQTRDLEtBQUtSLGNBQUwsRUFBNUM7QUFDRDtBQUNGOzs7V0FRRCx5QkFBc0I7QUFDcEIsV0FBS0osT0FBTCxJQUFnQixLQUFLRCxNQUFyQjtBQUNBLFdBQUtBLE1BQUwsR0FBYyxDQUFkOztBQUNBLFVBQUksS0FBS0csVUFBVCxFQUFxQjtBQUNuQnpCLFFBQUFBLGlCQUFpQixDQUFDb0MseUJBQWxCLENBQTRDLEtBQUtULGNBQUwsRUFBNUM7QUFDRDtBQUNGOzs7V0FTRCx1QkFBY1UsUUFBZCxFQUF5RDtBQUN2RCxXQUFLQyxZQUFMO0FBQ0EsV0FBS2QsVUFBTCxJQUFtQixLQUFLQSxVQUFMLENBQWdCSyxJQUFoQixFQUFuQjtBQUNBLFdBQUtMLFVBQUwsR0FBa0IsSUFBbEI7QUFDQWEsTUFBQUEsUUFBUSxJQUFJQSxRQUFRLENBQUMsS0FBS0UsVUFBTCxFQUFELENBQXBCO0FBQ0Q7OztXQU9ELHdCQUFlRixRQUFmLEVBQTBEO0FBQ3hELFdBQUtULGFBQUwsQ0FBbUJTLFFBQW5CO0FBQ0EsV0FBS2YsTUFBTCxHQUFjLEtBQUtELGNBQW5COztBQUNBLFVBQUksS0FBS0ksVUFBVCxFQUFxQjtBQUNuQnpCLFFBQUFBLGlCQUFpQixDQUFDZ0Msb0JBQWxCLENBQ0UsS0FBS0wsY0FBTCxFQURGLEVBRUUsS0FBS04sY0FGUDtBQUlEO0FBQ0Y7OztXQUVELHdDQUErQkYsS0FBL0IsRUFBb0Q7QUFDbEQsV0FBS1csWUFBTCxDQUFrQlgsS0FBbEIsRUFBeUIsS0FBekI7QUFDRDs7O1dBTUQscUJBQVlxQixNQUFaLEVBQW9FO0FBQ2xFLGFBQU8sSUFBSTdDLHFCQUFKLENBQTBCLElBQTFCLEVBQWdDNkMsTUFBaEMsQ0FBUDtBQUNEOzs7V0FRRCxpQkFBUUMsU0FBUixFQUE4QkosUUFBOUIsRUFBNEQ7QUFBQTs7QUFDMUQsVUFBSUssTUFBTSxHQUFHLElBQWI7O0FBQ0EsVUFBSUQsU0FBUyxDQUFDRSxlQUFkLEVBQStCO0FBQzdCRCxRQUFBQSxNQUFNLEdBQUc1QyxrQkFBa0IsQ0FBQzhDLHVCQUFuQixFQUFUO0FBQ0Q7O0FBQ0QsVUFBTUMsaUJBQWlCLEdBQUcsS0FBS3JCLFVBQS9CO0FBQ0EsV0FBS0EsVUFBTCxJQUFtQixLQUFLQSxVQUFMLENBQWdCSyxJQUFoQixFQUFuQjtBQUNBLFdBQUtMLFVBQUwsR0FBa0JpQixTQUFsQjtBQUNBQSxNQUFBQSxTQUFTLENBQUNLLEtBQVYsQ0FDRSxLQUFLeEIsTUFEUCxFQUVFLFVBQUFILEtBQUssRUFBSTtBQUdQLFFBQUEsTUFBSSxDQUFDVyxZQUFMLENBQWtCWCxLQUFsQixFQUF5QixJQUF6QjtBQUNELE9BTkgsRUFPRSxVQUFBNEIsTUFBTSxFQUFJO0FBQ1IsUUFBQSxNQUFJLENBQUN2QixVQUFMLEdBQWtCLElBQWxCOztBQUNBLFlBQUlrQixNQUFNLEtBQUssSUFBZixFQUFxQjtBQUNuQjVDLFVBQUFBLGtCQUFrQixDQUFDa0Qsc0JBQW5CLENBQTBDTixNQUExQztBQUNEOztBQUNETCxRQUFBQSxRQUFRLElBQUlBLFFBQVEsQ0FBQ1UsTUFBRCxDQUFwQjtBQUNELE9BYkgsRUFjRUYsaUJBZEYsRUFlRSxJQWZGO0FBaUJEOzs7V0FLRCx3QkFBcUI7QUFDbkIsV0FBS0ksU0FBTCxJQUFrQixLQUFLQSxTQUFMLENBQWVDLFFBQWYsRUFBbEI7QUFDQSxXQUFLRCxTQUFMLEdBQWlCLElBQWpCO0FBQ0Q7OztXQUtELGVBQU1FLFFBQU4sRUFBd0M7QUFDdEMsV0FBS2IsWUFBTDtBQUNBLFdBQUtXLFNBQUwsR0FBaUJFLFFBQWpCO0FBQ0Q7OztXQUVELHNCQUFhaEMsS0FBYixFQUE0QmlDLEtBQTVCLEVBQWtEO0FBQ2hELFVBQUlqQyxLQUFLLEtBQUtrQyxTQUFkLEVBQXlCO0FBQ3ZCLGNBQU0sSUFBSWpDLEtBQUosQ0FBVSxxREFBVixDQUFOO0FBQ0Q7O0FBRUQsV0FBS0UsTUFBTCxHQUFjSCxLQUFkOztBQUNBLFVBQUlpQyxLQUFKLEVBQVc7QUFDVGxELFFBQUFBLE1BQU0sQ0FBQyxJQUFELENBQU47QUFDRDs7QUFDRCxxSEFBc0IsS0FBS3FDLFVBQUwsRUFBdEI7QUFDRDs7O1dBRUQsNkJBQTRCO0FBQzFCLGFBQU87QUFDTGUsUUFBQUEsSUFBSSxFQUFFLE9BREQ7QUFFTG5DLFFBQUFBLEtBQUssRUFBRSxLQUFLRyxNQUZQO0FBR0xXLFFBQUFBLE1BQU0sRUFBRSxLQUFLVjtBQUhSLE9BQVA7QUFLRDs7O0VBNU15QjFCLG9COztBQStNNUIwRCxNQUFNLENBQUNDLE9BQVAsR0FBaUJ0QyxhQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkSW50ZXJwb2xhdGlvbiA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRJbnRlcnBvbGF0aW9uJyk7XG5jb25zdCBBbmltYXRlZFdpdGhDaGlsZHJlbiA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRXaXRoQ2hpbGRyZW4nKTtcbmNvbnN0IEludGVyYWN0aW9uTWFuYWdlciA9IHJlcXVpcmUoJy4uLy4uL0ludGVyYWN0aW9uL0ludGVyYWN0aW9uTWFuYWdlcicpO1xuY29uc3QgTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSByZXF1aXJlKCcuLi9OYXRpdmVBbmltYXRlZEhlbHBlcicpO1xuXG5pbXBvcnQgdHlwZSBBbmltYXRpb24sIHtFbmRDYWxsYmFja30gZnJvbSAnLi4vYW5pbWF0aW9ucy9BbmltYXRpb24nO1xuaW1wb3J0IHR5cGUge0ludGVycG9sYXRpb25Db25maWdUeXBlfSBmcm9tICcuL0FuaW1hdGVkSW50ZXJwb2xhdGlvbic7XG5pbXBvcnQgdHlwZSBBbmltYXRlZFRyYWNraW5nIGZyb20gJy4vQW5pbWF0ZWRUcmFja2luZyc7XG5cbmNvbnN0IE5hdGl2ZUFuaW1hdGVkQVBJID0gTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJO1xuXG4vKipcbiAqIEFuaW1hdGVkIHdvcmtzIGJ5IGJ1aWxkaW5nIGEgZGlyZWN0ZWQgYWN5Y2xpYyBncmFwaCBvZiBkZXBlbmRlbmNpZXNcbiAqIHRyYW5zcGFyZW50bHkgd2hlbiB5b3UgcmVuZGVyIHlvdXIgQW5pbWF0ZWQgY29tcG9uZW50cy5cbiAqXG4gKiAgICAgICAgICAgICAgIG5ldyBBbmltYXRlZC5WYWx1ZSgwKVxuICogICAgIC5pbnRlcnBvbGF0ZSgpICAgICAgICAuaW50ZXJwb2xhdGUoKSAgICBuZXcgQW5pbWF0ZWQuVmFsdWUoMSlcbiAqICAgICAgICAgb3BhY2l0eSAgICAgICAgICAgICAgIHRyYW5zbGF0ZVkgICAgICBzY2FsZVxuICogICAgICAgICAgc3R5bGUgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtXG4gKiAgICAgICAgIFZpZXcjMjM0ICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmlldyMxMjNcbiAqXG4gKiBBKSBUb3AgRG93biBwaGFzZVxuICogV2hlbiBhbiBBbmltYXRlZC5WYWx1ZSBpcyB1cGRhdGVkLCB3ZSByZWN1cnNpdmVseSBnbyBkb3duIHRocm91Z2ggdGhpc1xuICogZ3JhcGggaW4gb3JkZXIgdG8gZmluZCBsZWFmIG5vZGVzOiB0aGUgdmlld3MgdGhhdCB3ZSBmbGFnIGFzIG5lZWRpbmdcbiAqIGFuIHVwZGF0ZS5cbiAqXG4gKiBCKSBCb3R0b20gVXAgcGhhc2VcbiAqIFdoZW4gYSB2aWV3IGlzIGZsYWdnZWQgYXMgbmVlZGluZyBhbiB1cGRhdGUsIHdlIHJlY3Vyc2l2ZWx5IGdvIGJhY2sgdXBcbiAqIGluIG9yZGVyIHRvIGJ1aWxkIHRoZSBuZXcgdmFsdWUgdGhhdCBpdCBuZWVkcy4gVGhlIHJlYXNvbiB3aHkgd2UgbmVlZFxuICogdGhpcyB0d28tcGhhc2VzIHByb2Nlc3MgaXMgdG8gZGVhbCB3aXRoIGNvbXBvc2l0ZSBwcm9wcyBzdWNoIGFzXG4gKiB0cmFuc2Zvcm0gd2hpY2ggY2FuIHJlY2VpdmUgdmFsdWVzIGZyb20gbXVsdGlwbGUgcGFyZW50cy5cbiAqL1xuZnVuY3Rpb24gX2ZsdXNoKHJvb3ROb2RlOiBBbmltYXRlZFZhbHVlKTogdm9pZCB7XG4gIGNvbnN0IGFuaW1hdGVkU3R5bGVzID0gbmV3IFNldCgpO1xuICBmdW5jdGlvbiBmaW5kQW5pbWF0ZWRTdHlsZXMobm9kZSkge1xuICAgIC8qICRGbG93Rml4TWVbcHJvcC1taXNzaW5nXSAoPj0wLjY4LjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIpIFRoaXMgY29tbWVudFxuICAgICAqIHN1cHByZXNzZXMgYW4gZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjY4IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvclxuICAgICAqIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgIGlmICh0eXBlb2Ygbm9kZS51cGRhdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGFuaW1hdGVkU3R5bGVzLmFkZChub2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5fX2dldENoaWxkcmVuKCkuZm9yRWFjaChmaW5kQW5pbWF0ZWRTdHlsZXMpO1xuICAgIH1cbiAgfVxuICBmaW5kQW5pbWF0ZWRTdHlsZXMocm9vdE5vZGUpO1xuICAvLyAkRmxvd0ZpeE1lW3Byb3AtbWlzc2luZ11cbiAgYW5pbWF0ZWRTdHlsZXMuZm9yRWFjaChhbmltYXRlZFN0eWxlID0+IGFuaW1hdGVkU3R5bGUudXBkYXRlKCkpO1xufVxuXG4vKipcbiAqIFNvbWUgb3BlcmF0aW9ucyBhcmUgZXhlY3V0ZWQgb25seSBvbiBiYXRjaCBlbmQsIHdoaWNoIGlzIF9tb3N0bHlfIHNjaGVkdWxlZCB3aGVuXG4gKiBBbmltYXRlZCBjb21wb25lbnQgcHJvcHMgY2hhbmdlLiBGb3Igc29tZSBvZiB0aGUgY2hhbmdlcyB3aGljaCByZXF1aXJlIGltbWVkaWF0ZSBleGVjdXRpb25cbiAqIChlLmcuIHNldFZhbHVlKSwgd2UgY3JlYXRlIGEgc2VwYXJhdGUgYmF0Y2ggaW4gY2FzZSBub25lIGlzIHNjaGVkdWxlZC5cbiAqL1xuZnVuY3Rpb24gX2V4ZWN1dGVBc0FuaW1hdGVkQmF0Y2goaWQ6IHN0cmluZywgb3BlcmF0aW9uOiAoKSA9PiB2b2lkKSB7XG4gIE5hdGl2ZUFuaW1hdGVkQVBJLnNldFdhaXRpbmdGb3JJZGVudGlmaWVyKGlkKTtcbiAgb3BlcmF0aW9uKCk7XG4gIE5hdGl2ZUFuaW1hdGVkQVBJLnVuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoaWQpO1xufVxuXG4vKipcbiAqIFN0YW5kYXJkIHZhbHVlIGZvciBkcml2aW5nIGFuaW1hdGlvbnMuICBPbmUgYEFuaW1hdGVkLlZhbHVlYCBjYW4gZHJpdmVcbiAqIG11bHRpcGxlIHByb3BlcnRpZXMgaW4gYSBzeW5jaHJvbml6ZWQgZmFzaGlvbiwgYnV0IGNhbiBvbmx5IGJlIGRyaXZlbiBieSBvbmVcbiAqIG1lY2hhbmlzbSBhdCBhIHRpbWUuICBVc2luZyBhIG5ldyBtZWNoYW5pc20gKGUuZy4gc3RhcnRpbmcgYSBuZXcgYW5pbWF0aW9uLFxuICogb3IgY2FsbGluZyBgc2V0VmFsdWVgKSB3aWxsIHN0b3AgYW55IHByZXZpb3VzIG9uZXMuXG4gKlxuICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sXG4gKi9cbmNsYXNzIEFuaW1hdGVkVmFsdWUgZXh0ZW5kcyBBbmltYXRlZFdpdGhDaGlsZHJlbiB7XG4gIF92YWx1ZTogbnVtYmVyO1xuICBfc3RhcnRpbmdWYWx1ZTogbnVtYmVyO1xuICBfb2Zmc2V0OiBudW1iZXI7XG4gIF9hbmltYXRpb246ID9BbmltYXRpb247XG4gIF90cmFja2luZzogP0FuaW1hdGVkVHJhY2tpbmc7XG5cbiAgY29uc3RydWN0b3IodmFsdWU6IG51bWJlcikge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQW5pbWF0ZWRWYWx1ZTogQXR0ZW1wdGluZyB0byBzZXQgdmFsdWUgdG8gdW5kZWZpbmVkJyk7XG4gICAgfVxuICAgIHRoaXMuX3N0YXJ0aW5nVmFsdWUgPSB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMuX29mZnNldCA9IDA7XG4gICAgdGhpcy5fYW5pbWF0aW9uID0gbnVsbDtcbiAgfVxuXG4gIF9fZGV0YWNoKCkge1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLmdldFZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgdmFsdWUgPT4ge1xuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuc3RvcEFuaW1hdGlvbigpO1xuICAgIHN1cGVyLl9fZGV0YWNoKCk7XG4gIH1cblxuICBfX2dldFZhbHVlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlICsgdGhpcy5fb2Zmc2V0O1xuICB9XG5cbiAgLyoqXG4gICAqIERpcmVjdGx5IHNldCB0aGUgdmFsdWUuICBUaGlzIHdpbGwgc3RvcCBhbnkgYW5pbWF0aW9ucyBydW5uaW5nIG9uIHRoZSB2YWx1ZVxuICAgKiBhbmQgdXBkYXRlIGFsbCB0aGUgYm91bmQgcHJvcGVydGllcy5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3NldHZhbHVlXG4gICAqL1xuICBzZXRWYWx1ZSh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2FuaW1hdGlvbikge1xuICAgICAgdGhpcy5fYW5pbWF0aW9uLnN0b3AoKTtcbiAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKFxuICAgICAgdmFsdWUsXG4gICAgICAhdGhpcy5fX2lzTmF0aXZlIC8qIGRvbid0IHBlcmZvcm0gYSBmbHVzaCBmb3IgbmF0aXZlbHkgZHJpdmVuIHZhbHVlcyAqLyxcbiAgICApO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIF9leGVjdXRlQXNBbmltYXRlZEJhdGNoKHRoaXMuX19nZXROYXRpdmVUYWcoKS50b1N0cmluZygpLCAoKSA9PiB7XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnNldEFuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYW4gb2Zmc2V0IHRoYXQgaXMgYXBwbGllZCBvbiB0b3Agb2Ygd2hhdGV2ZXIgdmFsdWUgaXMgc2V0LCB3aGV0aGVyIHZpYVxuICAgKiBgc2V0VmFsdWVgLCBhbiBhbmltYXRpb24sIG9yIGBBbmltYXRlZC5ldmVudGAuICBVc2VmdWwgZm9yIGNvbXBlbnNhdGluZ1xuICAgKiB0aGluZ3MgbGlrZSB0aGUgc3RhcnQgb2YgYSBwYW4gZ2VzdHVyZS5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3NldG9mZnNldFxuICAgKi9cbiAgc2V0T2Zmc2V0KG9mZnNldDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5fb2Zmc2V0ID0gb2Zmc2V0O1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnNldEFuaW1hdGVkTm9kZU9mZnNldCh0aGlzLl9fZ2V0TmF0aXZlVGFnKCksIG9mZnNldCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1lcmdlcyB0aGUgb2Zmc2V0IHZhbHVlIGludG8gdGhlIGJhc2UgdmFsdWUgYW5kIHJlc2V0cyB0aGUgb2Zmc2V0IHRvIHplcm8uXG4gICAqIFRoZSBmaW5hbCBvdXRwdXQgb2YgdGhlIHZhbHVlIGlzIHVuY2hhbmdlZC5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI2ZsYXR0ZW5vZmZzZXRcbiAgICovXG4gIGZsYXR0ZW5PZmZzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5fdmFsdWUgKz0gdGhpcy5fb2Zmc2V0O1xuICAgIHRoaXMuX29mZnNldCA9IDA7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgTmF0aXZlQW5pbWF0ZWRBUEkuZmxhdHRlbkFuaW1hdGVkTm9kZU9mZnNldCh0aGlzLl9fZ2V0TmF0aXZlVGFnKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBvZmZzZXQgdmFsdWUgdG8gdGhlIGJhc2UgdmFsdWUsIGFuZCByZXNldHMgdGhlIGJhc2UgdmFsdWUgdG8gemVyby5cbiAgICogVGhlIGZpbmFsIG91dHB1dCBvZiB0aGUgdmFsdWUgaXMgdW5jaGFuZ2VkLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjZXh0cmFjdG9mZnNldFxuICAgKi9cbiAgZXh0cmFjdE9mZnNldCgpOiB2b2lkIHtcbiAgICB0aGlzLl9vZmZzZXQgKz0gdGhpcy5fdmFsdWU7XG4gICAgdGhpcy5fdmFsdWUgPSAwO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLmV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQodGhpcy5fX2dldE5hdGl2ZVRhZygpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcHMgYW55IHJ1bm5pbmcgYW5pbWF0aW9uIG9yIHRyYWNraW5nLiBgY2FsbGJhY2tgIGlzIGludm9rZWQgd2l0aCB0aGVcbiAgICogZmluYWwgdmFsdWUgYWZ0ZXIgc3RvcHBpbmcgdGhlIGFuaW1hdGlvbiwgd2hpY2ggaXMgdXNlZnVsIGZvciB1cGRhdGluZ1xuICAgKiBzdGF0ZSB0byBtYXRjaCB0aGUgYW5pbWF0aW9uIHBvc2l0aW9uIHdpdGggbGF5b3V0LlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjc3RvcGFuaW1hdGlvblxuICAgKi9cbiAgc3RvcEFuaW1hdGlvbihjYWxsYmFjaz86ID8odmFsdWU6IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcFRyYWNraW5nKCk7XG4gICAgdGhpcy5fYW5pbWF0aW9uICYmIHRoaXMuX2FuaW1hdGlvbi5zdG9wKCk7XG4gICAgdGhpcy5fYW5pbWF0aW9uID0gbnVsbDtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0aGlzLl9fZ2V0VmFsdWUoKSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcHMgYW55IGFuaW1hdGlvbiBhbmQgcmVzZXRzIHRoZSB2YWx1ZSB0byBpdHMgb3JpZ2luYWwuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNyZXNldGFuaW1hdGlvblxuICAgKi9cbiAgcmVzZXRBbmltYXRpb24oY2FsbGJhY2s/OiA/KHZhbHVlOiBudW1iZXIpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3BBbmltYXRpb24oY2FsbGJhY2spO1xuICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5fc3RhcnRpbmdWYWx1ZTtcbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEFQSS5zZXRBbmltYXRlZE5vZGVWYWx1ZShcbiAgICAgICAgdGhpcy5fX2dldE5hdGl2ZVRhZygpLFxuICAgICAgICB0aGlzLl9zdGFydGluZ1ZhbHVlLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBfb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQodmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHZhbHVlLCBmYWxzZSAvKmZsdXNoKi8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEludGVycG9sYXRlcyB0aGUgdmFsdWUgYmVmb3JlIHVwZGF0aW5nIHRoZSBwcm9wZXJ0eSwgZS5nLiBtYXBwaW5nIDAtMSB0b1xuICAgKiAwLTEwLlxuICAgKi9cbiAgaW50ZXJwb2xhdGUoY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSk6IEFuaW1hdGVkSW50ZXJwb2xhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBBbmltYXRlZEludGVycG9sYXRpb24odGhpcywgY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBpY2FsbHkgb25seSB1c2VkIGludGVybmFsbHksIGJ1dCBjb3VsZCBiZSB1c2VkIGJ5IGEgY3VzdG9tIEFuaW1hdGlvblxuICAgKiBjbGFzcy5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI2FuaW1hdGVcbiAgICovXG4gIGFuaW1hdGUoYW5pbWF0aW9uOiBBbmltYXRpb24sIGNhbGxiYWNrOiA/RW5kQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBsZXQgaGFuZGxlID0gbnVsbDtcbiAgICBpZiAoYW5pbWF0aW9uLl9faXNJbnRlcmFjdGlvbikge1xuICAgICAgaGFuZGxlID0gSW50ZXJhY3Rpb25NYW5hZ2VyLmNyZWF0ZUludGVyYWN0aW9uSGFuZGxlKCk7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzQW5pbWF0aW9uID0gdGhpcy5fYW5pbWF0aW9uO1xuICAgIHRoaXMuX2FuaW1hdGlvbiAmJiB0aGlzLl9hbmltYXRpb24uc3RvcCgpO1xuICAgIHRoaXMuX2FuaW1hdGlvbiA9IGFuaW1hdGlvbjtcbiAgICBhbmltYXRpb24uc3RhcnQoXG4gICAgICB0aGlzLl92YWx1ZSxcbiAgICAgIHZhbHVlID0+IHtcbiAgICAgICAgLy8gTmF0aXZlbHkgZHJpdmVuIGFuaW1hdGlvbnMgd2lsbCBuZXZlciBjYWxsIGludG8gdGhhdCBjYWxsYmFjaywgdGhlcmVmb3JlIHdlIGNhbiBhbHdheXNcbiAgICAgICAgLy8gcGFzcyBmbHVzaCA9IHRydWUgdG8gYWxsb3cgdGhlIHVwZGF0ZWQgdmFsdWUgdG8gcHJvcGFnYXRlIHRvIG5hdGl2ZSB3aXRoIHNldE5hdGl2ZVByb3BzXG4gICAgICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHZhbHVlLCB0cnVlIC8qIGZsdXNoICovKTtcbiAgICAgIH0sXG4gICAgICByZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgICAgICBpZiAoaGFuZGxlICE9PSBudWxsKSB7XG4gICAgICAgICAgSW50ZXJhY3Rpb25NYW5hZ2VyLmNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaGFuZGxlKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhyZXN1bHQpO1xuICAgICAgfSxcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uLFxuICAgICAgdGhpcyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGljYWxseSBvbmx5IHVzZWQgaW50ZXJuYWxseS5cbiAgICovXG4gIHN0b3BUcmFja2luZygpOiB2b2lkIHtcbiAgICB0aGlzLl90cmFja2luZyAmJiB0aGlzLl90cmFja2luZy5fX2RldGFjaCgpO1xuICAgIHRoaXMuX3RyYWNraW5nID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBpY2FsbHkgb25seSB1c2VkIGludGVybmFsbHkuXG4gICAqL1xuICB0cmFjayh0cmFja2luZzogQW5pbWF0ZWRUcmFja2luZyk6IHZvaWQge1xuICAgIHRoaXMuc3RvcFRyYWNraW5nKCk7XG4gICAgdGhpcy5fdHJhY2tpbmcgPSB0cmFja2luZztcbiAgfVxuXG4gIF91cGRhdGVWYWx1ZSh2YWx1ZTogbnVtYmVyLCBmbHVzaDogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FuaW1hdGVkVmFsdWU6IEF0dGVtcHRpbmcgdG8gc2V0IHZhbHVlIHRvIHVuZGVmaW5lZCcpO1xuICAgIH1cblxuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgaWYgKGZsdXNoKSB7XG4gICAgICBfZmx1c2godGhpcyk7XG4gICAgfVxuICAgIHN1cGVyLl9fY2FsbExpc3RlbmVycyh0aGlzLl9fZ2V0VmFsdWUoKSk7XG4gIH1cblxuICBfX2dldE5hdGl2ZUNvbmZpZygpOiBPYmplY3Qge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAndmFsdWUnLFxuICAgICAgdmFsdWU6IHRoaXMuX3ZhbHVlLFxuICAgICAgb2Zmc2V0OiB0aGlzLl9vZmZzZXQsXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFuaW1hdGVkVmFsdWU7XG4iXX0=