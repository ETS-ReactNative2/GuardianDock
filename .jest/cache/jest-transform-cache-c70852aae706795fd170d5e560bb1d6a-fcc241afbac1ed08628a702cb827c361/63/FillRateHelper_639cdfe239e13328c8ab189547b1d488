7314ca95dffccf53a7f126b417bb86b6
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var Info = (0, _createClass2.default)(function Info() {
  (0, _classCallCheck2.default)(this, Info);
  this.any_blank_count = 0;
  this.any_blank_ms = 0;
  this.any_blank_speed_sum = 0;
  this.mostly_blank_count = 0;
  this.mostly_blank_ms = 0;
  this.pixels_blank = 0;
  this.pixels_sampled = 0;
  this.pixels_scrolled = 0;
  this.total_time_spent = 0;
  this.sample_count = 0;
});
var DEBUG = false;
var _listeners = [];
var _minSampleCount = 10;

var _sampleRate = DEBUG ? 1 : null;

var FillRateHelper = function () {
  function FillRateHelper(getFrameMetrics) {
    (0, _classCallCheck2.default)(this, FillRateHelper);
    this._anyBlankStartTime = null;
    this._enabled = false;
    this._info = new Info();
    this._mostlyBlankStartTime = null;
    this._samplesStartTime = null;
    this._getFrameMetrics = getFrameMetrics;
    this._enabled = (_sampleRate || 0) > Math.random();

    this._resetData();
  }

  (0, _createClass2.default)(FillRateHelper, [{
    key: "activate",
    value: function activate() {
      if (this._enabled && this._samplesStartTime == null) {
        DEBUG && console.debug('FillRateHelper: activate');
        this._samplesStartTime = global.performance.now();
      }
    }
  }, {
    key: "deactivateAndFlush",
    value: function deactivateAndFlush() {
      if (!this._enabled) {
        return;
      }

      var start = this._samplesStartTime;

      if (start == null) {
        DEBUG && console.debug('FillRateHelper: bail on deactivate with no start time');
        return;
      }

      if (this._info.sample_count < _minSampleCount) {
        this._resetData();

        return;
      }

      var total_time_spent = global.performance.now() - start;
      var info = (0, _extends2.default)({}, this._info, {
        total_time_spent: total_time_spent
      });

      if (DEBUG) {
        var derived = {
          avg_blankness: this._info.pixels_blank / this._info.pixels_sampled,
          avg_speed: this._info.pixels_scrolled / (total_time_spent / 1000),
          avg_speed_when_any_blank: this._info.any_blank_speed_sum / this._info.any_blank_count,
          any_blank_per_min: this._info.any_blank_count / (total_time_spent / 1000 / 60),
          any_blank_time_frac: this._info.any_blank_ms / total_time_spent,
          mostly_blank_per_min: this._info.mostly_blank_count / (total_time_spent / 1000 / 60),
          mostly_blank_time_frac: this._info.mostly_blank_ms / total_time_spent
        };

        for (var key in derived) {
          derived[key] = Math.round(1000 * derived[key]) / 1000;
        }

        console.debug('FillRateHelper deactivateAndFlush: ', {
          derived: derived,
          info: info
        });
      }

      _listeners.forEach(function (listener) {
        return listener(info);
      });

      this._resetData();
    }
  }, {
    key: "computeBlankness",
    value: function computeBlankness(props, state, scrollMetrics) {
      if (!this._enabled || props.getItemCount(props.data) === 0 || this._samplesStartTime == null) {
        return 0;
      }

      var dOffset = scrollMetrics.dOffset,
          offset = scrollMetrics.offset,
          velocity = scrollMetrics.velocity,
          visibleLength = scrollMetrics.visibleLength;
      this._info.sample_count++;
      this._info.pixels_sampled += Math.round(visibleLength);
      this._info.pixels_scrolled += Math.round(Math.abs(dOffset));
      var scrollSpeed = Math.round(Math.abs(velocity) * 1000);
      var now = global.performance.now();

      if (this._anyBlankStartTime != null) {
        this._info.any_blank_ms += now - this._anyBlankStartTime;
      }

      this._anyBlankStartTime = null;

      if (this._mostlyBlankStartTime != null) {
        this._info.mostly_blank_ms += now - this._mostlyBlankStartTime;
      }

      this._mostlyBlankStartTime = null;
      var blankTop = 0;
      var first = state.first;

      var firstFrame = this._getFrameMetrics(first);

      while (first <= state.last && (!firstFrame || !firstFrame.inLayout)) {
        firstFrame = this._getFrameMetrics(first);
        first++;
      }

      if (firstFrame && first > 0) {
        blankTop = Math.min(visibleLength, Math.max(0, firstFrame.offset - offset));
      }

      var blankBottom = 0;
      var last = state.last;

      var lastFrame = this._getFrameMetrics(last);

      while (last >= state.first && (!lastFrame || !lastFrame.inLayout)) {
        lastFrame = this._getFrameMetrics(last);
        last--;
      }

      if (lastFrame && last < props.getItemCount(props.data) - 1) {
        var bottomEdge = lastFrame.offset + lastFrame.length;
        blankBottom = Math.min(visibleLength, Math.max(0, offset + visibleLength - bottomEdge));
      }

      var pixels_blank = Math.round(blankTop + blankBottom);
      var blankness = pixels_blank / visibleLength;

      if (blankness > 0) {
        this._anyBlankStartTime = now;
        this._info.any_blank_speed_sum += scrollSpeed;
        this._info.any_blank_count++;
        this._info.pixels_blank += pixels_blank;

        if (blankness > 0.5) {
          this._mostlyBlankStartTime = now;
          this._info.mostly_blank_count++;
        }
      } else if (scrollSpeed < 0.01 || Math.abs(dOffset) < 1) {
        this.deactivateAndFlush();
      }

      return blankness;
    }
  }, {
    key: "enabled",
    value: function enabled() {
      return this._enabled;
    }
  }, {
    key: "_resetData",
    value: function _resetData() {
      this._anyBlankStartTime = null;
      this._info = new Info();
      this._mostlyBlankStartTime = null;
      this._samplesStartTime = null;
    }
  }], [{
    key: "addListener",
    value: function addListener(callback) {
      if (_sampleRate === null) {
        console.warn('Call `FillRateHelper.setSampleRate` before `addListener`.');
      }

      _listeners.push(callback);

      return {
        remove: function remove() {
          _listeners = _listeners.filter(function (listener) {
            return callback !== listener;
          });
        }
      };
    }
  }, {
    key: "setSampleRate",
    value: function setSampleRate(sampleRate) {
      _sampleRate = sampleRate;
    }
  }, {
    key: "setMinSampleCount",
    value: function setMinSampleCount(minSampleCount) {
      _minSampleCount = minSampleCount;
    }
  }]);
  return FillRateHelper;
}();

module.exports = FillRateHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZpbGxSYXRlSGVscGVyLmpzIl0sIm5hbWVzIjpbIkluZm8iLCJhbnlfYmxhbmtfY291bnQiLCJhbnlfYmxhbmtfbXMiLCJhbnlfYmxhbmtfc3BlZWRfc3VtIiwibW9zdGx5X2JsYW5rX2NvdW50IiwibW9zdGx5X2JsYW5rX21zIiwicGl4ZWxzX2JsYW5rIiwicGl4ZWxzX3NhbXBsZWQiLCJwaXhlbHNfc2Nyb2xsZWQiLCJ0b3RhbF90aW1lX3NwZW50Iiwic2FtcGxlX2NvdW50IiwiREVCVUciLCJfbGlzdGVuZXJzIiwiX21pblNhbXBsZUNvdW50IiwiX3NhbXBsZVJhdGUiLCJGaWxsUmF0ZUhlbHBlciIsImdldEZyYW1lTWV0cmljcyIsIl9hbnlCbGFua1N0YXJ0VGltZSIsIl9lbmFibGVkIiwiX2luZm8iLCJfbW9zdGx5QmxhbmtTdGFydFRpbWUiLCJfc2FtcGxlc1N0YXJ0VGltZSIsIl9nZXRGcmFtZU1ldHJpY3MiLCJNYXRoIiwicmFuZG9tIiwiX3Jlc2V0RGF0YSIsImNvbnNvbGUiLCJkZWJ1ZyIsImdsb2JhbCIsInBlcmZvcm1hbmNlIiwibm93Iiwic3RhcnQiLCJpbmZvIiwiZGVyaXZlZCIsImF2Z19ibGFua25lc3MiLCJhdmdfc3BlZWQiLCJhdmdfc3BlZWRfd2hlbl9hbnlfYmxhbmsiLCJhbnlfYmxhbmtfcGVyX21pbiIsImFueV9ibGFua190aW1lX2ZyYWMiLCJtb3N0bHlfYmxhbmtfcGVyX21pbiIsIm1vc3RseV9ibGFua190aW1lX2ZyYWMiLCJrZXkiLCJyb3VuZCIsImZvckVhY2giLCJsaXN0ZW5lciIsInByb3BzIiwic3RhdGUiLCJzY3JvbGxNZXRyaWNzIiwiZ2V0SXRlbUNvdW50IiwiZGF0YSIsImRPZmZzZXQiLCJvZmZzZXQiLCJ2ZWxvY2l0eSIsInZpc2libGVMZW5ndGgiLCJhYnMiLCJzY3JvbGxTcGVlZCIsImJsYW5rVG9wIiwiZmlyc3QiLCJmaXJzdEZyYW1lIiwibGFzdCIsImluTGF5b3V0IiwibWluIiwibWF4IiwiYmxhbmtCb3R0b20iLCJsYXN0RnJhbWUiLCJib3R0b21FZGdlIiwibGVuZ3RoIiwiYmxhbmtuZXNzIiwiZGVhY3RpdmF0ZUFuZEZsdXNoIiwiY2FsbGJhY2siLCJ3YXJuIiwicHVzaCIsInJlbW92ZSIsImZpbHRlciIsInNhbXBsZVJhdGUiLCJtaW5TYW1wbGVDb3VudCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7Ozs7Ozs7O0lBSU1BLEk7O09BQ0pDLGUsR0FBMEIsQztPQUMxQkMsWSxHQUF1QixDO09BQ3ZCQyxtQixHQUE4QixDO09BQzlCQyxrQixHQUE2QixDO09BQzdCQyxlLEdBQTBCLEM7T0FDMUJDLFksR0FBdUIsQztPQUN2QkMsYyxHQUF5QixDO09BQ3pCQyxlLEdBQTBCLEM7T0FDMUJDLGdCLEdBQTJCLEM7T0FDM0JDLFksR0FBdUIsQzs7QUFVekIsSUFBTUMsS0FBSyxHQUFHLEtBQWQ7QUFFQSxJQUFJQyxVQUFpQyxHQUFHLEVBQXhDO0FBQ0EsSUFBSUMsZUFBZSxHQUFHLEVBQXRCOztBQUNBLElBQUlDLFdBQVcsR0FBR0gsS0FBSyxHQUFHLENBQUgsR0FBTyxJQUE5Qjs7SUFVTUksYztBQThCSiwwQkFBWUMsZUFBWixFQUErRDtBQUFBO0FBQUEsU0E3Qi9EQyxrQkE2QitELEdBN0J6QyxJQTZCeUM7QUFBQSxTQTVCL0RDLFFBNEIrRCxHQTVCcEQsS0E0Qm9EO0FBQUEsU0ExQi9EQyxLQTBCK0QsR0ExQnZELElBQUluQixJQUFKLEVBMEJ1RDtBQUFBLFNBekIvRG9CLHFCQXlCK0QsR0F6QnRDLElBeUJzQztBQUFBLFNBeEIvREMsaUJBd0IrRCxHQXhCMUMsSUF3QjBDO0FBQzdELFNBQUtDLGdCQUFMLEdBQXdCTixlQUF4QjtBQUNBLFNBQUtFLFFBQUwsR0FBZ0IsQ0FBQ0osV0FBVyxJQUFJLENBQWhCLElBQXFCUyxJQUFJLENBQUNDLE1BQUwsRUFBckM7O0FBQ0EsU0FBS0MsVUFBTDtBQUNEOzs7O1dBRUQsb0JBQVc7QUFDVCxVQUFJLEtBQUtQLFFBQUwsSUFBaUIsS0FB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LENBQUM2RCxNQUFYLENBQWtCLFVBQUE3QixRQUFRO0FBQUEsbUJBQUl5QixRQUFRLEtBQUt6QixRQUFqQjtBQUFBLFdBQTFCLENBQWI7QUFDRDtBQUhJLE9BQVA7QUFLRDs7O1dBRUQsdUJBQXFCOEIsVUFBckIsRUFBeUM7QUFDdkM1RCxNQUFBQSxXQUFXLEdBQUc0RCxVQUFkO0FBQ0Q7OztXQUVELDJCQUF5QkMsY0FBekIsRUFBaUQ7QUFDL0M5RCxNQUFBQSxlQUFlLEdBQUc4RCxjQUFsQjtBQUNEOzs7OztBQW9LSEMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCOUQsY0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgdHlwZSBGaWxsUmF0ZUluZm8gPSBJbmZvO1xuXG5jbGFzcyBJbmZvIHtcbiAgYW55X2JsYW5rX2NvdW50OiBudW1iZXIgPSAwO1xuICBhbnlfYmxhbmtfbXM6IG51bWJlciA9IDA7XG4gIGFueV9ibGFua19zcGVlZF9zdW06IG51bWJlciA9IDA7XG4gIG1vc3RseV9ibGFua19jb3VudDogbnVtYmVyID0gMDtcbiAgbW9zdGx5X2JsYW5rX21zOiBudW1iZXIgPSAwO1xuICBwaXhlbHNfYmxhbms6IG51bWJlciA9IDA7XG4gIHBpeGVsc19zYW1wbGVkOiBudW1iZXIgPSAwO1xuICBwaXhlbHNfc2Nyb2xsZWQ6IG51bWJlciA9IDA7XG4gIHRvdGFsX3RpbWVfc3BlbnQ6IG51bWJlciA9IDA7XG4gIHNhbXBsZV9jb3VudDogbnVtYmVyID0gMDtcbn1cblxudHlwZSBGcmFtZU1ldHJpY3MgPSB7XG4gIGluTGF5b3V0PzogYm9vbGVhbixcbiAgbGVuZ3RoOiBudW1iZXIsXG4gIG9mZnNldDogbnVtYmVyLFxuICAuLi5cbn07XG5cbmNvbnN0IERFQlVHID0gZmFsc2U7XG5cbmxldCBfbGlzdGVuZXJzOiBBcnJheTwoSW5mbykgPT4gdm9pZD4gPSBbXTtcbmxldCBfbWluU2FtcGxlQ291bnQgPSAxMDtcbmxldCBfc2FtcGxlUmF0ZSA9IERFQlVHID8gMSA6IG51bGw7XG5cbi8qKlxuICogQSBoZWxwZXIgY2xhc3MgZm9yIGRldGVjdGluZyB3aGVuIHRoZSBtYXhpbWVtIGZpbGwgcmF0ZSBvZiBgVmlydHVhbGl6ZWRMaXN0YCBpcyBleGNlZWRlZC5cbiAqIEJ5IGRlZmF1bHQgdGhlIHNhbXBsaW5nIHJhdGUgaXMgc2V0IHRvIHplcm8gYW5kIHRoaXMgd2lsbCBkbyBub3RoaW5nLiBJZiB5b3Ugd2FudCB0byBjb2xsZWN0XG4gKiBzYW1wbGVzIChlLmcuIHRvIGxvZyB0aGVtKSwgbWFrZSBzdXJlIHRvIGNhbGwgYEZpbGxSYXRlSGVscGVyLnNldFNhbXBsZVJhdGUoMC4wLTEuMClgLlxuICpcbiAqIExpc3RlbmVycyBhbmQgc2FtcGxlIHJhdGUgYXJlIGdsb2JhbCBmb3IgYWxsIGBWaXJ0dWFsaXplZExpc3RgcyAtIHR5cGljYWwgdXNhZ2Ugd2lsbCBjb21iaW5lIHdpdGhcbiAqIGBTY2VuZVRyYWNrZXIuZ2V0QWN0aXZlU2NlbmVgIHRvIGRldGVybWluZSB0aGUgY29udGV4dCBvZiB0aGUgZXZlbnRzLlxuICovXG5jbGFzcyBGaWxsUmF0ZUhlbHBlciB7XG4gIF9hbnlCbGFua1N0YXJ0VGltZSA9IChudWxsOiA/bnVtYmVyKTtcbiAgX2VuYWJsZWQgPSBmYWxzZTtcbiAgX2dldEZyYW1lTWV0cmljczogKGluZGV4OiBudW1iZXIpID0+ID9GcmFtZU1ldHJpY3M7XG4gIF9pbmZvID0gbmV3IEluZm8oKTtcbiAgX21vc3RseUJsYW5rU3RhcnRUaW1lID0gKG51bGw6ID9udW1iZXIpO1xuICBfc2FtcGxlc1N0YXJ0VGltZSA9IChudWxsOiA/bnVtYmVyKTtcblxuICBzdGF0aWMgYWRkTGlzdGVuZXIoXG4gICAgY2FsbGJhY2s6IEZpbGxSYXRlSW5mbyA9PiB2b2lkLFxuICApOiB7cmVtb3ZlOiAoKSA9PiB2b2lkLCAuLi59IHtcbiAgICBpZiAoX3NhbXBsZVJhdGUgPT09IG51bGwpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FsbCBgRmlsbFJhdGVIZWxwZXIuc2V0U2FtcGxlUmF0ZWAgYmVmb3JlIGBhZGRMaXN0ZW5lcmAuJyk7XG4gICAgfVxuICAgIF9saXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlbW92ZTogKCkgPT4ge1xuICAgICAgICBfbGlzdGVuZXJzID0gX2xpc3RlbmVycy5maWx0ZXIobGlzdGVuZXIgPT4gY2FsbGJhY2sgIT09IGxpc3RlbmVyKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBzZXRTYW1wbGVSYXRlKHNhbXBsZVJhdGU6IG51bWJlcikge1xuICAgIF9zYW1wbGVSYXRlID0gc2FtcGxlUmF0ZTtcbiAgfVxuXG4gIHN0YXRpYyBzZXRNaW5TYW1wbGVDb3VudChtaW5TYW1wbGVDb3VudDogbnVtYmVyKSB7XG4gICAgX21pblNhbXBsZUNvdW50ID0gbWluU2FtcGxlQ291bnQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihnZXRGcmFtZU1ldHJpY3M6IChpbmRleDogbnVtYmVyKSA9PiA/RnJhbWVNZXRyaWNzKSB7XG4gICAgdGhpcy5fZ2V0RnJhbWVNZXRyaWNzID0gZ2V0RnJhbWVNZXRyaWNzO1xuICAgIHRoaXMuX2VuYWJsZWQgPSAoX3NhbXBsZVJhdGUgfHwgMCkgPiBNYXRoLnJhbmRvbSgpO1xuICAgIHRoaXMuX3Jlc2V0RGF0YSgpO1xuICB9XG5cbiAgYWN0aXZhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2VuYWJsZWQgJiYgdGhpcy5fc2FtcGxlc1N0YXJ0VGltZSA9PSBudWxsKSB7XG4gICAgICBERUJVRyAmJiBjb25zb2xlLmRlYnVnKCdGaWxsUmF0ZUhlbHBlcjogYWN0aXZhdGUnKTtcbiAgICAgIHRoaXMuX3NhbXBsZXNTdGFydFRpbWUgPSBnbG9iYWwucGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfVxuICB9XG5cbiAgZGVhY3RpdmF0ZUFuZEZsdXNoKCkge1xuICAgIGlmICghdGhpcy5fZW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBzdGFydCA9IHRoaXMuX3NhbXBsZXNTdGFydFRpbWU7IC8vIGNvbnN0IGZvciBmbG93XG4gICAgaWYgKHN0YXJ0ID09IG51bGwpIHtcbiAgICAgIERFQlVHICYmXG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ0ZpbGxSYXRlSGVscGVyOiBiYWlsIG9uIGRlYWN0aXZhdGUgd2l0aCBubyBzdGFydCB0aW1lJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLl9pbmZvLnNhbXBsZV9jb3VudCA8IF9taW5TYW1wbGVDb3VudCkge1xuICAgICAgLy8gRG9uJ3QgYm90aGVyIHdpdGggdW5kZXItc2FtcGxlZCBldmVudHMuXG4gICAgICB0aGlzLl9yZXNldERhdGEoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdG90YWxfdGltZV9zcGVudCA9IGdsb2JhbC5wZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0O1xuICAgIGNvbnN0IGluZm86IGFueSA9IHtcbiAgICAgIC4uLnRoaXMuX2luZm8sXG4gICAgICB0b3RhbF90aW1lX3NwZW50LFxuICAgIH07XG4gICAgaWYgKERFQlVHKSB7XG4gICAgICBjb25zdCBkZXJpdmVkID0ge1xuICAgICAgICBhdmdfYmxhbmtuZXNzOiB0aGlzLl9pbmZvLnBpeGVsc19ibGFuayAvIHRoaXMuX2luZm8ucGl4ZWxzX3NhbXBsZWQsXG4gICAgICAgIGF2Z19zcGVlZDogdGhpcy5faW5mby5waXhlbHNfc2Nyb2xsZWQgLyAodG90YWxfdGltZV9zcGVudCAvIDEwMDApLFxuICAgICAgICBhdmdfc3BlZWRfd2hlbl9hbnlfYmxhbms6XG4gICAgICAgICAgdGhpcy5faW5mby5hbnlfYmxhbmtfc3BlZWRfc3VtIC8gdGhpcy5faW5mby5hbnlfYmxhbmtfY291bnQsXG4gICAgICAgIGFueV9ibGFua19wZXJfbWluOlxuICAgICAgICAgIHRoaXMuX2luZm8uYW55X2JsYW5rX2NvdW50IC8gKHRvdGFsX3RpbWVfc3BlbnQgLyAxMDAwIC8gNjApLFxuICAgICAgICBhbnlfYmxhbmtfdGltZV9mcmFjOiB0aGlzLl9pbmZvLmFueV9ibGFua19tcyAvIHRvdGFsX3RpbWVfc3BlbnQsXG4gICAgICAgIG1vc3RseV9ibGFua19wZXJfbWluOlxuICAgICAgICAgIHRoaXMuX2luZm8ubW9zdGx5X2JsYW5rX2NvdW50IC8gKHRvdGFsX3RpbWVfc3BlbnQgLyAxMDAwIC8gNjApLFxuICAgICAgICBtb3N0bHlfYmxhbmtfdGltZV9mcmFjOiB0aGlzLl9pbmZvLm1vc3RseV9ibGFua19tcyAvIHRvdGFsX3RpbWVfc3BlbnQsXG4gICAgICB9O1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGVyaXZlZCkge1xuICAgICAgICBkZXJpdmVkW2tleV0gPSBNYXRoLnJvdW5kKDEwMDAgKiBkZXJpdmVkW2tleV0pIC8gMTAwMDtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUuZGVidWcoJ0ZpbGxSYXRlSGVscGVyIGRlYWN0aXZhdGVBbmRGbHVzaDogJywge2Rlcml2ZWQsIGluZm99KTtcbiAgICB9XG4gICAgX2xpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IGxpc3RlbmVyKGluZm8pKTtcbiAgICB0aGlzLl9yZXNldERhdGEoKTtcbiAgfVxuXG4gIGNvbXB1dGVCbGFua25lc3MoXG4gICAgcHJvcHM6IHtcbiAgICAgIGRhdGE6IGFueSxcbiAgICAgIGdldEl0ZW1Db3VudDogKGRhdGE6IGFueSkgPT4gbnVtYmVyLFxuICAgICAgaW5pdGlhbE51bVRvUmVuZGVyPzogP251bWJlcixcbiAgICAgIC4uLlxuICAgIH0sXG4gICAgc3RhdGU6IHtcbiAgICAgIGZpcnN0OiBudW1iZXIsXG4gICAgICBsYXN0OiBudW1iZXIsXG4gICAgICAuLi5cbiAgICB9LFxuICAgIHNjcm9sbE1ldHJpY3M6IHtcbiAgICAgIGRPZmZzZXQ6IG51bWJlcixcbiAgICAgIG9mZnNldDogbnVtYmVyLFxuICAgICAgdmVsb2NpdHk6IG51bWJlcixcbiAgICAgIHZpc2libGVMZW5ndGg6IG51bWJlcixcbiAgICAgIC4uLlxuICAgIH0sXG4gICk6IG51bWJlciB7XG4gICAgaWYgKFxuICAgICAgIXRoaXMuX2VuYWJsZWQgfHxcbiAgICAgIHByb3BzLmdldEl0ZW1Db3VudChwcm9wcy5kYXRhKSA9PT0gMCB8fFxuICAgICAgdGhpcy5fc2FtcGxlc1N0YXJ0VGltZSA9PSBudWxsXG4gICAgKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3Qge2RPZmZzZXQsIG9mZnNldCwgdmVsb2NpdHksIHZpc2libGVMZW5ndGh9ID0gc2Nyb2xsTWV0cmljcztcblxuICAgIC8vIERlbm9taW5hdG9yIG1ldHJpY3MgdGhhdCB3ZSB0cmFjayBmb3IgYWxsIGV2ZW50cyAtIG1vc3Qgb2YgdGhlIHRpbWUgdGhlcmUgaXMgbm8gYmxhbmtuZXNzIGFuZFxuICAgIC8vIHdlIHdhbnQgdG8gY2FwdHVyZSB0aGF0LlxuICAgIHRoaXMuX2luZm8uc2FtcGxlX2NvdW50Kys7XG4gICAgdGhpcy5faW5mby5waXhlbHNfc2FtcGxlZCArPSBNYXRoLnJvdW5kKHZpc2libGVMZW5ndGgpO1xuICAgIHRoaXMuX2luZm8ucGl4ZWxzX3Njcm9sbGVkICs9IE1hdGgucm91bmQoTWF0aC5hYnMoZE9mZnNldCkpO1xuICAgIGNvbnN0IHNjcm9sbFNwZWVkID0gTWF0aC5yb3VuZChNYXRoLmFicyh2ZWxvY2l0eSkgKiAxMDAwKTsgLy8gcHggLyBzZWNcblxuICAgIC8vIFdoZXRoZXIgYmxhbmsgbm93IG9yIG5vdCwgcmVjb3JkIHRoZSBlbGFwc2VkIHRpbWUgYmxhbmsgaWYgd2Ugd2VyZSBibGFuayBsYXN0IHRpbWUuXG4gICAgY29uc3Qgbm93ID0gZ2xvYmFsLnBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGlmICh0aGlzLl9hbnlCbGFua1N0YXJ0VGltZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9pbmZvLmFueV9ibGFua19tcyArPSBub3cgLSB0aGlzLl9hbnlCbGFua1N0YXJ0VGltZTtcbiAgICB9XG4gICAgdGhpcy5fYW55QmxhbmtTdGFydFRpbWUgPSBudWxsO1xuICAgIGlmICh0aGlzLl9tb3N0bHlCbGFua1N0YXJ0VGltZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9pbmZvLm1vc3RseV9ibGFua19tcyArPSBub3cgLSB0aGlzLl9tb3N0bHlCbGFua1N0YXJ0VGltZTtcbiAgICB9XG4gICAgdGhpcy5fbW9zdGx5QmxhbmtTdGFydFRpbWUgPSBudWxsO1xuXG4gICAgbGV0IGJsYW5rVG9wID0gMDtcbiAgICBsZXQgZmlyc3QgPSBzdGF0ZS5maXJzdDtcbiAgICBsZXQgZmlyc3RGcmFtZSA9IHRoaXMuX2dldEZyYW1lTWV0cmljcyhmaXJzdCk7XG4gICAgd2hpbGUgKGZpcnN0IDw9IHN0YXRlLmxhc3QgJiYgKCFmaXJzdEZyYW1lIHx8ICFmaXJzdEZyYW1lLmluTGF5b3V0KSkge1xuICAgICAgZmlyc3RGcmFtZSA9IHRoaXMuX2dldEZyYW1lTWV0cmljcyhmaXJzdCk7XG4gICAgICBmaXJzdCsrO1xuICAgIH1cbiAgICAvLyBPbmx5IGNvdW50IGJsYW5rVG9wIGlmIHdlIGFyZW4ndCByZW5kZXJpbmcgdGhlIGZpcnN0IGl0ZW0sIG90aGVyd2lzZSB3ZSB3aWxsIGNvdW50IHRoZSBoZWFkZXJcbiAgICAvLyBhcyBibGFuay5cbiAgICBpZiAoZmlyc3RGcmFtZSAmJiBmaXJzdCA+IDApIHtcbiAgICAgIGJsYW5rVG9wID0gTWF0aC5taW4oXG4gICAgICAgIHZpc2libGVMZW5ndGgsXG4gICAgICAgIE1hdGgubWF4KDAsIGZpcnN0RnJhbWUub2Zmc2V0IC0gb2Zmc2V0KSxcbiAgICAgICk7XG4gICAgfVxuICAgIGxldCBibGFua0JvdHRvbSA9IDA7XG4gICAgbGV0IGxhc3QgPSBzdGF0ZS5sYXN0O1xuICAgIGxldCBsYXN0RnJhbWUgPSB0aGlzLl9nZXRGcmFtZU1ldHJpY3MobGFzdCk7XG4gICAgd2hpbGUgKGxhc3QgPj0gc3RhdGUuZmlyc3QgJiYgKCFsYXN0RnJhbWUgfHwgIWxhc3RGcmFtZS5pbkxheW91dCkpIHtcbiAgICAgIGxhc3RGcmFtZSA9IHRoaXMuX2dldEZyYW1lTWV0cmljcyhsYXN0KTtcbiAgICAgIGxhc3QtLTtcbiAgICB9XG4gICAgLy8gT25seSBjb3VudCBibGFua0JvdHRvbSBpZiB3ZSBhcmVuJ3QgcmVuZGVyaW5nIHRoZSBsYXN0IGl0ZW0sIG90aGVyd2lzZSB3ZSB3aWxsIGNvdW50IHRoZVxuICAgIC8vIGZvb3RlciBhcyBibGFuay5cbiAgICBpZiAobGFzdEZyYW1lICYmIGxhc3QgPCBwcm9wcy5nZXRJdGVtQ291bnQocHJvcHMuZGF0YSkgLSAxKSB7XG4gICAgICBjb25zdCBib3R0b21FZGdlID0gbGFzdEZyYW1lLm9mZnNldCArIGxhc3RGcmFtZS5sZW5ndGg7XG4gICAgICBibGFua0JvdHRvbSA9IE1hdGgubWluKFxuICAgICAgICB2aXNpYmxlTGVuZ3RoLFxuICAgICAgICBNYXRoLm1heCgwLCBvZmZzZXQgKyB2aXNpYmxlTGVuZ3RoIC0gYm90dG9tRWRnZSksXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBwaXhlbHNfYmxhbmsgPSBNYXRoLnJvdW5kKGJsYW5rVG9wICsgYmxhbmtCb3R0b20pO1xuICAgIGNvbnN0IGJsYW5rbmVzcyA9IHBpeGVsc19ibGFuayAvIHZpc2libGVMZW5ndGg7XG4gICAgaWYgKGJsYW5rbmVzcyA+IDApIHtcbiAgICAgIHRoaXMuX2FueUJsYW5rU3RhcnRUaW1lID0gbm93O1xuICAgICAgdGhpcy5faW5mby5hbnlfYmxhbmtfc3BlZWRfc3VtICs9IHNjcm9sbFNwZWVkO1xuICAgICAgdGhpcy5faW5mby5hbnlfYmxhbmtfY291bnQrKztcbiAgICAgIHRoaXMuX2luZm8ucGl4ZWxzX2JsYW5rICs9IHBpeGVsc19ibGFuaztcbiAgICAgIGlmIChibGFua25lc3MgPiAwLjUpIHtcbiAgICAgICAgdGhpcy5fbW9zdGx5QmxhbmtTdGFydFRpbWUgPSBub3c7XG4gICAgICAgIHRoaXMuX2luZm8ubW9zdGx5X2JsYW5rX2NvdW50Kys7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzY3JvbGxTcGVlZCA8IDAuMDEgfHwgTWF0aC5hYnMoZE9mZnNldCkgPCAxKSB7XG4gICAgICB0aGlzLmRlYWN0aXZhdGVBbmRGbHVzaCgpO1xuICAgIH1cbiAgICByZXR1cm4gYmxhbmtuZXNzO1xuICB9XG5cbiAgZW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDtcbiAgfVxuXG4gIF9yZXNldERhdGEoKSB7XG4gICAgdGhpcy5fYW55QmxhbmtTdGFydFRpbWUgPSBudWxsO1xuICAgIHRoaXMuX2luZm8gPSBuZXcgSW5mbygpO1xuICAgIHRoaXMuX21vc3RseUJsYW5rU3RhcnRUaW1lID0gbnVsbDtcbiAgICB0aGlzLl9zYW1wbGVzU3RhcnRUaW1lID0gbnVsbDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZpbGxSYXRlSGVscGVyO1xuIl19