7541ddb4c9a3526ac85b12b1a177c5c3
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

var _extends3 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["theme", "linking", "fallback", "documentTitle", "onReady"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _core = require("@react-navigation/core");

var React = _interopRequireWildcard(require("react"));

var _LinkingContext = _interopRequireDefault(require("./LinkingContext"));

var _DefaultTheme = _interopRequireDefault(require("./theming/DefaultTheme"));

var _ThemeProvider = _interopRequireDefault(require("./theming/ThemeProvider"));

var _useBackButton = _interopRequireDefault(require("./useBackButton"));

var _useDocumentTitle = _interopRequireDefault(require("./useDocumentTitle"));

var _useLinking = _interopRequireDefault(require("./useLinking"));

var _useThenable = _interopRequireDefault(require("./useThenable"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

global.REACT_NAVIGATION_DEVTOOLS = new WeakMap();

function NavigationContainerInner(_ref, ref) {
  var _ref$theme = _ref.theme,
      theme = _ref$theme === void 0 ? _DefaultTheme.default : _ref$theme,
      linking = _ref.linking,
      _ref$fallback = _ref.fallback,
      fallback = _ref$fallback === void 0 ? null : _ref$fallback,
      documentTitle = _ref.documentTitle,
      onReady = _ref.onReady,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);
  var isLinkingEnabled = linking ? linking.enabled !== false : false;

  if (linking !== null && linking !== void 0 && linking.config) {
    (0, _core.validatePathConfig)(linking.config);
  }

  var refContainer = React.useRef(null);
  (0, _useBackButton.default)(refContainer);
  (0, _useDocumentTitle.default)(refContainer, documentTitle);

  var _ref2 = (0, _useLinking.default)(refContainer, (0, _extends3.default)({
    independent: rest.independent,
    enabled: isLinkingEnabled,
    prefixes: []
  }, linking)),
      getInitialState = _ref2.getInitialState;

  React.useEffect(function () {
    if (refContainer.current) {
      REACT_NAVIGATION_DEVTOOLS.set(refContainer.current, {
        get linking() {
          var _linking$prefixes, _linking$getStateFrom, _linking$getPathFromS, _linking$getActionFro;

          return (0, _extends3.default)({}, linking, {
            enabled: isLinkingEnabled,
            prefixes: (_linking$prefixes = linking === null || linking === void 0 ? void 0 : linking.prefixes) !== null && _linking$prefixes !== void 0 ? _linking$prefixes : [],
            getStateFromPath: (_linking$getStateFrom = linking === null || linking === void 0 ? void 0 : linking.getStateFromPath) !== null && _linking$getStateFrom !== void 0 ? _linking$getStateFrom : _core.getStateFromPath,
            getPathFromState: (_linking$getPathFromS = linking === null || linking === void 0 ? void 0 : linking.getPathFromState) !== null && _linking$getPathFromS !== void 0 ? _linking$getPathFromS : _core.getPathFromState,
            getActionFromState: (_linking$getActionFro = linking === null || linking === void 0 ? void 0 : linking.getActionFromState) !== null && _linking$getActionFro !== void 0 ? _linking$getActionFro : _core.getActionFromState
          });
        }

      });
    }
  });

  var _ref3 = (0, _useThenable.default)(getInitialState),
      _ref4 = (0, _slicedToArray2.default)(_ref3, 2),
      isResolved = _ref4[0],
      initialState = _ref4[1];

  React.useImperativeHandle(ref, function () {
    return refContainer.current;
  });
  var linkingContext = React.useMemo(function () {
    return {
      options: linking
    };
  }, [linking]);
  var isReady = rest.initialState != null || !isLinkingEnabled || isResolved;
  var onReadyRef = React.useRef(onReady);
  React.useEffect(function () {
    onReadyRef.current = onReady;
  });
  React.useEffect(function () {
    if (isReady) {
      var _onReadyRef$current;

      (_onReadyRef$current = onReadyRef.current) === null || _onReadyRef$current === void 0 ? void 0 : _onReadyRef$current.call(onReadyRef);
    }
  }, [isReady]);

  if (!isReady) {
    return fallback;
  }

  return React.createElement(_LinkingContext.default.Provider, {
    value: linkingContext
  }, React.createElement(_ThemeProvider.default, {
    value: theme
  }, React.createElement(_core.BaseNavigationContainer, _extends({}, rest, {
    initialState: rest.initialState == null ? initialState : rest.initialState,
    ref: refContainer
  }))));
}

var NavigationContainer = React.forwardRef(NavigationContainerInner);
var _default = NavigationContainer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQWtEZ0IsVUFBbEU7QUFFQSxNQUFNTyxVQUFVLEdBQUdsQixLQUFLLENBQUNDLE1BQU5ELENBQWFOLE9BQWJNLENBQW5CO0FBRUFBLE9BQUssQ0FBQ0ssU0FBTkwsQ0FBZ0IsWUFBTTtBQUNwQmtCLGNBQVUsQ0FBQ1osT0FBWFksR0FBcUJ4QixPQUFyQndCO0FBREY7QUFJQWxCLE9BQUssQ0FBQ0ssU0FBTkwsQ0FBZ0IsWUFBTTtBQUNwQixRQUFJaUIsT0FBSixFQUFhO0FBQUE7O0FBQ1gsdUNBQVUsQ0FBQ1gsT0FBWDtBQUNEO0FBSEgsS0FJRyxDQUFDVyxPQUFELENBSkhqQjs7QUFNQSxNQUFJLENBQUNpQixPQUFMLEVBQWM7QUFHWixXQUFPekIsUUFBUDtBQUNEOztBQUVELFNBQ0VRLG9CQUFDbUIsd0JBQWVDLFFBQWhCO0FBQXlCQyxTQUFLLEVBQUVQO0FBQWhDLEtBQ0VkLG9CQUFDc0Isc0JBQUQ7QUFBZUQsU0FBSyxFQUFFaEM7QUFBdEIsS0FDRVcsb0JBQUN1Qiw2QkFBRCxlQUNNNUIsSUFETjtBQUVFaUIsZ0JBQVksRUFDVmpCLElBQUksQ0FBQ2lCLFlBQUxqQixJQUFxQixJQUFyQkEsR0FBNEJpQixZQUE1QmpCLEdBQTJDQSxJQUFJLENBQUNpQixZQUhwRDtBQUtFeEIsT0FBRyxFQUFFVztBQUxQLEtBREYsQ0FERixDQURGO0FBYUQ7O0FBRUQsSUFBTXlCLG1CQUFtQixHQUFHeEIsS0FBSyxDQUFDeUIsVUFBTnpCLENBQWlCYix3QkFBakJhLENBQTVCO2VBUWV3QiIsIm5hbWVzIjpbImdsb2JhbCIsIlJFQUNUX05BVklHQVRJT05fREVWVE9PTFMiLCJXZWFrTWFwIiwiTmF2aWdhdGlvbkNvbnRhaW5lcklubmVyIiwicmVmIiwidGhlbWUiLCJEZWZhdWx0VGhlbWUiLCJsaW5raW5nIiwiZmFsbGJhY2siLCJkb2N1bWVudFRpdGxlIiwib25SZWFkeSIsInJlc3QiLCJpc0xpbmtpbmdFbmFibGVkIiwiZW5hYmxlZCIsImNvbmZpZyIsInJlZkNvbnRhaW5lciIsIlJlYWN0IiwidXNlUmVmIiwiaW5kZXBlbmRlbnQiLCJwcmVmaXhlcyIsImdldEluaXRpYWxTdGF0ZSIsInVzZUVmZmVjdCIsImN1cnJlbnQiLCJzZXQiLCJnZXRTdGF0ZUZyb21QYXRoIiwiZ2V0UGF0aEZyb21TdGF0ZSIsImdldEFjdGlvbkZyb21TdGF0ZSIsImlzUmVzb2x2ZWQiLCJpbml0aWFsU3RhdGUiLCJ1c2VJbXBlcmF0aXZlSGFuZGxlIiwibGlua2luZ0NvbnRleHQiLCJ1c2VNZW1vIiwib3B0aW9ucyIsImlzUmVhZHkiLCJvblJlYWR5UmVmIiwiX0xpbmtpbmdDb250ZXh0IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIl9UaGVtZVByb3ZpZGVyIiwiX2NvcmUiLCJOYXZpZ2F0aW9uQ29udGFpbmVyIiwiZm9yd2FyZFJlZiJdLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25Db250YWluZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEJhc2VOYXZpZ2F0aW9uQ29udGFpbmVyLFxuICBnZXRBY3Rpb25Gcm9tU3RhdGUsXG4gIGdldFBhdGhGcm9tU3RhdGUsXG4gIGdldFN0YXRlRnJvbVBhdGgsXG4gIE5hdmlnYXRpb25Db250YWluZXJQcm9wcyxcbiAgTmF2aWdhdGlvbkNvbnRhaW5lclJlZixcbiAgUGFyYW1MaXN0QmFzZSxcbiAgdmFsaWRhdGVQYXRoQ29uZmlnLFxufSBmcm9tICdAcmVhY3QtbmF2aWdhdGlvbi9jb3JlJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IExpbmtpbmdDb250ZXh0IGZyb20gJy4vTGlua2luZ0NvbnRleHQnO1xuaW1wb3J0IERlZmF1bHRUaGVtZSBmcm9tICcuL3RoZW1pbmcvRGVmYXVsdFRoZW1lJztcbmltcG9ydCBUaGVtZVByb3ZpZGVyIGZyb20gJy4vdGhlbWluZy9UaGVtZVByb3ZpZGVyJztcbmltcG9ydCB0eXBlIHsgRG9jdW1lbnRUaXRsZU9wdGlvbnMsIExpbmtpbmdPcHRpb25zLCBUaGVtZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHVzZUJhY2tCdXR0b24gZnJvbSAnLi91c2VCYWNrQnV0dG9uJztcbmltcG9ydCB1c2VEb2N1bWVudFRpdGxlIGZyb20gJy4vdXNlRG9jdW1lbnRUaXRsZSc7XG5pbXBvcnQgdXNlTGlua2luZyBmcm9tICcuL3VzZUxpbmtpbmcnO1xuaW1wb3J0IHVzZVRoZW5hYmxlIGZyb20gJy4vdXNlVGhlbmFibGUnO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIHZhciBSRUFDVF9OQVZJR0FUSU9OX0RFVlRPT0xTOiBXZWFrTWFwPFxuICAgIE5hdmlnYXRpb25Db250YWluZXJSZWY8YW55PixcbiAgICB7IHJlYWRvbmx5IGxpbmtpbmc6IExpbmtpbmdPcHRpb25zPGFueT4gfVxuICA+O1xufVxuXG5nbG9iYWwuUkVBQ1RfTkFWSUdBVElPTl9ERVZUT09MUyA9IG5ldyBXZWFrTWFwKCk7XG5cbnR5cGUgUHJvcHM8UGFyYW1MaXN0IGV4dGVuZHMge30+ID0gTmF2aWdhdGlvbkNvbnRhaW5lclByb3BzICYge1xuICB0aGVtZT86IFRoZW1lO1xuICBsaW5raW5nPzogTGlua2luZ09wdGlvbnM8UGFyYW1MaXN0PjtcbiAgZmFsbGJhY2s/OiBSZWFjdC5SZWFjdE5vZGU7XG4gIGRvY3VtZW50VGl0bGU/OiBEb2N1bWVudFRpdGxlT3B0aW9ucztcbiAgb25SZWFkeT86ICgpID0+IHZvaWQ7XG59O1xuXG4vKipcbiAqIENvbnRhaW5lciBjb21wb25lbnQgd2hpY2ggaG9sZHMgdGhlIG5hdmlnYXRpb24gc3RhdGUgZGVzaWduZWQgZm9yIFJlYWN0IE5hdGl2ZSBhcHBzLlxuICogVGhpcyBzaG91bGQgYmUgcmVuZGVyZWQgYXQgdGhlIHJvb3Qgd3JhcHBpbmcgdGhlIHdob2xlIGFwcC5cbiAqXG4gKiBAcGFyYW0gcHJvcHMuaW5pdGlhbFN0YXRlIEluaXRpYWwgc3RhdGUgb2JqZWN0IGZvciB0aGUgbmF2aWdhdGlvbiB0cmVlLiBXaGVuIGRlZXAgbGluayBoYW5kbGluZyBpcyBlbmFibGVkLCB0aGlzIHdpbGwgb3ZlcnJpZGUgZGVlcCBsaW5rcyB3aGVuIHNwZWNpZmllZC4gTWFrZSBzdXJlIHRoYXQgeW91IGRvbid0IHNwZWNpZnkgYW4gYGluaXRpYWxTdGF0ZWAgd2hlbiB0aGVyZSdzIGEgZGVlcCBsaW5rIChgTGlua2luZy5nZXRJbml0aWFsVVJMKClgKS5cbiAqIEBwYXJhbSBwcm9wcy5vblJlYWR5IENhbGxiYWNrIHdoaWNoIGlzIGNhbGxlZCBhZnRlciB0aGUgbmF2aWdhdGlvbiB0cmVlIG1vdW50cy5cbiAqIEBwYXJhbSBwcm9wcy5vblN0YXRlQ2hhbmdlIENhbGxiYWNrIHdoaWNoIGlzIGNhbGxlZCB3aXRoIHRoZSBsYXRlc3QgbmF2aWdhdGlvbiBzdGF0ZSB3aGVuIGl0IGNoYW5nZXMuXG4gKiBAcGFyYW0gcHJvcHMudGhlbWUgVGhlbWUgb2JqZWN0IGZvciB0aGUgbmF2aWdhdG9ycy5cbiAqIEBwYXJhbSBwcm9wcy5saW5raW5nIE9wdGlvbnMgZm9yIGRlZXAgbGlua2luZy4gRGVlcCBsaW5rIGhhbmRsaW5nIGlzIGVuYWJsZWQgd2hlbiB0aGlzIHByb3AgaXMgcHJvdmlkZWQsIHVubGVzcyBgbGlua2luZy5lbmFibGVkYCBpcyBgZmFsc2VgLlxuICogQHBhcmFtIHByb3BzLmZhbGxiYWNrIEZhbGxiYWNrIGNvbXBvbmVudCB0byByZW5kZXIgdW50aWwgd2UgaGF2ZSBmaW5pc2hlZCBnZXR0aW5nIGluaXRpYWwgc3RhdGUgd2hlbiBsaW5raW5nIGlzIGVuYWJsZWQuIERlZmF1bHRzIHRvIGBudWxsYC5cbiAqIEBwYXJhbSBwcm9wcy5kb2N1bWVudFRpdGxlIE9wdGlvbnMgdG8gY29uZmlndXJlIHRoZSBkb2N1bWVudCB0aXRsZSBvbiBXZWIuIFVwZGF0aW5nIGRvY3VtZW50IHRpdGxlIGlzIGhhbmRsZWQgYnkgZGVmYXVsdCB1bmxlc3MgYGRvY3VtZW50VGl0bGUuZW5hYmxlZGAgaXMgYGZhbHNlYC5cbiAqIEBwYXJhbSBwcm9wcy5jaGlsZHJlbiBDaGlsZCBlbGVtZW50cyB0byByZW5kZXIgdGhlIGNvbnRlbnQuXG4gKiBAcGFyYW0gcHJvcHMucmVmIFJlZiBvYmplY3Qgd2hpY2ggcmVmZXJzIHRvIHRoZSBuYXZpZ2F0aW9uIG9iamVjdCBjb250YWluaW5nIGhlbHBlciBtZXRob2RzLlxuICovXG5mdW5jdGlvbiBOYXZpZ2F0aW9uQ29udGFpbmVySW5uZXIoXG4gIHtcbiAgICB0aGVtZSA9IERlZmF1bHRUaGVtZSxcbiAgICBsaW5raW5nLFxuICAgIGZhbGxiYWNrID0gbnVsbCxcbiAgICBkb2N1bWVudFRpdGxlLFxuICAgIG9uUmVhZHksXG4gICAgLi4ucmVzdFxuICB9OiBQcm9wczxQYXJhbUxpc3RCYXNlPixcbiAgcmVmPzogUmVhY3QuUmVmPE5hdmlnYXRpb25Db250YWluZXJSZWY8UGFyYW1MaXN0QmFzZT4gfCBudWxsPlxuKSB7XG4gIGNvbnN0IGlzTGlua2luZ0VuYWJsZWQgPSBsaW5raW5nID8gbGlua2luZy5lbmFibGVkICE9PSBmYWxzZSA6IGZhbHNlO1xuXG4gIGlmIChsaW5raW5nPy5jb25maWcpIHtcbiAgICB2YWxpZGF0ZVBhdGhDb25maWcobGlua2luZy5jb25maWcpO1xuICB9XG5cbiAgY29uc3QgcmVmQ29udGFpbmVyID1cbiAgICBSZWFjdC51c2VSZWY8TmF2aWdhdGlvbkNvbnRhaW5lclJlZjxQYXJhbUxpc3RCYXNlPj4obnVsbCk7XG5cbiAgdXNlQmFja0J1dHRvbihyZWZDb250YWluZXIpO1xuICB1c2VEb2N1bWVudFRpdGxlKHJlZkNvbnRhaW5lciwgZG9jdW1lbnRUaXRsZSk7XG5cbiAgY29uc3QgeyBnZXRJbml0aWFsU3RhdGUgfSA9IHVzZUxpbmtpbmcocmVmQ29udGFpbmVyLCB7XG4gICAgaW5kZXBlbmRlbnQ6IHJlc3QuaW5kZXBlbmRlbnQsXG4gICAgZW5hYmxlZDogaXNMaW5raW5nRW5hYmxlZCxcbiAgICBwcmVmaXhlczogW10sXG4gICAgLi4ubGlua2luZyxcbiAgfSk7XG5cbiAgLy8gQWRkIGFkZGl0aW9uYWwgbGlua2luZyByZWxhdGVkIGluZm8gdG8gdGhlIHJlZlxuICAvLyBUaGlzIHdpbGwgYmUgdXNlZCBieSB0aGUgZGV2dG9vbHNcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAocmVmQ29udGFpbmVyLmN1cnJlbnQpIHtcbiAgICAgIFJFQUNUX05BVklHQVRJT05fREVWVE9PTFMuc2V0KHJlZkNvbnRhaW5lci5jdXJyZW50LCB7XG4gICAgICAgIGdldCBsaW5raW5nKCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5saW5raW5nLFxuICAgICAgICAgICAgZW5hYmxlZDogaXNMaW5raW5nRW5hYmxlZCxcbiAgICAgICAgICAgIHByZWZpeGVzOiBsaW5raW5nPy5wcmVmaXhlcyA/PyBbXSxcbiAgICAgICAgICAgIGdldFN0YXRlRnJvbVBhdGg6IGxpbmtpbmc/LmdldFN0YXRlRnJvbVBhdGggPz8gZ2V0U3RhdGVGcm9tUGF0aCxcbiAgICAgICAgICAgIGdldFBhdGhGcm9tU3RhdGU6IGxpbmtpbmc/LmdldFBhdGhGcm9tU3RhdGUgPz8gZ2V0UGF0aEZyb21TdGF0ZSxcbiAgICAgICAgICAgIGdldEFjdGlvbkZyb21TdGF0ZTpcbiAgICAgICAgICAgICAgbGlua2luZz8uZ2V0QWN0aW9uRnJvbVN0YXRlID8/IGdldEFjdGlvbkZyb21TdGF0ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBbaXNSZXNvbHZlZCwgaW5pdGlhbFN0YXRlXSA9IHVzZVRoZW5hYmxlKGdldEluaXRpYWxTdGF0ZSk7XG5cbiAgUmVhY3QudXNlSW1wZXJhdGl2ZUhhbmRsZShyZWYsICgpID0+IHJlZkNvbnRhaW5lci5jdXJyZW50KTtcblxuICBjb25zdCBsaW5raW5nQ29udGV4dCA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gKHsgb3B0aW9uczogbGlua2luZyB9KSwgW2xpbmtpbmddKTtcblxuICBjb25zdCBpc1JlYWR5ID0gcmVzdC5pbml0aWFsU3RhdGUgIT0gbnVsbCB8fCAhaXNMaW5raW5nRW5hYmxlZCB8fCBpc1Jlc29sdmVkO1xuXG4gIGNvbnN0IG9uUmVhZHlSZWYgPSBSZWFjdC51c2VSZWYob25SZWFkeSk7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBvblJlYWR5UmVmLmN1cnJlbnQgPSBvblJlYWR5O1xuICB9KTtcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChpc1JlYWR5KSB7XG4gICAgICBvblJlYWR5UmVmLmN1cnJlbnQ/LigpO1xuICAgIH1cbiAgfSwgW2lzUmVhZHldKTtcblxuICBpZiAoIWlzUmVhZHkpIHtcbiAgICAvLyBUaGlzIGlzIHRlbXBvcmFyeSB1bnRpbCB3ZSBoYXZlIFN1c3BlbnNlIGZvciBkYXRhLWZldGNoaW5nXG4gICAgLy8gVGhlbiB0aGUgZmFsbGJhY2sgd2lsbCBiZSBoYW5kbGVkIGJ5IGEgcGFyZW50IGBTdXNwZW5zZWAgY29tcG9uZW50XG4gICAgcmV0dXJuIGZhbGxiYWNrIGFzIFJlYWN0LlJlYWN0RWxlbWVudDtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPExpbmtpbmdDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtsaW5raW5nQ29udGV4dH0+XG4gICAgICA8VGhlbWVQcm92aWRlciB2YWx1ZT17dGhlbWV9PlxuICAgICAgICA8QmFzZU5hdmlnYXRpb25Db250YWluZXJcbiAgICAgICAgICB7Li4ucmVzdH1cbiAgICAgICAgICBpbml0aWFsU3RhdGU9e1xuICAgICAgICAgICAgcmVzdC5pbml0aWFsU3RhdGUgPT0gbnVsbCA/IGluaXRpYWxTdGF0ZSA6IHJlc3QuaW5pdGlhbFN0YXRlXG4gICAgICAgICAgfVxuICAgICAgICAgIHJlZj17cmVmQ29udGFpbmVyfVxuICAgICAgICAvPlxuICAgICAgPC9UaGVtZVByb3ZpZGVyPlxuICAgIDwvTGlua2luZ0NvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59XG5cbmNvbnN0IE5hdmlnYXRpb25Db250YWluZXIgPSBSZWFjdC5mb3J3YXJkUmVmKE5hdmlnYXRpb25Db250YWluZXJJbm5lcikgYXMgPFxuICBSb290UGFyYW1MaXN0IGV4dGVuZHMge30gPSBSZWFjdE5hdmlnYXRpb24uUm9vdFBhcmFtTGlzdFxuPihcbiAgcHJvcHM6IFByb3BzPFJvb3RQYXJhbUxpc3Q+ICYge1xuICAgIHJlZj86IFJlYWN0LlJlZjxOYXZpZ2F0aW9uQ29udGFpbmVyUmVmPFJvb3RQYXJhbUxpc3Q+PjtcbiAgfVxuKSA9PiBSZWFjdC5SZWFjdEVsZW1lbnQ7XG5cbmV4cG9ydCBkZWZhdWx0IE5hdmlnYXRpb25Db250YWluZXI7XG4iXX0=