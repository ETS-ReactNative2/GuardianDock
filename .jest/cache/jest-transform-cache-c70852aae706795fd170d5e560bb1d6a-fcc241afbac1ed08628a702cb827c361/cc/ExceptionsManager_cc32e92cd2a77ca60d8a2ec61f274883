3b59a7ba407b48061f103c25e601c3e1
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _wrapNativeSuper2 = _interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var SyntheticError = function (_Error) {
  (0, _inherits2.default)(SyntheticError, _Error);

  var _super = _createSuper(SyntheticError);

  function SyntheticError() {
    var _this;

    (0, _classCallCheck2.default)(this, SyntheticError);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this.name = '';
    return _this;
  }

  return (0, _createClass2.default)(SyntheticError);
}((0, _wrapNativeSuper2.default)(Error));

var userExceptionDecorator;
var inUserExceptionDecorator = false;

function unstable_setExceptionDecorator(exceptionDecorator) {
  userExceptionDecorator = exceptionDecorator;
}

function preprocessException(data) {
  if (userExceptionDecorator && !inUserExceptionDecorator) {
    inUserExceptionDecorator = true;

    try {
      return userExceptionDecorator(data);
    } catch (_unused) {} finally {
      inUserExceptionDecorator = false;
    }
  }

  return data;
}

var exceptionID = 0;

function reportException(e, isFatal, reportToConsole) {
  var parseErrorStack = require("./Devtools/parseErrorStack");

  var stack = parseErrorStack(e == null ? void 0 : e.stack);
  var currentExceptionID = ++exceptionID;
  var originalMessage = e.message || '';
  var message = originalMessage;

  if (e.componentStack != null) {
    message += "\n\nThis error is located at:" + e.componentStack;
  }

  var namePrefix = e.name == null || e.name === '' ? '' : e.name + ": ";

  if (!message.startsWith(namePrefix)) {
    message = namePrefix + message;
  }

  message = e.jsEngine == null ? message : message + ", js engine: " + e.jsEngine;
  var data = preprocessException({
    message: message,
    originalMessage: message === originalMessage ? null : originalMessage,
    name: e.name == null || e.name === '' ? null : e.name,
    componentStack: typeof e.componentStack === 'string' ? e.componentStack : null,
    stack: stack,
    id: currentExceptionID,
    isFatal: isFatal,
    extraData: {
      jsEngine: e.jsEngine,
      rawStack: e.stack
    }
  });

  if (reportToConsole) {
    console.error(data.message);
  }

  if (__DEV__) {
    var LogBox = require("../LogBox/LogBox");

    LogBox.addException((0, _extends2.default)({}, data, {
      isComponentError: !!e.isComponentError
    }));
  } else if (isFatal || e.type !== 'warn') {
    var NativeExceptionsManager = require("./NativeExceptionsManager").default;

    if (NativeExceptionsManager) {
      NativeExceptionsManager.reportException(data);
    }
  }
}

var inExceptionHandler = false;

function handleException(e, isFatal) {
  var error;

  if (e instanceof Error) {
    error = e;
  } else {
    error = new SyntheticError(e);
  }

  try {
    inExceptionHandler = true;
    reportException(error, isFatal, true);
  } finally {
    inExceptionHandler = false;
  }
}

function reactConsoleErrorHandler() {
  var _console;

  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
    args[_key2] = arguments[_key2];
  }

  (_console = console)._errorOriginal.apply(_console, args);

  if (!console.reportErrorsAsExceptions) {
    return;
  }

  if (inExceptionHandler) {
    return;
  }

  var error;
  var firstArg = args[0];

  if (firstArg != null && firstArg.stack) {
    error = firstArg;
  } else {
    var stringifySafe = require("../Utilities/stringifySafe").default;

    if (typeof firstArg === 'string' && firstArg.startsWith('Warning: ')) {
      return;
    }

    var message = args.map(function (arg) {
      return typeof arg === 'string' ? arg : stringifySafe(arg);
    }).join(' ');
    error = new SyntheticError(message);
    error.name = 'console.error';
  }

  reportException(error, false, false);
}

function installConsoleErrorReporter() {
  if (console._errorOriginal) {
    return;
  }

  console._errorOriginal = console.error.bind(console);
  console.error = reactConsoleErrorHandler;

  if (console.reportErrorsAsExceptions === undefined) {
    console.reportErrorsAsExceptions = true;
  }
}

module.exports = {
  handleException: handleException,
  installConsoleErrorReporter: installConsoleErrorReporter,
  SyntheticError: SyntheticError,
  unstable_setExceptionDecorator: unstable_setExceptionDecorator
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4Y2VwdGlvbnNNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIlN5bnRoZXRpY0Vycm9yIiwibmFtZSIsIkVycm9yIiwidXNlckV4Y2VwdGlvbkRlY29yYXRvciIsImluVXNlckV4Y2VwdGlvbkRlY29yYXRvciIsInVuc3RhYmxlX3NldEV4Y2VwdGlvbkRlY29yYXRvciIsImV4Y2VwdGlvbkRlY29yYXRvciIsInByZXByb2Nlc3NFeGNlcHRpb24iLCJkYXRhIiwiZXhjZXB0aW9uSUQiLCJyZXBvcnRFeGNlcHRpb24iLCJlIiwiaXNGYXRhbCIsInJlcG9ydFRvQ29uc29sZSIsInBhcnNlRXJyb3JTdGFjayIsInJlcXVpcmUiLCJzdGFjayIsImN1cnJlbnRFeGNlcHRpb25JRCIsIm9yaWdpbmFsTWVzc2FnZSIsIm1lc3NhZ2UiLCJjb21wb25lbnRTdGFjayIsIm5hbWVQcmVmaXgiLCJzdGFydHNXaXRoIiwianNFbmdpbmUiLCJpZCIsImV4dHJhRGF0YSIsInJhd1N0YWNrIiwiY29uc29sZSIsImVycm9yIiwiX19ERVZfXyIsIkxvZ0JveCIsImFkZEV4Y2VwdGlvbiIsImlzQ29tcG9uZW50RXJyb3IiLCJ0eXBlIiwiTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIiLCJkZWZhdWx0IiwiaW5FeGNlcHRpb25IYW5kbGVyIiwiaGFuZGxlRXhjZXB0aW9uIiwicmVhY3RDb25zb2xlRXJyb3JIYW5kbGVyIiwiYXJncyIsIl9lcnJvck9yaWdpbmFsIiwicmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zIiwiZmlyc3RBcmciLCJzdHJpbmdpZnlTYWZlIiwibWFwIiwiYXJnIiwiam9pbiIsImluc3RhbGxDb25zb2xlRXJyb3JSZXBvcnRlciIsImJpbmQiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUtNQSxjOzs7Ozs7Ozs7Ozs7Ozs7VUFDSkMsSSxHQUFlLEU7Ozs7O2lDQURZQyxLOztBQU03QixJQUFJ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T0FBUCxHQUFpQjtBQUNmZCxFQUFBQSxlQUFlLEVBQWZBLGVBRGU7QUFFZlUsRUFBQUEsMkJBQTJCLEVBQTNCQSwyQkFGZTtBQUdmL0MsRUFBQUEsY0FBYyxFQUFkQSxjQUhlO0FBSWZLLEVBQUFBLDhCQUE4QixFQUE5QkE7QUFKZSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7RXh0ZW5kZWRFcnJvcn0gZnJvbSAnLi9FeHRlbmRlZEVycm9yJztcbmltcG9ydCB0eXBlIHtFeGNlcHRpb25EYXRhfSBmcm9tICcuL05hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyJztcblxuY2xhc3MgU3ludGhldGljRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIG5hbWU6IHN0cmluZyA9ICcnO1xufVxuXG50eXBlIEV4Y2VwdGlvbkRlY29yYXRvciA9IEV4Y2VwdGlvbkRhdGEgPT4gRXhjZXB0aW9uRGF0YTtcblxubGV0IHVzZXJFeGNlcHRpb25EZWNvcmF0b3I6ID9FeGNlcHRpb25EZWNvcmF0b3I7XG5sZXQgaW5Vc2VyRXhjZXB0aW9uRGVjb3JhdG9yID0gZmFsc2U7XG5cbi8qKlxuICogQWxsb3dzIHRoZSBhcHAgdG8gYWRkIGluZm9ybWF0aW9uIHRvIHRoZSBleGNlcHRpb24gcmVwb3J0IGJlZm9yZSBpdCBpcyBzZW50XG4gKiB0byBuYXRpdmUuIFRoaXMgQVBJIGlzIG5vdCBmaW5hbC5cbiAqL1xuXG5mdW5jdGlvbiB1bnN0YWJsZV9zZXRFeGNlcHRpb25EZWNvcmF0b3IoXG4gIGV4Y2VwdGlvbkRlY29yYXRvcjogP0V4Y2VwdGlvbkRlY29yYXRvcixcbikge1xuICB1c2VyRXhjZXB0aW9uRGVjb3JhdG9yID0gZXhjZXB0aW9uRGVjb3JhdG9yO1xufVxuXG5mdW5jdGlvbiBwcmVwcm9jZXNzRXhjZXB0aW9uKGRhdGE6IEV4Y2VwdGlvbkRhdGEpOiBFeGNlcHRpb25EYXRhIHtcbiAgaWYgKHVzZXJFeGNlcHRpb25EZWNvcmF0b3IgJiYgIWluVXNlckV4Y2VwdGlvbkRlY29yYXRvcikge1xuICAgIGluVXNlckV4Y2VwdGlvbkRlY29yYXRvciA9IHRydWU7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB1c2VyRXhjZXB0aW9uRGVjb3JhdG9yKGRhdGEpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gRmFsbCB0aHJvdWdoXG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGluVXNlckV4Y2VwdGlvbkRlY29yYXRvciA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXZlbG9wZXItdmlzaWJsZSBhc3BlY3Qgb2YgZXJyb3JzIGFuZCBleGNlcHRpb25zXG4gKi9cbmxldCBleGNlcHRpb25JRCA9IDA7XG5mdW5jdGlvbiByZXBvcnRFeGNlcHRpb24oXG4gIGU6IEV4dGVuZGVkRXJyb3IsXG4gIGlzRmF0YWw6IGJvb2xlYW4sXG4gIHJlcG9ydFRvQ29uc29sZTogYm9vbGVhbiwgLy8gb25seSB0cnVlIHdoZW4gY29taW5nIGZyb20gaGFuZGxlRXhjZXB0aW9uOyB0aGUgZXJyb3IgaGFzIG5vdCB5ZXQgYmVlbiBsb2dnZWRcbikge1xuICBjb25zdCBwYXJzZUVycm9yU3RhY2sgPSByZXF1aXJlKCcuL0RldnRvb2xzL3BhcnNlRXJyb3JTdGFjaycpO1xuICBjb25zdCBzdGFjayA9IHBhcnNlRXJyb3JTdGFjayhlPy5zdGFjayk7XG4gIGNvbnN0IGN1cnJlbnRFeGNlcHRpb25JRCA9ICsrZXhjZXB0aW9uSUQ7XG4gIGNvbnN0IG9yaWdpbmFsTWVzc2FnZSA9IGUubWVzc2FnZSB8fCAnJztcbiAgbGV0IG1lc3NhZ2UgPSBvcmlnaW5hbE1lc3NhZ2U7XG4gIGlmIChlLmNvbXBvbmVudFN0YWNrICE9IG51bGwpIHtcbiAgICBtZXNzYWdlICs9IGBcXG5cXG5UaGlzIGVycm9yIGlzIGxvY2F0ZWQgYXQ6JHtlLmNvbXBvbmVudFN0YWNrfWA7XG4gIH1cbiAgY29uc3QgbmFtZVByZWZpeCA9IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyAnJyA6IGAke2UubmFtZX06IGA7XG5cbiAgaWYgKCFtZXNzYWdlLnN0YXJ0c1dpdGgobmFtZVByZWZpeCkpIHtcbiAgICBtZXNzYWdlID0gbmFtZVByZWZpeCArIG1lc3NhZ2U7XG4gIH1cblxuICBtZXNzYWdlID1cbiAgICBlLmpzRW5naW5lID09IG51bGwgPyBtZXNzYWdlIDogYCR7bWVzc2FnZX0sIGpzIGVuZ2luZTogJHtlLmpzRW5naW5lfWA7XG5cbiAgY29uc3QgZGF0YSA9IHByZXByb2Nlc3NFeGNlcHRpb24oe1xuICAgIG1lc3NhZ2UsXG4gICAgb3JpZ2luYWxNZXNzYWdlOiBtZXNzYWdlID09PSBvcmlnaW5hbE1lc3NhZ2UgPyBudWxsIDogb3JpZ2luYWxNZXNzYWdlLFxuICAgIG5hbWU6IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyBudWxsIDogZS5uYW1lLFxuICAgIGNvbXBvbmVudFN0YWNrOlxuICAgICAgdHlwZW9mIGUuY29tcG9uZW50U3RhY2sgPT09ICdzdHJpbmcnID8gZS5jb21wb25lbnRTdGFjayA6IG51bGwsXG4gICAgc3RhY2ssXG4gICAgaWQ6IGN1cnJlbnRFeGNlcHRpb25JRCxcbiAgICBpc0ZhdGFsLFxuICAgIGV4dHJhRGF0YToge1xuICAgICAganNFbmdpbmU6IGUuanNFbmdpbmUsXG4gICAgICByYXdTdGFjazogZS5zdGFjayxcbiAgICB9LFxuICB9KTtcblxuICBpZiAocmVwb3J0VG9Db25zb2xlKSB7XG4gICAgLy8gd2UgZmVlZCBiYWNrIGludG8gY29uc29sZS5lcnJvciwgdG8gbWFrZSBzdXJlIGFueSBtZXRob2RzIHRoYXQgYXJlXG4gICAgLy8gbW9ua2V5IHBhdGNoZWQgb24gdG9wIG9mIGNvbnNvbGUuZXJyb3IgYXJlIGNhbGxlZCB3aGVuIGNvbWluZyBmcm9tXG4gICAgLy8gaGFuZGxlRXhjZXB0aW9uXG4gICAgY29uc29sZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICB9XG5cbiAgaWYgKF9fREVWX18pIHtcbiAgICBjb25zdCBMb2dCb3ggPSByZXF1aXJlKCcuLi9Mb2dCb3gvTG9nQm94Jyk7XG4gICAgTG9nQm94LmFkZEV4Y2VwdGlvbih7XG4gICAgICAuLi5kYXRhLFxuICAgICAgaXNDb21wb25lbnRFcnJvcjogISFlLmlzQ29tcG9uZW50RXJyb3IsXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoaXNGYXRhbCB8fCBlLnR5cGUgIT09ICd3YXJuJykge1xuICAgIGNvbnN0IE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyID0gcmVxdWlyZSgnLi9OYXRpdmVFeGNlcHRpb25zTWFuYWdlcicpXG4gICAgICAuZGVmYXVsdDtcbiAgICBpZiAoTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIpIHtcbiAgICAgIE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyLnJlcG9ydEV4Y2VwdGlvbihkYXRhKTtcbiAgICB9XG4gIH1cbn1cblxuZGVjbGFyZSB2YXIgY29uc29sZTogdHlwZW9mIGNvbnNvbGUgJiB7XG4gIF9lcnJvck9yaWdpbmFsOiB0eXBlb2YgY29uc29sZS5lcnJvcixcbiAgcmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zOiBib29sZWFuLFxuICAuLi5cbn07XG5cbi8vIElmIHdlIHRyaWdnZXIgY29uc29sZS5lcnJvciBfZnJvbV8gaGFuZGxlRXhjZXB0aW9uLFxuLy8gd2UgZG8gd2FudCB0byBtYWtlIHN1cmUgdGhhdCBjb25zb2xlLmVycm9yIGRvZXNuJ3QgdHJpZ2dlciBlcnJvciByZXBvcnRpbmcgYWdhaW5cbmxldCBpbkV4Y2VwdGlvbkhhbmRsZXIgPSBmYWxzZTtcblxuLyoqXG4gKiBMb2dzIGV4Y2VwdGlvbnMgdG8gdGhlIChuYXRpdmUpIGNvbnNvbGUgYW5kIGRpc3BsYXlzIHRoZW1cbiAqL1xuZnVuY3Rpb24gaGFuZGxlRXhjZXB0aW9uKGU6IG1peGVkLCBpc0ZhdGFsOiBib29sZWFuKSB7XG4gIGxldCBlcnJvcjogRXJyb3I7XG4gIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBlcnJvciA9IGU7XG4gIH0gZWxzZSB7XG4gICAgLy8gV29ya2Fyb3VuZCBmb3IgcmVwb3J0aW5nIGVycm9ycyBjYXVzZWQgYnkgYHRocm93ICdzb21lIHN0cmluZydgXG4gICAgLy8gVW5mb3J0dW5hdGVseSB0aGVyZSBpcyBubyB3YXkgdG8gZmlndXJlIG91dCB0aGUgc3RhY2t0cmFjZSBpbiB0aGlzXG4gICAgLy8gY2FzZSwgc28gaWYgeW91IGVuZGVkIHVwIGhlcmUgdHJ5aW5nIHRvIHRyYWNlIGFuIGVycm9yLCBsb29rIGZvclxuICAgIC8vIGB0aHJvdyAnPGVycm9yIG1lc3NhZ2U+J2Agc29tZXdoZXJlIGluIHlvdXIgY29kZWJhc2UuXG4gICAgZXJyb3IgPSBuZXcgU3ludGhldGljRXJyb3IoZSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBpbkV4Y2VwdGlvbkhhbmRsZXIgPSB0cnVlO1xuICAgIC8qICRGbG93Rml4TWVbY2xhc3Mtb2JqZWN0LXN1YnR5cGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzXG4gICAgICogcGFyYW1ldGVycyAqL1xuICAgIHJlcG9ydEV4Y2VwdGlvbihlcnJvciwgaXNGYXRhbCwgLypyZXBvcnRUb0NvbnNvbGUqLyB0cnVlKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpbkV4Y2VwdGlvbkhhbmRsZXIgPSBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZWFjdENvbnNvbGVFcnJvckhhbmRsZXIoLi4uYXJncykge1xuICAvLyBidWJibGUgdXAgdG8gYW55IG9yaWdpbmFsIGhhbmRsZXJzXG4gIGNvbnNvbGUuX2Vycm9yT3JpZ2luYWwoLi4uYXJncyk7XG4gIGlmICghY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGluRXhjZXB0aW9uSGFuZGxlcikge1xuICAgIC8vIFRoZSBmdW5kYW1lbnRhbCB0cmljayBoZXJlIGlzIHRoYXQgYXJlIG11bHRpcGxlIGVudHJ5IHBvaW50IHRvIGxvZ2dpbmcgZXJyb3JzOlxuICAgIC8vIChzZWUgRDE5NzQzMDc1IGZvciBtb3JlIGJhY2tncm91bmQpXG4gICAgLy9cbiAgICAvLyAxLiBBbiB1bmNhdWdodCBleGNlcHRpb24gYmVpbmcgY2F1Z2h0IGJ5IHRoZSBnbG9iYWwgaGFuZGxlclxuICAgIC8vIDIuIEFuIGVycm9yIGJlaW5nIGxvZ2dlZCB0aHJvdyBjb25zb2xlLmVycm9yXG4gICAgLy9cbiAgICAvLyBIb3dldmVyLCBjb25zb2xlLmVycm9yIGlzIG1vbmtleSBwYXRjaGVkIG11bHRpcGxlIHRpbWVzOiBieSB0aGlzIG1vZHVsZSwgYW5kIGJ5IHRoZVxuICAgIC8vIERldlRvb2xzIHNldHVwIHRoYXQgc2VuZHMgbWVzc2FnZXMgdG8gTWV0cm8uXG4gICAgLy8gVGhlIHBhdGNoaW5nIG9yZGVyIGNhbm5vdCBiZSByZWxpZWQgdXBvbi5cbiAgICAvL1xuICAgIC8vIFNvLCBzb21lIHNjZW5hcmlvcyB0aGF0IGFyZSBoYW5kbGVkIGJ5IHRoaXMgZmxhZzpcbiAgICAvL1xuICAgIC8vIExvZ2dpbmcgYW4gZXJyb3I6XG4gICAgLy8gMS4gY29uc29sZS5lcnJvciBjYWxsZWQgZnJvbSB1c2VyIGNvZGVcbiAgICAvLyAyLiAocG9zc2libHkpIGFycml2ZXMgX2ZpcnN0XyBhdCBEZXZUb29sIGhhbmRsZXIsIHNlbmQgdG8gTWV0cm9cbiAgICAvLyAzLiBCdWJibGVzIHRvIGhlcmVcbiAgICAvLyA0LiBnb2VzIGludG8gcmVwb3J0IEV4Y2VwdGlvbi5cbiAgICAvLyA1LiBzaG91bGQgbm90IHRyaWdnZXIgY29uc29sZS5lcnJvciBhZ2FpbiwgdG8gYXZvaWQgbG9vcGluZyAvIGxvZ2dpbmcgdHdpY2VcbiAgICAvLyA2LiBzaG91bGQgc3RpbGwgYnViYmxlIHVwIHRvIG9yaWdpbmFsIGNvbnNvbGVcbiAgICAvLyAgICAod2hpY2ggbWlnaHQgZWl0aGVyIGJlIGNvbnNvbGUubG9nLCBvciB0aGUgRGV2VG9vbHMgaGFuZGxlciBpbiBjYXNlIGl0IHBhdGNoZWQgX2VhcmxpZXJfIGFuZCAoMikgZGlkbid0IGhhcHBlbilcbiAgICAvL1xuICAgIC8vIFRocm93aW5nIGFuIHVuY2F1Z2h0IGV4Y2VwdGlvbjpcbiAgICAvLyAxLiBleGNlcHRpb24gdGhyb3duXG4gICAgLy8gMi4gcGlja2VkIHVwIGJ5IGhhbmRsZUV4Y2VwdGlvblxuICAgIC8vIDMuIHNob3VsZCBiZSBzZW5kIHRvIGNvbnNvbGUuZXJyb3IgKG5vdCBjb25zb2xlLl9lcnJvck9yaWdpbmFsLCBhcyBEZXZUb29scyBtaWdodCBoYXZlIHBhdGNoZWQgX2xhdGVyXyBhbmQgaXQgbmVlZHMgdG8gc2VuZCBpdCB0byBNZXRybylcbiAgICAvLyA0LiB0aGF0IF9taWdodF8gYnViYmxlIGFnYWluIHRvIHRoZSBgcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVgIGRlZmluZWQgaGVyZVxuICAgIC8vICAgIC0+IHNob3VsZCBub3QgaGFuZGxlIGV4Y2VwdGlvbiBfYWdhaW5fLCB0byBhdm9pZCBsb29waW5nIC8gc2hvd2luZyB0d2ljZSAodGhpcyBjb2RlIGJyYW5jaClcbiAgICAvLyA1LiBzaG91bGQgc3RpbGwgYnViYmxlIHVwIHRvIG9yaWdpbmFsIGNvbnNvbGUgKHdoaWNoIG1pZ2h0IGVpdGhlciBiZSBjb25zb2xlLmxvZywgb3IgdGhlIERldlRvb2xzIGhhbmRsZXIgaW4gY2FzZSB0aGF0IG9uZSBwYXRjaGVkIF9lYXJsaWVyXylcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgZXJyb3I7XG5cbiAgY29uc3QgZmlyc3RBcmcgPSBhcmdzWzBdO1xuICBpZiAoZmlyc3RBcmc/LnN0YWNrKSB7XG4gICAgLy8gcmVwb3J0RXhjZXB0aW9uIHdpbGwgY29uc29sZS5lcnJvciB0aGlzIHdpdGggaGlnaCBlbm91Z2ggZmlkZWxpdHkuXG4gICAgZXJyb3IgPSBmaXJzdEFyZztcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBzdHJpbmdpZnlTYWZlID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL3N0cmluZ2lmeVNhZmUnKS5kZWZhdWx0O1xuICAgIGlmICh0eXBlb2YgZmlyc3RBcmcgPT09ICdzdHJpbmcnICYmIGZpcnN0QXJnLnN0YXJ0c1dpdGgoJ1dhcm5pbmc6ICcpKSB7XG4gICAgICAvLyBSZWFjdCB3YXJuaW5ncyB1c2UgY29uc29sZS5lcnJvciBzbyB0aGF0IGEgc3RhY2sgdHJhY2UgaXMgc2hvd24sIGJ1dFxuICAgICAgLy8gd2UgZG9uJ3QgKGN1cnJlbnRseSkgd2FudCB0aGVzZSB0byBzaG93IGEgcmVkYm94XG4gICAgICAvLyAoTm90ZTogTG9naWMgZHVwbGljYXRlZCBpbiBwb2x5ZmlsbHMvY29uc29sZS5qcy4pXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBhcmdzXG4gICAgICAubWFwKGFyZyA9PiAodHlwZW9mIGFyZyA9PT0gJ3N0cmluZycgPyBhcmcgOiBzdHJpbmdpZnlTYWZlKGFyZykpKVxuICAgICAgLmpvaW4oJyAnKTtcblxuICAgIGVycm9yID0gbmV3IFN5bnRoZXRpY0Vycm9yKG1lc3NhZ2UpO1xuICAgIGVycm9yLm5hbWUgPSAnY29uc29sZS5lcnJvcic7XG4gIH1cblxuICByZXBvcnRFeGNlcHRpb24oXG4gICAgLyogJEZsb3dGaXhNZVtjbGFzcy1vYmplY3Qtc3VidHlwaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yIHRoaXNcbiAgICAgKiBwYXJhbWV0ZXJzICovXG4gICAgZXJyb3IsXG4gICAgZmFsc2UsIC8vIGlzRmF0YWxcbiAgICBmYWxzZSwgLy8gcmVwb3J0VG9Db25zb2xlXG4gICk7XG59XG5cbi8qKlxuICogU2hvd3MgYSByZWRib3ggd2l0aCBzdGFja3RyYWNlIGZvciBhbGwgY29uc29sZS5lcnJvciBtZXNzYWdlcy4gIERpc2FibGUgYnlcbiAqIHNldHRpbmcgYGNvbnNvbGUucmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zID0gZmFsc2U7YCBpbiB5b3VyIGFwcC5cbiAqL1xuZnVuY3Rpb24gaW5zdGFsbENvbnNvbGVFcnJvclJlcG9ydGVyKCkge1xuICAvLyBFbmFibGUgcmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zXG4gIGlmIChjb25zb2xlLl9lcnJvck9yaWdpbmFsKSB7XG4gICAgcmV0dXJuOyAvLyBhbHJlYWR5IGluc3RhbGxlZFxuICB9XG4gIC8vIEZsb3cgZG9lc24ndCBsaWtlIGl0IHdoZW4geW91IHNldCBhcmJpdHJhcnkgdmFsdWVzIG9uIGEgZ2xvYmFsIG9iamVjdFxuICBjb25zb2xlLl9lcnJvck9yaWdpbmFsID0gY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpO1xuICBjb25zb2xlLmVycm9yID0gcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVyO1xuICBpZiAoY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIEluZGl2aWR1YWwgYXBwcyBjYW4gZGlzYWJsZSB0aGlzXG4gICAgLy8gRmxvdyBkb2Vzbid0IGxpa2UgaXQgd2hlbiB5b3Ugc2V0IGFyYml0cmFyeSB2YWx1ZXMgb24gYSBnbG9iYWwgb2JqZWN0XG4gICAgY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPSB0cnVlO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBoYW5kbGVFeGNlcHRpb24sXG4gIGluc3RhbGxDb25zb2xlRXJyb3JSZXBvcnRlcixcbiAgU3ludGhldGljRXJyb3IsXG4gIHVuc3RhYmxlX3NldEV4Y2VwdGlvbkRlY29yYXRvcixcbn07XG4iXX0=