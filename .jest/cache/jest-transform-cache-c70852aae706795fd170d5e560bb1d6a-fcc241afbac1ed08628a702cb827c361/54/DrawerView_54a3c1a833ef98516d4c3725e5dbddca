55603cc23d72ccb66c4c156ab2889910
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends3 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

var _excluded = ["navigation"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = DrawerView;

var _elements = require("@react-navigation/elements");

var _native = require("@react-navigation/native");

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var Reanimated = _interopRequireWildcard(require("react-native-reanimated"));

var _reactNativeSafeAreaContext = require("react-native-safe-area-context");

var _DrawerPositionContext = _interopRequireDefault(require("../utils/DrawerPositionContext"));

var _DrawerStatusContext = _interopRequireDefault(require("../utils/DrawerStatusContext"));

var _getDrawerStatusFromState = _interopRequireDefault(require("../utils/getDrawerStatusFromState"));

var _DrawerContent = _interopRequireDefault(require("./DrawerContent"));

var _DrawerToggleButton = _interopRequireDefault(require("./DrawerToggleButton"));

var _GestureHandler = require("./GestureHandler");

var _ScreenFallback = require("./ScreenFallback");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

var getDefaultDrawerWidth = function getDefaultDrawerWidth(_ref) {
  var height = _ref.height,
      width = _ref.width;
  var smallerAxisSize = Math.min(height, width);
  var isLandscape = width > height;
  var isTablet = smallerAxisSize >= 600;
  var appBarHeight = _reactNative.Platform.OS === 'ios' ? isLandscape ? 32 : 44 : 56;
  var maxWidth = isTablet ? 320 : 280;
  return Math.min(smallerAxisSize - appBarHeight, maxWidth);
};

var GestureHandlerWrapper = _GestureHandler.GestureHandlerRootView !== null && _GestureHandler.GestureHandlerRootView !== void 0 ? _GestureHandler.GestureHandlerRootView : _reactNative.View;

function DrawerViewBase(_ref2) {
  var _Reanimated$isConfigu;

  var state = _ref2.state,
      navigation = _ref2.navigation,
      descriptors = _ref2.descriptors,
      defaultStatus = _ref2.defaultStatus,
      _ref2$drawerContent = _ref2.drawerContent,
      drawerContent = _ref2$drawerContent === void 0 ? function (props) {
    return React.createElement(_DrawerContent.default, props);
  } : _ref2$drawerContent,
      _ref2$detachInactiveS = _ref2.detachInactiveScreens,
      detachInactiveScreens = _ref2$detachInactiveS === void 0 ? _reactNative.Platform.OS === 'web' || _reactNative.Platform.OS === 'android' || _reactNative.Platform.OS === 'ios' : _ref2$detachInactiveS,
      _ref2$useLegacyImplem = _ref2.useLegacyImplementation,
      useLegacyImplementation = _ref2$useLegacyImplem === void 0 ? !global.nativeCallSyncHook || !((_Reanimated$isConfigu = Reanimated.isConfigured) !== null && _Reanimated$isConfigu !== void 0 && _Reanimated$isConfigu.call(Reanimated)) : _ref2$useLegacyImplem;
  var Drawer = useLegacyImplementation ? require('./legacy/Drawer').default : require('./modern/Drawer').default;
  var focusedRouteKey = state.routes[state.index].key;
  var _descriptors$focusedR = descriptors[focusedRouteKey].options,
      _descriptors$focusedR2 = _descriptors$focusedR.drawerHideStatusBarOnOpen,
      drawerHideStatusBarOnOpen = _descriptors$focusedR2 === void 0 ? false : _descriptors$focusedR2,
      _descriptors$focusedR3 = _descriptors$focusedR.drawerPosition,
      drawerPosition = _descriptors$focusedR3 === void 0 ? _reactNative.I18nManager.isRTL ? 'right' : 'left' : _descriptors$focusedR3,
      _descriptors$focusedR4 = _descriptors$focusedR.drawerStatusBarAnimation,
      drawerStatusBarAnimation = _descriptors$focusedR4 === void 0 ? 'slide' : _descriptors$focusedR4,
      drawerStyle = _descriptors$focusedR.drawerStyle,
      _descriptors$focusedR5 = _descriptors$focusedR.drawerType,
      drawerType = _descriptors$focusedR5 === void 0 ? _reactNative.Platform.select({
    ios: 'slide',
    default: 'front'
  }) : _descriptors$focusedR5,
      gestureHandlerProps = _descriptors$focusedR.gestureHandlerProps,
      _descriptors$focusedR6 = _descriptors$focusedR.keyboardDismissMode,
      keyboardDismissMode = _descriptors$focusedR6 === void 0 ? 'on-drag' : _descriptors$focusedR6,
      _descriptors$focusedR7 = _descriptors$focusedR.overlayColor,
      overlayColor = _descriptors$focusedR7 === void 0 ? 'rgba(0, 0, 0, 0.5)' : _descriptors$focusedR7,
      _descriptors$focusedR8 = _descriptors$focusedR.swipeEdgeWidth,
      swipeEdgeWidth = _descriptors$focusedR8 === void 0 ? 32 : _descriptors$focusedR8,
      _descriptors$focusedR9 = _descriptors$focusedR.swipeEnabled,
      swipeEnabled = _descriptors$focusedR9 === void 0 ? _reactNative.Platform.OS !== 'web' && _reactNative.Platform.OS !== 'windows' && _reactNative.Platform.OS !== 'macos' : _descriptors$focusedR9,
      _descriptors$focusedR10 = _descriptors$focusedR.swipeMinDistance,
      swipeMinDistance = _descriptors$focusedR10 === void 0 ? 60 : _descriptors$focusedR10;

  var _React$useState = React.useState([focusedRouteKey]),
      _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 2),
      loaded = _React$useState2[0],
      setLoaded = _React$useState2[1];

  if (!loaded.includes(focusedRouteKey)) {
    setLoaded([].concat((0, _toConsumableArray2.default)(loaded), [focusedRouteKey]));
  }

  var dimensions = (0, _reactNativeSafeAreaContext.useSafeAreaFrame)();

  var _ref5 = (0, _native.useTheme)(),
      colors = _ref5.colors;

  var drawerStatus = (0, _getDrawerStatusFromState.default)(state);
  var handleDrawerOpen = React.useCallback(function () {
    navigation.dispatch((0, _extends3.default)({}, _native.DrawerActions.openDrawer(), {
      target: state.key
    }));
  }, [navigation, state.key]);
  var handleDrawerClose = React.useCallback(function () {
    navigation.dispatch((0, _extends3.default)({}, _native.DrawerActions.closeDrawer(), {
      target: state.key
    }));
  }, [navigation, state.key]);
  React.useEffect(function () {
    if (drawerStatus === defaultStatus || drawerType === 'permanent') {
      return;
    }

    var handleHardwareBack = function handleHardwareBack() {
      if (!navigation.isFocused()) {
        return false;
      }

      if (defaultStatus === 'open') {
        handleDrawerOpen();
      } else {
        handleDrawerClose();
      }

      return true;
    };

    var handleEscape = function handleEscape(e) {
      if (e.key === 'Escape') {
        handleHardwareBack();
      }
    };

    var subscription = _reactNative.BackHandler.addEventListener('hardwareBackPress', handleHardwareBack);

    if (_reactNative.Platform.OS === 'web') {
      var _document, _document$body, _document$body$addEve;

      (_document = document) === null || _document === void 0 ? void 0 : (_document$body = _document.body) === null || _document$body === void 0 ? void 0 : (_document$body$addEve = _document$body.addEventListener) === null || _document$body$addEve === void 0 ? void 0 : _document$body$addEve.call(_document$body, 'keyup', handleEscape);
    }

    return function () {
      subscription.remove();

      if (_reactNative.Platform.OS === 'web') {
        var _document2, _document2$body, _document2$body$remov;

        (_document2 = document) === null || _document2 === void 0 ? void 0 : (_document2$body = _document2.body) === null || _document2$body === void 0 ? void 0 : (_document2$body$remov = _document2$body.removeEventListener) === null || _document2$body$remov === void 0 ? void 0 : _document2$body$remov.call(_document2$body, 'keyup', handleEscape);
      }
    };
  }, [defaultStatus, drawerStatus, drawerType, handleDrawerClose, handleDrawerOpen, navigation]);

  var renderDrawerContent = function renderDrawerContent() {
    return React.createElement(_DrawerPositionContext.default.Provider, {
      value: drawerPosition
    }, drawerContent({
      state: state,
      navigation: navigation,
      descriptors: descriptors
    }));
  };

  var renderSceneContent = function renderSceneContent() {
    return React.createElement(_ScreenFallback.MaybeScreenContainer, {
      enabled: detachInactiveScreens,
      hasTwoStates: true,
      style: styles.content
    }, state.routes.map(function (route, index) {
      var descriptor = descriptors[route.key];
      var _descriptor$options = descriptor.options,
          _descriptor$options$l = _descriptor$options.lazy,
          lazy = _descriptor$options$l === void 0 ? true : _descriptor$options$l,
          unmountOnBlur = _descriptor$options.unmountOnBlur;
      var isFocused = state.index === index;

      if (unmountOnBlur && !isFocused) {
        return null;
      }

      if (lazy && !loaded.includes(route.key) && !isFocused) {
        return null;
      }

      var _descriptor$options2 = descriptor.options,
          _descriptor$options2$ = _descriptor$options2.header,
          header = _descriptor$options2$ === void 0 ? function (_ref3) {
        var _options$headerLeft;

        var layout = _ref3.layout,
            options = _ref3.options;
        return React.createElement(_elements.Header, _extends({}, options, {
          layout: layout,
          title: (0, _elements.getHeaderTitle)(options, route.name),
          headerLeft: (_options$headerLeft = options.headerLeft) !== null && _options$headerLeft !== void 0 ? _options$headerLeft : function (props) {
            return React.createElement(_DrawerToggleButton.default, props);
          }
        }));
      } : _descriptor$options2$,
          sceneContainerStyle = _descriptor$options2.sceneContainerStyle;
      return React.createElement(_ScreenFallback.MaybeScreen, {
        key: route.key,
        style: [_reactNative.StyleSheet.absoluteFill, {
          zIndex: isFocused ? 0 : -1
        }],
        visible: isFocused,
        enabled: detachInactiveScreens
      }, React.createElement(_elements.Screen, {
        focused: isFocused,
        route: descriptor.route,
        navigation: descriptor.navigation,
        headerShown: descriptor.options.headerShown,
        headerTransparent: descriptor.options.headerTransparent,
        headerStatusBarHeight: descriptor.options.headerStatusBarHeight,
        header: header({
          layout: dimensions,
          route: descriptor.route,
          navigation: descriptor.navigation,
          options: descriptor.options
        }),
        style: sceneContainerStyle
      }, descriptor.render()));
    }));
  };

  return React.createElement(_DrawerStatusContext.default.Provider, {
    value: drawerStatus
  }, React.createElement(Drawer, {
    open: drawerStatus !== 'closed',
    onOpen: handleDrawerOpen,
    onClose: handleDrawerClose,
    gestureHandlerProps: gestureHandlerProps,
    swipeEnabled: swipeEnabled,
    swipeEdgeWidth: swipeEdgeWidth,
    swipeVelocityThreshold: 500,
    swipeDistanceThreshold: swipeMinDistance,
    hideStatusBarOnOpen: drawerHideStatusBarOnOpen,
    statusBarAnimation: drawerStatusBarAnimation,
    keyboardDismissMode: keyboardDismissMode,
    drawerType: drawerType,
    drawerPosition: drawerPosition,
    drawerStyle: [{
      width: getDefaultDrawerWidth(dimensions),
      backgroundColor: colors.card
    }, drawerType === 'permanent' && (drawerPosition === 'left' ? {
      borderRightColor: colors.border,
      borderRightWidth: _reactNative.StyleSheet.hairlineWidth
    } : {
      borderLeftColor: colors.border,
      borderLeftWidth: _reactNative.StyleSheet.hairlineWidth
    }), drawerStyle],
    overlayStyle: {
      backgroundColor: overlayColor
    },
    renderDrawerContent: renderDrawerContent,
    renderSceneContent: renderSceneContent,
    dimensions: dimensions
  }));
}

function DrawerView(_ref4) {
  var navigation = _ref4.navigation,
      rest = (0, _objectWithoutProperties2.default)(_ref4, _excluded);
  return React.createElement(_elements.SafeAreaProviderCompat, null, React.createElement(GestureHandlerWrapper, {
    style: styles.content
  }, React.createElement(DrawerViewBase, _extends({
    navigation: navigation
  }, rest))));
}

var styles = _reactNative.StyleSheet.create({
  content: {
    flex: 1
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FEVyxFQUtYN0UsVUFBVSxLQUFLLFdBQWZBLEtBQ0dMLGNBQWMsS0FBSyxNQUFuQkEsR0FDRztBQUNFbUYsc0JBQWdCLEVBQUVoRSxNQUFNLENBQUNpRSxNQUQzQjtBQUVFQyxzQkFBZ0IsRUFBRXJCLHdCQUFXc0I7QUFGL0IsS0FESHRGLEdBS0c7QUFDRXVGLHFCQUFlLEVBQUVwRSxNQUFNLENBQUNpRSxNQUQxQjtBQUVFSSxxQkFBZSxFQUFFeEIsd0JBQVdzQjtBQUY5QixLQU5OakYsQ0FMVyxFQWVYRCxXQWZXLENBZGY7QUErQkVxRixnQkFBWSxFQUFFO0FBQUVSLHFCQUFlLEVBQUV2RTtBQUFuQixLQS9CaEI7QUFnQ0U4Qix1QkFBbUIsRUFBRUEsbUJBaEN2QjtBQWlDRUksc0JBQWtCLEVBQUVBLGtCQWpDdEI7QUFrQ0UxQixjQUFVLEVBQUVBO0FBbENkLElBREYsQ0FERjtBQXdDRDs7QUFFYyxTQUFTd0UsVUFBVCxRQUFvRDtBQUFBLE1BQTlCakgsVUFBOEIsU0FBOUJBLFVBQThCO0FBQUEsTUFBZmtILElBQWU7QUFDakUsU0FDRTdHLG9CQUFDNEUsZ0NBQUQsUUFDRTVFLG9CQUFDVixxQkFBRDtBQUF1QjRFLFNBQUssRUFBRUMsTUFBTSxDQUFDQztBQUFyQyxLQUNFcEUsb0JBQUNQLGNBQUQ7QUFBZ0JFLGNBQVUsRUFBRUE7QUFBNUIsS0FBNENrSCxJQUE1QyxFQURGLENBREYsQ0FERjtBQU9EOztBQUVELElBQU0xQyxNQUFNLEdBQUdlLHdCQUFXNEIsTUFBWDVCLENBQWtCO0FBQy9CZCxTQUFPLEVBQUU7QUFDUDJDLFFBQUksRUFBRTtBQURDO0FBRHNCLENBQWxCN0IsQ0FBZiIsIm5hbWVzIjpbImdldERlZmF1bHREcmF3ZXJXaWR0aCIsImhlaWdodCIsIndpZHRoIiwic21hbGxlckF4aXNTaXplIiwiTWF0aCIsIm1pbiIsImlzTGFuZHNjYXBlIiwiaXNUYWJsZXQiLCJhcHBCYXJIZWlnaHQiLCJQbGF0Zm9ybSIsIk9TIiwibWF4V2lkdGgiLCJHZXN0dXJlSGFuZGxlcldyYXBwZXIiLCJHZXN0dXJlSGFuZGxlclJvb3RWaWV3IiwiVmlldyIsIkRyYXdlclZpZXdCYXNlIiwic3RhdGUiLCJuYXZpZ2F0aW9uIiwiZGVzY3JpcHRvcnMiLCJkZWZhdWx0U3RhdHVzIiwiZHJhd2VyQ29udGVudCIsInByb3BzIiwiUmVhY3QiLCJfRHJhd2VyQ29udGVudCIsImRldGFjaEluYWN0aXZlU2NyZWVucyIsInVzZUxlZ2FjeUltcGxlbWVudGF0aW9uIiwiZ2xvYmFsIiwibmF0aXZlQ2FsbFN5bmNIb29rIiwiUmVhbmltYXRlZCIsImlzQ29uZmlndXJlZCIsIl9SZWFuaW1hdGVkJGlzQ29uZmlndSIsIkRyYXdlciIsInJlcXVpcmUiLCJkZWZhdWx0IiwiZm9jdXNlZFJvdXRlS2V5Iiwicm91dGVzIiwiaW5kZXgiLCJrZXkiLCJvcHRpb25zIiwiZHJhd2VySGlkZVN0YXR1c0Jhck9uT3BlbiIsImRyYXdlclBvc2l0aW9uIiwiSTE4bk1hbmFnZXIiLCJpc1JUTCIsImRyYXdlclN0YXR1c0JhckFuaW1hdGlvbiIsImRyYXdlclN0eWxlIiwiZHJhd2VyVHlwZSIsInNlbGVjdCIsImlvcyIsImdlc3R1cmVIYW5kbGVyUHJvcHMiLCJrZXlib2FyZERpc21pc3NNb2RlIiwib3ZlcmxheUNvbG9yIiwic3dpcGVFZGdlV2lkdGgiLCJzd2lwZUVuYWJsZWQiLCJzd2lwZU1pbkRpc3RhbmNlIiwidXNlU3RhdGUiLCJsb2FkZWQiLCJzZXRMb2FkZWQiLCJpbmNsdWRlcyIsImRpbWVuc2lvbnMiLCJjb2xvcnMiLCJkcmF3ZXJTdGF0dXMiLCJoYW5kbGVEcmF3ZXJPcGVuIiwidXNlQ2FsbGJhY2siLCJkaXNwYXRjaCIsIkRyYXdlckFjdGlvbnMiLCJvcGVuRHJhd2VyIiwidGFyZ2V0IiwiaGFuZGxlRHJhd2VyQ2xvc2UiLCJjbG9zZURyYXdlciIsInVzZUVmZmVjdCIsImhhbmRsZUhhcmR3YXJlQmFjayIsImlzRm9jdXNlZCIsImhhbmRsZUVzY2FwZSIsImUiLCJzdWJzY3JpcHRpb24iLCJCYWNrSGFuZGxlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJib2R5IiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbmRlckRyYXdlckNvbnRlbnQiLCJfRHJhd2VyUG9zaXRpb25Db250ZXh0IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsInJlbmRlclNjZW5lQ29udGVudCIsIl9TY3JlZW5GYWxsYmFjayIsImVuYWJsZWQiLCJoYXNUd29TdGF0ZXMiLCJzdHlsZSIsInN0eWxlcyIsImNvbnRlbnQiLCJtYXAiLCJyb3V0ZSIsImRlc2NyaXB0b3IiLCJsYXp5IiwidW5tb3VudE9uQmx1ciIsImhlYWRlciIsImxheW91dCIsIl9lbGVtZW50cyIsInRpdGxlIiwibmFtZSIsImhlYWRlckxlZnQiLCJfRHJhd2VyVG9nZ2xlQnV0dG9uIiwic2NlbmVDb250YWluZXJTdHlsZSIsIlN0eWxlU2hlZXQiLCJhYnNvbHV0ZUZpbGwiLCJ6SW5kZXgiLCJ2aXNpYmxlIiwiZm9jdXNlZCIsImhlYWRlclNob3duIiwiaGVhZGVyVHJhbnNwYXJlbnQiLCJoZWFkZXJTdGF0dXNCYXJIZWlnaHQiLCJyZW5kZXIiLCJfRHJhd2VyU3RhdHVzQ29udGV4dCIsIm9wZW4iLCJvbk9wZW4iLCJvbkNsb3NlIiwic3dpcGVWZWxvY2l0eVRocmVzaG9sZCIsInN3aXBlRGlzdGFuY2VUaHJlc2hvbGQiLCJoaWRlU3RhdHVzQmFyT25PcGVuIiwic3RhdHVzQmFyQW5pbWF0aW9uIiwiYmFja2dyb3VuZENvbG9yIiwiY2FyZCIsImJvcmRlclJpZ2h0Q29sb3IiLCJib3JkZXIiLCJib3JkZXJSaWdodFdpZHRoIiwiaGFpcmxpbmVXaWR0aCIsImJvcmRlckxlZnRDb2xvciIsImJvcmRlckxlZnRXaWR0aCIsIm92ZXJsYXlTdHlsZSIsIkRyYXdlclZpZXciLCJyZXN0IiwiY3JlYXRlIiwiZmxleCJdLCJzb3VyY2VzIjpbIkRyYXdlclZpZXcudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGdldEhlYWRlclRpdGxlLFxuICBIZWFkZXIsXG4gIFNhZmVBcmVhUHJvdmlkZXJDb21wYXQsXG4gIFNjcmVlbixcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vZWxlbWVudHMnO1xuaW1wb3J0IHtcbiAgRHJhd2VyQWN0aW9ucyxcbiAgRHJhd2VyTmF2aWdhdGlvblN0YXRlLFxuICBEcmF3ZXJTdGF0dXMsXG4gIFBhcmFtTGlzdEJhc2UsXG4gIHVzZVRoZW1lLFxufSBmcm9tICdAcmVhY3QtbmF2aWdhdGlvbi9uYXRpdmUnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQmFja0hhbmRsZXIsXG4gIEkxOG5NYW5hZ2VyLFxuICBQbGF0Zm9ybSxcbiAgU3R5bGVTaGVldCxcbiAgVmlldyxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCAqIGFzIFJlYW5pbWF0ZWQgZnJvbSAncmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQnO1xuaW1wb3J0IHsgdXNlU2FmZUFyZWFGcmFtZSB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1zYWZlLWFyZWEtY29udGV4dCc7XG5cbmltcG9ydCB0eXBlIHtcbiAgRHJhd2VyQ29udGVudENvbXBvbmVudFByb3BzLFxuICBEcmF3ZXJEZXNjcmlwdG9yTWFwLFxuICBEcmF3ZXJIZWFkZXJQcm9wcyxcbiAgRHJhd2VyTmF2aWdhdGlvbkNvbmZpZyxcbiAgRHJhd2VyTmF2aWdhdGlvbkhlbHBlcnMsXG4gIERyYXdlck5hdmlnYXRpb25Qcm9wLFxuICBEcmF3ZXJQcm9wcyxcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IERyYXdlclBvc2l0aW9uQ29udGV4dCBmcm9tICcuLi91dGlscy9EcmF3ZXJQb3NpdGlvbkNvbnRleHQnO1xuaW1wb3J0IERyYXdlclN0YXR1c0NvbnRleHQgZnJvbSAnLi4vdXRpbHMvRHJhd2VyU3RhdHVzQ29udGV4dCc7XG5pbXBvcnQgZ2V0RHJhd2VyU3RhdHVzRnJvbVN0YXRlIGZyb20gJy4uL3V0aWxzL2dldERyYXdlclN0YXR1c0Zyb21TdGF0ZSc7XG5pbXBvcnQgRHJhd2VyQ29udGVudCBmcm9tICcuL0RyYXdlckNvbnRlbnQnO1xuaW1wb3J0IERyYXdlclRvZ2dsZUJ1dHRvbiBmcm9tICcuL0RyYXdlclRvZ2dsZUJ1dHRvbic7XG5pbXBvcnQgeyBHZXN0dXJlSGFuZGxlclJvb3RWaWV3IH0gZnJvbSAnLi9HZXN0dXJlSGFuZGxlcic7XG5pbXBvcnQgeyBNYXliZVNjcmVlbiwgTWF5YmVTY3JlZW5Db250YWluZXIgfSBmcm9tICcuL1NjcmVlbkZhbGxiYWNrJztcblxudHlwZSBQcm9wcyA9IERyYXdlck5hdmlnYXRpb25Db25maWcgJiB7XG4gIGRlZmF1bHRTdGF0dXM6IERyYXdlclN0YXR1cztcbiAgc3RhdGU6IERyYXdlck5hdmlnYXRpb25TdGF0ZTxQYXJhbUxpc3RCYXNlPjtcbiAgbmF2aWdhdGlvbjogRHJhd2VyTmF2aWdhdGlvbkhlbHBlcnM7XG4gIGRlc2NyaXB0b3JzOiBEcmF3ZXJEZXNjcmlwdG9yTWFwO1xufTtcblxuY29uc3QgZ2V0RGVmYXVsdERyYXdlcldpZHRoID0gKHtcbiAgaGVpZ2h0LFxuICB3aWR0aCxcbn06IHtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG59KSA9PiB7XG4gIC8qXG4gICAqIERlZmF1bHQgZHJhd2VyIHdpZHRoIGlzIHNjcmVlbiB3aWR0aCAtIGhlYWRlciBoZWlnaHRcbiAgICogd2l0aCBhIG1heCB3aWR0aCBvZiAyODAgb24gbW9iaWxlIGFuZCAzMjAgb24gdGFibGV0XG4gICAqIGh0dHBzOi8vbWF0ZXJpYWwuaW8vY29tcG9uZW50cy9uYXZpZ2F0aW9uLWRyYXdlclxuICAgKi9cbiAgY29uc3Qgc21hbGxlckF4aXNTaXplID0gTWF0aC5taW4oaGVpZ2h0LCB3aWR0aCk7XG4gIGNvbnN0IGlzTGFuZHNjYXBlID0gd2lkdGggPiBoZWlnaHQ7XG4gIGNvbnN0IGlzVGFibGV0ID0gc21hbGxlckF4aXNTaXplID49IDYwMDtcbiAgY29uc3QgYXBwQmFySGVpZ2h0ID0gUGxhdGZvcm0uT1MgPT09ICdpb3MnID8gKGlzTGFuZHNjYXBlID8gMzIgOiA0NCkgOiA1NjtcbiAgY29uc3QgbWF4V2lkdGggPSBpc1RhYmxldCA/IDMyMCA6IDI4MDtcblxuICByZXR1cm4gTWF0aC5taW4oc21hbGxlckF4aXNTaXplIC0gYXBwQmFySGVpZ2h0LCBtYXhXaWR0aCk7XG59O1xuXG5jb25zdCBHZXN0dXJlSGFuZGxlcldyYXBwZXIgPSBHZXN0dXJlSGFuZGxlclJvb3RWaWV3ID8/IFZpZXc7XG5cbmZ1bmN0aW9uIERyYXdlclZpZXdCYXNlKHtcbiAgc3RhdGUsXG4gIG5hdmlnYXRpb24sXG4gIGRlc2NyaXB0b3JzLFxuICBkZWZhdWx0U3RhdHVzLFxuICBkcmF3ZXJDb250ZW50ID0gKHByb3BzOiBEcmF3ZXJDb250ZW50Q29tcG9uZW50UHJvcHMpID0+IChcbiAgICA8RHJhd2VyQ29udGVudCB7Li4ucHJvcHN9IC8+XG4gICksXG4gIGRldGFjaEluYWN0aXZlU2NyZWVucyA9IFBsYXRmb3JtLk9TID09PSAnd2ViJyB8fFxuICAgIFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcgfHxcbiAgICBQbGF0Zm9ybS5PUyA9PT0gJ2lvcycsXG4gIC8vIFJ1bm5pbmcgaW4gY2hyb21lIGRlYnVnZ2VyXG4gIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgdXNlTGVnYWN5SW1wbGVtZW50YXRpb24gPSAhZ2xvYmFsLm5hdGl2ZUNhbGxTeW5jSG9vayB8fFxuICAgIC8vIFJlYW5pbWF0ZWQgMiBpcyBub3QgY29uZmlndXJlZFxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3I6IHRoZSB0eXBlIGRlZmluaXRpb25zIGFyZSBpbmNvbXBsZXRlXG4gICAgIVJlYW5pbWF0ZWQuaXNDb25maWd1cmVkPy4oKSxcbn06IFByb3BzKSB7XG4gIGNvbnN0IERyYXdlcjogUmVhY3QuQ29tcG9uZW50VHlwZTxEcmF3ZXJQcm9wcz4gPSB1c2VMZWdhY3lJbXBsZW1lbnRhdGlvblxuICAgID8gcmVxdWlyZSgnLi9sZWdhY3kvRHJhd2VyJykuZGVmYXVsdFxuICAgIDogcmVxdWlyZSgnLi9tb2Rlcm4vRHJhd2VyJykuZGVmYXVsdDtcblxuICBjb25zdCBmb2N1c2VkUm91dGVLZXkgPSBzdGF0ZS5yb3V0ZXNbc3RhdGUuaW5kZXhdLmtleTtcbiAgY29uc3Qge1xuICAgIGRyYXdlckhpZGVTdGF0dXNCYXJPbk9wZW4gPSBmYWxzZSxcbiAgICBkcmF3ZXJQb3NpdGlvbiA9IEkxOG5NYW5hZ2VyLmlzUlRMID8gJ3JpZ2h0JyA6ICdsZWZ0JyxcbiAgICBkcmF3ZXJTdGF0dXNCYXJBbmltYXRpb24gPSAnc2xpZGUnLFxuICAgIGRyYXdlclN0eWxlLFxuICAgIGRyYXdlclR5cGUgPSBQbGF0Zm9ybS5zZWxlY3QoeyBpb3M6ICdzbGlkZScsIGRlZmF1bHQ6ICdmcm9udCcgfSksXG4gICAgZ2VzdHVyZUhhbmRsZXJQcm9wcyxcbiAgICBrZXlib2FyZERpc21pc3NNb2RlID0gJ29uLWRyYWcnLFxuICAgIG92ZXJsYXlDb2xvciA9ICdyZ2JhKDAsIDAsIDAsIDAuNSknLFxuICAgIHN3aXBlRWRnZVdpZHRoID0gMzIsXG4gICAgc3dpcGVFbmFibGVkID0gUGxhdGZvcm0uT1MgIT09ICd3ZWInICYmXG4gICAgICBQbGF0Zm9ybS5PUyAhPT0gJ3dpbmRvd3MnICYmXG4gICAgICBQbGF0Zm9ybS5PUyAhPT0gJ21hY29zJyxcbiAgICBzd2lwZU1pbkRpc3RhbmNlID0gNjAsXG4gIH0gPSBkZXNjcmlwdG9yc1tmb2N1c2VkUm91dGVLZXldLm9wdGlvbnM7XG5cbiAgY29uc3QgW2xvYWRlZCwgc2V0TG9hZGVkXSA9IFJlYWN0LnVzZVN0YXRlKFtmb2N1c2VkUm91dGVLZXldKTtcblxuICBpZiAoIWxvYWRlZC5pbmNsdWRlcyhmb2N1c2VkUm91dGVLZXkpKSB7XG4gICAgc2V0TG9hZGVkKFsuLi5sb2FkZWQsIGZvY3VzZWRSb3V0ZUtleV0pO1xuICB9XG5cbiAgY29uc3QgZGltZW5zaW9ucyA9IHVzZVNhZmVBcmVhRnJhbWUoKTtcblxuICBjb25zdCB7IGNvbG9ycyB9ID0gdXNlVGhlbWUoKTtcblxuICBjb25zdCBkcmF3ZXJTdGF0dXMgPSBnZXREcmF3ZXJTdGF0dXNGcm9tU3RhdGUoc3RhdGUpO1xuXG4gIGNvbnN0IGhhbmRsZURyYXdlck9wZW4gPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgbmF2aWdhdGlvbi5kaXNwYXRjaCh7XG4gICAgICAuLi5EcmF3ZXJBY3Rpb25zLm9wZW5EcmF3ZXIoKSxcbiAgICAgIHRhcmdldDogc3RhdGUua2V5LFxuICAgIH0pO1xuICB9LCBbbmF2aWdhdGlvbiwgc3RhdGUua2V5XSk7XG5cbiAgY29uc3QgaGFuZGxlRHJhd2VyQ2xvc2UgPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgbmF2aWdhdGlvbi5kaXNwYXRjaCh7XG4gICAgICAuLi5EcmF3ZXJBY3Rpb25zLmNsb3NlRHJhd2VyKCksXG4gICAgICB0YXJnZXQ6IHN0YXRlLmtleSxcbiAgICB9KTtcbiAgfSwgW25hdmlnYXRpb24sIHN0YXRlLmtleV0pO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGRyYXdlclN0YXR1cyA9PT0gZGVmYXVsdFN0YXR1cyB8fCBkcmF3ZXJUeXBlID09PSAncGVybWFuZW50Jykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGhhbmRsZUhhcmR3YXJlQmFjayA9ICgpID0+IHtcbiAgICAgIC8vIFdlIHNob3VsZG4ndCBoYW5kbGUgdGhlIGJhY2sgYnV0dG9uIGlmIHRoZSBwYXJlbnQgc2NyZWVuIGlzbid0IGZvY3VzZWRcbiAgICAgIC8vIFRoaXMgd2lsbCBhdm9pZCB0aGUgZHJhd2VyIG92ZXJyaWRpbmcgZXZlbnQgbGlzdGVuZXJzIGZyb20gYSBmb2N1c2VkIHNjcmVlblxuICAgICAgaWYgKCFuYXZpZ2F0aW9uLmlzRm9jdXNlZCgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRTdGF0dXMgPT09ICdvcGVuJykge1xuICAgICAgICBoYW5kbGVEcmF3ZXJPcGVuKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVEcmF3ZXJDbG9zZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgY29uc3QgaGFuZGxlRXNjYXBlID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgaGFuZGxlSGFyZHdhcmVCYWNrKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIFdlIG9ubHkgYWRkIHRoZSBsaXN0ZW5lcnMgd2hlbiBkcmF3ZXIgb3BlbnNcbiAgICAvLyBUaGlzIHdheSB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgdGhlIGxpc3RlbmVyIGlzIGFkZGVkIGFzIGxhdGUgYXMgcG9zc2libGVcbiAgICAvLyBUaGlzIHdpbGwgbWFrZSBzdXJlIHRoYXQgb3VyIGhhbmRsZXIgd2lsbCBydW4gZmlyc3Qgd2hlbiBiYWNrIGJ1dHRvbiBpcyBwcmVzc2VkXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gQmFja0hhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdoYXJkd2FyZUJhY2tQcmVzcycsXG4gICAgICBoYW5kbGVIYXJkd2FyZUJhY2tcbiAgICApO1xuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnd2ViJykge1xuICAgICAgZG9jdW1lbnQ/LmJvZHk/LmFkZEV2ZW50TGlzdGVuZXI/Ligna2V5dXAnLCBoYW5kbGVFc2NhcGUpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBzdWJzY3JpcHRpb24ucmVtb3ZlKCk7XG5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICAgICAgZG9jdW1lbnQ/LmJvZHk/LnJlbW92ZUV2ZW50TGlzdGVuZXI/Ligna2V5dXAnLCBoYW5kbGVFc2NhcGUpO1xuICAgICAgfVxuICAgIH07XG4gIH0sIFtcbiAgICBkZWZhdWx0U3RhdHVzLFxuICAgIGRyYXdlclN0YXR1cyxcbiAgICBkcmF3ZXJUeXBlLFxuICAgIGhhbmRsZURyYXdlckNsb3NlLFxuICAgIGhhbmRsZURyYXdlck9wZW4sXG4gICAgbmF2aWdhdGlvbixcbiAgXSk7XG5cbiAgY29uc3QgcmVuZGVyRHJhd2VyQ29udGVudCA9ICgpID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgPERyYXdlclBvc2l0aW9uQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17ZHJhd2VyUG9zaXRpb259PlxuICAgICAgICB7ZHJhd2VyQ29udGVudCh7XG4gICAgICAgICAgc3RhdGU6IHN0YXRlLFxuICAgICAgICAgIG5hdmlnYXRpb246IG5hdmlnYXRpb24sXG4gICAgICAgICAgZGVzY3JpcHRvcnM6IGRlc2NyaXB0b3JzLFxuICAgICAgICB9KX1cbiAgICAgIDwvRHJhd2VyUG9zaXRpb25Db250ZXh0LlByb3ZpZGVyPlxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyU2NlbmVDb250ZW50ID0gKCkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICA8TWF5YmVTY3JlZW5Db250YWluZXJcbiAgICAgICAgZW5hYmxlZD17ZGV0YWNoSW5hY3RpdmVTY3JlZW5zfVxuICAgICAgICBoYXNUd29TdGF0ZXNcbiAgICAgICAgc3R5bGU9e3N0eWxlcy5jb250ZW50fVxuICAgICAgPlxuICAgICAgICB7c3RhdGUucm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JzW3JvdXRlLmtleV07XG4gICAgICAgICAgY29uc3QgeyBsYXp5ID0gdHJ1ZSwgdW5tb3VudE9uQmx1ciB9ID0gZGVzY3JpcHRvci5vcHRpb25zO1xuICAgICAgICAgIGNvbnN0IGlzRm9jdXNlZCA9IHN0YXRlLmluZGV4ID09PSBpbmRleDtcblxuICAgICAgICAgIGlmICh1bm1vdW50T25CbHVyICYmICFpc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChsYXp5ICYmICFsb2FkZWQuaW5jbHVkZXMocm91dGUua2V5KSAmJiAhaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICAvLyBEb24ndCByZW5kZXIgYSBsYXp5IHNjcmVlbiBpZiB3ZSd2ZSBuZXZlciBuYXZpZ2F0ZWQgdG8gaXRcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGhlYWRlciA9ICh7IGxheW91dCwgb3B0aW9ucyB9OiBEcmF3ZXJIZWFkZXJQcm9wcykgPT4gKFxuICAgICAgICAgICAgICA8SGVhZGVyXG4gICAgICAgICAgICAgICAgey4uLm9wdGlvbnN9XG4gICAgICAgICAgICAgICAgbGF5b3V0PXtsYXlvdXR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e2dldEhlYWRlclRpdGxlKG9wdGlvbnMsIHJvdXRlLm5hbWUpfVxuICAgICAgICAgICAgICAgIGhlYWRlckxlZnQ9e1xuICAgICAgICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJMZWZ0ID8/XG4gICAgICAgICAgICAgICAgICAoKHByb3BzKSA9PiA8RHJhd2VyVG9nZ2xlQnV0dG9uIHsuLi5wcm9wc30gLz4pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHNjZW5lQ29udGFpbmVyU3R5bGUsXG4gICAgICAgICAgfSA9IGRlc2NyaXB0b3Iub3B0aW9ucztcblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8TWF5YmVTY3JlZW5cbiAgICAgICAgICAgICAga2V5PXtyb3V0ZS5rZXl9XG4gICAgICAgICAgICAgIHN0eWxlPXtbU3R5bGVTaGVldC5hYnNvbHV0ZUZpbGwsIHsgekluZGV4OiBpc0ZvY3VzZWQgPyAwIDogLTEgfV19XG4gICAgICAgICAgICAgIHZpc2libGU9e2lzRm9jdXNlZH1cbiAgICAgICAgICAgICAgZW5hYmxlZD17ZGV0YWNoSW5hY3RpdmVTY3JlZW5zfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8U2NyZWVuXG4gICAgICAgICAgICAgICAgZm9jdXNlZD17aXNGb2N1c2VkfVxuICAgICAgICAgICAgICAgIHJvdXRlPXtkZXNjcmlwdG9yLnJvdXRlfVxuICAgICAgICAgICAgICAgIG5hdmlnYXRpb249e2Rlc2NyaXB0b3IubmF2aWdhdGlvbn1cbiAgICAgICAgICAgICAgICBoZWFkZXJTaG93bj17ZGVzY3JpcHRvci5vcHRpb25zLmhlYWRlclNob3dufVxuICAgICAgICAgICAgICAgIGhlYWRlclRyYW5zcGFyZW50PXtkZXNjcmlwdG9yLm9wdGlvbnMuaGVhZGVyVHJhbnNwYXJlbnR9XG4gICAgICAgICAgICAgICAgaGVhZGVyU3RhdHVzQmFySGVpZ2h0PXtkZXNjcmlwdG9yLm9wdGlvbnMuaGVhZGVyU3RhdHVzQmFySGVpZ2h0fVxuICAgICAgICAgICAgICAgIGhlYWRlcj17aGVhZGVyKHtcbiAgICAgICAgICAgICAgICAgIGxheW91dDogZGltZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgIHJvdXRlOiBkZXNjcmlwdG9yLnJvdXRlLFxuICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbjpcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRvci5uYXZpZ2F0aW9uIGFzIERyYXdlck5hdmlnYXRpb25Qcm9wPFBhcmFtTGlzdEJhc2U+LFxuICAgICAgICAgICAgICAgICAgb3B0aW9uczogZGVzY3JpcHRvci5vcHRpb25zLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgIHN0eWxlPXtzY2VuZUNvbnRhaW5lclN0eWxlfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge2Rlc2NyaXB0b3IucmVuZGVyKCl9XG4gICAgICAgICAgICAgIDwvU2NyZWVuPlxuICAgICAgICAgICAgPC9NYXliZVNjcmVlbj5cbiAgICAgICAgICApO1xuICAgICAgICB9KX1cbiAgICAgIDwvTWF5YmVTY3JlZW5Db250YWluZXI+XG4gICAgKTtcbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxEcmF3ZXJTdGF0dXNDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtkcmF3ZXJTdGF0dXN9PlxuICAgICAgPERyYXdlclxuICAgICAgICBvcGVuPXtkcmF3ZXJTdGF0dXMgIT09ICdjbG9zZWQnfVxuICAgICAgICBvbk9wZW49e2hhbmRsZURyYXdlck9wZW59XG4gICAgICAgIG9uQ2xvc2U9e2hhbmRsZURyYXdlckNsb3NlfVxuICAgICAgICBnZXN0dXJlSGFuZGxlclByb3BzPXtnZXN0dXJlSGFuZGxlclByb3BzfVxuICAgICAgICBzd2lwZUVuYWJsZWQ9e3N3aXBlRW5hYmxlZH1cbiAgICAgICAgc3dpcGVFZGdlV2lkdGg9e3N3aXBlRWRnZVdpZHRofVxuICAgICAgICBzd2lwZVZlbG9jaXR5VGhyZXNob2xkPXs1MDB9XG4gICAgICAgIHN3aXBlRGlzdGFuY2VUaHJlc2hvbGQ9e3N3aXBlTWluRGlzdGFuY2V9XG4gICAgICAgIGhpZGVTdGF0dXNCYXJPbk9wZW49e2RyYXdlckhpZGVTdGF0dXNCYXJPbk9wZW59XG4gICAgICAgIHN0YXR1c0JhckFuaW1hdGlvbj17ZHJhd2VyU3RhdHVzQmFyQW5pbWF0aW9ufVxuICAgICAgICBrZXlib2FyZERpc21pc3NNb2RlPXtrZXlib2FyZERpc21pc3NNb2RlfVxuICAgICAgICBkcmF3ZXJUeXBlPXtkcmF3ZXJUeXBlfVxuICAgICAgICBkcmF3ZXJQb3NpdGlvbj17ZHJhd2VyUG9zaXRpb259XG4gICAgICAgIGRyYXdlclN0eWxlPXtbXG4gICAgICAgICAge1xuICAgICAgICAgICAgd2lkdGg6IGdldERlZmF1bHREcmF3ZXJXaWR0aChkaW1lbnNpb25zKSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogY29sb3JzLmNhcmQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkcmF3ZXJUeXBlID09PSAncGVybWFuZW50JyAmJlxuICAgICAgICAgICAgKGRyYXdlclBvc2l0aW9uID09PSAnbGVmdCdcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiBjb2xvcnMuYm9yZGVyLFxuICAgICAgICAgICAgICAgICAgYm9yZGVyUmlnaHRXaWR0aDogU3R5bGVTaGVldC5oYWlybGluZVdpZHRoLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0Q29sb3I6IGNvbG9ycy5ib3JkZXIsXG4gICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0V2lkdGg6IFN0eWxlU2hlZXQuaGFpcmxpbmVXaWR0aCxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICBkcmF3ZXJTdHlsZSxcbiAgICAgICAgXX1cbiAgICAgICAgb3ZlcmxheVN0eWxlPXt7IGJhY2tncm91bmRDb2xvcjogb3ZlcmxheUNvbG9yIH19XG4gICAgICAgIHJlbmRlckRyYXdlckNvbnRlbnQ9e3JlbmRlckRyYXdlckNvbnRlbnR9XG4gICAgICAgIHJlbmRlclNjZW5lQ29udGVudD17cmVuZGVyU2NlbmVDb250ZW50fVxuICAgICAgICBkaW1lbnNpb25zPXtkaW1lbnNpb25zfVxuICAgICAgLz5cbiAgICA8L0RyYXdlclN0YXR1c0NvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIERyYXdlclZpZXcoeyBuYXZpZ2F0aW9uLCAuLi5yZXN0IH06IFByb3BzKSB7XG4gIHJldHVybiAoXG4gICAgPFNhZmVBcmVhUHJvdmlkZXJDb21wYXQ+XG4gICAgICA8R2VzdHVyZUhhbmRsZXJXcmFwcGVyIHN0eWxlPXtzdHlsZXMuY29udGVudH0+XG4gICAgICAgIDxEcmF3ZXJWaWV3QmFzZSBuYXZpZ2F0aW9uPXtuYXZpZ2F0aW9ufSB7Li4ucmVzdH0gLz5cbiAgICAgIDwvR2VzdHVyZUhhbmRsZXJXcmFwcGVyPlxuICAgIDwvU2FmZUFyZWFQcm92aWRlckNvbXBhdD5cbiAgKTtcbn1cblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBjb250ZW50OiB7XG4gICAgZmxleDogMSxcbiAgfSxcbn0pO1xuIl19