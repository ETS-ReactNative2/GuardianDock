b87cc28f9602bf240e0faeb0a32a146b
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends3 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["small", "icon", "label", "accessibilityLabel", "accessibilityState", "animated", "color", "disabled", "onPress", "onLongPress", "theme", "style", "visible", "uppercase", "loading", "testID"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FAB = exports.default = void 0;

var _color = _interopRequireDefault(require("color"));

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _ActivityIndicator = _interopRequireDefault(require("../ActivityIndicator"));

var _Surface = _interopRequireDefault(require("../Surface"));

var _CrossFadeIcon = _interopRequireDefault(require("../CrossFadeIcon"));

var _Icon = _interopRequireDefault(require("../Icon"));

var _Text = _interopRequireDefault(require("../Typography/Text"));

var _TouchableRipple = _interopRequireDefault(require("../TouchableRipple/TouchableRipple"));

var _colors = require("../../styles/colors");

var _theming = require("../../core/theming");

var _getContrastingColor = _interopRequireDefault(require("../../utils/getContrastingColor"));

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

_getContrastingColor.default;

var FAB = function FAB(_ref) {
  var small = _ref.small,
      icon = _ref.icon,
      label = _ref.label,
      _ref$accessibilityLab = _ref.accessibilityLabel,
      accessibilityLabel = _ref$accessibilityLab === void 0 ? label : _ref$accessibilityLab,
      accessibilityState = _ref.accessibilityState,
      _ref$animated = _ref.animated,
      animated = _ref$animated === void 0 ? true : _ref$animated,
      customColor = _ref.color,
      disabled = _ref.disabled,
      onPress = _ref.onPress,
      onLongPress = _ref.onLongPress,
      theme = _ref.theme,
      style = _ref.style,
      _ref$visible = _ref.visible,
      visible = _ref$visible === void 0 ? true : _ref$visible,
      _ref$uppercase = _ref.uppercase,
      uppercase = _ref$uppercase === void 0 ? true : _ref$uppercase,
      loading = _ref.loading,
      testID = _ref.testID,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);

  var _React$useRef = React.useRef(new _reactNative.Animated.Value(visible ? 1 : 0)),
      visibility = _React$useRef.current;

  var scale = theme.animation.scale;
  React.useEffect(function () {
    if (visible) {
      _reactNative.Animated.timing(visibility, {
        toValue: 1,
        duration: 200 * scale,
        useNativeDriver: true
      }).start();
    } else {
      _reactNative.Animated.timing(visibility, {
        toValue: 0,
        duration: 150 * scale,
        useNativeDriver: true
      }).start();
    }
  }, [visible, scale, visibility]);
  var IconComponent = animated ? _CrossFadeIcon.default : _Icon.default;
  var disabledColor = (0, _color.default)(theme.dark ? _colors.white : _colors.black).alpha(0.12).rgb().string();

  var _ref2 = _reactNative.StyleSheet.flatten(style) || {},
      _ref2$backgroundColor = _ref2.backgroundColor,
      backgroundColor = _ref2$backgroundColor === void 0 ? disabled ? disabledColor : theme.colors.accent : _ref2$backgroundColor;

  var foregroundColor;

  if (typeof customColor !== 'undefined') {
    foregroundColor = customColor;
  } else if (disabled) {
    foregroundColor = (0, _color.default)(theme.dark ? _colors.white : _colors.black).alpha(0.32).rgb().string();
  } else {
    foregroundColor = (0, _getContrastingColor.default)(backgroundColor, _colors.white, 'rgba(0, 0, 0, .54)');
  }

  var rippleColor = (0, _color.default)(foregroundColor).alpha(0.32).rgb().string();
  return React.createElement(_Surface.default, _extends({}, rest, {
    style: [{
      backgroundColor: backgroundColor,
      opacity: visibility,
      transform: [{
        scale: visibility
      }]
    }, styles.container, disabled && styles.disabled, style],
    pointerEvents: visible ? 'auto' : 'none'
  }), React.createElement(_TouchableRipple.default, {
    borderless: true,
    onPress: onPress,
    onLongPress: onLongPress,
    rippleColor: rippleColor,
    disabled: disabled,
    accessibilityLabel: accessibilityLabel,
    accessibilityTraits: disabled ? ['button', 'disabled'] : 'button',
    accessibilityComponentType: "button",
    accessibilityRole: "button",
    accessibilityState: (0, _extends3.default)({}, accessibilityState, {
      disabled: disabled
    }),
    style: styles.touchable,
    testID: testID
  }, React.createElement(_reactNative.View, {
    style: [styles.content, label ? styles.extended : small ? styles.small : styles.standard],
    pointerEvents: "none"
  }, icon && loading !== true ? React.createElement(IconComponent, {
    source: icon,
    size: 24,
    color: foregroundColor
  }) : null, loading ? React.createElement(_ActivityIndicator.default, {
    size: 18,
    color: foregroundColor
  }) : null, label ? React.createElement(_Text.default, {
    selectable: false,
    style: [styles.label, uppercase && styles.uppercaseLabel, (0, _extends3.default)({
      color: foregroundColor
    }, theme.fonts.medium)]
  }, label) : null)));
};

var styles = _reactNative.StyleSheet.create({
  container: {
    borderRadius: 28,
    elevation: 6
  },
  touchable: {
    borderRadius: 28
  },
  standard: {
    height: 56,
    width: 56
  },
  small: {
    height: 40,
    width: 40
  },
  extended: {
    height: 48,
    paddingHorizontal: 16
  },
  content: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center'
  },
  label: {
    marginHorizontal: 8
  },
  uppercaseLabel: {
    textTransform: 'uppercase'
  },
  disabled: {
    elevation: 0
  }
});

var _default = (0, _theming.withTheme)(FAB);

exports.default = _default;
var FABWithTheme = (0, _theming.withTheme)(FAB);
exports.FAB = FABWithTheme;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLEVBQUUsRUFEQTtBQUVSQyxTQUFLLEVBQUU7QUFGQyxHQVJxQjtBQVkvQjdFLE9BQUssRUFBRTtBQUNMNEUsVUFBTSxFQUFFLEVBREg7QUFFTEMsU0FBSyxFQUFFO0FBRkYsR0Fad0I7QUFnQi9CZCxVQUFRLEVBQUU7QUFDUmEsVUFBTSxFQUFFLEVBREE7QUFFUkUscUJBQWlCLEVBQUU7QUFGWCxHQWhCcUI7QUFvQi9CaEIsU0FBTyxFQUFFO0FBQ1BpQixpQkFBYSxFQUFFLEtBRFI7QUFFUEMsY0FBVSxFQUFFLFFBRkw7QUFHUEMsa0JBQWMsRUFBRTtBQUhULEdBcEJzQjtBQXlCL0IvRSxPQUFLLEVBQUU7QUFDTGdGLG9CQUFnQixFQUFFO0FBRGIsR0F6QndCO0FBNEIvQlosZ0JBQWMsRUFBRTtBQUNkYSxpQkFBYSxFQUFFO0FBREQsR0E1QmU7QUErQi9CM0UsVUFBUSxFQUFFO0FBQ1JtRSxhQUFTLEVBQUU7QUFESDtBQS9CcUIsQ0FBbEJqQyxDQUFmOztlQW9DZSx3QkFBVTNDLEdBQVY7OztBQUdmLElBQU1xRixZQUFZLEdBQUcsd0JBQVVyRixHQUFWLENBQXJCIiwibmFtZXMiOlsiZ2V0Q29udHJhc3RpbmdDb2xvciIsIkZBQiIsInNtYWxsIiwiaWNvbiIsImxhYmVsIiwiYWNjZXNzaWJpbGl0eUxhYmVsIiwiYWNjZXNzaWJpbGl0eVN0YXRlIiwiYW5pbWF0ZWQiLCJjdXN0b21Db2xvciIsImNvbG9yIiwiZGlzYWJsZWQiLCJvblByZXNzIiwib25Mb25nUHJlc3MiLCJ0aGVtZSIsInN0eWxlIiwidmlzaWJsZSIsInVwcGVyY2FzZSIsImxvYWRpbmciLCJ0ZXN0SUQiLCJyZXN0IiwiUmVhY3QiLCJ1c2VSZWYiLCJBbmltYXRlZCIsIlZhbHVlIiwidmlzaWJpbGl0eSIsImN1cnJlbnQiLCJzY2FsZSIsImFuaW1hdGlvbiIsInVzZUVmZmVjdCIsInRpbWluZyIsInRvVmFsdWUiLCJkdXJhdGlvbiIsInVzZU5hdGl2ZURyaXZlciIsInN0YXJ0IiwiSWNvbkNvbXBvbmVudCIsIkNyb3NzRmFkZUljb24iLCJJY29uIiwiZGlzYWJsZWRDb2xvciIsImRhcmsiLCJ3aGl0ZSIsImJsYWNrIiwiYWxwaGEiLCJyZ2IiLCJzdHJpbmciLCJTdHlsZVNoZWV0IiwiZmxhdHRlbiIsImJhY2tncm91bmRDb2xvciIsImNvbG9ycyIsImFjY2VudCIsImZvcmVncm91bmRDb2xvciIsInJpcHBsZUNvbG9yIiwiX1N1cmZhY2UiLCJvcGFjaXR5IiwidHJhbnNmb3JtIiwic3R5bGVzIiwiY29udGFpbmVyIiwicG9pbnRlckV2ZW50cyIsIl9Ub3VjaGFibGVSaXBwbGUiLCJib3JkZXJsZXNzIiwiYWNjZXNzaWJpbGl0eVRyYWl0cyIsImFjY2Vzc2liaWxpdHlDb21wb25lbnRUeXBlIiwiYWNjZXNzaWJpbGl0eVJvbGUiLCJ0b3VjaGFibGUiLCJfcmVhY3ROYXRpdmUiLCJjb250ZW50IiwiZXh0ZW5kZWQiLCJzdGFuZGFyZCIsInNvdXJjZSIsInNpemUiLCJfQWN0aXZpdHlJbmRpY2F0b3IiLCJfVGV4dCIsInNlbGVjdGFibGUiLCJ1cHBlcmNhc2VMYWJlbCIsImZvbnRzIiwibWVkaXVtIiwiY3JlYXRlIiwiYm9yZGVyUmFkaXVzIiwiZWxldmF0aW9uIiwiaGVpZ2h0Iiwid2lkdGgiLCJwYWRkaW5nSG9yaXpvbnRhbCIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJtYXJnaW5Ib3Jpem9udGFsIiwidGV4dFRyYW5zZm9ybSIsIkZBQldpdGhUaGVtZSJdLCJzb3VyY2VzIjpbIkZBQi50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNvbG9yIGZyb20gJ2NvbG9yJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEFuaW1hdGVkLFxuICBWaWV3LFxuICBWaWV3U3R5bGUsXG4gIFN0eWxlU2hlZXQsXG4gIFN0eWxlUHJvcCxcbiAgQWNjZXNzaWJpbGl0eVN0YXRlLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IEFjdGl2aXR5SW5kaWNhdG9yIGZyb20gJy4uL0FjdGl2aXR5SW5kaWNhdG9yJztcbmltcG9ydCBTdXJmYWNlIGZyb20gJy4uL1N1cmZhY2UnO1xuaW1wb3J0IENyb3NzRmFkZUljb24gZnJvbSAnLi4vQ3Jvc3NGYWRlSWNvbic7XG5pbXBvcnQgSWNvbiwgeyBJY29uU291cmNlIH0gZnJvbSAnLi4vSWNvbic7XG5pbXBvcnQgVGV4dCBmcm9tICcuLi9UeXBvZ3JhcGh5L1RleHQnO1xuaW1wb3J0IFRvdWNoYWJsZVJpcHBsZSBmcm9tICcuLi9Ub3VjaGFibGVSaXBwbGUvVG91Y2hhYmxlUmlwcGxlJztcbmltcG9ydCB7IGJsYWNrLCB3aGl0ZSB9IGZyb20gJy4uLy4uL3N0eWxlcy9jb2xvcnMnO1xuaW1wb3J0IHsgd2l0aFRoZW1lIH0gZnJvbSAnLi4vLi4vY29yZS90aGVtaW5nJztcbmltcG9ydCBnZXRDb250cmFzdGluZ0NvbG9yIGZyb20gJy4uLy4uL3V0aWxzL2dldENvbnRyYXN0aW5nQ29sb3InO1xuaW1wb3J0IHR5cGUgeyAkUmVtb3ZlQ2hpbGRyZW4gfSBmcm9tICcuLi8uLi90eXBlcyc7XG5cbmdldENvbnRyYXN0aW5nQ29sb3I7XG5cbnR5cGUgUHJvcHMgPSAkUmVtb3ZlQ2hpbGRyZW48dHlwZW9mIFN1cmZhY2U+ICYge1xuICAvKipcbiAgICogSWNvbiB0byBkaXNwbGF5IGZvciB0aGUgYEZBQmAuXG4gICAqL1xuICBpY29uOiBJY29uU291cmNlO1xuICAvKipcbiAgICogT3B0aW9uYWwgbGFiZWwgZm9yIGV4dGVuZGVkIGBGQUJgLlxuICAgKi9cbiAgbGFiZWw/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBNYWtlIHRoZSBsYWJlbCB0ZXh0IHVwcGVyY2FzZWQuXG4gICAqL1xuICB1cHBlcmNhc2U/OiBib29sZWFuO1xuICAvKipcbiAgICogQWNjZXNzaWJpbGl0eSBsYWJlbCBmb3IgdGhlIEZBQi4gVGhpcyBpcyByZWFkIGJ5IHRoZSBzY3JlZW4gcmVhZGVyIHdoZW4gdGhlIHVzZXIgdGFwcyB0aGUgRkFCLlxuICAgKiBVc2VzIGBsYWJlbGAgYnkgZGVmYXVsdCBpZiBzcGVjaWZpZWQuXG4gICAqL1xuICBhY2Nlc3NpYmlsaXR5TGFiZWw/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBY2Nlc3NpYmlsaXR5IHN0YXRlIGZvciB0aGUgRkFCLiBUaGlzIGlzIHJlYWQgYnkgdGhlIHNjcmVlbiByZWFkZXIgd2hlbiB0aGUgdXNlciB0YXBzIHRoZSBGQUIuXG4gICAqL1xuICBhY2Nlc3NpYmlsaXR5U3RhdGU/OiBBY2Nlc3NpYmlsaXR5U3RhdGU7XG4gIC8qKlxuICAgKiBXaGV0aGVyIGFuIGljb24gY2hhbmdlIGlzIGFuaW1hdGVkLlxuICAgKi9cbiAgYW5pbWF0ZWQ/OiBib29sZWFuO1xuICAvKipcbiAgICogIFdoZXRoZXIgRkFCIGlzIG1pbmktc2l6ZWQsIHVzZWQgdG8gY3JlYXRlIHZpc3VhbCBjb250aW51aXR5IHdpdGggb3RoZXIgZWxlbWVudHMuIFRoaXMgaGFzIG5vIGVmZmVjdCBpZiBgbGFiZWxgIGlzIHNwZWNpZmllZC5cbiAgICovXG4gIHNtYWxsPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEN1c3RvbSBjb2xvciBmb3IgdGhlIGljb24gYW5kIGxhYmVsIG9mIHRoZSBgRkFCYC5cbiAgICovXG4gIGNvbG9yPzogc3RyaW5nO1xuICAvKipcbiAgICogV2hldGhlciBgRkFCYCBpcyBkaXNhYmxlZC4gQSBkaXNhYmxlZCBidXR0b24gaXMgZ3JleWVkIG91dCBhbmQgYG9uUHJlc3NgIGlzIG5vdCBjYWxsZWQgb24gdG91Y2guXG4gICAqL1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIGBGQUJgIGlzIGN1cnJlbnRseSB2aXNpYmxlLlxuICAgKi9cbiAgdmlzaWJsZT86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHNob3cgYSBsb2FkaW5nIGluZGljYXRvci5cbiAgICovXG4gIGxvYWRpbmc/OiBib29sZWFuO1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBwcmVzcy5cbiAgICovXG4gIG9uUHJlc3M/OiAoKSA9PiB2b2lkO1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBsb25nIHByZXNzLlxuICAgKi9cbiAgb25Mb25nUHJlc3M/OiAoKSA9PiB2b2lkO1xuICBzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqL1xuICB0aGVtZTogUmVhY3ROYXRpdmVQYXBlci5UaGVtZTtcbiAgdGVzdElEPzogc3RyaW5nO1xufTtcblxuLyoqXG4gKiBBIGZsb2F0aW5nIGFjdGlvbiBidXR0b24gcmVwcmVzZW50cyB0aGUgcHJpbWFyeSBhY3Rpb24gaW4gYW4gYXBwbGljYXRpb24uXG4gKlxuICogPGRpdiBjbGFzcz1cInNjcmVlbnNob3RzXCI+XG4gKiAgIDxpbWcgc3JjPVwic2NyZWVuc2hvdHMvZmFiLTEucG5nXCIgLz5cbiAqICAgPGltZyBzcmM9XCJzY3JlZW5zaG90cy9mYWItMi5wbmdcIiAvPlxuICogPC9kaXY+XG4gKlxuICogIyMgVXNhZ2VcbiAqIGBgYGpzXG4gKiBpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG4gKiBpbXBvcnQgeyBTdHlsZVNoZWV0IH0gZnJvbSAncmVhY3QtbmF0aXZlJztcbiAqIGltcG9ydCB7IEZBQiB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1wYXBlcic7XG4gKlxuICogY29uc3QgTXlDb21wb25lbnQgPSAoKSA9PiAoXG4gKiAgIDxGQUJcbiAqICAgICBzdHlsZT17c3R5bGVzLmZhYn1cbiAqICAgICBzbWFsbFxuICogICAgIGljb249XCJwbHVzXCJcbiAqICAgICBvblByZXNzPXsoKSA9PiBjb25zb2xlLmxvZygnUHJlc3NlZCcpfVxuICogICAvPlxuICogKTtcbiAqXG4gKiBjb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gKiAgIGZhYjoge1xuICogICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICogICAgIG1hcmdpbjogMTYsXG4gKiAgICAgcmlnaHQ6IDAsXG4gKiAgICAgYm90dG9tOiAwLFxuICogICB9LFxuICogfSlcbiAqXG4gKiBleHBvcnQgZGVmYXVsdCBNeUNvbXBvbmVudDtcbiAqIGBgYFxuICovXG5jb25zdCBGQUIgPSAoe1xuICBzbWFsbCxcbiAgaWNvbixcbiAgbGFiZWwsXG4gIGFjY2Vzc2liaWxpdHlMYWJlbCA9IGxhYmVsLFxuICBhY2Nlc3NpYmlsaXR5U3RhdGUsXG4gIGFuaW1hdGVkID0gdHJ1ZSxcbiAgY29sb3I6IGN1c3RvbUNvbG9yLFxuICBkaXNhYmxlZCxcbiAgb25QcmVzcyxcbiAgb25Mb25nUHJlc3MsXG4gIHRoZW1lLFxuICBzdHlsZSxcbiAgdmlzaWJsZSA9IHRydWUsXG4gIHVwcGVyY2FzZSA9IHRydWUsXG4gIGxvYWRpbmcsXG4gIHRlc3RJRCxcbiAgLi4ucmVzdFxufTogUHJvcHMpID0+IHtcbiAgY29uc3QgeyBjdXJyZW50OiB2aXNpYmlsaXR5IH0gPSBSZWFjdC51c2VSZWY8QW5pbWF0ZWQuVmFsdWU+KFxuICAgIG5ldyBBbmltYXRlZC5WYWx1ZSh2aXNpYmxlID8gMSA6IDApXG4gICk7XG4gIGNvbnN0IHsgc2NhbGUgfSA9IHRoZW1lLmFuaW1hdGlvbjtcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICBBbmltYXRlZC50aW1pbmcodmlzaWJpbGl0eSwge1xuICAgICAgICB0b1ZhbHVlOiAxLFxuICAgICAgICBkdXJhdGlvbjogMjAwICogc2NhbGUsXG4gICAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgIH0pLnN0YXJ0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEFuaW1hdGVkLnRpbWluZyh2aXNpYmlsaXR5LCB7XG4gICAgICAgIHRvVmFsdWU6IDAsXG4gICAgICAgIGR1cmF0aW9uOiAxNTAgKiBzY2FsZSxcbiAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlLFxuICAgICAgfSkuc3RhcnQoKTtcbiAgICB9XG4gIH0sIFt2aXNpYmxlLCBzY2FsZSwgdmlzaWJpbGl0eV0pO1xuXG4gIGNvbnN0IEljb25Db21wb25lbnQgPSBhbmltYXRlZCA/IENyb3NzRmFkZUljb24gOiBJY29uO1xuXG4gIGNvbnN0IGRpc2FibGVkQ29sb3IgPSBjb2xvcih0aGVtZS5kYXJrID8gd2hpdGUgOiBibGFjaylcbiAgICAuYWxwaGEoMC4xMilcbiAgICAucmdiKClcbiAgICAuc3RyaW5nKCk7XG5cbiAgY29uc3Qge1xuICAgIGJhY2tncm91bmRDb2xvciA9IGRpc2FibGVkID8gZGlzYWJsZWRDb2xvciA6IHRoZW1lLmNvbG9ycy5hY2NlbnQsXG4gIH0gPSAoU3R5bGVTaGVldC5mbGF0dGVuKHN0eWxlKSB8fCB7fSkgYXMgVmlld1N0eWxlO1xuXG4gIGxldCBmb3JlZ3JvdW5kQ29sb3I7XG5cbiAgaWYgKHR5cGVvZiBjdXN0b21Db2xvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBmb3JlZ3JvdW5kQ29sb3IgPSBjdXN0b21Db2xvcjtcbiAgfSBlbHNlIGlmIChkaXNhYmxlZCkge1xuICAgIGZvcmVncm91bmRDb2xvciA9IGNvbG9yKHRoZW1lLmRhcmsgPyB3aGl0ZSA6IGJsYWNrKVxuICAgICAgLmFscGhhKDAuMzIpXG4gICAgICAucmdiKClcbiAgICAgIC5zdHJpbmcoKTtcbiAgfSBlbHNlIHtcbiAgICBmb3JlZ3JvdW5kQ29sb3IgPSBnZXRDb250cmFzdGluZ0NvbG9yKFxuICAgICAgYmFja2dyb3VuZENvbG9yLFxuICAgICAgd2hpdGUsXG4gICAgICAncmdiYSgwLCAwLCAwLCAuNTQpJ1xuICAgICk7XG4gIH1cblxuICBjb25zdCByaXBwbGVDb2xvciA9IGNvbG9yKGZvcmVncm91bmRDb2xvcikuYWxwaGEoMC4zMikucmdiKCkuc3RyaW5nKCk7XG5cbiAgcmV0dXJuIChcbiAgICA8U3VyZmFjZVxuICAgICAgey4uLnJlc3R9XG4gICAgICBzdHlsZT17XG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICBvcGFjaXR5OiB2aXNpYmlsaXR5LFxuICAgICAgICAgICAgdHJhbnNmb3JtOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogdmlzaWJpbGl0eSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdHlsZXMuY29udGFpbmVyLFxuICAgICAgICAgIGRpc2FibGVkICYmIHN0eWxlcy5kaXNhYmxlZCxcbiAgICAgICAgICBzdHlsZSxcbiAgICAgICAgXSBhcyBTdHlsZVByb3A8Vmlld1N0eWxlPlxuICAgICAgfVxuICAgICAgcG9pbnRlckV2ZW50cz17dmlzaWJsZSA/ICdhdXRvJyA6ICdub25lJ31cbiAgICA+XG4gICAgICA8VG91Y2hhYmxlUmlwcGxlXG4gICAgICAgIGJvcmRlcmxlc3NcbiAgICAgICAgb25QcmVzcz17b25QcmVzc31cbiAgICAgICAgb25Mb25nUHJlc3M9e29uTG9uZ1ByZXNzfVxuICAgICAgICByaXBwbGVDb2xvcj17cmlwcGxlQ29sb3J9XG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgYWNjZXNzaWJpbGl0eUxhYmVsPXthY2Nlc3NpYmlsaXR5TGFiZWx9XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgV2Uga2VlcCBvbGQgYTExeSBwcm9wcyBmb3IgYmFja3dhcmRzIGNvbXBhdCB3aXRoIG9sZCBSTiB2ZXJzaW9uc1xuICAgICAgICBhY2Nlc3NpYmlsaXR5VHJhaXRzPXtkaXNhYmxlZCA/IFsnYnV0dG9uJywgJ2Rpc2FibGVkJ10gOiAnYnV0dG9uJ31cbiAgICAgICAgYWNjZXNzaWJpbGl0eUNvbXBvbmVudFR5cGU9XCJidXR0b25cIlxuICAgICAgICBhY2Nlc3NpYmlsaXR5Um9sZT1cImJ1dHRvblwiXG4gICAgICAgIGFjY2Vzc2liaWxpdHlTdGF0ZT17eyAuLi5hY2Nlc3NpYmlsaXR5U3RhdGUsIGRpc2FibGVkIH19XG4gICAgICAgIHN0eWxlPXtzdHlsZXMudG91Y2hhYmxlfVxuICAgICAgICB0ZXN0SUQ9e3Rlc3RJRH1cbiAgICAgID5cbiAgICAgICAgPFZpZXdcbiAgICAgICAgICBzdHlsZT17W1xuICAgICAgICAgICAgc3R5bGVzLmNvbnRlbnQsXG4gICAgICAgICAgICBsYWJlbCA/IHN0eWxlcy5leHRlbmRlZCA6IHNtYWxsID8gc3R5bGVzLnNtYWxsIDogc3R5bGVzLnN0YW5kYXJkLFxuICAgICAgICAgIF19XG4gICAgICAgICAgcG9pbnRlckV2ZW50cz1cIm5vbmVcIlxuICAgICAgICA+XG4gICAgICAgICAge2ljb24gJiYgbG9hZGluZyAhPT0gdHJ1ZSA/IChcbiAgICAgICAgICAgIDxJY29uQ29tcG9uZW50IHNvdXJjZT17aWNvbn0gc2l6ZT17MjR9IGNvbG9yPXtmb3JlZ3JvdW5kQ29sb3J9IC8+XG4gICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAge2xvYWRpbmcgPyAoXG4gICAgICAgICAgICA8QWN0aXZpdHlJbmRpY2F0b3Igc2l6ZT17MTh9IGNvbG9yPXtmb3JlZ3JvdW5kQ29sb3J9IC8+XG4gICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAge2xhYmVsID8gKFxuICAgICAgICAgICAgPFRleHRcbiAgICAgICAgICAgICAgc2VsZWN0YWJsZT17ZmFsc2V9XG4gICAgICAgICAgICAgIHN0eWxlPXtbXG4gICAgICAgICAgICAgICAgc3R5bGVzLmxhYmVsLFxuICAgICAgICAgICAgICAgIHVwcGVyY2FzZSAmJiBzdHlsZXMudXBwZXJjYXNlTGFiZWwsXG4gICAgICAgICAgICAgICAgeyBjb2xvcjogZm9yZWdyb3VuZENvbG9yLCAuLi50aGVtZS5mb250cy5tZWRpdW0gfSxcbiAgICAgICAgICAgICAgXX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2xhYmVsfVxuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICA8L1RvdWNoYWJsZVJpcHBsZT5cbiAgICA8L1N1cmZhY2U+XG4gICk7XG59O1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGNvbnRhaW5lcjoge1xuICAgIGJvcmRlclJhZGl1czogMjgsXG4gICAgZWxldmF0aW9uOiA2LFxuICB9LFxuICB0b3VjaGFibGU6IHtcbiAgICBib3JkZXJSYWRpdXM6IDI4LFxuICB9LFxuICBzdGFuZGFyZDoge1xuICAgIGhlaWdodDogNTYsXG4gICAgd2lkdGg6IDU2LFxuICB9LFxuICBzbWFsbDoge1xuICAgIGhlaWdodDogNDAsXG4gICAgd2lkdGg6IDQwLFxuICB9LFxuICBleHRlbmRlZDoge1xuICAgIGhlaWdodDogNDgsXG4gICAgcGFkZGluZ0hvcml6b250YWw6IDE2LFxuICB9LFxuICBjb250ZW50OiB7XG4gICAgZmxleERpcmVjdGlvbjogJ3JvdycsXG4gICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICB9LFxuICBsYWJlbDoge1xuICAgIG1hcmdpbkhvcml6b250YWw6IDgsXG4gIH0sXG4gIHVwcGVyY2FzZUxhYmVsOiB7XG4gICAgdGV4dFRyYW5zZm9ybTogJ3VwcGVyY2FzZScsXG4gIH0sXG4gIGRpc2FibGVkOiB7XG4gICAgZWxldmF0aW9uOiAwLFxuICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHdpdGhUaGVtZShGQUIpO1xuXG4vLyBAY29tcG9uZW50LWRvY3MgaWdub3JlLW5leHQtbGluZVxuY29uc3QgRkFCV2l0aFRoZW1lID0gd2l0aFRoZW1lKEZBQik7XG4vLyBAY29tcG9uZW50LWRvY3MgaWdub3JlLW5leHQtbGluZVxuZXhwb3J0IHsgRkFCV2l0aFRoZW1lIGFzIEZBQiB9O1xuIl19